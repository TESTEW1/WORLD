import discord
from discord.ext import commands, tasks
import random
import os
import asyncio
import sqlite3
from datetime import datetime, timedelta
import json
import time
#
# ================= INTENTS =================
intents = discord.Intents.default()
intents.message_content = True
intents.members = True
intents.guilds = True

bot = commands.Bot(command_prefix="!", intents=intents, help_command=None)

# ================= CONFIG =================
TOKEN = os.getenv("TOKEN")
DB_FILE = "world_csi.db"
CANAL_BETA = "ğŸŒãƒ»mundo-csi"
ADMIN_ID = 769951556388257812


# ================= CLASSES =================
CLASSES = {
    "Guerreiro": {
        "emoji": "âš”ï¸",
        "hp_bonus": 30,
        "atk_bonus": 15,
        "def_bonus": 10,
        "description": "Mestre do combate corpo a corpo, resistente e poderoso."
    },
    "Mago": {
        "emoji": "ğŸ”®",
        "hp_bonus": 10,
        "atk_bonus": 25,
        "def_bonus": 5,
        "description": "Manipulador de energias arcanas, devastador mas frÃ¡gil."
    },
    "Arqueiro": {
        "emoji": "ğŸ¹",
        "hp_bonus": 15,
        "atk_bonus": 20,
        "def_bonus": 8,
        "description": "Atirador preciso, Ã¡gil e letal Ã  distÃ¢ncia."
    },
    "Paladino": {
        "emoji": "ğŸ›¡ï¸",
        "hp_bonus": 25,
        "atk_bonus": 12,
        "def_bonus": 15,
        "description": "Guerreiro sagrado, equilibrado entre ataque e defesa."
    },
    "Assassino": {
        "emoji": "ğŸ—¡ï¸",
        "hp_bonus": 12,
        "atk_bonus": 22,
        "def_bonus": 6,
        "description": "Mestre das sombras, golpes crÃ­ticos devastadores."
    },
    "Necromante": {
        "emoji": "ğŸ’€",
        "hp_bonus": 8,
        "atk_bonus": 23,
        "def_bonus": 7,
        "description": "Senhor dos mortos, drena vida dos inimigos."
    },
    "Berserker": {
        "emoji": "ğŸª“",
        "hp_bonus": 35,
        "atk_bonus": 18,
        "def_bonus": 5,
        "description": "FÃºria incontrolÃ¡vel, quanto menor o HP mais forte."
    },
    "Druida": {
        "emoji": "ğŸŒ¿",
        "hp_bonus": 20,
        "atk_bonus": 14,
        "def_bonus": 12,
        "description": "GuardiÃ£o da natureza, se cura ao coletar recursos."
    },
    "Monge": {
        "emoji": "ğŸ‘Š",
        "hp_bonus": 18,
        "atk_bonus": 16,
        "def_bonus": 14,
        "description": "Mestre das artes marciais, equilibrado e versÃ¡til."
    },
    "Bardo": {
        "emoji": "ğŸµ",
        "hp_bonus": 15,
        "atk_bonus": 10,
        "def_bonus": 10,
        "mana_bonus": 20,
        "description": "MÃºsico encantador, bÃ´nus de XP e sorte aumentada."
    }
}

# ================= RAÃ‡AS =================
RACES = {
    "Humano": {
        "emoji": "ğŸ‘¤",
        "hp_bonus": 20,
        "atk_bonus": 8,
        "def_bonus": 8,
        "xp_mult": 1.10,
        "description": "AdaptÃ¡veis e resilientes. Ganham 10% a mais de XP em todas as aÃ§Ãµes.",
        "passive": "Adaptabilidade: +10% XP ganho permanentemente.",
        "lore": "Os humanos sÃ£o os mais jovens entre as raÃ§as, mas sua ambiÃ§Ã£o supera qualquer limitaÃ§Ã£o natural."
    },
    "Ã‰lfico": {
        "emoji": "ğŸ§",
        "hp_bonus": 12,
        "atk_bonus": 18,
        "def_bonus": 6,
        "xp_mult": 1.05,
        "description": "Ãgeis e precisos, com afinidade natural por magia e arco.",
        "passive": "VisÃ£o Ã‰lfica: +15% chance de crÃ­tico com ataques Ã  distÃ¢ncia.",
        "lore": "Os elfos habitam as florestas eternas, guardiÃµes da memÃ³ria do mundo antes dos humanos."
    },
    "AnÃ£o": {
        "emoji": "âš’ï¸",
        "hp_bonus": 35,
        "atk_bonus": 12,
        "def_bonus": 20,
        "xp_mult": 1.0,
        "description": "Robustos e resistentes, mestres da forja e da batalha em espaÃ§os fechados.",
        "passive": "Pele de Pedra: Reduz o dano recebido em 10%.",
        "lore": "Os anÃµes nasceram das rochas primordiais. Cada golpe deles ecoa como um martelo na bigorna."
    },
    "Orc": {
        "emoji": "ğŸŸ¢",
        "hp_bonus": 40,
        "atk_bonus": 22,
        "def_bonus": 5,
        "xp_mult": 0.95,
        "description": "Brutais e selvagens, forÃ§a fÃ­sica incomparÃ¡vel mas baixa resistÃªncia mÃ¡gica.",
        "passive": "FÃºria Tribal: +20% ATK quando HP < 40%.",
        "lore": "Os orcs vieram das estepes vermelhas. Sua forÃ§a Ã© lendÃ¡ria â€” dizem que um orc raivoso vale dez guerreiros humanos."
    },
    "Anjo": {
        "emoji": "ğŸ‘¼",
        "hp_bonus": 18,
        "atk_bonus": 14,
        "def_bonus": 16,
        "xp_mult": 1.05,
        "description": "Seres celestiais com cura poderosa e proteÃ§Ã£o divina.",
        "passive": "GraÃ§a Divina: Recupera 5% HP ao inÃ­cio de cada turno de batalha.",
        "lore": "Os anjos desceram do Trono Celestial. Poucos escolhem o caminho mortal â€” aqueles que o fazem carregam um propÃ³sito eterno."
    },
    "DemÃ´nio": {
        "emoji": "ğŸ˜ˆ",
        "hp_bonus": 15,
        "atk_bonus": 25,
        "def_bonus": 8,
        "xp_mult": 1.0,
        "description": "Seres infernais com poder destrutivo e corrupÃ§Ã£o.",
        "passive": "EssÃªncia Corrompida: +25% dano de veneno e maldiÃ§Ãµes.",
        "lore": "Os demÃ´nios emergem do Abismo Ardente. Sua presenÃ§a corrÃ³i a realidade ao redor."
    },
    "DragÃ´nico": {
        "emoji": "ğŸ‰",
        "hp_bonus": 30,
        "atk_bonus": 20,
        "def_bonus": 12,
        "xp_mult": 1.0,
        "description": "Descendentes de dragÃµes com escamas resistentes e sopro de fogo.",
        "passive": "Sangue de DragÃ£o: Imune a veneno; +15% dano de fogo.",
        "lore": "Os dragÃ´nicos sÃ£o filhos da alianÃ§a proibida entre humanos e dragÃµes. Carregam o fardo e a glÃ³ria de dois mundos."
    },
    "Vampiro": {
        "emoji": "ğŸ§›",
        "hp_bonus": 10,
        "atk_bonus": 22,
        "def_bonus": 10,
        "xp_mult": 1.05,
        "description": "Imortais sedentes de sangue, drenam vida dos inimigos.",
        "passive": "Sede de Sangue: 15% de chance de drenar 10% do dano causado como HP.",
        "lore": "Os vampiros sÃ£o os primeiros imortais criados pela Lua Negra. Eles lembram de tudo â€” inclusive do fim do mundo anterior."
    },
    "Lobisomem": {
        "emoji": "ğŸº",
        "hp_bonus": 28,
        "atk_bonus": 20,
        "def_bonus": 8,
        "xp_mult": 1.0,
        "description": "Metamorfos furiosos, mais fortes Ã  noite e em batalhas prolongadas.",
        "passive": "Instinto PredatÃ³rio: +10% ATK para cada turno passado em batalha.",
        "lore": "Os lobisomens nasceram da primeira lua cheia apÃ³s a Queda. Vivem entre dois mundos sem pertencer a nenhum."
    },
    "Espectro": {
        "emoji": "ğŸ‘»",
        "hp_bonus": 5,
        "atk_bonus": 28,
        "def_bonus": 4,
        "xp_mult": 1.05,
        "description": "Seres etÃ©reos, difÃ­ceis de acertar e com ataques que atravessam defesas.",
        "passive": "Forma EtÃ©rea: 20% de chance de esquivar completamente de um ataque.",
        "lore": "Os espectros sÃ£o almas que recusaram morrer. Existem em ambos os planos â€” e nÃ£o pertencem a nenhum."
    },
    "Golem": {
        "emoji": "ğŸ—¿",
        "hp_bonus": 60,
        "atk_bonus": 10,
        "def_bonus": 30,
        "xp_mult": 0.90,
        "description": "ConstruÃ§Ãµes animadas com HP e DEF extremos mas baixo ATK.",
        "passive": "Corpo de Pedra: Reduz dano recebido em 20%, mas ganha 10% menos XP.",
        "lore": "Os golems foram criados para serem perfeitos. Alguns desenvolveram consciÃªncia â€” e nenhum de seus criadores sobreviveu para contar."
    },
    "Sereia": {
        "emoji": "ğŸ§œ",
        "hp_bonus": 14,
        "atk_bonus": 16,
        "def_bonus": 10,
        "xp_mult": 1.08,
        "description": "Criaturas aquÃ¡ticas com magias de encantamento e controle.",
        "passive": "Voz Encantada: 25% de chance de encantar o inimigo, fazendo-o perder um turno.",
        "lore": "As sereias governam os oceanos hÃ¡ mais tempo do que existem cidades. Sua voz Ã© a coisa mais perigosa do mundo."
    },
    "TitÃ£": {
        "emoji": "ğŸ”ï¸",
        "hp_bonus": 50,
        "atk_bonus": 25,
        "def_bonus": 15,
        "xp_mult": 0.92,
        "description": "Descendentes dos TitÃ£s primordiais, forÃ§a e tamanho colossal.",
        "passive": "HeranÃ§a TitÃ¢nica: +30% HP mÃ¡ximo ao evoluir de classe.",
        "lore": "Os titÃ£s sÃ£o os filhos dos primeiros seres criados pelo universo. Poucos existem â€” e cada um Ã© uma forÃ§a da natureza."
    },
    "Fada": {
        "emoji": "ğŸ§š",
        "hp_bonus": 8,
        "atk_bonus": 12,
        "def_bonus": 6,
        "xp_mult": 1.15,
        "description": "Seres mÃ¡gicos minÃºsculos com sorte extrema e bÃ´nus de XP elevado.",
        "passive": "BenÃ§Ã£o da Fada: +15% XP e +1 ponto de sorte permanentemente.",
        "lore": "As fadas sÃ£o os espÃ­ritos do primeiro jardim do mundo. Pequenas em tamanho, imensas em poder mÃ¡gico."
    },
    "ElementÃ¡rio": {
        "emoji": "ğŸŒ€",
        "hp_bonus": 20,
        "atk_bonus": 20,
        "def_bonus": 10,
        "xp_mult": 1.0,
        "description": "Seres compostos de elementos puros, mudam de forma em batalha.",
        "passive": "MudanÃ§a Elemental: Alterna entre bÃ´nus de fogo, gelo ou raio a cada batalha.",
        "lore": "Os elementÃ¡rios sÃ£o os pensamentos dos elementos ganhos em forma. NÃ£o nasceram â€” simplesmente sempre existiram."
    },
    "Goblin": {
        "emoji": "ğŸ‘º",
        "hp_bonus": 10,
        "atk_bonus": 15,
        "def_bonus": 5,
        "xp_mult": 1.12,
        "description": "Pequenos e astutos, alta sorte e ganho de moedas aumentado.",
        "passive": "GanÃ¢ncia Goblin: +20% moedas de qualquer fonte.",
        "lore": "Os goblins sÃ£o desprezados por todos â€” e ricos como poucos. Sua astÃºcia transforma sucata em ouro."
    },
    "Gnomo": {
        "emoji": "ğŸ”§",
        "hp_bonus": 12,
        "atk_bonus": 14,
        "def_bonus": 14,
        "xp_mult": 1.05,
        "description": "Inventores natos, equipamentos tÃªm efeito dobrado.",
        "passive": "Engenharia: BÃ´nus de arma e armadura aumentados em 25%.",
        "lore": "Os gnomos construÃ­ram a primeira mÃ¡quina a vapor no Ano 1 da Nova Era. NinguÃ©m sabe o que eles estÃ£o construindo agora."
    },
    "Ciclope": {
        "emoji": "ğŸ‘ï¸",
        "hp_bonus": 45,
        "atk_bonus": 30,
        "def_bonus": 5,
        "xp_mult": 0.95,
        "description": "Um olho que vÃª tudo â€” visÃ£o perfeita garante crÃ­ticos mais frequentes.",
        "passive": "Olho Perfeito: +30% chance de crÃ­tico; crÃ­ticos causam 2x dano.",
        "lore": "Os ciclopes vivem nas montanhas proibidas. Cada um guarda um segredo do universo em seu Ãºnico olho."
    },
    "Sombra": {
        "emoji": "ğŸŒ‘",
        "hp_bonus": 8,
        "atk_bonus": 26,
        "def_bonus": 6,
        "xp_mult": 1.05,
        "description": "Seres das trevas, invisÃ­veis e letais, especializados em ataques furtivos.",
        "passive": "Invisibilidade das Sombras: Primeiro ataque de cada batalha Ã© sempre crÃ­tico.",
        "lore": "As sombras sÃ£o o que sobrou das entidades do Vazio apÃ³s a criaÃ§Ã£o do mundo. Existem onde a luz nÃ£o alcanÃ§a."
    },
    "AnciÃ£o": {
        "emoji": "ğŸ§™",
        "hp_bonus": 15,
        "atk_bonus": 15,
        "def_bonus": 15,
        "xp_mult": 1.20,
        "description": "Seres de sabedoria suprema, ganham muito mais XP e tÃªm acesso a magias proibidas.",
        "passive": "Sabedoria Eterna: +20% XP e desbloqueia habilidades com 5 nÃ­veis de antecedÃªncia.",
        "lore": "Os anciÃµes existem desde antes da memÃ³ria. Cada um passou por mil vidas â€” e ainda buscam respostas."
    },
}

# ================= EVOLUÃ‡ÃƒO DE RAÃ‡A =================
# Cada raÃ§a tem 3 estÃ¡gios de evoluÃ§Ã£o com bÃ´nus em dobro
# Req: level 30 â†’ Evo1, level 70 â†’ Evo2, level 130 â†’ Evo3
RACE_EVOLUTION_TREE = {
    "Humano": [
        {"level": 30,  "name": "Humano Desperto",     "emoji": "ğŸ‘¤âœ¨", "suffix": " Desperto",
         "lore": "Sua ambiÃ§Ã£o ultrapassou os limites do comum. O potencial humano comeÃ§a a se revelar.",
         "hp_bonus": 40, "atk_bonus": 16, "def_bonus": 16},
        {"level": 70,  "name": "Humano Transcendente","emoji": "ğŸ‘¤ğŸ”¥", "suffix": " Transcendente",
         "lore": "VocÃª transcendeu a limitaÃ§Ã£o humana. O seu corpo e mente operam em outro plano.",
         "hp_bonus": 80, "atk_bonus": 32, "def_bonus": 32},
        {"level": 130, "name": "AlÃ©m-Humano",         "emoji": "ğŸ‘¤ğŸ’", "suffix": " AlÃ©m-Humano",
         "lore": "VocÃª nÃ£o Ã© mais humano no sentido comum. VocÃª Ã© o passo seguinte da evoluÃ§Ã£o.",
         "hp_bonus": 160, "atk_bonus": 64, "def_bonus": 64},
    ],
    "Ã‰lfico": [
        {"level": 30,  "name": "Alto Ã‰lfico",         "emoji": "ğŸ§âœ¨", "suffix": " Alto",
         "lore": "A magia Ã©lfica flui com mais pureza em suas veias. Seus olhos enxergam alÃ©m do vÃ©u.",
         "hp_bonus": 24, "atk_bonus": 36, "def_bonus": 12},
        {"level": 70,  "name": "Ã‰lfico Estelar",      "emoji": "ğŸ§â­", "suffix": " Estelar",
         "lore": "As estrelas respondem ao seu chamado. VocÃª se tornou um canal vivo da magia estelar.",
         "hp_bonus": 48, "atk_bonus": 72, "def_bonus": 24},
        {"level": 130, "name": "Ã‰lfico Primordial",   "emoji": "ğŸ§ğŸ‘‘", "suffix": " Primordial",
         "lore": "VocÃª carrega a memÃ³ria do primeiro elfos â€” e o poder que veio com ela.",
         "hp_bonus": 96, "atk_bonus": 144, "def_bonus": 48},
    ],
    "AnÃ£o": [
        {"level": 30,  "name": "AnÃ£o de Ferro",       "emoji": "âš’ï¸ğŸ”©", "suffix": " de Ferro",
         "lore": "Seu corpo endureceu como o metal que forja. Cada golpe que vocÃª absorve te torna mais forte.",
         "hp_bonus": 70, "atk_bonus": 24, "def_bonus": 40},
        {"level": 70,  "name": "AnÃ£o de Adamantio",   "emoji": "âš’ï¸ğŸ’", "suffix": " de Adamantio",
         "lore": "Sua pele rivaliza com o adamantio. Nada penetra sua defesa sem pagar um alto preÃ§o.",
         "hp_bonus": 140, "atk_bonus": 48, "def_bonus": 80},
        {"level": 130, "name": "AnÃ£o Primordial",     "emoji": "âš’ï¸ğŸ‘‘", "suffix": " Primordial",
         "lore": "VocÃª Ã© a rocha viva em forma de anÃ£o. Os prÃ³prios titÃ£s curvam-se ante sua resistÃªncia.",
         "hp_bonus": 280, "atk_bonus": 96, "def_bonus": 160},
    ],
    "Orc": [
        {"level": 30,  "name": "Orc Warchief",        "emoji": "ğŸŸ¢âš”ï¸", "suffix": " Warchief",
         "lore": "Sua fÃºria nÃ£o Ã© cega â€” Ã© calculada. Os outros orcs te seguem sem questionar.",
         "hp_bonus": 80, "atk_bonus": 44, "def_bonus": 10},
        {"level": 70,  "name": "Orc LendÃ¡rio",        "emoji": "ğŸŸ¢ğŸ”¥", "suffix": " LendÃ¡rio",
         "lore": "Lendas sÃ£o contadas sobre sua fÃºria. Inimigos fogem apenas ao ouvir seu nome.",
         "hp_bonus": 160, "atk_bonus": 88, "def_bonus": 20},
        {"level": 130, "name": "Orc Primordial",      "emoji": "ğŸŸ¢ğŸ‘‘", "suffix": " Primordial",
         "lore": "VocÃª Ã© a encarnaÃ§Ã£o da fÃºria tribal. Uma forÃ§a da natureza com forma de guerreiro.",
         "hp_bonus": 320, "atk_bonus": 176, "def_bonus": 40},
    ],
    "Anjo": [
        {"level": 30,  "name": "Anjo GuardiÃ£o",       "emoji": "ğŸ‘¼âœ¨", "suffix": " GuardiÃ£o",
         "lore": "Sua luz divina se intensificou. VocÃª protege nÃ£o apenas a si, mas todos ao redor.",
         "hp_bonus": 36, "atk_bonus": 28, "def_bonus": 32},
        {"level": 70,  "name": "Anjo Celestial",      "emoji": "ğŸ‘¼â­", "suffix": " Celestial",
         "lore": "Suas asas tocam os cÃ©us mais altos. O prÃ³prio divino reconhece seu poder.",
         "hp_bonus": 72, "atk_bonus": 56, "def_bonus": 64},
        {"level": 130, "name": "Arcanjo",             "emoji": "ğŸ‘¼ğŸ‘‘", "suffix": " Arcanjo",
         "lore": "VocÃª ascendeu ao posto de Arcanjo. Poucos mortais chegaram tÃ£o alto â€” ou voltaram para contar.",
         "hp_bonus": 144, "atk_bonus": 112, "def_bonus": 128},
    ],
    "DemÃ´nio": [
        {"level": 30,  "name": "DemÃ´nio Maior",       "emoji": "ğŸ˜ˆğŸ”¥", "suffix": " Maior",
         "lore": "Sua essÃªncia corrompida se intensificou. VocÃª nÃ£o apenas destrÃ³i â€” vocÃª consome.",
         "hp_bonus": 30, "atk_bonus": 50, "def_bonus": 16},
        {"level": 70,  "name": "ArquidemÃ´nio",        "emoji": "ğŸ˜ˆğŸ’€", "suffix": " Arqui",
         "lore": "VocÃª lidera legiÃµes do abismo. Sua simples presenÃ§a corrÃ³i a realidade.",
         "hp_bonus": 60, "atk_bonus": 100, "def_bonus": 32},
        {"level": 130, "name": "DemÃ´nio Primordial",  "emoji": "ğŸ˜ˆğŸ‘‘", "suffix": " Primordial",
         "lore": "VocÃª Ã© uma das primeiras forÃ§as do caos. Anterior ao prÃ³prio tempo.",
         "hp_bonus": 120, "atk_bonus": 200, "def_bonus": 64},
    ],
    "DragÃ´nico": [
        {"level": 30,  "name": "Meio-DragÃ£o",         "emoji": "ğŸ‰âœ¨", "suffix": " Meio-DragÃ£o",
         "lore": "O sangue dracÃ´nico queima mais forte em suas veias. Suas escamas brilham como metal.",
         "hp_bonus": 60, "atk_bonus": 40, "def_bonus": 24},
        {"level": 70,  "name": "DragÃ´nico Puro",      "emoji": "ğŸ‰ğŸ”¥", "suffix": " Puro",
         "lore": "A heranÃ§a dracÃ´nica se revelou por completo. VocÃª Ã© mais dragÃ£o do que humano agora.",
         "hp_bonus": 120, "atk_bonus": 80, "def_bonus": 48},
        {"level": 130, "name": "DragÃ£o Encarnado",    "emoji": "ğŸ‰ğŸ‘‘", "suffix": " Encarnado",
         "lore": "VocÃª Ã© a reencarnaÃ§Ã£o de um dragÃ£o anciÃ£o em forma humanoide. Lendas te tratam como divindade.",
         "hp_bonus": 240, "atk_bonus": 160, "def_bonus": 96},
    ],
    "Vampiro": [
        {"level": 30,  "name": "Vampiro Antigo",      "emoji": "ğŸ§›ğŸŒ™", "suffix": " Antigo",
         "lore": "SÃ©culos de existÃªncia te tornaram mais refinado. Seu toque drena mais do que sangue.",
         "hp_bonus": 20, "atk_bonus": 44, "def_bonus": 20},
        {"level": 70,  "name": "Vampiro Nobre",       "emoji": "ğŸ§›ğŸ‘‘", "suffix": " Nobre",
         "lore": "VocÃª lidera a nobreza vampÃ­rica. Sua sede transforma batalhas em banquetes.",
         "hp_bonus": 40, "atk_bonus": 88, "def_bonus": 40},
        {"level": 130, "name": "Vampiro Primordial",  "emoji": "ğŸ§›ğŸ’", "suffix": " Primordial",
         "lore": "VocÃª existia antes da Lua Negra. Os outros vampiros sÃ£o crianÃ§as perto de vocÃª.",
         "hp_bonus": 80, "atk_bonus": 176, "def_bonus": 80},
    ],
    "Lobisomem": [
        {"level": 30,  "name": "Lobisomem Alfa",      "emoji": "ğŸºâš¡", "suffix": " Alfa",
         "lore": "Sua matilha te reconhece como lÃ­der. A lua cheia te obedece.",
         "hp_bonus": 56, "atk_bonus": 40, "def_bonus": 16},
        {"level": 70,  "name": "Lobisomem LendÃ¡rio",  "emoji": "ğŸºğŸ”¥", "suffix": " LendÃ¡rio",
         "lore": "Lendas de aldeias inteiras falam do lobo que nunca morre. Esse lobo Ã© vocÃª.",
         "hp_bonus": 112, "atk_bonus": 80, "def_bonus": 32},
        {"level": 130, "name": "Lobisomem Primordial","emoji": "ğŸºğŸ‘‘", "suffix": " Primordial",
         "lore": "VocÃª Ã© o primeiro â€” o lobo antes de todos os lobos. A prÃ³pria lua te teme.",
         "hp_bonus": 224, "atk_bonus": 160, "def_bonus": 64},
    ],
    "Espectro": [
        {"level": 30,  "name": "Espectro Sombrio",    "emoji": "ğŸ‘»ğŸŒ‘", "suffix": " Sombrio",
         "lore": "VocÃª dominou a fronteira entre os planos. Seus ataques atravessam atÃ© armaduras mÃ¡gicas.",
         "hp_bonus": 10, "atk_bonus": 56, "def_bonus": 8},
        {"level": 70,  "name": "Espectro Eterno",     "emoji": "ğŸ‘»ğŸ’€", "suffix": " Eterno",
         "lore": "Nem o tempo nem a morte te alcanÃ§am mais. VocÃª simplesmente existe â€” para sempre.",
         "hp_bonus": 20, "atk_bonus": 112, "def_bonus": 16},
        {"level": 130, "name": "Espectro Primordial", "emoji": "ğŸ‘»ğŸ‘‘", "suffix": " Primordial",
         "lore": "VocÃª Ã© o eco de uma era anterior ao mundo. Sua existÃªncia dobra a realidade.",
         "hp_bonus": 40, "atk_bonus": 224, "def_bonus": 32},
    ],
    "Golem": [
        {"level": 30,  "name": "Golem de AÃ§o",        "emoji": "ğŸ—¿âš™ï¸", "suffix": " de AÃ§o",
         "lore": "VocÃª absorveu metal puro em sua estrutura. Agora vocÃª Ã© uma fortaleza ambulante.",
         "hp_bonus": 120, "atk_bonus": 20, "def_bonus": 60},
        {"level": 70,  "name": "Golem Arcano",        "emoji": "ğŸ—¿ğŸ”®", "suffix": " Arcano",
         "lore": "Runa mÃ¡gicas foram gravadas em sua pedra. VocÃª conduz magia atravÃ©s de seu prÃ³prio corpo.",
         "hp_bonus": 240, "atk_bonus": 40, "def_bonus": 120},
        {"level": 130, "name": "Golem Primordial",    "emoji": "ğŸ—¿ğŸ‘‘", "suffix": " Primordial",
         "lore": "VocÃª Ã© a pedra mais antiga do mundo. Nem deuses conseguem arranhar sua superfÃ­cie.",
         "hp_bonus": 480, "atk_bonus": 80, "def_bonus": 240},
    ],
    "Sereia": [
        {"level": 30,  "name": "Sereia das Profundezas","emoji": "ğŸ§œğŸŒŠ", "suffix": " das Profundezas",
         "lore": "VocÃª dominou as correntes abissais. Sua voz ressoa em todos os oceanos.",
         "hp_bonus": 28, "atk_bonus": 32, "def_bonus": 20},
        {"level": 70,  "name": "Rainha do Mar",       "emoji": "ğŸ§œğŸ‘‘", "suffix": " Rainha",
         "lore": "Os oceanos te obedecem. Criaturas marinhas caem de joelhos ante sua presenÃ§a.",
         "hp_bonus": 56, "atk_bonus": 64, "def_bonus": 40},
        {"level": 130, "name": "Sereia Primordial",   "emoji": "ğŸ§œğŸ’", "suffix": " Primordial",
         "lore": "VocÃª Ã© mais velha que os oceanos. O mar nÃ£o te criou â€” vocÃª criou o mar.",
         "hp_bonus": 112, "atk_bonus": 128, "def_bonus": 80},
    ],
    "TitÃ£": [
        {"level": 30,  "name": "TitÃ£ Guerreiro",      "emoji": "ğŸ”ï¸âš”ï¸", "suffix": " Guerreiro",
         "lore": "Seu tamanho e forÃ§a atingiram proporcoes mÃ­ticas. ExÃ©rcitos inteiros fogem.",
         "hp_bonus": 100, "atk_bonus": 50, "def_bonus": 30},
        {"level": 70,  "name": "TitÃ£ AnciÃ£o",         "emoji": "ğŸ”ï¸ğŸŒŸ", "suffix": " AnciÃ£o",
         "lore": "VocÃª viveu mais do que civilizaÃ§Ãµes. Sua sabedoria e forÃ§a rivalizam com deuses.",
         "hp_bonus": 200, "atk_bonus": 100, "def_bonus": 60},
        {"level": 130, "name": "TitÃ£ Primordial",     "emoji": "ğŸ”ï¸ğŸ‘‘", "suffix": " Primordial",
         "lore": "VocÃª Ã© um dos primeiros seres criados pelo universo. Sua existÃªncia move montanhas.",
         "hp_bonus": 400, "atk_bonus": 200, "def_bonus": 120},
    ],
    "Fada": [
        {"level": 30,  "name": "Fada Encantada",      "emoji": "ğŸ§šâœ¨", "suffix": " Encantada",
         "lore": "Sua magia se tornou impossÃ­vel de ignorar. VocÃª distorce a sorte ao seu redor.",
         "hp_bonus": 16, "atk_bonus": 24, "def_bonus": 12},
        {"level": 70,  "name": "Fada MÃ­stica",        "emoji": "ğŸ§šğŸŒŸ", "suffix": " MÃ­stica",
         "lore": "VocÃª Ã© uma anomalia da sorte. Coisas impossÃ­veis acontecem ao seu favor.",
         "hp_bonus": 32, "atk_bonus": 48, "def_bonus": 24},
        {"level": 130, "name": "Rainha das Fadas",    "emoji": "ğŸ§šğŸ‘‘", "suffix": " Rainha",
         "lore": "VocÃª governa o primeiro jardim do mundo. Toda a magia de sorte emana de vocÃª.",
         "hp_bonus": 64, "atk_bonus": 96, "def_bonus": 48},
    ],
    "ElementÃ¡rio": [
        {"level": 30,  "name": "ElementÃ¡rio Puro",    "emoji": "ğŸŒ€ğŸ”¥", "suffix": " Puro",
         "lore": "VocÃª nÃ£o alterna mais â€” vocÃª domina todos os elementos simultaneamente.",
         "hp_bonus": 40, "atk_bonus": 40, "def_bonus": 20},
        {"level": 70,  "name": "ElementÃ¡rio Mestre",  "emoji": "ğŸŒ€âš¡", "suffix": " Mestre",
         "lore": "Os elementos te obedecem. Fogo, gelo e raio respondem ao seu pensamento.",
         "hp_bonus": 80, "atk_bonus": 80, "def_bonus": 40},
        {"level": 130, "name": "ElementÃ¡rio Primordial","emoji": "ğŸŒ€ğŸ‘‘", "suffix": " Primordial",
         "lore": "VocÃª Ã‰ os elementos. VocÃª nÃ£o usa magia â€” vocÃª Ã© a magia em sua forma mais pura.",
         "hp_bonus": 160, "atk_bonus": 160, "def_bonus": 80},
    ],
    "Goblin": [
        {"level": 30,  "name": "Goblin Mestre",       "emoji": "ğŸ‘ºğŸ’°", "suffix": " Mestre",
         "lore": "Sua astÃºcia ultrapassou qualquer goblin comum. O ouro te encontra antes de vocÃª o procurar.",
         "hp_bonus": 20, "atk_bonus": 30, "def_bonus": 10},
        {"level": 70,  "name": "Goblin LendÃ¡rio",     "emoji": "ğŸ‘ºğŸ‘‘", "suffix": " LendÃ¡rio",
         "lore": "Sua riqueza e influÃªncia tornaram-se lendÃ¡rias. Reinos inteiros devem favores a vocÃª.",
         "hp_bonus": 40, "atk_bonus": 60, "def_bonus": 20},
        {"level": 130, "name": "Rei Goblin",          "emoji": "ğŸ‘ºğŸ’", "suffix": " Rei",
         "lore": "VocÃª Ã© o rei absoluto dos goblins. Sua ganÃ¢ncia moldou impÃ©rios.",
         "hp_bonus": 80, "atk_bonus": 120, "def_bonus": 40},
    ],
    "Gnomo": [
        {"level": 30,  "name": "Gnomo Inventor",      "emoji": "ğŸ”§âš™ï¸", "suffix": " Inventor",
         "lore": "Suas criaÃ§Ãµes desafiam as leis da fÃ­sica. Engenharia virou arte em suas mÃ£os.",
         "hp_bonus": 24, "atk_bonus": 28, "def_bonus": 28},
        {"level": 70,  "name": "Gnomo Arcano",        "emoji": "ğŸ”§ğŸ”®", "suffix": " Arcano",
         "lore": "VocÃª fundiu magia e engenharia. Suas mÃ¡quinas funcionam com energia pura do cosmos.",
         "hp_bonus": 48, "atk_bonus": 56, "def_bonus": 56},
        {"level": 130, "name": "Grande Gnomo",        "emoji": "ğŸ”§ğŸ‘‘", "suffix": " Grande",
         "lore": "VocÃª Ã© a mente mais brilhante jÃ¡ criada. Suas invenÃ§Ãµes moldaram o curso da histÃ³ria.",
         "hp_bonus": 96, "atk_bonus": 112, "def_bonus": 112},
    ],
    "Ciclope": [
        {"level": 30,  "name": "Ciclope Guerreiro",   "emoji": "ğŸ‘ï¸âš”ï¸", "suffix": " Guerreiro",
         "lore": "Seu olho Ãºnico vÃª atravÃ©s de ilusÃµes, armaduras e atÃ© o tempo. Nada escapa.",
         "hp_bonus": 90, "atk_bonus": 60, "def_bonus": 10},
        {"level": 70,  "name": "Ciclope AnciÃ£o",      "emoji": "ğŸ‘ï¸ğŸŒŸ", "suffix": " AnciÃ£o",
         "lore": "VocÃª guarda dois segredos do universo agora. Seu olho vÃª coisas que nÃ£o deveriam existir.",
         "hp_bonus": 180, "atk_bonus": 120, "def_bonus": 20},
        {"level": 130, "name": "Ciclope Primordial",  "emoji": "ğŸ‘ï¸ğŸ‘‘", "suffix": " Primordial",
         "lore": "VocÃª guarda o segredo da criaÃ§Ã£o. Seu olho viu o nascimento do universo.",
         "hp_bonus": 360, "atk_bonus": 240, "def_bonus": 40},
    ],
    "Sombra": [
        {"level": 30,  "name": "Sombra Viva",         "emoji": "ğŸŒ‘âš¡", "suffix": " Viva",
         "lore": "VocÃª nÃ£o habita as sombras â€” vocÃª Ã© a sombra. Luz alguma te revela.",
         "hp_bonus": 16, "atk_bonus": 52, "def_bonus": 12},
        {"level": 70,  "name": "Sombra Eterna",       "emoji": "ğŸŒ‘ğŸ’€", "suffix": " Eterna",
         "lore": "VocÃª existirÃ¡ enquanto houver ausÃªncia de luz. O vazio te alimenta.",
         "hp_bonus": 32, "atk_bonus": 104, "def_bonus": 24},
        {"level": 130, "name": "Sombra Primordial",   "emoji": "ğŸŒ‘ğŸ‘‘", "suffix": " Primordial",
         "lore": "VocÃª era a escuridÃ£o antes do primeiro raio de luz. VocÃª viu o universo nascer â€” do seu interior.",
         "hp_bonus": 64, "atk_bonus": 208, "def_bonus": 48},
    ],
    "AnciÃ£o": [
        {"level": 30,  "name": "AnciÃ£o SÃ¡bio",        "emoji": "ğŸ§™ğŸ“š", "suffix": " SÃ¡bio",
         "lore": "Sua sabedoria transcendeu o aprendizado. VocÃª nÃ£o busca conhecimento â€” ele te encontra.",
         "hp_bonus": 30, "atk_bonus": 30, "def_bonus": 30},
        {"level": 70,  "name": "AnciÃ£o Eterno",       "emoji": "ğŸ§™â­", "suffix": " Eterno",
         "lore": "VocÃª viveu mais vidas do que a maioria existiu. Cada ciclo te tornou mais poderoso.",
         "hp_bonus": 60, "atk_bonus": 60, "def_bonus": 60},
        {"level": 130, "name": "AnciÃ£o Primordial",   "emoji": "ğŸ§™ğŸ‘‘", "suffix": " Primordial",
         "lore": "VocÃª Ã© mais velho que o prÃ³prio universo. Sua existÃªncia Ã© a resposta que todos buscam.",
         "hp_bonus": 120, "atk_bonus": 120, "def_bonus": 120},
    ],
}

def get_race_evolution_stage(race_name, player_level):
    """Retorna o estÃ¡gio de evoluÃ§Ã£o atual da raÃ§a (0=base, 1/2/3=evoluÃ­da)"""
    evos = RACE_EVOLUTION_TREE.get(race_name, [])
    stage = 0
    for i, evo in enumerate(evos):
        if player_level >= evo["level"]:
            stage = i + 1
    return stage

def get_race_current_data(race_name, stage):
    """Retorna os dados da raÃ§a no estÃ¡gio informado"""
    if stage == 0:
        return RACES.get(race_name)
    evos = RACE_EVOLUTION_TREE.get(race_name, [])
    if stage <= len(evos):
        evo = evos[stage - 1]
        base = RACES.get(race_name, {})
        return {
            **base,
            "name": evo["name"],
            "emoji": evo["emoji"],
            "hp_bonus": evo["hp_bonus"],
            "atk_bonus": evo["atk_bonus"],
            "def_bonus": evo["def_bonus"],
            "lore": evo["lore"],
        }
    return RACES.get(race_name)


# ================= 20 NOVAS CLASSES =================
NEW_CLASSES = {
    "Cavaleiro das Sombras": {
        "emoji": "ğŸŒ‘",
        "hp_bonus": 28,
        "atk_bonus": 20,
        "def_bonus": 12,
        "description": "Guerreiro das trevas que combina forÃ§a bruta e magia sombria.",
        "race_affinity": ["Sombra", "Vampiro", "DemÃ´nio"],
    },
    "Invocador": {
        "emoji": "ğŸŒ€",
        "hp_bonus": 12,
        "atk_bonus": 22,
        "def_bonus": 8,
        "description": "Conjura criaturas de outros planos para lutar em seu lugar.",
        "race_affinity": ["ElementÃ¡rio", "Anjo", "Espectro"],
    },
    "Runesmith": {
        "emoji": "ğŸ”£",
        "hp_bonus": 16,
        "atk_bonus": 18,
        "def_bonus": 16,
        "description": "Grava runas em armas e armaduras para potencializar seus efeitos.",
        "race_affinity": ["Gnomo", "AnÃ£o", "Humano"],
    },
    "Cazador de Recompensas": {
        "emoji": "ğŸ¯",
        "hp_bonus": 18,
        "atk_bonus": 24,
        "def_bonus": 8,
        "description": "Especialista em rastrear e eliminar alvos especÃ­ficos.",
        "race_affinity": ["Humano", "Ã‰lfico", "Goblin"],
    },
    "XamÃ£": {
        "emoji": "ğŸª¶",
        "hp_bonus": 20,
        "atk_bonus": 14,
        "def_bonus": 14,
        "description": "Canaliza os espÃ­ritos ancestrais para curar, amaldiÃ§oar e destruir.",
        "race_affinity": ["Lobisomem", "Orc", "TitÃ£"],
    },
    "Tempesteiro": {
        "emoji": "â›ˆï¸",
        "hp_bonus": 12,
        "atk_bonus": 28,
        "def_bonus": 5,
        "description": "Controla raios e tempestades com poder devastador.",
        "race_affinity": ["ElementÃ¡rio", "DragÃ´nico", "TitÃ£"],
    },
    "Ilusionista": {
        "emoji": "ğŸª„",
        "hp_bonus": 10,
        "atk_bonus": 20,
        "def_bonus": 10,
        "description": "Cria ilusÃµes para confundir e destruir inimigos.",
        "race_affinity": ["Fada", "Espectro", "Sereia"],
    },
    "Alquimista": {
        "emoji": "âš—ï¸",
        "hp_bonus": 14,
        "atk_bonus": 16,
        "def_bonus": 12,
        "description": "Transforma elementos em poderosas poÃ§Ãµes e bombas.",
        "race_affinity": ["Gnomo", "Goblin", "Humano"],
    },
    "GuardiÃ£o do Abismo": {
        "emoji": "â™¾ï¸",
        "hp_bonus": 22,
        "atk_bonus": 22,
        "def_bonus": 10,
        "description": "Canaliza o poder do Abismo Arcano para aniquilar inimigos.",
        "race_affinity": ["Espectro", "DemÃ´nio", "Sombra"],
    },
    "DanÃ§arino da Morte": {
        "emoji": "ğŸ’ƒ",
        "hp_bonus": 10,
        "atk_bonus": 26,
        "def_bonus": 6,
        "description": "Combina danÃ§a e lÃ¢minas em movimentos letais e imprevisÃ­veis.",
        "race_affinity": ["Vampiro", "Sombra", "Ã‰lfico"],
    },
    "OrÃ¡culo": {
        "emoji": "ğŸ”®",
        "hp_bonus": 8,
        "atk_bonus": 18,
        "def_bonus": 8,
        "description": "VÃª o futuro e manipula o destino dos inimigos.",
        "race_affinity": ["AnciÃ£o", "Fada", "Anjo"],
    },
    "Colossus": {
        "emoji": "ğŸ—¿",
        "hp_bonus": 55,
        "atk_bonus": 18,
        "def_bonus": 25,
        "description": "Corpo transformado em fortaleza viva â€” quase indestrutÃ­vel.",
        "race_affinity": ["Golem", "TitÃ£", "Orc"],
    },
    "Devorador de Almas": {
        "emoji": "ğŸ’«",
        "hp_bonus": 14,
        "atk_bonus": 30,
        "def_bonus": 5,
        "description": "Consome as almas dos inimigos para ganhar poder crescente.",
        "race_affinity": ["DemÃ´nio", "Vampiro", "Lobisomem"],
    },
    "Arauto Celestial": {
        "emoji": "âœ¨",
        "hp_bonus": 20,
        "atk_bonus": 16,
        "def_bonus": 18,
        "description": "Mensageiro dos deuses, combina cura divina e golpes sagrados.",
        "race_affinity": ["Anjo", "Humano", "Ã‰lfico"],
    },
    "LanÃ§ador de Venenos": {
        "emoji": "â˜ ï¸",
        "hp_bonus": 12,
        "atk_bonus": 22,
        "def_bonus": 8,
        "description": "Especialista em venenos, doenÃ§as e debuffs devastadores.",
        "race_affinity": ["Goblin", "Vampiro", "DragÃ´nico"],
    },
    "Gladiador": {
        "emoji": "ğŸŸï¸",
        "hp_bonus": 32,
        "atk_bonus": 22,
        "def_bonus": 8,
        "description": "Combatente de arena, quanto mais mata mais forte fica.",
        "race_affinity": ["Orc", "Humano", "Ciclope"],
    },
    "Mestre das Correntes": {
        "emoji": "â›“ï¸",
        "hp_bonus": 20,
        "atk_bonus": 20,
        "def_bonus": 12,
        "description": "Usa correntes de energia para prender e devastar inimigos.",
        "race_affinity": ["Golem", "AnÃ£o", "TitÃ£"],
    },
    "Profeta da DestruiÃ§Ã£o": {
        "emoji": "ğŸ“¯",
        "hp_bonus": 10,
        "atk_bonus": 25,
        "def_bonus": 8,
        "description": "Prediz e causa calamidades. Seus feitiÃ§os se tornam realidade.",
        "race_affinity": ["AnciÃ£o", "DemÃ´nio", "Espectro"],
    },
    "Ferreiro de Guerra": {
        "emoji": "ğŸ”¨",
        "hp_bonus": 25,
        "atk_bonus": 20,
        "def_bonus": 20,
        "description": "Forja equipamentos durante batalha, melhorando armas e armaduras em tempo real.",
        "race_affinity": ["AnÃ£o", "Gnomo", "Golem"],
    },
    "Dragonlancer": {
        "emoji": "ğŸ²",
        "hp_bonus": 24,
        "atk_bonus": 28,
        "def_bonus": 10,
        "description": "Cavaleiro dracÃ´nico que monta dragÃµes e usa lanÃ§a de fogo.",
        "race_affinity": ["DragÃ´nico", "Humano", "TitÃ£"],
    },
}

# Merge NEW_CLASSES into CLASSES
CLASSES.update(NEW_CLASSES)

# ================= SISTEMA DE RAÃ‡AS =================
# Adicionado ao perfil do jogador como player["race"]

# ================= ÃRVORES DE EVOLUÃ‡ÃƒO DE CLASSE =================
# Cada classe pode evoluir nos nÃ­veis 40, 80, 120 e 160
# Ao evoluir, o jogador escolhe uma especializaÃ§Ã£o
CLASS_EVOLUTION_TREE = {
    # â”€â”€ CLASSES ORIGINAIS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    "Guerreiro": {
        40:  {"name": "Guerreiro Elite",     "spec_options": ["CampeÃ£o", "GuardiÃ£o InabalÃ¡vel"]},
        80:  {"name": "Lorde da Guerra",     "spec_options": ["Berserker Sagrado", "Comandante TÃ¡tico"]},
        120: {"name": "Titan da Batalha",    "spec_options": ["Avatar da Guerra", "Senhor dos ExÃ©rcitos"]},
        160: {"name": "Imperador Guerreiro", "spec_options": ["Deus da Guerra Mortal", "Lenda Imortal"]},
        200: {"name": "Avatar da Guerra Transcendental", "spec_options": ["Conquistador dos Planos", "Devastador de DimensÃµes"]},
        400: {"name": "ForÃ§a Dimensional Absoluta", "spec_options": ["Guerreiro do Vazio", "TitÃ£ do Multiverso"]},
        500: {"name": "Guerreiro do Plano Absoluto", "spec_options": ["O Ãšltimo Guerreiro", "ForÃ§a Primordial Final"]},
    },
    "Mago": {
        40:  {"name": "Arcano Iniciado",   "spec_options": ["Piromante", "Criomante"]},
        80:  {"name": "Arquimago",         "spec_options": ["Mago do Caos", "Conjurador Estelar"]},
        120: {"name": "SÃ¡bio Eterno",      "spec_options": ["Deus Arcano", "Tecedor da Realidade"]},
        160: {"name": "Transcendente",     "spec_options": ["Onisciente do Cosmos", "Destruidor de Planos"]},
        200: {"name": "Arquiteto da Realidade", "spec_options": ["Tejedor do Cosmos", "Mago Primordial"]},
        400: {"name": "ConsciÃªncia Dimensional", "spec_options": ["Mente do Multiverso", "Deus da Magia Absoluta"]},
        500: {"name": "A Magia em Pessoa", "spec_options": ["Origem de Todo FeitiÃ§o", "Magia do Plano Absoluto"]},
    },
    "Arqueiro": {
        40:  {"name": "Atirador de Elite",   "spec_options": ["CaÃ§ador Sombrio", "Arqueiro da Tempestade"]},
        80:  {"name": "Mestre dos Arcos",    "spec_options": ["Atirador Fantasma", "Arqueiro Divino"]},
        120: {"name": "Lenda do Arco",       "spec_options": ["CaÃ§ador de Deuses", "Vendaval de Flechas"]},
        160: {"name": "Flecha Primordial",   "spec_options": ["Atirador do Fim dos Tempos", "Sombra Alada"]},
        200: {"name": "CaÃ§ador AlÃ©m dos Planos", "spec_options": ["Atirador Dimensional", "CaÃ§ador do Vazio"]},
        400: {"name": "Flecha do Cosmos", "spec_options": ["Tiro Que Perfura DimensÃµes", "Arqueiro do Multiverso"]},
        500: {"name": "Flecha do Plano Absoluto", "spec_options": ["O Ãšltimo Disparo", "Extintor de Mundos Ã  DistÃ¢ncia"]},
    },
    "Paladino": {
        40:  {"name": "Cavaleiro Sagrado",   "spec_options": ["Cruzado", "Sentinela Divina"]},
        80:  {"name": "Arauto da Luz",       "spec_options": ["CampeÃ£o Celestial", "Protetor Eterno"]},
        120: {"name": "Lorde Sagrado",       "spec_options": ["Avatar Divino", "Juiz dos Deuses"]},
        160: {"name": "Divindade Encarnada", "spec_options": ["Santo Guerreiro", "Escudo do Universo"]},
        200: {"name": "CampeÃ£o Transcendente", "spec_options": ["Paladino da Luz Absoluta", "GuardiÃ£o dos Planos"]},
        400: {"name": "Divindade Sagrada Dimensional", "spec_options": ["Escudo do Cosmos", "Paladino do Multiverso"]},
        500: {"name": "Santo do Plano Absoluto", "spec_options": ["Protetor da CriaÃ§Ã£o Final", "Escudo do Universo Absoluto"]},
    },
    "Assassino": {
        40:  {"name": "Phantom Blade",     "spec_options": ["Mestre das Sombras", "Envenenador Letal"]},
        80:  {"name": "Sombra Absoluta",   "spec_options": ["CaÃ§ador Dimensional", "Executor Supremo"]},
        120: {"name": "Espectro Mortal",   "spec_options": ["Sombra do Abismo", "DanÃ§arino da Morte Noir"]},
        160: {"name": "Void Walker",       "spec_options": ["Ceifador do Vazio", "Aniquilador Silencioso"]},
        200: {"name": "Sombra Transcendental", "spec_options": ["Ceifador dos Planos", "Assassino do Cosmos"]},
        400: {"name": "Executor Dimensional", "spec_options": ["Morte que Atravessa DimensÃµes", "Sombra do Multiverso"]},
        500: {"name": "ExtinÃ§Ã£o Silenciosa Absoluta", "spec_options": ["O Golpe Final", "Aniquilador do Plano Absoluto"]},
    },
    "Necromante": {
        40:  {"name": "Mestre dos Mortos",   "spec_options": ["Invocador Sombrio", "Lich Aprendiz"]},
        80:  {"name": "Lorde dos NÃ£o-Mortos","spec_options": ["Lich Verdadeiro", "Senhor das Almas"]},
        120: {"name": "Soberano Eterno",     "spec_options": ["Deus Morto-Vivo", "Destruidor de Almas"]},
        160: {"name": "Lich Primordial",     "spec_options": ["Rei da Morte Eterna", "Corrompedor do Cosmos"]},
        200: {"name": "Senhor da Morte Transcendente", "spec_options": ["NecrÃ´mante dos Planos", "Deus dos Mortos-Vivos CÃ³smicos"]},
        400: {"name": "Morte Dimensional", "spec_options": ["Senhor dos Mortos do Multiverso", "Corruptor de DimensÃµes"]},
        500: {"name": "A Morte Absoluta", "spec_options": ["Fim de Toda Vida", "Necromante do Plano Final"]},
    },
    "Berserker": {
        40:  {"name": "BÃ¡rbaro Sangrento",   "spec_options": ["Carnificina", "Orc-Sangue"]},
        80:  {"name": "Destruidor",          "spec_options": ["Avatar da FÃºria", "Berserker Divino"]},
        120: {"name": "Flagelo Vivo",        "spec_options": ["Destruidor de Mundos", "Cataclismo Ambulante"]},
        160: {"name": "FÃºria Primordial",    "spec_options": ["Ira dos TitÃ£s", "Apocalipse em Forma"]},
        200: {"name": "FÃºria Transcendente", "spec_options": ["Devastador dos Planos", "Colosso da FÃºria CÃ³smica"]},
        400: {"name": "Apocalipse Dimensional", "spec_options": ["Raiva do Multiverso", "Destruidor de DimensÃµes"]},
        500: {"name": "Ira do Plano Absoluto", "spec_options": ["Raiva que DestrÃ³i Tudo", "Calamidade Final"]},
    },
    "Druida": {
        40:  {"name": "GuardiÃ£o da Floresta","spec_options": ["Metamorfo", "Druida Lunar"]},
        80:  {"name": "AnciÃ£o da Natureza",  "spec_options": ["Druida do Caos", "GuardiÃ£o Primordial"]},
        120: {"name": "EspÃ­rito da Terra",   "spec_options": ["Avatar da Natureza", "Ent Vivente"]},
        160: {"name": "Gaia Encarnada",      "spec_options": ["A PrÃ³pria Floresta", "Senhor das Bestas Eternas"]},
        200: {"name": "Natureza Transcendente", "spec_options": ["GuardiÃ£o dos Planos", "EspÃ­rito da CriaÃ§Ã£o"]},
        400: {"name": "Alma Dimensional da Terra", "spec_options": ["Natureza do Cosmos", "Gaia Dimensional"]},
        500: {"name": "A Natureza Primordial Absoluta", "spec_options": ["CriaÃ§Ã£o que Sustenta Tudo", "Druida do Plano Final"]},
    },
    "Monge": {
        40:  {"name": "Mestre do Ki",         "spec_options": ["Punho de AÃ§o", "Monge do Vento"]},
        80:  {"name": "Mestre Supremo",       "spec_options": ["Monge Celestial", "FÃºria Controlada"]},
        120: {"name": "Iluminado",            "spec_options": ["Monge Transcendente", "DanÃ§arino do Ki"]},
        160: {"name": "AlÃ©m do Mortal",       "spec_options": ["Ki Primordial", "Vazio em Movimento"]},
        200: {"name": "TranscendÃªncia do Ki", "spec_options": ["Monge dos Planos", "Ki CÃ³smico"]},
        400: {"name": "Ki Dimensional Absoluto", "spec_options": ["Punho do Multiverso", "Movimento do Cosmos"]},
        500: {"name": "Ki do Plano Absoluto", "spec_options": ["Golpe que Para o Tempo", "Monge do Fim"]},
    },
    "Bardo": {
        40:  {"name": "Maestro",            "spec_options": ["Bardo da Batalha", "Encantador Supremo"]},
        80:  {"name": "Lenda Viva",         "spec_options": ["Bardo do Destino", "Cantor dos Deuses"]},
        120: {"name": "Voz do Cosmos",      "spec_options": ["Sinfonia da DestruiÃ§Ã£o", "MÃºsica do Universo"]},
        160: {"name": "A CanÃ§Ã£o Eterna",    "spec_options": ["Compositor do Fim", "Eco Primordial"]},
        200: {"name": "Melodia dos Planos", "spec_options": ["Cantor do Cosmos", "Bardo Transcendente"]},
        400: {"name": "Sinfonia Dimensional", "spec_options": ["MÃºsica do Multiverso", "Eco Dimensional"]},
        500: {"name": "A Ãšltima CanÃ§Ã£o", "spec_options": ["MÃºsica do Plano Absoluto", "Compositor do Fim de Tudo"]},
    },
    # â”€â”€ NOVAS CLASSES â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    "Cavaleiro das Sombras": {
        40:  {"name": "Lorde das Sombras",     "spec_options": ["Cavaleiro do Vazio", "Sombra Armada"]},
        80:  {"name": "GuardiÃ£o Sombrio",      "spec_options": ["DragÃ£o das Trevas", "Fantasma de AÃ§o"]},
        120: {"name": "Soberano das Trevas",   "spec_options": ["Lich Cavaleiro", "Sombra Imortal"]},
        160: {"name": "Abismo Encarnado",      "spec_options": ["Ceifeiro das Sombras", "Vazio Armado"]},
        200: {"name": "Cavaleiro Transcendental das Trevas", "spec_options": ["Sombra dos Planos", "Cavaleiro do Vazio CÃ³smico"]},
        400: {"name": "Trevas Dimensionais Armadas", "spec_options": ["Cavaleiro do Multiverso Sombrio", "Armadura do Vazio"]},
        500: {"name": "Sombra do Plano Absoluto", "spec_options": ["Cavaleiro do Fim", "Trevas Absolutas Encarnadas"]},
    },
    "Invocador": {
        40:  {"name": "Senhor das Criaturas",  "spec_options": ["Invocador Elemental", "PortÃ£o do Abismo"]},
        80:  {"name": "Mestre dos Planos",     "spec_options": ["Invocador Divino", "Abridor de Portais"]},
        120: {"name": "Soberano das DimensÃµes","spec_options": ["Senhor das LegiÃµes", "Tecedor de Planos"]},
        160: {"name": "Criador de Mundos",     "spec_options": ["Pai das Criaturas", "Nexo Dimensional"]},
        200: {"name": "Invocador dos Planos", "spec_options": ["Senhor das DimensÃµes", "PortÃ£o do Cosmos"]},
        400: {"name": "Criador Dimensional", "spec_options": ["Nexo do Multiverso", "Invocador Absoluto"]},
        500: {"name": "Pai de Tudo do Plano Final", "spec_options": ["Criador Primordial das Criaturas", "Invocador do Absoluto"]},
    },
    "Runesmith": {
        40:  {"name": "Gravador de Runas",     "spec_options": ["Runesmith de Batalha", "Arquiteto de Runas"]},
        80:  {"name": "Mestre das Runas",      "spec_options": ["Runas Proibidas", "Construtor Arcano"]},
        120: {"name": "Runa Viva",             "spec_options": ["Avatar das Runas", "Runas Primordiais"]},
        160: {"name": "A Primeira Runa",       "spec_options": ["Origem do Poder", "Runa do Fim"]},
        200: {"name": "Runa Transcendente", "spec_options": ["Gravador dos Planos", "Runas CÃ³smicas"]},
        400: {"name": "Arquiteto Dimensional das Runas", "spec_options": ["Runas do Multiverso", "Construtor do Cosmos"]},
        500: {"name": "Primeira Runa Absoluta", "spec_options": ["Runa do Plano Final", "Gravador do Fim"]},
    },
    "Cazador de Recompensas": {
        40:  {"name": "CaÃ§ador LendÃ¡rio",      "spec_options": ["Sniper Arcano", "CaÃ§ador de Monstros"]},
        80:  {"name": "CaÃ§ador de Bosses",     "spec_options": ["Exterminador Elite", "Sombra CaÃ§adora"]},
        120: {"name": "Lenda da CaÃ§a",         "spec_options": ["CaÃ§ador de Deuses", "Predador Supremo"]},
        160: {"name": "O Ãšltimo CaÃ§ador",      "spec_options": ["Fim de Tudo", "CaÃ§ador Imortal"]},
        200: {"name": "CaÃ§ador dos Planos", "spec_options": ["Predador Transcendente", "CaÃ§ador CÃ³smico"]},
        400: {"name": "CaÃ§ador Dimensional", "spec_options": ["Exterminador do Multiverso", "Predador Absoluto"]},
        500: {"name": "O CaÃ§ador Final", "spec_options": ["CaÃ§ador do Plano Absoluto", "Extintor de Tudo"]},
    },
    "XamÃ£": {
        40:  {"name": "GuardiÃ£o Espiritual",   "spec_options": ["XamÃ£ de Guerra", "Curandeiro dos EspÃ­ritos"]},
        80:  {"name": "Ancestral Vivo",        "spec_options": ["XamÃ£ do Caos", "Portador dos Ancestrais"]},
        120: {"name": "EspÃ­rito Encarnado",    "spec_options": ["EspÃ­rito da DestruiÃ§Ã£o", "AnciÃ£o dos EspÃ­ritos"]},
        160: {"name": "Pai dos EspÃ­ritos",     "spec_options": ["EspÃ­rito Primordial", "Voz dos Mortos"]},
        200: {"name": "XamÃ£ dos Planos", "spec_options": ["EspÃ­rito Transcendente", "GuardiÃ£o CÃ³smico"]},
        400: {"name": "AnciÃ£o Dimensional", "spec_options": ["Portador dos EspÃ­ritos do Cosmos", "XamÃ£ do Multiverso"]},
        500: {"name": "EspÃ­rito do Plano Absoluto", "spec_options": ["XamÃ£ Final", "Voz dos Mortos do Fim"]},
    },
    "Tempesteiro": {
        40:  {"name": "Senhor do TrovÃ£o",      "spec_options": ["Tempesteiro de Plasma", "Deus do Raio"]},
        80:  {"name": "Tempestade Viva",       "spec_options": ["FuracÃ£o Arcano", "RelÃ¢mpago Encarnado"]},
        120: {"name": "Olho da Tempestade",    "spec_options": ["Tempesteiro Divino", "Zeus Menor"]},
        160: {"name": "A Tempestade Eterna",   "spec_options": ["Armageddon ElÃ©trico", "Tempestade Primordial"]},
        200: {"name": "Tempestade dos Planos", "spec_options": ["RelÃ¢mpago Transcendente", "FuracÃ£o CÃ³smico"]},
        400: {"name": "Tempestade Dimensional", "spec_options": ["Raio do Multiverso", "Tornado do Cosmos"]},
        500: {"name": "A Tempestade Final Absoluta", "spec_options": ["RelÃ¢mpago do Plano Absoluto", "Apocalipse ElÃ©trico Final"]},
    },
    "Ilusionista": {
        40:  {"name": "Mestre das IlusÃµes",    "spec_options": ["Ilusionista de Batalha", "Sonhador Arcano"]},
        80:  {"name": "Arquiteto de Sonhos",   "spec_options": ["Senhor dos Pesadelos", "Criador de Realidades"]},
        120: {"name": "Realidade Alternativa", "spec_options": ["Deus das IlusÃµes", "Espelho do Cosmos"]},
        160: {"name": "A IlusÃ£o Suprema",      "spec_options": ["Realidade que Mente", "Ilusionista Primordial"]},
        200: {"name": "Arquiteto dos Planos IlusÃ³rios", "spec_options": ["Ilusionista dos Planos", "Sonhador Transcendente"]},
        400: {"name": "Realidade Dimensional IlusÃ³ria", "spec_options": ["Ilusionista do Multiverso", "A Mentira Absoluta"]},
        500: {"name": "A IlusÃ£o do Plano Absoluto", "spec_options": ["Realidade que NÃ£o Existe", "IlusÃ£o Final de Tudo"]},
    },
    "Alquimista": {
        40:  {"name": "Alquimista de Elite",   "spec_options": ["Bombardeiro", "Alquimista Curador"]},
        80:  {"name": "Mestre Alquimista",     "spec_options": ["Transmutador", "Fabricante do Caos"]},
        120: {"name": "GrÃ£o-Alquimista",       "spec_options": ["Pedra Filosofal Viva", "Alquimista Divino"]},
        160: {"name": "Primeiro Alquimista",   "spec_options": ["Criador da Vida", "Destruidor da MatÃ©ria"]},
        200: {"name": "Alquimista Transcendente", "spec_options": ["Transmutador dos Planos", "Alquimista CÃ³smico"]},
        400: {"name": "Pedra Filosofal Dimensional", "spec_options": ["Transmutador do Multiverso", "Alquimia Absoluta"]},
        500: {"name": "O Alquimista do Plano Final", "spec_options": ["Criador da Vida Absoluta", "Destruidor da MatÃ©ria Final"]},
    },
    "GuardiÃ£o do Abismo": {
        40:  {"name": "Sentinela do Vazio",    "spec_options": ["GuardiÃ£o das Almas", "Soldado do Abismo"]},
        80:  {"name": "Lorde do Abismo",       "spec_options": ["Entidade do Vazio", "Comandante das Sombras"]},
        120: {"name": "Soberano do Nada",      "spec_options": ["Avatar do Abismo", "GuardiÃ£o Eterno"]},
        160: {"name": "O Abismo em Pessoa",    "spec_options": ["Vazio Primordial", "O Nada que DestrÃ³i"]},
        200: {"name": "Abismo Transcendente", "spec_options": ["GuardiÃ£o dos Planos Sombrios", "Entidade do Vazio CÃ³smico"]},
        400: {"name": "Vazio Dimensional", "spec_options": ["Abismo do Multiverso", "GuardiÃ£o CÃ³smico do Nada"]},
        500: {"name": "O Abismo do Plano Absoluto", "spec_options": ["Vazio Final Absoluto", "GuardiÃ£o do Fim"]},
    },
    "DanÃ§arino da Morte": {
        40:  {"name": "Executora da Sombra",   "spec_options": ["LÃ¢minas do Vento", "DanÃ§a Mortal"]},
        80:  {"name": "Ceifadora Elegante",    "spec_options": ["Fantasma DanÃ§ante", "Morte Personificada"]},
        120: {"name": "DanÃ§a do Apocalipse",   "spec_options": ["Ãšltima DanÃ§a", "Ceifadora do Cosmos"]},
        160: {"name": "A Morte DanÃ§a",         "spec_options": ["Fim do Mundo Bailado", "ExtinÃ§Ã£o Graciosa"]},
        200: {"name": "DanÃ§a Transcendente da Morte", "spec_options": ["Ceifadora dos Planos", "DanÃ§a CÃ³smica"]},
        400: {"name": "Morte Dimensional DanÃ§ante", "spec_options": ["DanÃ§a do Multiverso", "Ceifadora CÃ³smica"]},
        500: {"name": "A Morte DanÃ§a no Plano Absoluto", "spec_options": ["Ãšltima DanÃ§a do Cosmos", "ExtinÃ§Ã£o Graciosa Final"]},
    },
    "OrÃ¡culo": {
        40:  {"name": "Vidente do Destino",    "spec_options": ["OrÃ¡culo de Batalha", "Manipulador do Tempo"]},
        80:  {"name": "Profeta dos Deuses",    "spec_options": ["Reescritor do Destino", "Senhor do Futuro"]},
        120: {"name": "Olho do Cosmos",        "spec_options": ["Onisciente", "Paradoxo Vivo"]},
        160: {"name": "O Destino em Pessoa",   "spec_options": ["Fim Predestinado", "Tecedor do Cosmos"]},
        200: {"name": "OrÃ¡culo dos Planos", "spec_options": ["Profeta Transcendente", "Vidente CÃ³smico"]},
        400: {"name": "Destino Dimensional", "spec_options": ["OrÃ¡culo do Multiverso", "Tecedor do Cosmos Final"]},
        500: {"name": "O Destino do Plano Absoluto", "spec_options": ["Fim Predestinado Absoluto", "Vidente do Fim de Tudo"]},
    },
    "Colossus": {
        40:  {"name": "Fortaleza Viva",        "spec_options": ["Titan da Defesa", "Colosso de Batalha"]},
        80:  {"name": "Muralha InquebrÃ¡vel",   "spec_options": ["Monolito Eterno", "Colosso Sagrado"]},
        120: {"name": "FundaÃ§Ã£o do Mundo",     "spec_options": ["Rocha Primordial", "Colossus Divino"]},
        160: {"name": "A Montanha Que Caminha","spec_options": ["Continente Animado", "TitÃ£ Imortal"]},
        200: {"name": "Colossus Transcendente", "spec_options": ["FundaÃ§Ã£o dos Planos", "Muralha CÃ³smica"]},
        400: {"name": "Montanha Dimensional", "spec_options": ["Rocha do Multiverso", "Colossus CÃ³smico"]},
        500: {"name": "O Continente do Plano Absoluto", "spec_options": ["A Base de Tudo", "Colosso do Fim"]},
    },
    "Devorador de Almas": {
        40:  {"name": "Colecionador de Almas", "spec_options": ["Devorador de Guerreiros", "Absorvedor Eterno"]},
        80:  {"name": "LadrÃ£o de EssÃªncias",   "spec_options": ["Devorador de Deuses", "Vazio Faminto"]},
        120: {"name": "O Vazio Faminto",       "spec_options": ["Consumidor de Realidades", "Fome Eterna"]},
        160: {"name": "Devor. do Universo",    "spec_options": ["Fim de Toda ExistÃªncia", "O VÃ¡cuo Primordial"]},
        200: {"name": "Devorador dos Planos", "spec_options": ["Consumidor de DimensÃµes", "Vazio Transcendente Faminto"]},
        400: {"name": "Fome Dimensional Absoluta", "spec_options": ["Devorador do Multiverso", "Consumidor de Realidades"]},
        500: {"name": "Fome do Plano Absoluto", "spec_options": ["Fim de Toda ExistÃªncia Absoluta", "O VÃ¡cuo Final"]},
    },
    "Arauto Celestial": {
        40:  {"name": "Mensageiro dos Deuses", "spec_options": ["Arauto da Luz", "Protetor Divino"]},
        80:  {"name": "Voz do Trono",          "spec_options": ["Arauto da DestruiÃ§Ã£o", "Escudo dos CÃ©us"]},
        120: {"name": "Avatar Celestial",      "spec_options": ["BraÃ§o dos Deuses", "SentenÃ§a Divina"]},
        160: {"name": "Deus Mensageiro",       "spec_options": ["Vontade do Cosmos", "Portador do Fim"]},
        200: {"name": "Arauto dos Planos Supremos", "spec_options": ["Mensageiro Transcendente", "Voz dos Planos"]},
        400: {"name": "Arauto Dimensional", "spec_options": ["Mensageiro do Multiverso", "Portador da DestruiÃ§Ã£o CÃ³smica"]},
        500: {"name": "Arauto do Plano Absoluto", "spec_options": ["Vontade Final do Cosmos", "Mensageiro do Fim"]},
    },
    "LanÃ§ador de Venenos": {
        40:  {"name": "Mestre das Toxinas",    "spec_options": ["Envenenador Supremo", "Corrosivo Letal"]},
        80:  {"name": "Senhor das Pragas",     "spec_options": ["Praga Viva", "Destruidor Silencioso"]},
        120: {"name": "Catalisador da Morte",  "spec_options": ["Pandemia Personificada", "Toxina Primordial"]},
        160: {"name": "A Praga Final",         "spec_options": ["Extintor de Mundos", "Veneno do Cosmos"]},
        200: {"name": "Praga Transcendente", "spec_options": ["Veneno dos Planos", "Toxina CÃ³smica"]},
        400: {"name": "Pandemia Dimensional", "spec_options": ["Praga do Multiverso", "Veneno Absoluto"]},
        500: {"name": "A Praga do Plano Final", "spec_options": ["Extintor de Mundos Final", "Veneno do Cosmos Absoluto"]},
    },
    "Gladiador": {
        40:  {"name": "CampeÃ£o da Arena",      "spec_options": ["Gladiador Impiedoso", "Gladiador Protetor"]},
        80:  {"name": "Lenda da Arena",        "spec_options": ["Gladiador Divino", "Mestre do EspetÃ¡culo"]},
        120: {"name": "Senhor dos Combates",   "spec_options": ["Invicto Eterno", "Arena Personificada"]},
        160: {"name": "Gladiador Imortal",     "spec_options": ["O Ãšltimo em PÃ©", "Combate Primordial"]},
        200: {"name": "Gladiador dos Planos", "spec_options": ["CampeÃ£o Transcendente", "Combatente CÃ³smico"]},
        400: {"name": "Gladiador Dimensional", "spec_options": ["Arena do Multiverso", "Invicto do Cosmos"]},
        500: {"name": "O Gladiador do Plano Absoluto", "spec_options": ["O Ãšltimo em PÃ© no Cosmos", "Combate Final Primordial"]},
    },
    "Mestre das Correntes": {
        40:  {"name": "Aprisionador",          "spec_options": ["Correntes de Fogo", "Correntes do Abismo"]},
        80:  {"name": "Controlador Supremo",   "spec_options": ["Correntes da Realidade", "Aprisionador Eterno"]},
        120: {"name": "Deus das Correntes",    "spec_options": ["Correntes Primordiais", "LigaÃ§Ã£o do Cosmos"]},
        160: {"name": "Corrente do Universo",  "spec_options": ["Tudo Acorrentado", "Fim da Liberdade"]},
        200: {"name": "Mestre das Correntes dos Planos", "spec_options": ["Aprisionador Transcendente", "Correntes CÃ³smicas"]},
        400: {"name": "Correntes Dimensionais", "spec_options": ["Aprisionador do Multiverso", "Correntes do Cosmos"]},
        500: {"name": "O Universo Acorrentado", "spec_options": ["Correntes do Plano Absoluto", "Aprisionamento Final"]},
    },
    "Profeta da DestruiÃ§Ã£o": {
        40:  {"name": "Anunciador do Caos",    "spec_options": ["Profeta do Fogo", "Voz do Abismo"]},
        80:  {"name": "Catalisador do Fim",    "spec_options": ["Profeta DemonÃ­aco", "Anunciador do JuÃ­zo"]},
        120: {"name": "A Profecia em Pessoa",  "spec_options": ["DestruiÃ§Ã£o InevitÃ¡vel", "Profeta do Cosmos"]},
        160: {"name": "O Fim Anunciado",       "spec_options": ["Apocalipse Ambulante", "Profecia Primordial"]},
        200: {"name": "Profeta dos Planos", "spec_options": ["DestruiÃ§Ã£o Transcendente", "Profeta CÃ³smico"]},
        400: {"name": "Catalisador Dimensional do Fim", "spec_options": ["Profecia do Multiverso", "Anunciador do Fim CÃ³smico"]},
        500: {"name": "O Fim Anunciado no Plano Absoluto", "spec_options": ["Apocalipse Final Absoluto", "Profecia do Fim de Tudo"]},
    },
    "Ferreiro de Guerra": {
        40:  {"name": "Armeiro de Batalha",    "spec_options": ["Ferreiro Divino", "Construtor de Lendas"]},
        80:  {"name": "Forjador de HerÃ³is",    "spec_options": ["Mestre da Forja Sagrada", "Armeiro Eterno"]},
        120: {"name": "Forjador de Deuses",    "spec_options": ["Criador de Armas Divinas", "Ferreiro Primordial"]},
        160: {"name": "A Primeira Forja",      "spec_options": ["Forja do Cosmos", "Armeiro do Universo"]},
        200: {"name": "Ferreiro dos Planos", "spec_options": ["Forjador Transcendente", "Armeiro CÃ³smico"]},
        400: {"name": "Ferreiro Dimensional", "spec_options": ["Forjador do Multiverso", "Armeiro do Cosmos"]},
        500: {"name": "A Forja do Plano Absoluto", "spec_options": ["Criador de Armas do Fim", "Armeiro Final Primordial"]},
    },
    "Dragonlancer": {
        40:  {"name": "Cavaleiro de DragÃ£o",   "spec_options": ["LanÃ§ador de Chamas", "Cavaleiro do Gelo"]},
        80:  {"name": "Senhor dos DragÃµes",    "spec_options": ["Avatar DracÃ´nico", "Dragonlord"]},
        120: {"name": "DragÃ£o Encarnado",      "spec_options": ["Forma Final do DragÃ£o", "Ãšltimo DragÃ£o"]},
        160: {"name": "DragÃ£o Primordial",     "spec_options": ["Pai dos DragÃµes", "Chama da CriaÃ§Ã£o"]},
        200: {"name": "DragÃ£o dos Planos", "spec_options": ["Cavaleiro Transcendente de DragÃ£o", "Senhor dos DragÃµes CÃ³smicos"]},
        400: {"name": "DragÃ£o Dimensional", "spec_options": ["Dragonlord do Multiverso", "Pai dos DragÃµes CÃ³smicos"]},
        500: {"name": "DragÃ£o do Plano Absoluto", "spec_options": ["DragÃ£o Final Primordial", "Chama da CriaÃ§Ã£o Absoluta"]},
    },
}

# ================= HABILIDADES POR TIER DE EVOLUÃ‡ÃƒO =================
# basic=nÃ­vel 1-39, intermediate=40-79, advanced=80-119, supreme=desbloqueada por boss
CLASS_TIERED_SKILLS = {
    # â”€â”€ GUERREIRO â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    "Guerreiro": {
        "basic": [
            {"name": "ğŸ—¡ï¸ Golpe Devastador",  "mana_cost": 0,  "dmg_mult": 1.4, "desc": "Um golpe poderoso com toda a forÃ§a!"},
            {"name": "ğŸ›¡ï¸ Ataque Protetor",   "mana_cost": 10, "dmg_mult": 1.2, "def_bonus": 10, "desc": "Ataca enquanto se defende."},
        ],
        "intermediate": [
            {"name": "âš”ï¸ FÃºria do Guerreiro", "mana_cost": 20, "dmg_mult": 1.8, "desc": "Rajada de golpes furiosos!"},
            {"name": "ğŸ”¥ Grito de Batalha",   "mana_cost": 15, "dmg_mult": 1.5, "stun_chance": 0.2, "desc": "Paralisa o inimigo."},
            {"name": "ğŸ’ª Postura do TitÃ£",    "mana_cost": 25, "dmg_mult": 1.3, "def_bonus": 25, "self_heal": 20, "desc": "Postura defensiva que tambÃ©m cura."},
        ],
        "advanced": [
            {"name": "ğŸŒªï¸ Redemoinho de AÃ§o", "mana_cost": 35, "dmg_mult": 2.2, "stun_chance": 0.3, "desc": "Gira causando dano em Ã¡rea!"},
            {"name": "ğŸ©¸ Golpe do Colosso",  "mana_cost": 45, "dmg_mult": 2.8, "ignore_def": True, "desc": "ForÃ§a dos titÃ£s em um golpe!"},
        ],
        "supreme": {
            "name": "â˜ ï¸ AniquilaÃ§Ã£o Total", "mana_cost": 80, "dmg_mult": 5.0, "stun_chance": 0.5, "ignore_def": True,
            "desc": "O poder de um deus mortal. DestrÃ³i qualquer defesa!",
            "unlock_boss": "Yeti Colossal"
        },
    },
    # â”€â”€ MAGO â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    "Mago": {
        "basic": [
            {"name": "ğŸ”¥ Bola de Fogo",      "mana_cost": 25, "dmg_mult": 2.0, "desc": "Uma esfera flamejante!"},
            {"name": "â„ï¸ Toque Gelado",      "mana_cost": 20, "dmg_mult": 1.6, "slow_chance": 0.4, "desc": "Congela o adversÃ¡rio."},
        ],
        "intermediate": [
            {"name": "âš¡ RelÃ¢mpago Arcano",  "mana_cost": 30, "dmg_mult": 2.2, "stun_chance": 0.3, "desc": "Eletricidade arcana!"},
            {"name": "ğŸŒ€ ExplosÃ£o do Vazio", "mana_cost": 40, "dmg_mult": 2.8, "desc": "Poder do abismo!"},
            {"name": "ğŸŒŒ Chuva de Meteoros", "mana_cost": 50, "dmg_mult": 2.5, "poison": True, "desc": "Meteoros arcanos caem!"},
        ],
        "advanced": [
            {"name": "â­ Colapso Estelar",   "mana_cost": 60, "dmg_mult": 3.5, "stun_chance": 0.4, "desc": "Estrelas colapsam no alvo!"},
            {"name": "ğŸ’¥ Singularidade",     "mana_cost": 70, "dmg_mult": 3.8, "ignore_def": True, "desc": "Buraco negro arcano!"},
        ],
        "supreme": {
            "name": "ğŸŒ  ExtinÃ§Ã£o Arcana", "mana_cost": 100, "dmg_mult": 6.5, "ignore_def": True, "stun_chance": 0.6,
            "desc": "DestrÃ³i a realidade ao redor do alvo. O poder mais destrutivo da magia arcana!",
            "unlock_boss": "Olho do Abismo"
        },
    },
    # â”€â”€ ARQUEIRO â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    "Arqueiro": {
        "basic": [
            {"name": "ğŸ¹ Flecha Certeira",   "mana_cost": 0,  "dmg_mult": 1.5, "desc": "Flecha com precisÃ£o mortal."},
            {"name": "ğŸŒ¿ Flecha Envenenada", "mana_cost": 10, "dmg_mult": 1.3, "poison": True, "desc": "Veneno corrosivo."},
        ],
        "intermediate": [
            {"name": "ğŸ’¨ Chuva de Flechas",  "mana_cost": 20, "dmg_mult": 1.7, "desc": "MÃºltiplas flechas!"},
            {"name": "ğŸ¯ Tiro Perfurante",   "mana_cost": 15, "dmg_mult": 2.0, "ignore_def": True, "desc": "Perfura qualquer defesa."},
            {"name": "âš¡ Flecha do TrovÃ£o",  "mana_cost": 25, "dmg_mult": 2.2, "stun_chance": 0.35, "desc": "Paralisa com raio."},
        ],
        "advanced": [
            {"name": "ğŸŒŒ Flecha CÃ³smica",    "mana_cost": 35, "dmg_mult": 2.8, "ignore_def": True, "desc": "Flecha imbuÃ­da de energia estelar!"},
            {"name": "ğŸ”¥ Inferno BalÃ­stico", "mana_cost": 45, "dmg_mult": 3.2, "poison": True, "stun_chance": 0.2, "desc": "Flechas de fogo infernal!"},
        ],
        "supreme": {
            "name": "ğŸŒ  A Ãšltima Flecha", "mana_cost": 90, "dmg_mult": 5.5, "ignore_def": True, "crit_chance": 0.8,
            "desc": "Uma Ãºnica flecha que atravessa dimensÃµes. NÃ£o falha. Nunca.",
            "unlock_boss": "Arquimago Zephyr Corrompido"
        },
    },
    # â”€â”€ PALADINO â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    "Paladino": {
        "basic": [
            {"name": "âœ¨ Golpe Sagrado",     "mana_cost": 15, "dmg_mult": 1.6, "desc": "Energia divina!"},
            {"name": "ğŸ›¡ï¸ Escudo da FÃ©",     "mana_cost": 20, "dmg_mult": 1.0, "self_heal": 30, "desc": "Cura ao defender."},
        ],
        "intermediate": [
            {"name": "â˜€ï¸ Julgamento Divino", "mana_cost": 35, "dmg_mult": 2.0, "desc": "Julgamento dos cÃ©us!"},
            {"name": "ğŸŒŸ Aura de ProteÃ§Ã£o",  "mana_cost": 25, "dmg_mult": 1.2, "def_bonus": 20, "desc": "Aura protetora."},
            {"name": "ğŸ•Šï¸ BÃªnÃ§Ã£o dos Anjos", "mana_cost": 30, "dmg_mult": 1.5, "self_heal": 40, "desc": "Cura massiva divina."},
        ],
        "advanced": [
            {"name": "âš¡ Espada do JuÃ­zo",   "mana_cost": 50, "dmg_mult": 2.8, "ignore_def": True, "desc": "Espada forjada no cÃ©u!"},
            {"name": "ğŸŒˆ Nova Sagrada",      "mana_cost": 55, "dmg_mult": 2.5, "self_heal": 60, "stun_chance": 0.3, "desc": "ExplosÃ£o de luz divina!"},
        ],
        "supreme": {
            "name": "ğŸ‘‘ JuÃ­zo Final Divino", "mana_cost": 95, "dmg_mult": 5.0, "self_heal": 100, "ignore_def": True,
            "desc": "O poder do Trono Celestial canalizado. Cura completamente e destrÃ³i o inimigo!",
            "unlock_boss": "Imperador Astral"
        },
    },
    # â”€â”€ ASSASSINO â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    "Assassino": {
        "basic": [
            {"name": "ğŸ—¡ï¸ Golpe Sorrateiro",  "mana_cost": 0,  "dmg_mult": 1.8, "crit_chance": 0.4, "desc": "Das sombras, golpe mortal!"},
            {"name": "â˜ ï¸ Veneno Assassino",  "mana_cost": 15, "dmg_mult": 1.3, "poison": True, "desc": "Veneno letal."},
        ],
        "intermediate": [
            {"name": "ğŸ’¨ DanÃ§a das LÃ¢minas", "mana_cost": 20, "dmg_mult": 1.5, "desc": "SequÃªncia vertiginosa."},
            {"name": "ğŸŒ‘ Golpe das Sombras", "mana_cost": 30, "dmg_mult": 2.5, "crit_chance": 0.5, "desc": "Alta chance crÃ­tica!"},
            {"name": "ğŸ­ IlusÃ£o Mortal",     "mana_cost": 25, "dmg_mult": 2.2, "stun_chance": 0.4, "desc": "Ilude e golpeia."},
        ],
        "advanced": [
            {"name": "âš¡ Tempestade de LÃ¢minas","mana_cost": 40, "dmg_mult": 3.0, "crit_chance": 0.6, "desc": "Cem lÃ¢minas em um segundo!"},
            {"name": "ğŸŒ€ Portal Sombrio",    "mana_cost": 45, "dmg_mult": 3.3, "ignore_def": True, "desc": "Aparece atrÃ¡s do inimigo."},
        ],
        "supreme": {
            "name": "ğŸ’€ Morte Certa", "mana_cost": 85, "dmg_mult": 6.0, "crit_chance": 0.9, "ignore_def": True, "poison": True,
            "desc": "Um golpe que nÃ£o pode ser evitado. Veneno, crÃ­tico e ignora toda defesa.",
            "unlock_boss": "Senhor das Sombras"
        },
    },
    # â”€â”€ NECROMANTE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    "Necromante": {
        "basic": [
            {"name": "ğŸ’€ Dreno de Vida",    "mana_cost": 20, "dmg_mult": 1.5, "self_heal": 20, "desc": "Rouba HP!"},
            {"name": "ğŸŒ‘ MaldiÃ§Ã£o Sombria", "mana_cost": 25, "dmg_mult": 1.4, "weaken": True, "desc": "Enfraquece o inimigo."},
        ],
        "intermediate": [
            {"name": "ğŸ¦´ Invocar Esqueleto", "mana_cost": 30, "dmg_mult": 1.7, "desc": "Esqueleto guerreiro!"},
            {"name": "â˜ ï¸ Morte InstantÃ¢nea", "mana_cost": 50, "dmg_mult": 3.0, "desc": "Toca a morte!"},
            {"name": "ğŸ©¸ Praga dos Mortos",  "mana_cost": 35, "dmg_mult": 1.8, "poison": True, "weaken": True, "desc": "Praga que drena e enfraquece."},
        ],
        "advanced": [
            {"name": "ğŸŒ’ ExÃ©rcito Espectral","mana_cost": 55, "dmg_mult": 2.8, "self_heal": 50, "desc": "Horda de espectros ataca!"},
            {"name": "ğŸ’€ Apocalipse Morto",  "mana_cost": 65, "dmg_mult": 3.5, "weaken": True, "poison": True, "desc": "A morte vem em ondas."},
        ],
        "supreme": {
            "name": "â™¾ï¸ Extinction Protocol", "mana_cost": 100, "dmg_mult": 5.8, "self_heal": 80, "ignore_def": True, "weaken": True,
            "desc": "Convoca todos os mortos do campo de batalha. A morte absoluta.",
            "unlock_boss": "Rei das Sombras Eternas"
        },
    },
    # â”€â”€ BERSERKER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    "Berserker": {
        "basic": [
            {"name": "ğŸª“ Frenesi",           "mana_cost": 0,  "dmg_mult": 2.0, "desc": "Ataque frenÃ©tico!"},
            {"name": "ğŸ’¢ Ira IncontrolÃ¡vel", "mana_cost": 15, "dmg_mult": 2.2, "self_dmg": 10, "desc": "Sacrifica HP por poder."},
        ],
        "intermediate": [
            {"name": "ğŸ©¸ Sede de Sangue",    "mana_cost": 10, "dmg_mult": 1.8, "hp_scale": True, "desc": "Quanto menos HP, mais forte!"},
            {"name": "ğŸ’¥ ExplosÃ£o de FÃºria", "mana_cost": 25, "dmg_mult": 2.8, "desc": "Toda raiva liberada!"},
            {"name": "ğŸ”¥ FÃºria SanguinÃ¡ria", "mana_cost": 20, "dmg_mult": 2.5, "self_dmg": 15, "stun_chance": 0.3, "desc": "Corre sangrando e paralisa."},
        ],
        "advanced": [
            {"name": "ğŸŒ‹ Terremoto",         "mana_cost": 40, "dmg_mult": 3.2, "stun_chance": 0.45, "desc": "Soca o chÃ£o rachando tudo!"},
            {"name": "ğŸ’€ Modo Deus da FÃºria", "mana_cost": 50, "dmg_mult": 3.8, "ignore_def": True, "desc": "AlÃ©m do limite humano."},
        ],
        "supreme": {
            "name": "ğŸŒªï¸ RagnarÃ¶k Pessoal", "mana_cost": 70, "dmg_mult": 6.2, "ignore_def": True, "stun_chance": 0.5, "self_dmg": 30,
            "desc": "O fim do mundo concentrado em um Ãºnico ser. DevastaÃ§Ã£o total.",
            "unlock_boss": "Primeiro Gigante Primordial"
        },
    },
    # â”€â”€ DRUIDA â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    "Druida": {
        "basic": [
            {"name": "ğŸŒ¿ Golpe Natural",     "mana_cost": 0,  "dmg_mult": 1.3, "self_heal": 15, "desc": "Natureza cura ao atacar."},
            {"name": "ğŸŒªï¸ Tempestade de Folhas","mana_cost": 20,"dmg_mult": 1.6, "desc": "Tempestade de espinhos!"},
        ],
        "intermediate": [
            {"name": "ğŸº FÃºria Animal",      "mana_cost": 30, "dmg_mult": 2.0, "desc": "Transforma-se em besta!"},
            {"name": "âš¡ TrovÃ£o da Terra",   "mana_cost": 35, "dmg_mult": 2.3, "stun_chance": 0.3, "desc": "Terra responde com trovÃ£o!"},
            {"name": "ğŸŒŠ MarÃ© da Floresta",  "mana_cost": 30, "dmg_mult": 1.9, "self_heal": 35, "desc": "A floresta cura e destrÃ³i."},
        ],
        "advanced": [
            {"name": "ğŸŒ³ AbraÃ§o do Ent",     "mana_cost": 45, "dmg_mult": 2.6, "stun_chance": 0.5, "desc": "RaÃ­zes gigantes prendem e esmagam!"},
            {"name": "ğŸŒ Pulso da Terra",    "mana_cost": 55, "dmg_mult": 3.0, "self_heal": 50, "desc": "A prÃ³pria terra ataca!"},
        ],
        "supreme": {
            "name": "ğŸŒŒ Gaia's Wrath", "mana_cost": 90, "dmg_mult": 5.3, "self_heal": 120, "stun_chance": 0.4,
            "desc": "A raiva do planeta em forma de ataque. A natureza em seu estado mais puro e destrutivo.",
            "unlock_boss": "Ent AnciÃ£o"
        },
    },
    # â”€â”€ MONGE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    "Monge": {
        "basic": [
            {"name": "ğŸ‘Š Soco do DragÃ£o",    "mana_cost": 0,  "dmg_mult": 1.5, "desc": "Soco carregado de ki!"},
            {"name": "ğŸŒ€ Cem Golpes",        "mana_cost": 20, "dmg_mult": 1.7, "desc": "Cem golpes em um segundo!"},
        ],
        "intermediate": [
            {"name": "âš¡ Raio de Ki",        "mana_cost": 25, "dmg_mult": 2.0, "desc": "Energia vital projetada!"},
            {"name": "ğŸ§˜ Golpe Transcendente","mana_cost": 40,"dmg_mult": 2.5, "desc": "Corpo e mente em harmonia."},
            {"name": "ğŸŒŠ Onda de Ki",        "mana_cost": 30, "dmg_mult": 2.2, "stun_chance": 0.3, "desc": "Onda de energia pura."},
        ],
        "advanced": [
            {"name": "ğŸ’« ExplosÃ£o de Ki",    "mana_cost": 50, "dmg_mult": 3.2, "ignore_def": True, "desc": "Ki explode em todas as direÃ§Ãµes!"},
            {"name": "ğŸŒŸ Modo Ultra-Ki",     "mana_cost": 60, "dmg_mult": 3.5, "stun_chance": 0.4, "desc": "AlÃ©m do limite do ki mortal."},
        ],
        "supreme": {
            "name": "â˜¯ï¸ TranscendÃªncia Absoluta", "mana_cost": 85, "dmg_mult": 5.8, "ignore_def": True, "self_heal": 80,
            "desc": "A alma e o universo se tornam um. O golpe que existe alÃ©m da fÃ­sica.",
            "unlock_boss": "Loop Temporal"
        },
    },
    # â”€â”€ BARDO â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    "Bardo": {
        "basic": [
            {"name": "ğŸµ Nota Dissonante",   "mana_cost": 10, "dmg_mult": 1.3, "stun_chance": 0.3, "desc": "Nota que atordoa!"},
            {"name": "ğŸ¸ Acorde do Caos",    "mana_cost": 20, "dmg_mult": 1.6, "desc": "Confunde os sentidos."},
        ],
        "intermediate": [
            {"name": "ğŸº Fanfarra da RuÃ­na", "mana_cost": 15, "dmg_mult": 1.5, "weaken": True, "desc": "Enfraquece com mÃºsica."},
            {"name": "ğŸ» Sinfonia da DestruiÃ§Ã£o","mana_cost": 35,"dmg_mult": 2.2, "desc": "MÃºsica torna-se forÃ§a!"},
            {"name": "ğŸ¹ Requiem do Inimigo", "mana_cost": 30, "dmg_mult": 2.0, "weaken": True, "stun_chance": 0.25, "desc": "Canta a morte do inimigo."},
        ],
        "advanced": [
            {"name": "ğŸ¼ Apocalipse SÃ´nico", "mana_cost": 50, "dmg_mult": 2.8, "stun_chance": 0.4, "weaken": True, "desc": "Som que racha o espaÃ§o!"},
            {"name": "ğŸŒŒ Canto das Estrelas","mana_cost": 55, "dmg_mult": 3.0, "self_heal": 40, "desc": "MÃºsica das esferas cura e destrÃ³i."},
        ],
        "supreme": {
            "name": "ğŸµ A CanÃ§Ã£o Que Encerra o Mundo", "mana_cost": 90, "dmg_mult": 5.0, "weaken": True, "stun_chance": 0.7, "self_heal": 60,
            "desc": "Uma melodia tÃ£o perfeita que a realidade se recusa a continuar. O inimigo simplesmente para.",
            "unlock_boss": "Querubim Corrompido Makhael"
        },
    },
    # â”€â”€ CAVALEIRO DAS SOMBRAS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    "Cavaleiro das Sombras": {
        "basic": [
            {"name": "ğŸŒ‘ Estocada das Trevas","mana_cost": 0, "dmg_mult": 1.6, "desc": "LanÃ§a sombria perfura o inimigo."},
            {"name": "â›“ï¸ Correntes Sombrias", "mana_cost": 15,"dmg_mult": 1.4, "stun_chance": 0.25, "desc": "Correntes de trevas prendem."},
        ],
        "intermediate": [
            {"name": "ğŸ’€ Cavalgar nas Sombras","mana_cost": 25,"dmg_mult": 2.0, "desc": "Surge das sombras em alta velocidade."},
            {"name": "ğŸ´ Corcel das Trevas",  "mana_cost": 30, "dmg_mult": 2.3, "stun_chance": 0.3, "desc": "Cavalo sombrio esmaga o inimigo."},
            {"name": "ğŸŒ‘ Aura Corrompida",    "mana_cost": 20, "dmg_mult": 1.5, "weaken": True, "def_bonus": 15, "desc": "Aura que enfraquece e protege."},
        ],
        "advanced": [
            {"name": "ğŸ’« Lance do Apocalipse","mana_cost": 50, "dmg_mult": 3.0, "ignore_def": True, "desc": "LanÃ§a atravessa qualquer coisa."},
            {"name": "ğŸŒªï¸ Vendaval Sombrio",  "mana_cost": 55, "dmg_mult": 3.4, "stun_chance": 0.4, "desc": "TufÃ£o de energia sombria."},
        ],
        "supreme": {
            "name": "ğŸ‡ Cavaleiro do Apocalipse", "mana_cost": 90, "dmg_mult": 5.5, "ignore_def": True, "stun_chance": 0.5, "weaken": True,
            "desc": "Monta o corcel da morte e arrasa tudo em seu caminho.",
            "unlock_boss": "Senhor das Sombras"
        },
    },
    # â”€â”€ INVOCADOR â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    "Invocador": {
        "basic": [
            {"name": "ğŸŒ€ Invocar Elemental", "mana_cost": 20, "dmg_mult": 1.5, "desc": "Elemental menor ataca."},
            {"name": "ğŸ‘ï¸ Olho Observador",   "mana_cost": 15, "dmg_mult": 1.3, "weaken": True, "desc": "Olho arcano debilita o inimigo."},
        ],
        "intermediate": [
            {"name": "ğŸ”¥ Invocar DemÃ´nio",   "mana_cost": 35, "dmg_mult": 2.2, "desc": "DemÃ´nio menor combate junto."},
            {"name": "ğŸ’€ PortÃ£o da Morte",   "mana_cost": 40, "dmg_mult": 2.5, "poison": True, "desc": "Portal libera criaturas mortais."},
            {"name": "ğŸŒŒ Invocar Colossus",  "mana_cost": 45, "dmg_mult": 2.8, "stun_chance": 0.3, "desc": "Golem gigante esmaga."},
        ],
        "advanced": [
            {"name": "â­ Invocar LendÃ¡rio",  "mana_cost": 60, "dmg_mult": 3.5, "desc": "Uma criatura lendÃ¡ria entra em batalha!"},
            {"name": "ğŸŒ  PortÃ£o Celestial",  "mana_cost": 65, "dmg_mult": 3.8, "ignore_def": True, "desc": "Anjo de guerra desce Ã  batalha."},
        ],
        "supreme": {
            "name": "â™¾ï¸ Invocar a ExtinÃ§Ã£o", "mana_cost": 100, "dmg_mult": 5.5, "ignore_def": True, "stun_chance": 0.4, "weaken": True,
            "desc": "Abre um portal para o fim dos tempos. Criaturas primordiais devoram o inimigo.",
            "unlock_boss": "VÃ¡cuo da CriaÃ§Ã£o"
        },
    },
    # â”€â”€ RUNESMITH â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    "Runesmith": {
        "basic": [
            {"name": "ğŸ”£ Runa de Fogo",      "mana_cost": 15, "dmg_mult": 1.5, "desc": "Runa explode em chamas."},
            {"name": "â„ï¸ Runa de Gelo",      "mana_cost": 15, "dmg_mult": 1.4, "stun_chance": 0.2, "desc": "Runa congela o inimigo."},
        ],
        "intermediate": [
            {"name": "âš¡ Runa do TrovÃ£o",    "mana_cost": 25, "dmg_mult": 2.0, "stun_chance": 0.35, "desc": "Runa elÃ©trica paralisa."},
            {"name": "ğŸ’€ Runa da Morte",     "mana_cost": 30, "dmg_mult": 2.2, "weaken": True, "desc": "Runa que drena a vida."},
            {"name": "ğŸ›¡ï¸ Runa Protetora",   "mana_cost": 20, "dmg_mult": 1.2, "def_bonus": 30, "self_heal": 25, "desc": "Runa escuda e cura."},
        ],
        "advanced": [
            {"name": "ğŸŒŸ Runa Suprema",      "mana_cost": 50, "dmg_mult": 3.0, "ignore_def": True, "desc": "Runa inscrita na realidade."},
            {"name": "â™¾ï¸ Runa do Abismo",    "mana_cost": 60, "dmg_mult": 3.5, "poison": True, "weaken": True, "desc": "Runa do vazio corrompido."},
        ],
        "supreme": {
            "name": "ğŸŒŒ Runa Primordial", "mana_cost": 95, "dmg_mult": 5.8, "ignore_def": True, "stun_chance": 0.5,
            "desc": "A primeira runa gravada no universo. Poder irresistÃ­vel.",
            "unlock_boss": "O Caos em Pessoa"
        },
    },
    # â”€â”€ CAZADOR DE RECOMPENSAS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    "Cazador de Recompensas": {
        "basic": [
            {"name": "ğŸ¯ Disparo Preciso",   "mana_cost": 0,  "dmg_mult": 1.5, "desc": "Tiro certeiro na fraqueza."},
            {"name": "ğŸ” Marcar Alvo",       "mana_cost": 10, "dmg_mult": 1.3, "weaken": True, "desc": "Marca o alvo para mais dano."},
        ],
        "intermediate": [
            {"name": "ğŸ’£ Bomba de Fragmentos","mana_cost": 25,"dmg_mult": 2.0, "stun_chance": 0.3, "desc": "ExplosÃ£o de estilhaÃ§os."},
            {"name": "â˜ ï¸ Disparo Envenenado","mana_cost": 20, "dmg_mult": 1.8, "poison": True, "desc": "Bala com veneno mortal."},
            {"name": "ğŸŒªï¸ Rajada RÃ¡pida",    "mana_cost": 30, "dmg_mult": 2.2, "desc": "Cinco tiros em um segundo."},
        ],
        "advanced": [
            {"name": "ğŸ”« Tiro Fatal",        "mana_cost": 45, "dmg_mult": 3.0, "crit_chance": 0.5, "desc": "Tiro com 50% de crÃ­tico."},
            {"name": "ğŸ’¥ ExplosÃ£o Suprema",  "mana_cost": 55, "dmg_mult": 3.5, "ignore_def": True, "desc": "ProjÃ©til que ignora armaduras."},
        ],
        "supreme": {
            "name": "ğŸ‘ï¸ O Tiro ImpossÃ­vel", "mana_cost": 80, "dmg_mult": 5.8, "crit_chance": 0.85, "ignore_def": True,
            "desc": "Um tiro que viaja atravÃ©s do tempo para acertar o alvo. ImpossÃ­vel de desviar.",
            "unlock_boss": "â™¾ï¸ Loop Temporal"
        },
    },
    # â”€â”€ XAMÃƒ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    "XamÃ£": {
        "basic": [
            {"name": "ğŸª¶ EspÃ­rito Guerreiro", "mana_cost": 15,"dmg_mult": 1.5, "desc": "EspÃ­rito ancestral ataca."},
            {"name": "ğŸŒŠ MaldiÃ§Ã£o Tribal",    "mana_cost": 20, "dmg_mult": 1.3, "weaken": True, "desc": "MaldiÃ§Ã£o dos ancestrais."},
        ],
        "intermediate": [
            {"name": "ğŸº EspÃ­rito do Lobo",  "mana_cost": 30, "dmg_mult": 2.0, "desc": "Lobo espiritual desmembra."},
            {"name": "âš¡ TrovÃ£o dos Ancestrais","mana_cost": 35,"dmg_mult": 2.3, "stun_chance": 0.35, "desc": "Raio convocado pelos mortos."},
            {"name": "ğŸ’š Cura dos EspÃ­ritos", "mana_cost": 25, "dmg_mult": 1.2, "self_heal": 60, "desc": "EspÃ­ritos curam ferimentos."},
        ],
        "advanced": [
            {"name": "ğŸŒ‹ FÃºria dos Totens",  "mana_cost": 50, "dmg_mult": 2.8, "poison": True, "stun_chance": 0.3, "desc": "Totens ancestrais despertam furiosos."},
            {"name": "ğŸ’€ PossessÃ£o Espiritual","mana_cost": 55,"dmg_mult": 3.2, "weaken": True, "ignore_def": True, "desc": "EspÃ­rito penetra o inimigo por dentro."},
        ],
        "supreme": {
            "name": "ğŸŒŒ ConvocaÃ§Ã£o Primordial", "mana_cost": 90, "dmg_mult": 5.2, "self_heal": 100, "stun_chance": 0.5,
            "desc": "Chama todos os ancestrais de todas as eras. O maior poder espiritual do mundo.",
            "unlock_boss": "Yeti Colossal"
        },
    },
    # â”€â”€ TEMPESTEIRO â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    "Tempesteiro": {
        "basic": [
            {"name": "âš¡ Raio Simples",      "mana_cost": 10, "dmg_mult": 1.5, "stun_chance": 0.2, "desc": "Raio bÃ¡sico."},
            {"name": "ğŸ’¨ Rajada de Vento",   "mana_cost": 15, "dmg_mult": 1.4, "desc": "Vento cortante."},
        ],
        "intermediate": [
            {"name": "â›ˆï¸ Tempestade Local",  "mana_cost": 30, "dmg_mult": 2.2, "stun_chance": 0.3, "desc": "Tempestade concentrada."},
            {"name": "ğŸŒŠ Ciclone ElÃ©trico",  "mana_cost": 35, "dmg_mult": 2.5, "stun_chance": 0.4, "desc": "FuracÃ£o elÃ©trico devasta."},
            {"name": "ğŸŒ©ï¸ Cadeia de Raios",  "mana_cost": 40, "dmg_mult": 2.0, "poison": True, "desc": "Raios encadeados que queimam."},
        ],
        "advanced": [
            {"name": "ğŸŒªï¸ FuracÃ£o Arcano",   "mana_cost": 55, "dmg_mult": 3.2, "stun_chance": 0.45, "desc": "FuracÃ£o que leva o inimigo."},
            {"name": "âš¡ Plasma Absoluto",   "mana_cost": 60, "dmg_mult": 3.6, "ignore_def": True, "desc": "Plasma que dissolve matÃ©ria."},
        ],
        "supreme": {
            "name": "ğŸŒ©ï¸ Zeus Menor II â€” A Tempestade Eterna", "mana_cost": 100, "dmg_mult": 6.0, "stun_chance": 0.7, "ignore_def": True,
            "desc": "Invoca o poder de Zeus Menor. RelÃ¢mpagos sem fim que nunca param.",
            "unlock_boss": "Zeus Menor, o Trovejante"
        },
    },
    # â”€â”€ ILUSIONISTA â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    "Ilusionista": {
        "basic": [
            {"name": "ğŸª„ IlusÃ£o BÃ¡sica",     "mana_cost": 10, "dmg_mult": 1.3, "stun_chance": 0.2, "desc": "IlusÃ£o confunde o inimigo."},
            {"name": "ğŸŒ€ Espelho Falso",      "mana_cost": 15, "dmg_mult": 1.2, "def_bonus": 15, "desc": "Cria cÃ³pia para desviar ataques."},
        ],
        "intermediate": [
            {"name": "ğŸ­ Pesadelo VÃ­vido",   "mana_cost": 30, "dmg_mult": 2.0, "stun_chance": 0.4, "weaken": True, "desc": "Faz o inimigo ver seus medos."},
            {"name": "ğŸ’« DoppelgÃ¤nger",       "mana_cost": 35, "dmg_mult": 2.2, "desc": "Clone que ataca o inimigo."},
            {"name": "ğŸŒ‘ Realidade Alternativa","mana_cost": 40,"dmg_mult": 2.4, "ignore_def": True, "desc": "Move o ataque para uma realidade sem defesas."},
        ],
        "advanced": [
            {"name": "ğŸ‘ï¸ Labirinto Mental",  "mana_cost": 50, "dmg_mult": 2.8, "stun_chance": 0.6, "desc": "Prende a mente do inimigo."},
            {"name": "ğŸŒŒ Grande IlusÃ£o",      "mana_cost": 60, "dmg_mult": 3.2, "weaken": True, "stun_chance": 0.4, "desc": "IlusÃ£o tÃ£o real que causa dano fÃ­sico."},
        ],
        "supreme": {
            "name": "â™¾ï¸ Fim da Realidade", "mana_cost": 90, "dmg_mult": 5.0, "stun_chance": 0.8, "weaken": True,
            "desc": "Faz o inimigo acreditar que jÃ¡ morreu. TÃ£o poderoso que pode se tornar realidade.",
            "unlock_boss": "Olho do Abismo"
        },
    },
    # â”€â”€ ALQUIMISTA â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    "Alquimista": {
        "basic": [
            {"name": "âš—ï¸ Bomba Ãcida",       "mana_cost": 10, "dmg_mult": 1.4, "poison": True, "desc": "Ãcido corroi o inimigo."},
            {"name": "ğŸ§ª PoÃ§Ã£o Explosiva",    "mana_cost": 15, "dmg_mult": 1.5, "desc": "PoÃ§Ã£o que explode no contato."},
        ],
        "intermediate": [
            {"name": "â˜ ï¸ GÃ¡s TÃ³xico",        "mana_cost": 25, "dmg_mult": 1.8, "poison": True, "weaken": True, "desc": "Nuvem de gÃ¡s envenena e debilita."},
            {"name": "ğŸ”¥ Napalm Arcano",     "mana_cost": 30, "dmg_mult": 2.2, "poison": True, "desc": "LÃ­quido flamejante grudento."},
            {"name": "ğŸ’Š Elixir de Combate", "mana_cost": 20, "dmg_mult": 1.3, "self_heal": 50, "def_bonus": 20, "desc": "Elixir que potencializa capacidades."},
        ],
        "advanced": [
            {"name": "ğŸ’¥ Bomba de Fragmentos Arcanos","mana_cost": 50,"dmg_mult": 3.0, "stun_chance": 0.35, "poison": True, "desc": "EstilhaÃ§os envenenados!"},
            {"name": "âš—ï¸ TransmutaÃ§Ã£o Letal", "mana_cost": 55, "dmg_mult": 3.4, "ignore_def": True, "desc": "Transmuta a armadura do inimigo em pÃ³."},
        ],
        "supreme": {
            "name": "â˜¢ï¸ Grande TransmutaÃ§Ã£o", "mana_cost": 85, "dmg_mult": 5.5, "ignore_def": True, "poison": True, "weaken": True,
            "desc": "Transmuta toda matÃ©ria do inimigo em elemento instÃ¡vel. A pedra filosofal da destruiÃ§Ã£o.",
            "unlock_boss": "O Caos em Pessoa"
        },
    },
    # â”€â”€ GUARDIÃƒO DO ABISMO â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    "GuardiÃ£o do Abismo": {
        "basic": [
            {"name": "â™¾ï¸ Toque do Vazio",    "mana_cost": 15, "dmg_mult": 1.5, "weaken": True, "desc": "O vazio corrÃ³i o inimigo."},
            {"name": "ğŸŒ‘ Barreira do Abismo","mana_cost": 20, "dmg_mult": 1.2, "def_bonus": 25, "desc": "Barreira de energia do vazio."},
        ],
        "intermediate": [
            {"name": "ğŸ’€ Fissura do Vazio",  "mana_cost": 30, "dmg_mult": 2.2, "ignore_def": True, "desc": "Fenda dimensional ataca."},
            {"name": "ğŸŒ€ Espiral do Nada",   "mana_cost": 35, "dmg_mult": 2.4, "stun_chance": 0.35, "desc": "Espiral suga e destrÃ³i."},
            {"name": "ğŸ‘ï¸ Olhar do Abismo",  "mana_cost": 25, "dmg_mult": 1.8, "weaken": True, "poison": True, "desc": "Olhar que corrÃ³i alma e corpo."},
        ],
        "advanced": [
            {"name": "â™¾ï¸ Colapso Dimensional","mana_cost": 55,"dmg_mult": 3.3, "stun_chance": 0.4, "desc": "DimensÃ£o colapsa sobre o inimigo!"},
            {"name": "ğŸŒŒ Pureza do Vazio",   "mana_cost": 65, "dmg_mult": 3.8, "ignore_def": True, "weaken": True, "desc": "Poder puro do nada absoluto."},
        ],
        "supreme": {
            "name": "â˜¯ï¸ O Nada Que Devora", "mana_cost": 100, "dmg_mult": 6.0, "ignore_def": True, "weaken": True, "stun_chance": 0.5,
            "desc": "O abismo engole o inimigo completamente. NÃ£o existe defesa contra o nada.",
            "unlock_boss": "O Senhor das Sombras"
        },
    },
    # â”€â”€ DANÃ‡ARINO DA MORTE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    "DanÃ§arino da Morte": {
        "basic": [
            {"name": "ğŸ’ƒ Passo Letal",        "mana_cost": 0,  "dmg_mult": 1.5, "crit_chance": 0.3, "desc": "DanÃ§a e golpeia sem parar."},
            {"name": "ğŸ—¡ï¸ LÃ¢minas DanÃ§antes", "mana_cost": 15, "dmg_mult": 1.6, "desc": "LÃ¢minas giram em danÃ§a."},
        ],
        "intermediate": [
            {"name": "ğŸ’€ Valsa da Morte",     "mana_cost": 25, "dmg_mult": 2.2, "crit_chance": 0.4, "desc": "DanÃ§a mortal e hipnÃ³tica."},
            {"name": "ğŸ©¸ Sangue na Pista",    "mana_cost": 20, "dmg_mult": 2.0, "poison": True, "desc": "Deixa rastro de veneno na danÃ§a."},
            {"name": "ğŸŒ€ Girar do Caos",      "mana_cost": 30, "dmg_mult": 2.3, "stun_chance": 0.35, "desc": "Gira causando tontura no inimigo."},
        ],
        "advanced": [
            {"name": "ğŸŒªï¸ TurbilhÃ£o de LÃ¢minas","mana_cost": 45,"dmg_mult": 3.0, "crit_chance": 0.5, "desc": "TufÃ£o de lÃ¢minas afiadas!"},
            {"name": "ğŸ’« Ãšltimo Passo",       "mana_cost": 55, "dmg_mult": 3.5, "ignore_def": True, "crit_chance": 0.4, "desc": "O golpe final da danÃ§a."},
        ],
        "supreme": {
            "name": "â˜ ï¸ DanÃ§a do Apocalipse", "mana_cost": 85, "dmg_mult": 5.8, "crit_chance": 0.9, "ignore_def": True, "poison": True,
            "desc": "Uma danÃ§a tÃ£o rÃ¡pida que cria rÃ©plicas. Cortes em cada dimensÃ£o do espaÃ§o.",
            "unlock_boss": "DanÃ§arino da Morte"
        },
    },
    # â”€â”€ ORÃCULO â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    "OrÃ¡culo": {
        "basic": [
            {"name": "ğŸ”® VisÃ£o do Futuro",   "mana_cost": 15, "dmg_mult": 1.4, "weaken": True, "desc": "VÃª o prÃ³ximo ataque e debilita."},
            {"name": "â­ MaldiÃ§Ã£o do Destino","mana_cost": 20, "dmg_mult": 1.5, "desc": "Predestina dano ao inimigo."},
        ],
        "intermediate": [
            {"name": "â±ï¸ DistorÃ§Ã£o Temporal", "mana_cost": 30, "dmg_mult": 2.0, "stun_chance": 0.45, "desc": "Temporariamente paralisa o tempo do inimigo."},
            {"name": "ğŸ’« Fio do Destino",     "mana_cost": 25, "dmg_mult": 2.2, "ignore_def": True, "desc": "Ataca atravÃ©s do destino predestinado."},
            {"name": "ğŸŒŒ Paradoxo",           "mana_cost": 35, "dmg_mult": 2.4, "weaken": True, "stun_chance": 0.3, "desc": "Cria paradoxo que confunde e debilita."},
        ],
        "advanced": [
            {"name": "â™¾ï¸ Reescrever o Passado","mana_cost": 55,"dmg_mult": 3.2, "ignore_def": True, "desc": "Reescreve a batalha a seu favor."},
            {"name": "ğŸŒ  VisÃ£o do Fim",       "mana_cost": 60, "dmg_mult": 3.5, "weaken": True, "stun_chance": 0.4, "desc": "Mostra ao inimigo sua prÃ³pria morte."},
        ],
        "supreme": {
            "name": "â³ O Destino Era Este", "mana_cost": 95, "dmg_mult": 5.5, "stun_chance": 0.7, "ignore_def": True, "weaken": True,
            "desc": "Desde o inÃ­cio do universo, estava escrito que este golpe acertaria. IrresistÃ­vel.",
            "unlock_boss": "Loop Temporal"
        },
    },
    # â”€â”€ COLOSSUS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    "Colossus": {
        "basic": [
            {"name": "ğŸ—¿ Soco de Pedra",     "mana_cost": 0,  "dmg_mult": 1.6, "stun_chance": 0.2, "desc": "Punho do tamanho de uma rocha."},
            {"name": "ğŸ”ï¸ Postura de Granito","mana_cost": 10, "dmg_mult": 0.8, "def_bonus": 35, "desc": "Postura impenetrÃ¡vel."},
        ],
        "intermediate": [
            {"name": "ğŸŒ‹ Pisar do Colossus", "mana_cost": 25, "dmg_mult": 2.0, "stun_chance": 0.4, "desc": "Pisada que racha o chÃ£o."},
            {"name": "ğŸ’ª Golpe MonolÃ­tico",  "mana_cost": 30, "dmg_mult": 2.3, "ignore_def": True, "desc": "ForÃ§a de uma montanha."},
            {"name": "ğŸ›¡ï¸ Fortaleza Viva",   "mana_cost": 20, "dmg_mult": 1.0, "def_bonus": 50, "self_heal": 40, "desc": "Torna-se uma fortaleza."},
        ],
        "advanced": [
            {"name": "ğŸŒ Terremoto",         "mana_cost": 50, "dmg_mult": 3.0, "stun_chance": 0.5, "desc": "Abala a terra causando tremores."},
            {"name": "ğŸ’¥ Colapso Gravitacional","mana_cost": 55,"dmg_mult": 3.4, "ignore_def": True, "desc": "Gravidade aumentada esmaga."},
        ],
        "supreme": {
            "name": "ğŸ”ï¸ A Montanha Desperta", "mana_cost": 80, "dmg_mult": 5.2, "stun_chance": 0.6, "ignore_def": True, "def_bonus": 40,
            "desc": "A forÃ§a de uma cordilheira inteira. Nada sobrevive a este golpe.",
            "unlock_boss": "Primeiro Gigante Primordial"
        },
    },
    # â”€â”€ DEVORADOR DE ALMAS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    "Devorador de Almas": {
        "basic": [
            {"name": "ğŸ’« Devorar Fragmento", "mana_cost": 15, "dmg_mult": 1.5, "self_heal": 15, "desc": "Consume fragmento da alma do inimigo."},
            {"name": "ğŸŒ‘ Fome das Sombras",  "mana_cost": 20, "dmg_mult": 1.4, "weaken": True, "desc": "Fome que drena energia."},
        ],
        "intermediate": [
            {"name": "ğŸ’€ IngestÃ£o da ForÃ§a", "mana_cost": 30, "dmg_mult": 2.0, "self_heal": 30, "desc": "Devora a forÃ§a do inimigo."},
            {"name": "ğŸŒ€ VÃ³rtice da Fome",   "mana_cost": 35, "dmg_mult": 2.3, "stun_chance": 0.3, "desc": "VÃ³rtice que suga energia."},
            {"name": "â˜ ï¸ Roubo de EssÃªncia", "mana_cost": 25, "dmg_mult": 1.8, "self_heal": 40, "weaken": True, "desc": "Rouba essÃªncia vital."},
        ],
        "advanced": [
            {"name": "ğŸ’« Devorar a Alma",    "mana_cost": 55, "dmg_mult": 3.2, "self_heal": 60, "ignore_def": True, "desc": "Consome a alma diretamente."},
            {"name": "ğŸŒŒ Fome Infinita",     "mana_cost": 60, "dmg_mult": 3.5, "self_heal": 80, "desc": "Fome sem fim que cresce com cada golpe."},
        ],
        "supreme": {
            "name": "â™¾ï¸ Consumir a ExistÃªncia", "mana_cost": 100, "dmg_mult": 5.8, "self_heal": 150, "ignore_def": True, "weaken": True,
            "desc": "Devora a prÃ³pria existÃªncia do inimigo. Cada partÃ­cula consumida restaura o Devorador.",
            "unlock_boss": "VÃ¡cuo da CriaÃ§Ã£o"
        },
    },
    # â”€â”€ ARAUTO CELESTIAL â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    "Arauto Celestial": {
        "basic": [
            {"name": "âœ¨ Mensagem Divina",   "mana_cost": 10, "dmg_mult": 1.4, "desc": "Mensagem dos deuses como forÃ§a."},
            {"name": "ğŸ•Šï¸ Escudo da GraÃ§a",  "mana_cost": 15, "dmg_mult": 0.9, "def_bonus": 20, "self_heal": 20, "desc": "GraÃ§a divina protege e cura."},
        ],
        "intermediate": [
            {"name": "â˜€ï¸ Proclama Sagrada",  "mana_cost": 25, "dmg_mult": 2.0, "stun_chance": 0.3, "desc": "Proclama santa atordoa."},
            {"name": "ğŸ‘¼ Chamado dos Anjos", "mana_cost": 30, "dmg_mult": 2.2, "self_heal": 40, "desc": "Anjos respondem ao chamado."},
            {"name": "ğŸŒŸ Luz Celestial",     "mana_cost": 35, "dmg_mult": 2.4, "weaken": True, "desc": "Luz que queima seres das trevas."},
        ],
        "advanced": [
            {"name": "âš¡ LanÃ§a dos CÃ©us",    "mana_cost": 50, "dmg_mult": 3.0, "ignore_def": True, "desc": "LanÃ§a forjada no Trono Celestial."},
            {"name": "ğŸŒˆ Julgamento Celestial","mana_cost": 55,"dmg_mult": 3.3, "stun_chance": 0.4, "self_heal": 60, "desc": "Julgamento dos cÃ©us cai."},
        ],
        "supreme": {
            "name": "ğŸ‘‘ Vontade dos Deuses", "mana_cost": 90, "dmg_mult": 5.2, "ignore_def": True, "self_heal": 120, "stun_chance": 0.4,
            "desc": "Os prÃ³prios deuses falam atravÃ©s do Arauto. O golpe e a cura mÃ¡xima simultaneamente.",
            "unlock_boss": "Imperador Astral"
        },
    },
    # â”€â”€ LANÃ‡ADOR DE VENENOS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    "LanÃ§ador de Venenos": {
        "basic": [
            {"name": "â˜ ï¸ InoculaÃ§Ã£o BÃ¡sica", "mana_cost": 0,  "dmg_mult": 1.3, "poison": True, "desc": "Veneno bÃ¡sico inoculado."},
            {"name": "ğŸ§ª Spray TÃ³xico",      "mana_cost": 10, "dmg_mult": 1.2, "poison": True, "weaken": True, "desc": "Spray que envenena e debilita."},
        ],
        "intermediate": [
            {"name": "ğŸ’€ Veneno Paralisante","mana_cost": 25, "dmg_mult": 1.8, "poison": True, "stun_chance": 0.35, "desc": "Veneno que paralisa os nervos."},
            {"name": "ğŸŒ‘ Praga Sombria",     "mana_cost": 30, "dmg_mult": 2.0, "poison": True, "weaken": True, "desc": "Praga que se espalha."},
            {"name": "âš—ï¸ Toxina Corrosiva",  "mana_cost": 20, "dmg_mult": 1.6, "poison": True, "ignore_def": True, "desc": "CorrÃ³i armaduras e carne."},
        ],
        "advanced": [
            {"name": "â˜¢ï¸ Veneno Arcano",     "mana_cost": 45, "dmg_mult": 2.8, "poison": True, "ignore_def": True, "desc": "Veneno que ignora proteÃ§Ãµes mÃ¡gicas."},
            {"name": "ğŸ’« Morte Lenta Total", "mana_cost": 55, "dmg_mult": 3.2, "poison": True, "weaken": True, "stun_chance": 0.3, "desc": "Veneno que destrÃ³i todos os sistemas."},
        ],
        "supreme": {
            "name": "â˜ ï¸ O Veneno de Todos os Venenos", "mana_cost": 80, "dmg_mult": 4.8, "poison": True, "weaken": True, "ignore_def": True, "stun_chance": 0.5,
            "desc": "Combina todo veneno existente. Paralisa, corrÃ³i, enfraquece e mata simultaneamente.",
            "unlock_boss": "DragÃ£o de Magma"
        },
    },
    # â”€â”€ GLADIADOR â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    "Gladiador": {
        "basic": [
            {"name": "ğŸŸï¸ Golpe da Arena",    "mana_cost": 0,  "dmg_mult": 1.5, "desc": "Golpe calibrado para matar."},
            {"name": "ğŸ›¡ï¸ Bloquear e Golpear","mana_cost": 10, "dmg_mult": 1.3, "def_bonus": 15, "desc": "Defende e contra-ataca."},
        ],
        "intermediate": [
            {"name": "âš”ï¸ Combo da VitÃ³ria",  "mana_cost": 25, "dmg_mult": 2.0, "desc": "SequÃªncia treinada para matar."},
            {"name": "ğŸ’¥ Golpe do CampeÃ£o",  "mana_cost": 30, "dmg_mult": 2.3, "stun_chance": 0.3, "desc": "Golpe de campeÃ£o invicto."},
            {"name": "ğŸ©¸ Sede de GlÃ³ria",    "mana_cost": 20, "dmg_mult": 2.2, "self_heal": 30, "desc": "A glÃ³ria cura ferimentos."},
        ],
        "advanced": [
            {"name": "ğŸ† ExecuÃ§Ã£o LendÃ¡ria", "mana_cost": 50, "dmg_mult": 3.2, "ignore_def": True, "desc": "ExecuÃ§Ã£o digna de lendas."},
            {"name": "ğŸŒŸ Aura do Invicto",   "mana_cost": 45, "dmg_mult": 2.8, "def_bonus": 30, "self_heal": 50, "desc": "Aura de um guerreiro sem derrota."},
        ],
        "supreme": {
            "name": "ğŸŸï¸ O Ãšltimo Combate", "mana_cost": 85, "dmg_mult": 5.5, "ignore_def": True, "stun_chance": 0.45, "self_heal": 80,
            "desc": "O golpe final de uma carreira de mil batalhas. Tudo aprendido, tudo liberado.",
            "unlock_boss": "Imperador Astral"
        },
    },
    # â”€â”€ MESTRE DAS CORRENTES â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    "Mestre das Correntes": {
        "basic": [
            {"name": "â›“ï¸ Corrente BÃ¡sica",   "mana_cost": 10, "dmg_mult": 1.3, "stun_chance": 0.2, "desc": "Corrente prende brevemente."},
            {"name": "ğŸ’ª AÃ§oite de Ferro",   "mana_cost": 0,  "dmg_mult": 1.4, "desc": "AÃ§oite metÃ¡lico poderoso."},
        ],
        "intermediate": [
            {"name": "â›“ï¸ Aprisionamento",    "mana_cost": 25, "dmg_mult": 1.8, "stun_chance": 0.45, "desc": "Correntes prendem o inimigo."},
            {"name": "ğŸ”¥ Correntes Flamejantes","mana_cost": 30,"dmg_mult": 2.2, "poison": True, "desc": "Correntes de fogo queimam."},
            {"name": "ğŸ’« DanÃ§a das Correntes","mana_cost": 20, "dmg_mult": 2.0, "desc": "MÃºltiplas correntes giram e golpeiam."},
        ],
        "advanced": [
            {"name": "ğŸŒ‘ Correntes do Abismo","mana_cost": 50, "dmg_mult": 3.0, "weaken": True, "stun_chance": 0.4, "desc": "Correntes do vazio prendem a alma."},
            {"name": "â™¾ï¸ LaÃ§o da Realidade", "mana_cost": 55, "dmg_mult": 3.3, "ignore_def": True, "desc": "Corrente prende na prÃ³pria realidade."},
        ],
        "supreme": {
            "name": "â›“ï¸ Acorrentar o Universo", "mana_cost": 90, "dmg_mult": 5.3, "stun_chance": 0.7, "ignore_def": True, "weaken": True,
            "desc": "Correntes que aprisionam atÃ© a alma. Nada pode se mover.",
            "unlock_boss": "Caos em Pessoa"
        },
    },
    # â”€â”€ PROFETA DA DESTRUIÃ‡ÃƒO â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    "Profeta da DestruiÃ§Ã£o": {
        "basic": [
            {"name": "ğŸ“¯ AnÃºncio do Caos",   "mana_cost": 10, "dmg_mult": 1.4, "weaken": True, "desc": "Profecia que enfraquece."},
            {"name": "ğŸŒ‘ Sombra da Profecia", "mana_cost": 15, "dmg_mult": 1.5, "desc": "Sombra da destruiÃ§Ã£o futura."},
        ],
        "intermediate": [
            {"name": "ğŸ”¥ Profecias em Chamas","mana_cost": 25, "dmg_mult": 2.0, "poison": True, "desc": "Profecia se manifesta em fogo."},
            {"name": "ğŸ’€ Decreto do Fim",     "mana_cost": 30, "dmg_mult": 2.3, "weaken": True, "stun_chance": 0.3, "desc": "Decreta a destruiÃ§Ã£o do inimigo."},
            {"name": "ğŸŒªï¸ Tempestade ProfÃ©tica","mana_cost": 35,"dmg_mult": 2.5, "desc": "Tempestade do futuro atinge agora."},
        ],
        "advanced": [
            {"name": "ğŸŒ‹ Armageddon Menor",  "mana_cost": 55, "dmg_mult": 3.2, "stun_chance": 0.4, "ignore_def": True, "desc": "VersÃ£o menor do fim do mundo."},
            {"name": "ğŸ’« A Profecia Se Cumpre","mana_cost": 60,"dmg_mult": 3.6, "weaken": True, "poison": True, "desc": "O inevitÃ¡vel ocorre agora."},
        ],
        "supreme": {
            "name": "ğŸŒŒ O Fim Que Profetizei", "mana_cost": 100, "dmg_mult": 6.0, "ignore_def": True, "stun_chance": 0.5, "weaken": True, "poison": True,
            "desc": "A profecia que sempre foi. O universo colapsa em torno do inimigo.",
            "unlock_boss": "O Caos em Pessoa"
        },
    },
    # â”€â”€ FERREIRO DE GUERRA â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    "Ferreiro de Guerra": {
        "basic": [
            {"name": "ğŸ”¨ Martelada Brutal",  "mana_cost": 0,  "dmg_mult": 1.5, "desc": "Martelo de guerra esmaga."},
            {"name": "âš’ï¸ Forjar na Batalha", "mana_cost": 15, "dmg_mult": 1.2, "def_bonus": 20, "desc": "Forja armadura adicional no campo."},
        ],
        "intermediate": [
            {"name": "ğŸ”¥ Golpe da Forja",    "mana_cost": 25, "dmg_mult": 2.0, "stun_chance": 0.3, "desc": "Golpe com metal incandescente."},
            {"name": "âš™ï¸ Bomba da Engrenagem","mana_cost": 30, "dmg_mult": 2.2, "desc": "Engrenagem explosiva arremessada."},
            {"name": "ğŸ›¡ï¸ Armadura de Batalha","mana_cost": 20, "dmg_mult": 1.0, "def_bonus": 40, "self_heal": 35, "desc": "Forja armadura sagrada em segundos."},
        ],
        "advanced": [
            {"name": "ğŸ’« Arma Perfeita",     "mana_cost": 50, "dmg_mult": 3.0, "ignore_def": True, "desc": "Forja a arma perfeita para este momento."},
            {"name": "ğŸŒŸ Lenda da Forja",    "mana_cost": 55, "dmg_mult": 3.4, "def_bonus": 30, "stun_chance": 0.3, "desc": "Arma forjada com memÃ³rias de batalha."},
        ],
        "supreme": {
            "name": "âš’ï¸ A Forja Sagrada Desperta", "mana_cost": 90, "dmg_mult": 5.5, "ignore_def": True, "def_bonus": 50, "self_heal": 80,
            "desc": "A Forja Sagrada dos AnÃµes primordiais. A arma e a armadura definitivas.",
            "unlock_boss": "Golem da Forja Corrompida"
        },
    },
    # â”€â”€ DRAGONLANCER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    "Dragonlancer": {
        "basic": [
            {"name": "ğŸ² LanÃ§a de Fogo",     "mana_cost": 15, "dmg_mult": 1.6, "desc": "LanÃ§a imbuÃ­da de fogo dracÃ´nico."},
            {"name": "ğŸ”¥ Sopro do DragÃ£o",   "mana_cost": 20, "dmg_mult": 1.5, "poison": True, "desc": "Sopro de fogo queima o inimigo."},
        ],
        "intermediate": [
            {"name": "ğŸ‰ Carga DracÃ´nica",   "mana_cost": 30, "dmg_mult": 2.2, "stun_chance": 0.3, "desc": "Monta dragÃ£o e carrega o inimigo."},
            {"name": "ğŸ’¥ Golpe de Cauda",    "mana_cost": 25, "dmg_mult": 2.0, "stun_chance": 0.4, "desc": "Cauda de dragÃ£o golpeia brutalmente."},
            {"name": "ğŸŒ‹ Chuva de Lava",     "mana_cost": 35, "dmg_mult": 2.4, "poison": True, "desc": "Lava cai do cÃ©u."},
        ],
        "advanced": [
            {"name": "ğŸŒŒ Voo DracÃ´nico",     "mana_cost": 50, "dmg_mult": 3.0, "ignore_def": True, "desc": "Ataca em alta velocidade do cÃ©u."},
            {"name": "â­ LanÃ§a das Estrelas", "mana_cost": 55, "dmg_mult": 3.4, "crit_chance": 0.4, "desc": "LanÃ§a de energia estelar."},
        ],
        "supreme": {
            "name": "ğŸ‰ O Ãšltimo DragÃ£o Desperta", "mana_cost": 95, "dmg_mult": 5.8, "ignore_def": True, "stun_chance": 0.4, "poison": True,
            "desc": "O primeiro e Ãºltimo dragÃ£o primordial emerge. Fogo que nÃ£o tem temperatura â€” apenas destruiÃ§Ã£o.",
            "unlock_boss": "DragÃ£o de Magma"
        },
    },
}

# ================= ESPECIALIZAÃ‡Ã•ES (desbloqueadas ao evoluir de classe) =================
CLASS_SPECIALIZATIONS = {
    # â”€â”€ GUERREIRO â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    "CampeÃ£o": {
        "emoji": "ğŸ†",
        "desc": "Especializado em golpes crÃ­ticos e combate ofensivo.",
        "passive": "+20% chance de crÃ­tico. CrÃ­ticos causam 2.5x dano.",
        "bonus_atk": 15, "bonus_hp": 10, "bonus_def": 0,
        "special_skill": {"name": "ğŸ† Golpe do CampeÃ£o", "mana_cost": 35, "dmg_mult": 2.8, "crit_chance": 0.6, "desc": "Golpe do verdadeiro campeÃ£o!"}
    },
    "GuardiÃ£o InabalÃ¡vel": {
        "emoji": "ğŸ›¡ï¸",
        "desc": "Especializado em defesa extrema e proteÃ§Ã£o de aliados.",
        "passive": "+30 DEF permanente. Reflete 10% do dano recebido.",
        "bonus_atk": 0, "bonus_hp": 25, "bonus_def": 30,
        "special_skill": {"name": "ğŸ›¡ï¸ BastiÃ£o", "mana_cost": 25, "dmg_mult": 1.0, "def_bonus": 60, "self_heal": 50, "desc": "Nada atravessa este escudo!"}
    },
    # â”€â”€ MAGO â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    "Piromante": {
        "emoji": "ğŸ”¥",
        "desc": "Controla o fogo com poder sem igual.",
        "passive": "+30% dano de fogo. Todos ataques tÃªm chance de queimar.",
        "bonus_atk": 20, "bonus_hp": 0, "bonus_def": 0,
        "special_skill": {"name": "ğŸŒ‹ Inferno Absoluto", "mana_cost": 60, "dmg_mult": 3.8, "poison": True, "desc": "Fogo que queima atÃ© as almas!"}
    },
    "Criomante": {
        "emoji": "â„ï¸",
        "desc": "Mestre do gelo e do congelamento.",
        "passive": "+35% chance de congelar. Inimigos congelados recebem +20% dano.",
        "bonus_atk": 15, "bonus_hp": 5, "bonus_def": 5,
        "special_skill": {"name": "â„ï¸ Blizzard Eterno", "mana_cost": 55, "dmg_mult": 3.5, "stun_chance": 0.7, "desc": "Tempestade de gelo que imobiliza tudo!"}
    },
    # â”€â”€ ARQUEIRO â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    "CaÃ§ador Sombrio": {
        "emoji": "ğŸŒ‘",
        "desc": "Usa as sombras para golpes letais.",
        "passive": "Primeiro ataque de cada combate Ã© sempre crÃ­tico. +15% crit.",
        "bonus_atk": 18, "bonus_hp": 5, "bonus_def": 0,
        "special_skill": {"name": "ğŸŒ‘ Flecha Sombria", "mana_cost": 40, "dmg_mult": 3.5, "crit_chance": 0.7, "desc": "Flecha que surge das sombras!"}
    },
    "Arqueiro da Tempestade": {
        "emoji": "âš¡",
        "desc": "Flechas carregadas com energia elÃ©trica.",
        "passive": "+30% chance de paralisar com flechas. Cada flecha causa dano em Ã¡rea.",
        "bonus_atk": 20, "bonus_hp": 0, "bonus_def": 0,
        "special_skill": {"name": "âš¡ Tempestade de Raios", "mana_cost": 45, "dmg_mult": 3.2, "stun_chance": 0.6, "desc": "Raios disparam em todas as direÃ§Ãµes!"}
    },
    # â”€â”€ GENÃ‰RICO (demais especializaÃ§Ãµes seguem o mesmo padrÃ£o) â”€â”€â”€â”€
    "Berserker Sagrado": {
        "emoji": "ğŸ”¥",
        "desc": "FÃºria abenÃ§oada pelos deuses da guerra.",
        "passive": "+25% ATK quando HP < 50%. Regenera HP ao matar.",
        "bonus_atk": 25, "bonus_hp": 15, "bonus_def": 0,
        "special_skill": {"name": "ğŸ”¥ FÃºria Sagrada", "mana_cost": 40, "dmg_mult": 3.5, "ignore_def": True, "desc": "FÃºria abenÃ§oada que ignora defesas!"}
    },
    "Mestre das Sombras": {
        "emoji": "ğŸŒ‘",
        "desc": "InvÃ­sivel aos olhos mortais.",
        "passive": "30% de esquiva. Ataques furtivos causam 2x dano.",
        "bonus_atk": 20, "bonus_hp": 0, "bonus_def": 5,
        "special_skill": {"name": "ğŸŒ‘ ExtinÃ§Ã£o Furtiva", "mana_cost": 45, "dmg_mult": 3.8, "crit_chance": 0.65, "desc": "Ataque do invisÃ­vel â€” impossÃ­vel de desviar!"}
    },
    "Lich Aprendiz": {
        "emoji": "ğŸ’€",
        "desc": "Primeiro passo para a imortalidade dos lich.",
        "passive": "Revive com 25% HP uma vez por batalha.",
        "bonus_atk": 15, "bonus_hp": 10, "bonus_def": 5,
        "special_skill": {"name": "ğŸ’€ RessurreiÃ§Ã£o Negra", "mana_cost": 50, "dmg_mult": 2.5, "self_heal": 60, "desc": "Morre e renasce com o poder dos mortos!"}
    },
    "Carnificina": {
        "emoji": "ğŸ©¸",
        "desc": "Cada kill aumenta o dano do prÃ³ximo ataque.",
        "passive": "Acumula stacks de fÃºria a cada dano recebido. +5% ATK por stack.",
        "bonus_atk": 30, "bonus_hp": 0, "bonus_def": 0,
        "special_skill": {"name": "ğŸ©¸ Modo Carnificina", "mana_cost": 35, "dmg_mult": 4.0, "self_dmg": 20, "desc": "Dano mÃ¡ximo com sacrifÃ­cio de HP!"}
    },
    "Metamorfo": {
        "emoji": "ğŸº",
        "desc": "Transforma-se em diferentes bestas para diferentes situaÃ§Ãµes.",
        "passive": "Pode alternar entre forma de ataque (+20% ATK) e forma de cura (+30 HP regen).",
        "bonus_atk": 12, "bonus_hp": 20, "bonus_def": 8,
        "special_skill": {"name": "ğŸº Forma Primordial", "mana_cost": 45, "dmg_mult": 3.2, "self_heal": 60, "desc": "Transforma-se na besta mais antiga!"}
    },
    "Punho de AÃ§o": {
        "emoji": "ğŸ‘Š",
        "desc": "MÃ£os tornam-se armas sagradas.",
        "passive": "+25% dano de golpes sem armas. Cada crÃ­tico cura 15 HP.",
        "bonus_atk": 22, "bonus_hp": 12, "bonus_def": 5,
        "special_skill": {"name": "ğŸ‘Š Punho Divino", "mana_cost": 40, "dmg_mult": 3.5, "ignore_def": True, "desc": "Punho sagrado que atravessa qualquer coisa!"}
    },
    "Bardo da Batalha": {
        "emoji": "ğŸ¸",
        "desc": "MÃºsica inspira e destrÃ³i em igual medida.",
        "passive": "+15% ATK para cada aliado na batalha. MÃºsica causa dano em Ã¡rea.",
        "bonus_atk": 18, "bonus_hp": 10, "bonus_def": 5,
        "special_skill": {"name": "ğŸ¸ Solo da Morte", "mana_cost": 40, "dmg_mult": 3.2, "stun_chance": 0.5, "desc": "Solo tÃ£o poderoso que desintegra!"}
    },
}

# ================= MANA POR CLASSE (novas classes incluÃ­das) =================
CLASS_MANA = {
    "Guerreiro":  {"base_mana": 30,  "mana_per_level": 2},
    "Mago":       {"base_mana": 100, "mana_per_level": 8},
    "Arqueiro":   {"base_mana": 40,  "mana_per_level": 3},
    "Paladino":   {"base_mana": 60,  "mana_per_level": 4},
    "Assassino":  {"base_mana": 50,  "mana_per_level": 3},
    "Necromante": {"base_mana": 80,  "mana_per_level": 6},
    "Berserker":  {"base_mana": 20,  "mana_per_level": 1},
    "Druida":     {"base_mana": 70,  "mana_per_level": 5},
    "Monge":      {"base_mana": 55,  "mana_per_level": 4},
    "Bardo":      {"base_mana": 65,  "mana_per_level": 5},
    # Novas classes
    "Cavaleiro das Sombras": {"base_mana": 55, "mana_per_level": 4},
    "Invocador":             {"base_mana": 90, "mana_per_level": 7},
    "Runesmith":             {"base_mana": 60, "mana_per_level": 4},
    "Cazador de Recompensas":{"base_mana": 45, "mana_per_level": 3},
    "XamÃ£":                  {"base_mana": 75, "mana_per_level": 5},
    "Tempesteiro":           {"base_mana": 85, "mana_per_level": 7},
    "Ilusionista":           {"base_mana": 80, "mana_per_level": 6},
    "Alquimista":            {"base_mana": 55, "mana_per_level": 4},
    "GuardiÃ£o do Abismo":    {"base_mana": 75, "mana_per_level": 6},
    "DanÃ§arino da Morte":    {"base_mana": 50, "mana_per_level": 3},
    "OrÃ¡culo":               {"base_mana": 95, "mana_per_level": 7},
    "Colossus":              {"base_mana": 25, "mana_per_level": 2},
    "Devorador de Almas":    {"base_mana": 70, "mana_per_level": 5},
    "Arauto Celestial":      {"base_mana": 65, "mana_per_level": 5},
    "LanÃ§ador de Venenos":   {"base_mana": 45, "mana_per_level": 3},
    "Gladiador":             {"base_mana": 35, "mana_per_level": 2},
    "Mestre das Correntes":  {"base_mana": 60, "mana_per_level": 4},
    "Profeta da DestruiÃ§Ã£o": {"base_mana": 80, "mana_per_level": 6},
    "Ferreiro de Guerra":    {"base_mana": 40, "mana_per_level": 3},
    "Dragonlancer":          {"base_mana": 55, "mana_per_level": 4},
}

# ================= HABILIDADES POR CLASSE (PvP) =================
CLASS_SKILLS = {
    "Guerreiro": [
        {"name": "ğŸ—¡ï¸ Golpe Devastador", "mana_cost": 0, "dmg_mult": 1.4, "desc": "Um golpe poderoso com toda a forÃ§a!"},
        {"name": "ğŸ›¡ï¸ Ataque Protetor", "mana_cost": 10, "dmg_mult": 1.2, "def_bonus": 10, "desc": "Ataca enquanto se defende."},
        {"name": "âš”ï¸ FÃºria do Guerreiro", "mana_cost": 20, "dmg_mult": 1.8, "desc": "Desencadeia uma rajada de golpes furiosos!"},
        {"name": "ğŸ”¥ Grito de Batalha", "mana_cost": 15, "dmg_mult": 1.5, "stun_chance": 0.2, "desc": "Grita aterrorizante que pode paralisar."},
    ],
    "Mago": [
        {"name": "ğŸ”¥ Bola de Fogo", "mana_cost": 25, "dmg_mult": 2.0, "desc": "Uma esfera flamejante de destruiÃ§Ã£o!"},
        {"name": "âš¡ RelÃ¢mpago Arcano", "mana_cost": 30, "dmg_mult": 2.2, "stun_chance": 0.3, "desc": "Eletricidade arcana que pode paralisar."},
        {"name": "â„ï¸ Toque Gelado", "mana_cost": 20, "dmg_mult": 1.6, "slow_chance": 0.4, "desc": "Congela o adversÃ¡rio reduzindo sua aÃ§Ã£o."},
        {"name": "ğŸŒ€ ExplosÃ£o do Vazio", "mana_cost": 40, "dmg_mult": 2.8, "desc": "Poder do abismo canalizado em destruiÃ§Ã£o!"},
    ],
    "Arqueiro": [
        {"name": "ğŸ¹ Flecha Certeira", "mana_cost": 0, "dmg_mult": 1.5, "desc": "Uma flecha lanÃ§ada com precisÃ£o mortal."},
        {"name": "ğŸ’¨ Chuva de Flechas", "mana_cost": 20, "dmg_mult": 1.7, "desc": "MÃºltiplas flechas caem como chuva!"},
        {"name": "ğŸ¯ Tiro Perfurante", "mana_cost": 15, "dmg_mult": 2.0, "ignore_def": True, "desc": "Flecha que penetra qualquer defesa."},
        {"name": "ğŸŒ¿ Flecha Envenenada", "mana_cost": 10, "dmg_mult": 1.3, "poison": True, "desc": "Veneno que corrÃ³i lentamente."},
    ],
    "Paladino": [
        {"name": "âœ¨ Golpe Sagrado", "mana_cost": 15, "dmg_mult": 1.6, "desc": "Energia divina concentrada em um golpe!"},
        {"name": "ğŸ›¡ï¸ Escudo da FÃ©", "mana_cost": 20, "dmg_mult": 1.0, "self_heal": 30, "desc": "Cura a si mesmo enquanto defende."},
        {"name": "â˜€ï¸ Julgamento Divino", "mana_cost": 35, "dmg_mult": 2.0, "desc": "O julgamento dos cÃ©us cai sobre o inimigo!"},
        {"name": "ğŸŒŸ Aura de ProteÃ§Ã£o", "mana_cost": 25, "dmg_mult": 1.2, "def_bonus": 20, "desc": "Aura que reduz o dano recebido."},
    ],
    "Assassino": [
        {"name": "ğŸ—¡ï¸ Golpe Sorrateiro", "mana_cost": 0, "dmg_mult": 1.8, "crit_chance": 0.4, "desc": "Das sombras, um golpe mortal!"},
        {"name": "ğŸ’¨ DanÃ§a das LÃ¢minas", "mana_cost": 20, "dmg_mult": 1.5, "desc": "Uma sequÃªncia vertiginosa de ataques."},
        {"name": "â˜ ï¸ Veneno Assassino", "mana_cost": 15, "dmg_mult": 1.3, "poison": True, "desc": "Aplica veneno letal no adversÃ¡rio."},
        {"name": "ğŸŒ‘ Golpe das Sombras", "mana_cost": 30, "dmg_mult": 2.5, "crit_chance": 0.5, "desc": "Ataque das trevas com alta chance crÃ­tica!"},
    ],
    "Necromante": [
        {"name": "ğŸ’€ Dreno de Vida", "mana_cost": 20, "dmg_mult": 1.5, "self_heal": 20, "desc": "Rouba HP do adversÃ¡rio!"},
        {"name": "ğŸ¦´ Invocar Esqueleto", "mana_cost": 30, "dmg_mult": 1.7, "desc": "Um esqueleto guerreiro ataca!"},
        {"name": "ğŸŒ‘ MaldiÃ§Ã£o Sombria", "mana_cost": 25, "dmg_mult": 1.4, "weaken": True, "desc": "MaldiÃ§Ã£o que enfraquece o inimigo."},
        {"name": "â˜ ï¸ Morte InstantÃ¢nea", "mana_cost": 50, "dmg_mult": 3.0, "desc": "Toca o vÃ©u entre vida e morte!"},
    ],
    "Berserker": [
        {"name": "ğŸª“ Frenesi", "mana_cost": 0, "dmg_mult": 2.0, "desc": "Ataque frenÃ©tico sem controle!"},
        {"name": "ğŸ’¢ Ira IncontrolÃ¡vel", "mana_cost": 15, "dmg_mult": 2.2, "self_dmg": 10, "desc": "Sacrifica HP prÃ³prio por poder devastador."},
        {"name": "ğŸ©¸ Sede de Sangue", "mana_cost": 10, "dmg_mult": 1.8, "hp_scale": True, "desc": "Quanto menos HP, mais forte o golpe!"},
        {"name": "ğŸ’¥ ExplosÃ£o de FÃºria", "mana_cost": 25, "dmg_mult": 2.8, "desc": "Toda a raiva liberada em um instante!"},
    ],
    "Druida": [
        {"name": "ğŸŒ¿ Golpe Natural", "mana_cost": 0, "dmg_mult": 1.3, "self_heal": 15, "desc": "A natureza cura ao atacar."},
        {"name": "ğŸŒªï¸ Tempestade de Folhas", "mana_cost": 20, "dmg_mult": 1.6, "desc": "Uma tempestade de espinhos e folhas!"},
        {"name": "ğŸº FÃºria Animal", "mana_cost": 30, "dmg_mult": 2.0, "desc": "Transforma-se em besta selvagem!"},
        {"name": "âš¡ TrovÃ£o da Terra", "mana_cost": 35, "dmg_mult": 2.3, "stun_chance": 0.3, "desc": "A terra responde com trovÃ£o!"},
    ],
    "Monge": [
        {"name": "ğŸ‘Š Soco do DragÃ£o", "mana_cost": 0, "dmg_mult": 1.5, "desc": "Um soco carregado de ki!"},
        {"name": "ğŸŒ€ Cem Golpes", "mana_cost": 20, "dmg_mult": 1.7, "desc": "Cem golpes em menos de um segundo!"},
        {"name": "âš¡ Raio de Ki", "mana_cost": 25, "dmg_mult": 2.0, "desc": "Energia vital lanÃ§ada como projÃ©til!"},
        {"name": "ğŸ§˜ Golpe Transcendente", "mana_cost": 40, "dmg_mult": 2.5, "desc": "O corpo e a mente em perfeita harmonia."},
    ],
    "Bardo": [
        {"name": "ğŸµ Nota Dissonante", "mana_cost": 10, "dmg_mult": 1.3, "stun_chance": 0.3, "desc": "Uma nota que atordoa o adversÃ¡rio!"},
        {"name": "ğŸ¸ Acorde do Caos", "mana_cost": 20, "dmg_mult": 1.6, "desc": "Um acorde que confunde os sentidos."},
        {"name": "ğŸº Fanfarra da RuÃ­na", "mana_cost": 15, "dmg_mult": 1.5, "weaken": True, "desc": "Enfraquece o inimigo com mÃºsica mÃ¡gica."},
        {"name": "ğŸ» Sinfonia da DestruiÃ§Ã£o", "mana_cost": 35, "dmg_mult": 2.2, "desc": "A mÃºsica se torna forÃ§a destrutiva pura!"},
    ],
}

# ================= BOSS SKILLS =================
BOSS_SKILLS = {
    "default": [
        {"name": "âš”ï¸ Golpe Brutal", "dmg_mult": 1.5, "desc": "Um golpe poderoso que ecoa pela arena!"},
        {"name": "ğŸŒ€ Rajada de Energia", "dmg_mult": 1.8, "desc": "Energia sombria Ã© liberada em ondas!", "weaken": True},
        {"name": "ğŸ’¥ Impacto SÃ­smico", "dmg_mult": 2.0, "desc": "O tremor abala cada osso do seu corpo!", "stun_chance": 0.25},
        {"name": "ğŸ”¥ Chama Infernal", "dmg_mult": 1.6, "desc": "Fogo que queima a prÃ³pria alma!", "poison": True},
        {"name": "ğŸ’€ Golpe Devastador", "dmg_mult": 2.5, "desc": "Toda a forÃ§a bestial concentrada num Ãºnico golpe!"},
        {"name": "ğŸŒ‘ Sombra Voraz", "dmg_mult": 1.9, "desc": "TentÃ¡culos de escuridÃ£o envolhem o alvo!", "weaken": True},
    ],
    "Slime Rei": [
        {"name": "ğŸŸ¢ DivisÃ£o Slime", "dmg_mult": 1.2, "desc": "O Rei se divide em dezenas de fragmentos corrosivos!", "poison": True},
        {"name": "ğŸ’§ Ãcido Corrosivo", "dmg_mult": 1.8, "desc": "Um jato de Ã¡cido dissolve armadura e carne!", "weaken": True},
        {"name": "ğŸŒŠ Onda Viscosa", "dmg_mult": 2.0, "desc": "Uma onda gigante de gosma engole o campo inteiro!", "stun_chance": 0.3},
        {"name": "ğŸ‘‘ ProclamaÃ§Ã£o Real", "dmg_mult": 2.3, "desc": "*GLUB GLUB!* O Rei slime proclama seu domÃ­nio com um ataque esmagador!"},
        {"name": "ğŸ¦  InfecÃ§Ã£o Celular", "dmg_mult": 1.6, "desc": "CÃ©lulas slime invadem o corpo e se reproduzem dentro!", "poison": True, "weaken": True},
    ],
    "Ent AnciÃ£o": [
        {"name": "ğŸŒ¿ Chicote de Raiz", "dmg_mult": 1.6, "desc": "RaÃ­zes milenares se enroscam nos tornozelos com forÃ§a brutal!"},
        {"name": "ğŸŒªï¸ Tempestade de Espinhos", "dmg_mult": 1.9, "desc": "Mil espinhos perfuram de todos os lados!", "poison": True},
        {"name": "ğŸŒ³ Esmagamento ArbÃ³reo", "dmg_mult": 2.3, "desc": "Galhos do tamanho de troncos esmagam como marretas!", "stun_chance": 0.35},
        {"name": "ğŸ‚ RespiraÃ§Ã£o da Floresta", "dmg_mult": 1.4, "desc": "Polens venenosos paralisam os pulmÃµes!", "poison": True, "stun_chance": 0.2},
        {"name": "ğŸŒ² DESPERTAR ANCESTRAL", "dmg_mult": 2.8, "desc": "O Ent canaliza sÃ©culos de ira â€” a floresta inteira responde ao chamado!", "weaken": True},
    ],
    "FaraÃ³ AmaldiÃ§oado": [
        {"name": "ğŸ”® MaldiÃ§Ã£o Antiga", "dmg_mult": 1.7, "desc": "A maldiÃ§Ã£o dos faraÃ³s drena vitalidade e forÃ§a!", "weaken": True},
        {"name": "ğŸ’€ ExÃ©rcito dos Mortos", "dmg_mult": 2.0, "desc": "LegiÃµes de mÃºmias surgem das areias para devorar!"},
        {"name": "âš¡ Raio do Deserto", "dmg_mult": 2.4, "desc": "A energia elÃ©trica do sol do deserto concentrada num raio!", "stun_chance": 0.2},
        {"name": "ğŸ“¿ Olho de RÃ¡", "dmg_mult": 2.1, "desc": "O olho sagrado abre e emite um feixe de energia devastadora!", "poison": True},
        {"name": "âš°ï¸ AMALDIÃ‡OAMENTO ETERNO", "dmg_mult": 3.0, "desc": "O FaraÃ³ invoca o poder de todos os deuses egÃ­pcios! Morte inevitÃ¡vel!", "weaken": True, "stun_chance": 0.3},
    ],
    "Yeti Colossal": [
        {"name": "â„ï¸ Sopro Ãrtico", "dmg_mult": 1.8, "desc": "Um sopro que congela o sangue nas veias!", "stun_chance": 0.4},
        {"name": "ğŸ”ï¸ Avalanche", "dmg_mult": 2.1, "desc": "Toneladas de neve e pedra rolam montanha abaixo!"},
        {"name": "ğŸ’ª Soco Colossal", "dmg_mult": 2.6, "desc": "Um punho do tamanho de uma pedra de granito!"},
        {"name": "ğŸŒ¨ï¸ Nevasca Mortal", "dmg_mult": 1.7, "desc": "Gelo cortante como navalhas cobre tudo ao redor!", "poison": True, "stun_chance": 0.2},
        {"name": "ğŸ¦£ FÃšRIA DAS MONTANHAS", "dmg_mult": 3.2, "desc": "O Yeti bate o peito e avanÃ§a com toda a sua massa colossal! A terra treme!", "stun_chance": 0.5},
    ],
    "DragÃ£o de Magma": [
        {"name": "ğŸ”¥ Chama Draconiana", "dmg_mult": 2.0, "desc": "Fogo a 3000Â°C que derrete aÃ§o e pedra!", "poison": True},
        {"name": "ğŸ’¨ Rugido de Magma", "dmg_mult": 1.7, "desc": "O rugido cria ondas de calor que queimam por dentro!", "stun_chance": 0.2},
        {"name": "ğŸŒ‹ ErupÃ§Ã£o DracÃ´nica", "dmg_mult": 2.8, "desc": "O dragÃ£o explode â€” lava brota do corpo como uma vulcÃ£o!"},
        {"name": "ğŸ‰ Asas de Cinzas", "dmg_mult": 1.9, "desc": "Asas de chama criam um vÃ³rtice de destruiÃ§Ã£o ao bater!", "weaken": True},
        {"name": "ğŸ’ ESCAMAS DE OBSIDIANA", "dmg_mult": 2.4, "desc": "O dragÃ£o mergulha na lava e ressurge com escamas incandescentes â€” invulnerÃ¡vel!"},
        {"name": "â˜„ï¸ CHUVA DE METEOROS", "dmg_mult": 3.5, "desc": "O DragÃ£o libera toda a energia vulcÃ¢nica acumulada! Pedras em chamas caem do cÃ©u!", "poison": True, "stun_chance": 0.35},
    ],
    "Senhor das Sombras": [
        {"name": "ğŸŒ‘ Trevas Absolutas", "dmg_mult": 2.2, "desc": "A escuridÃ£o total consome todos os sentidos!", "weaken": True},
        {"name": "ğŸ‘ï¸ Olhar Paralisante", "dmg_mult": 1.5, "desc": "Um olhar que paralisa corpo e alma simultaneamente!", "stun_chance": 0.5},
        {"name": "ğŸ’€ Ceifada da Morte", "dmg_mult": 3.0, "desc": "A foice etÃ©rea avanÃ§a â€” nÃ£o hÃ¡ defesa contra ela!", "poison": True},
        {"name": "ğŸ©¸ Drenagem de Alma", "dmg_mult": 1.8, "desc": "Sua essÃªncia vital Ã© sugada das entranhas!", "weaken": True},
        {"name": "ğŸ‘» ExÃ©rcito Espectral", "dmg_mult": 2.5, "desc": "Espectros de guerreiros caÃ­dos atacam simultaneamente!"},
        {"name": "ğŸŒ€ ABISMO ETERNO", "dmg_mult": 4.0, "desc": "O Senhor abre um portal para o vazio eterno â€” tudo Ã© engolido pela escuridÃ£o primordial!", "weaken": True, "stun_chance": 0.4, "poison": True},
    ],
}

# ================= BOSS INTROS (diÃ¡logos de entrada) =================
BOSS_INTROS = {
    "Slime Rei": [
        "ğŸ‘‘ *Uma massa gelatinosa gigantesca emerge do pÃ¢ntano com uma coroa de cristal na cabeÃ§a...*\n> **'GLUB GLUB! GLUB GLUB GLUB!'** *â€” O Slime Rei anuncia seu domÃ­nio!*",
        "ğŸŸ¢ *O chÃ£o estremece enquanto uma gosma colossal coroada avanÃ§a em sua direÃ§Ã£o...*\n> **'Pequeno intruso... vocÃª ousa entrar no meu domÃ­nio viscoso?!'**",
    ],
    "Ent AnciÃ£o": [
        "ğŸŒ³ *As raÃ­zes da floresta tremem... um ser de madeira e ira milenÃ¡ria se ergue das sombras...*\n> **'Esta floresta existia antes de vocÃª nascer. E permanecerÃ¡ depois que vocÃª morrer.'**",
        "ğŸŒ¿ *O vento para. Os pÃ¡ssaros fogem. E entÃ£o... ele abre os olhos de Ã¢mbar...*\n> **'VocÃª perturbou minha paz por 500 anos. Agora pague com sangue.'**",
    ],
    "FaraÃ³ AmaldiÃ§oado": [
        "âš°ï¸ *Vendagens se enrolam. Ouro brilha nas trevas. O faraÃ³ se levanta do sarcÃ³fago...*\n> **'EU FUI TRAÃDO... e agora toda alma que me encontra paga pela traiÃ§Ã£o!'**",
        "ğŸ”® *Os hierÃ³glifos na parede brilham em vermelho. Uma risada seca ecoa nas cÃ¢maras...*\n> **'Milhares de anos de maldiÃ§Ã£o aumentaram meu poder alÃ©m da compreensÃ£o mortal!'**",
    ],
    "Yeti Colossal": [
        "â„ï¸ *Uma silhueta branca e imensa surge atravÃ©s da nevasca. O chÃ£o racha com cada passo...*\n> **'GRAAAAAAAH!'** *â€” NÃ£o hÃ¡ palavras. Apenas fÃºria ancestral.*",
        "ğŸ”ï¸ *Avalanches comeÃ§am ao redor. E entÃ£o vocÃª o vÃª: um colosso de pelo e raiva...*\n> **'VOCÃŠ INVADIU MEU TERRITÃ“RIO... agora sofra as consequÃªncias!'**",
    ],
    "DragÃ£o de Magma": [
        "ğŸŒ‹ *A montanha explode. Lava jorra. E das chamas emerge algo que parece um deus...*\n> **'Ousei de tudo que veio antes de mim. NADA SOBREVIVEU!'**",
        "ğŸ”¥ *VocÃª sente o calor antes de vÃª-lo. EntÃ£o o DragÃ£o de Magma abre seus olhos de fogo...*\n> **'Eu sou o fim de todas as coisas combustÃ­veis. E vocÃª... arde fÃ¡cil.'**",
    ],
    "Senhor das Sombras": [
        "ğŸŒ‘ *A luz some. Toda a luz. E uma voz que vem de todos os lugares ao mesmo tempo ressoa...*\n> **'VocÃª buscou poder nas sombras. Agora as sombras te consomem.'**",
        "ğŸ‘ï¸ *Um olho enorme se forma na escuridÃ£o. Depois outro. E mais. AtÃ© que tudo Ã© olhos...*\n> **'Eu vi o inÃ­cio dos mundos. Serei a testemunha do SEU fim.'**",
    ],
    "default": [
        "*Uma presenÃ§a maligna preenche o ar. O chÃ£o treme. E entÃ£o... ele aparece.*",
        "*O vento para. Um silÃªncio mortal cai sobre o campo de batalha.*",
        "*VocÃª sentiu isso vindo. Mas a realidade sempre Ã© pior do que o imaginado.*",
    ]
}

# ================= BOSS PHASE TAUNTS =================
BOSS_PHASE_TAUNTS = {
    "Slime Rei": {
        "phase2": "ğŸ’¢ **'GLUB! GLUB GLUB! VOCÃŠ ME MACHUCOU?! EU VOU TE DISSOLVER!!!'** *â€” O Slime Rei pulsa com raiva gelatinosa!*",
        "phase3": "ğŸ˜¤ **'N-NÃƒO! IMPOSSÃVEL! EU SOU O REI! O REI NÃƒO PERDE!!!'** *â€” Sua massa comeÃ§a a borbulhar de forma caÃ³tica!*",
        "enrage": "ğŸ’€ **'MODO REI ABSOLUTO ATIVADO!!!'** *â€” O Slime explode e se reagrega em uma forma aterrorizante!*",
    },
    "Ent AnciÃ£o": {
        "phase2": "ğŸŒ¿ **'VocÃª ousou ferir a floresta... Agora ela responde com toda sua FÃšRiA!'** *â€” RaÃ­zes cobrem o cÃ©u!*",
        "phase3": "ğŸ˜¡ **'MIL ANOS DE PACIÃŠNCIA SE ESGOTARAM!'** *â€” Toda a floresta ao redor comeÃ§a a se mover!*",
        "enrage": "ğŸ’¥ **'EU SOU A FLORESTA! EU SOU A IRA DA NATUREZA!'** *â€” O Ent cresce o dobro do seu tamanho!*",
    },
    "FaraÃ³ AmaldiÃ§oado": {
        "phase2": "ğŸ˜  **'COMO OUSAIS?! FUI DERRUBADO?! CONVOCO AS MALDIÃ‡Ã•ES DOS DEZ FARAÃ“S!'**",
        "phase3": "ğŸ’€ **'RÃ¡ me abandona... mas SET me darÃ¡ forÃ§a! A MALDIÃ‡ÃƒO Ã‰ ETERNA!'**",
        "enrage": "â˜ ï¸ **'NÃƒO HÃ MORTE PARA MIM! EU SOU A PRÃ“PRIA MALDIÃ‡ÃƒO ENCARNADA!'** *â€” Aura negra explode ao redor!*",
    },
    "Yeti Colossal": {
        "phase2": "ğŸ˜¤ **'GRRRAAAHHH!!!'** *â€” Mais alto. Mais furioso. A neve ao redor vira uma nevasca!*",
        "phase3": "ğŸ©¸ **'ARGH! VOCÃŠ... VOCÃŠ ME FERIU! NINGUÃ‰M ME FERE!'** *â€” Sangue misturado com neve escorre de seu pelo!*",
        "enrage": "ğŸ’€ **'MODO FERAL ATIVADO!'** *â€” Os olhos do Yeti ficam completamente vermelhos. Toda contenÃ§Ã£o foi perdida!*",
    },
    "DragÃ£o de Magma": {
        "phase2": "ğŸ”¥ **'VocÃª... conseguiu me ferir?! IMPRESSIONANTE! E INACEITÃVEL!'** *â€” As escamas incendeiam com mais intensidade!*",
        "phase3": "ğŸŒ‹ **'SINTO O MAGMA FERVER EM MINHAS VEIAS! VOCÃŠ ACORDOU O VULCÃƒO DENTRO DE MIM!'**",
        "enrage": "â˜„ï¸ **'FORMA FINAL DE DRAGÃƒO!'** *â€” O dragÃ£o se ergue, libera um rugido que racha o cÃ©u e a terra pega fogo!*",
    },
    "Senhor das Sombras": {
        "phase2": "ğŸ‘ï¸ **'Dor? HÃ¡ dÃ©cadas nÃ£o sinto dor... Que sensaÃ§Ã£o... DELICIOSA.'**",
        "phase3": "ğŸŒ‘ **'VocÃª me surpreende, mortal. Talvez eu te dÃª a honra de te matar pessoalmente.'**",
        "enrage": "ğŸ’€ **'MODO DEUS DAS TREVAS!'** *â€” O Senhor das Sombras se dissolve e a escuridÃ£o toma conta de tudo!*",
    },
    "default": {
        "phase2": "ğŸ˜¡ **'Impressionante... mas INSUFICIENTE!'** *â€” O boss comeÃ§a a brilhar com energia sombria!*",
        "phase3": "ğŸ©¸ **'Eu nÃ£o... EU NÃƒO VOU MORRER AQUI!'** *â€” O boss entra em frenesi!*",
        "enrage": "ğŸ’€ **'FORMA FINAL!'** *â€” Uma aura devastadora explode ao redor do boss!*",
    }
}

# ================= BOSS DEATH LINES =================
BOSS_DEATH_LINES = {
    "Slime Rei": "ğŸ’š *O Slime Rei emite um Ãºltimo 'glub' triste... e se desfaz lentamente em uma poÃ§a de gosma inerte. Sua coroa cai no chÃ£o com um tinido.*\n> **'...glub...'**",
    "Ent AnciÃ£o": "ğŸ‚ *Com um gemido que soa como mil Ã¡rvores caindo, o Ent AnciÃ£o tremula... suas folhas caem todas de uma vez. E entÃ£o ele para.*\n> **'...proteji... o que pude...'**",
    "FaraÃ³ AmaldiÃ§oado": "âš°ï¸ *As vendagens se desintegram. O ouro escurece. Com um grito de agonia, o FaraÃ³ se desfaz em pÃ³ de areia...*\n> **'A MALDIÃ‡ÃƒO... segue contigo... para sempre...'**",
    "Yeti Colossal": "â„ï¸ *O Yeti Colossal tamba para trÃ¡s como uma montanha desabando. A neve se assentua. SilÃªncio nas montanhas.*\n> **'...queria apenas... paz...'**",
    "DragÃ£o de Magma": "ğŸŒ‹ *O DragÃ£o de Magma emite um rugido final que range os ossos. Seu corpo se resfria... rachadurasaparecem em suas escamas. E entÃ£o... silÃªncio vulcÃ¢nico.*\n> **'Eu... eu era... invencÃ­vel...'**",
    "Senhor das Sombras": "ğŸŒ‘ *A escuridÃ£o recua. Pela primeira vez em milÃªnios, luz penetra neste lugar. O Senhor das Sombras se fragmenta em mil sombras menores, que desaparecem no vento.*\n> **'...a escuridÃ£o... sempre... retorna...'**",
    "default": "*O boss emite um grito final e cai, derrubando o chÃ£o ao redor. O eco da batalha se dissipa lentamente...*",
}

# ================= BOSS VICTORY LINES (quando o boss vence) =================
BOSS_VICTORY_TAUNTS = {
    "Slime Rei": "ğŸ‘‘ **'GLUB GLUB GLORIOSO!'** *â€” O Slime Rei celebra engolindo seu equipamento.*",
    "Ent AnciÃ£o": "ğŸŒ¿ **'A floresta prevalece. Como sempre prevaleceu.'**",
    "FaraÃ³ AmaldiÃ§oado": "âš°ï¸ **'Mais uma alma para minha coleÃ§Ã£o. Descanse entre os mortos, herÃ³i.'**",
    "Yeti Colossal": "â„ï¸ **'GRAAAAH!'** *â€” O Yeti assopra neve sobre vocÃª e vai embora.*",
    "DragÃ£o de Magma": "ğŸ”¥ **'PatÃ©tico. Vejo melhores guerreiros na sola das minhas garras.'**",
    "Senhor das Sombras": "ğŸŒ‘ **'As sombras te agradecem pela refeiÃ§Ã£o, herÃ³i. Descanse nas trevas eternas.'**",
    "default": "*O boss te olha com desprezo e vai embora, deixando vocÃª na poeira da derrota.*",
}

# ================= ALLY BATTLE SYSTEM =================
ALLY_CLASS_ACTIONS = {
    "Guerreiro": [
        ("âš”ï¸ **{name}** avanÃ§a com um grito de guerra e golpeia com todo o peso de sua armadura!", 1.4),
        ("ğŸ›¡ï¸ **{name}** para na frente para proteger o grupo e devolve o dano em dobro!", 1.6),
        ("ğŸ’ª **{name}** levanta sua espada para os cÃ©us e desfere um golpe devastador!", 1.8),
    ],
    "Mago": [
        ("ğŸ”® **{name}** conjura uma explosÃ£o arcana que faz o boss recuar em dor!", 1.7),
        ("âš¡ **{name}** lanÃ§a raios mÃ¡gicos em sÃ©rie que perfuram as defesas do boss!", 1.9),
        ("âœ¨ **{name}** abre um tomo proibido e libera energia que distorce a realidade ao redor do boss!", 2.1),
    ],
    "Arqueiro": [
        ("ğŸ¹ **{name}** mira com precisÃ£o cirÃºrgica e dispara uma flecha no ponto fraco!", 1.5),
        ("ğŸ¯ **{name}** solta uma chuva de flechas encantadas que cobre o boss por inteiro!", 1.7),
        ("ğŸ’¨ **{name}** atira uma flecha de vento que atravessa todas as defesas!", 1.6),
    ],
    "Paladino": [
        ("ğŸŒŸ **{name}** invoca a luz sagrada e descarrega energia divina sobre o boss!", 1.6),
        ("âš¡ **{name}** bate o escudo no chÃ£o e cria uma onda sagrada expansiva!", 1.8),
        ("ğŸ›¡ï¸ **{name}** ergue a espada sagrada e esmaga o boss com o peso da justiÃ§a!", 1.7),
    ],
    "Assassino": [
        ("ğŸ—¡ï¸ **{name}** some nas sombras e reaparece pelas costas do boss â€” golpe crÃ­tico garantido!", 2.0),
        ("ğŸŒ‘ **{name}** usa veneno de cobra real e finca duas lÃ¢minas nos pontos vitais!", 1.9),
        ("âš¡ **{name}** executa dez golpes em um segundo â€” uma danÃ§a mortal de lÃ¢minas!", 1.8),
    ],
    "Necromante": [
        ("ğŸ’€ **{name}** invoca o espÃ­rito de um guerreiro caÃ­do que ataca com fÃºria fantasmagÃ³rica!", 1.7),
        ("ğŸ©¸ **{name}** drena a forÃ§a vital do boss e transfere energia para os aliados!", 1.6),
        ("â˜ ï¸ **{name}** lanÃ§a uma maldiÃ§Ã£o que apodrece a armadura do boss por dentro!", 1.8),
    ],
    "Berserker": [
        ("ğŸª“ **{name}** entra em frenesi total e desmonta o boss com golpes descomunais!", 2.0),
        ("ğŸ˜¤ **{name}** ignora qualquer dano e avanÃ§a como uma mÃ¡quina de destruiÃ§Ã£o!", 1.9),
        ("ğŸ’¥ **{name}** grita com os pulmÃµes e ataca sem controle â€” puro poder bruto!", 2.2),
    ],
    "Druida": [
        ("ğŸŒ¿ **{name}** convoca um enxame de besouros mÃ¡gicos que corroem o boss!", 1.5),
        ("ğŸŒ± **{name}** faz raÃ­zes emergirem do chÃ£o e imobilizarem o boss momentaneamente!", 1.7),
        ("ğŸŒŠ **{name}** chama uma tempestade natural que esmaga o boss com granizo mÃ¡gico!", 1.8),
    ],
    "Monge": [
        ("ğŸ‘Š **{name}** desacorrentado de toda inibiÃ§Ã£o, golpeia 50 vezes em 3 segundos!", 1.9),
        ("ğŸŒ€ **{name}** canaliza ki puro e desfere um soco que cria uma onda de choque!", 2.0),
        ("âš¡ **{name}** combina defesa e ataque num movimento de arte marcial ancestral!", 1.7),
    ],
    "Bardo": [
        ("ğŸµ **{name}** toca uma melodia de guerra que amplifica o poder de todos os aliados! O boss estremece!", 1.4),
        ("ğŸ¶ **{name}** canta uma canÃ§Ã£o maldita que enfraquece as defesas do boss!", 1.5),
        ("ğŸ¸ **{name}** executa um acorde tÃ£o poderoso que cria uma onda sonora destruidora!", 1.6),
    ],
    "default": [
        ("âš”ï¸ **{name}** avanÃ§a e ataca com determinaÃ§Ã£o feroz!", 1.5),
        ("ğŸ’¥ **{name}** golpeia o boss com toda sua forÃ§a!", 1.7),
    ]
}

ALLY_BATTLE_CRIES = {
    "Guerreiro": [
        "âš”ï¸ *'Por honra e glÃ³ria!'*",
        "ğŸ›¡ï¸ *'Nenhum de nÃ³s cai hoje!'*",
        "ğŸ’ª *'Juntos somos invencÃ­veis!'*",
    ],
    "Mago": [
        "ğŸ”® *'Minha magia estÃ¡ do nosso lado!'*",
        "âœ¨ *'O arcanismo nunca falha!'*",
        "âš¡ *'Deixa eu acabar com isso!'*",
    ],
    "Arqueiro": [
        "ğŸ¹ *'Achei o ponto fraco!'*",
        "ğŸ¯ *'Essa flecha vai doer!'*",
        "ğŸ’¨ *'Confiem na minha pontaria!'*",
    ],
    "Paladino": [
        "ğŸŒŸ *'A luz nos protege!'*",
        "âš”ï¸ *'Pela justiÃ§a divina!'*",
        "ğŸ›¡ï¸ *'Eu nunca recuo!'*",
    ],
    "Assassino": [
        "ğŸ—¡ï¸ *'JÃ¡ vi o ponto fatal...'*",
        "ğŸŒ‘ *'SilÃªncio antes da tempestade.'*",
        "âš¡ *'RÃ¡pido como o vento, mortal como a noite.'*",
    ],
    "Necromante": [
        "ğŸ’€ *'Os mortos trabalham para nÃ³s!'*",
        "â˜ ï¸ *'A morte Ã© apenas o comeÃ§o!'*",
        "ğŸ©¸ *'Meus aliados nunca morrem de verdade.'*",
    ],
    "Berserker": [
        "ğŸª“ *'MATAR! DESTRUIR! SMASH!'*",
        "ğŸ˜¤ *'EU NÃƒO SINTO DOR!!!*",
        "ğŸ’¥ *'MODO BERSERK ATIVADO!!!'*",
    ],
    "Druida": [
        "ğŸŒ¿ *'A natureza responde ao chamado!'*",
        "ğŸŒ± *'RaÃ­zes e trevas nos obedecem!'*",
        "ğŸŒŠ *'Os elementos lutam conosco!'*",
    ],
    "Monge": [
        "ğŸ‘Š *'Foco. RespiraÃ§Ã£o. DestruiÃ§Ã£o.'*",
        "ğŸŒ€ *'Meu ki estÃ¡ no limite mÃ¡ximo!'*",
        "âš¡ *'Um golpe. Ã‰ tudo que preciso.'*",
    ],
    "Bardo": [
        "ğŸµ *'Que minha mÃºsica seja nossa arma!'*",
        "ğŸ¶ *'OuÃ§am o som da vitÃ³ria!'*",
        "ğŸ¸ *'Esta batalha merece uma balada Ã©pica!'*",
    ],
    "default": [
        "*'NÃ£o vou deixar vocÃª lutar sozinho!'*",
        "*'Juntos atÃ© o fim!'*",
        "*'Vamos acabar com esse monstro!'*",
    ]
}

# ================= ACHIEVEMENTS =================
ACHIEVEMENTS = [
    # === COMBATE (30) ===
    {"id": "first_kill", "cat": "âš”ï¸ Combate", "name": "Primeiro Sangue", "desc": "Derrote seu primeiro monstro", "xp": 100, "stat": "monsters_killed", "threshold": 1},
    {"id": "kills_10", "cat": "âš”ï¸ Combate", "name": "CaÃ§ador Iniciante", "desc": "Derrote 10 monstros", "xp": 100, "stat": "monsters_killed", "threshold": 10},
    {"id": "kills_50", "cat": "âš”ï¸ Combate", "name": "CaÃ§ador Experiente", "desc": "Derrote 50 monstros", "xp": 200, "stat": "monsters_killed", "threshold": 50},
    {"id": "kills_100", "cat": "âš”ï¸ Combate", "name": "CaÃ§ador Veterano", "desc": "Derrote 100 monstros", "xp": 400, "stat": "monsters_killed", "threshold": 100},
    {"id": "kills_250", "cat": "âš”ï¸ Combate", "name": "Exterminador", "desc": "Derrote 250 monstros", "xp": 600, "stat": "monsters_killed", "threshold": 250},
    {"id": "kills_500", "cat": "âš”ï¸ Combate", "name": "Anjo da Morte", "desc": "Derrote 500 monstros", "xp": 900, "stat": "monsters_killed", "threshold": 500},
    {"id": "kills_1000", "cat": "âš”ï¸ Combate", "name": "Lenda das Batalhas", "desc": "Derrote 1000 monstros", "xp": 1500, "stat": "monsters_killed", "threshold": 1000},
    {"id": "boss_1", "cat": "âš”ï¸ Combate", "name": "CaÃ§ador de Bosses", "desc": "Derrote seu primeiro boss", "xp": 150, "stat": "bosses_defeated", "threshold": 1},
    {"id": "boss_3", "cat": "âš”ï¸ Combate", "name": "Domador de Colossais", "desc": "Derrote 3 bosses", "xp": 300, "stat": "bosses_defeated", "threshold": 3},
    {"id": "boss_5", "cat": "âš”ï¸ Combate", "name": "Terror dos Bosses", "desc": "Derrote 5 bosses", "xp": 500, "stat": "bosses_defeated", "threshold": 5},
    {"id": "boss_10", "cat": "âš”ï¸ Combate", "name": "Matador de Deuses", "desc": "Derrote 10 bosses", "xp": 900, "stat": "bosses_defeated", "threshold": 10},
    {"id": "boss_20", "cat": "âš”ï¸ Combate", "name": "Lenda Imortal", "desc": "Derrote 20 bosses", "xp": 1500, "stat": "bosses_defeated", "threshold": 20},
    {"id": "first_boss_unique", "cat": "âš”ï¸ Combate", "name": "Primeiro Colossus", "desc": "Derrote o primeiro boss de level", "xp": 300, "special": "level_boss_1"},
    {"id": "all_level_bosses", "cat": "âš”ï¸ Combate", "name": "Conquistador dos Planos Absolutos", "desc": "Derrote todos os 60 bosses de level (do nÃ­vel 9 ao 599)", "xp": 50000, "special": "all_level_bosses"},
    {"id": "slime_rei", "cat": "âš”ï¸ Combate", "name": "Massacrador de Slimes", "desc": "Derrote o Slime Rei", "xp": 300, "special": "boss_slime_rei"},
    {"id": "dragon", "cat": "âš”ï¸ Combate", "name": "Dragoneante", "desc": "Derrote o DragÃ£o de Magma", "xp": 600, "special": "boss_dragao"},
    {"id": "shadow_lord", "cat": "âš”ï¸ Combate", "name": "Derrotando as Sombras", "desc": "Derrote o Senhor das Sombras", "xp": 750, "special": "boss_sombras"},
    {"id": "pvp_win_1", "cat": "âš”ï¸ Combate", "name": "Guerreiro PvP", "desc": "VenÃ§a seu primeiro duelo PvP", "xp": 150, "special": "pvp_win_1"},
    {"id": "pvp_win_10", "cat": "âš”ï¸ Combate", "name": "CampeÃ£o de Duelos", "desc": "VenÃ§a 10 duelos PvP", "xp": 450, "special": "pvp_win_10"},
    {"id": "no_damage", "cat": "âš”ï¸ Combate", "name": "IntocÃ¡vel", "desc": "Derrote um boss com HP acima de 80%", "xp": 450, "special": "boss_no_damage"},
    {"id": "crit_master", "cat": "âš”ï¸ Combate", "name": "Mestre dos CrÃ­ticos", "desc": "Acerte 50 golpes crÃ­ticos", "xp": 400, "special": "crit_50"},
    {"id": "poison_master", "cat": "âš”ï¸ Combate", "name": "Mestre dos Venenos", "desc": "Envenene 20 inimigos", "xp": 200, "special": "poison_20"},
    {"id": "stun_master", "cat": "âš”ï¸ Combate", "name": "Mestre dos Atordoamentos", "desc": "Atordoe 15 inimigos", "xp": 200, "special": "stun_15"},
    {"id": "class_master", "cat": "âš”ï¸ Combate", "name": "Mestre da Classe", "desc": "Use todas as habilidades da sua classe em batalha", "xp": 300, "special": "all_skills_used"},
    {"id": "dungeon_10", "cat": "âš”ï¸ Combate", "name": "Explorador de Masmorras", "desc": "Complete 10 masmorras", "xp": 300, "special": "dungeons_10"},
    {"id": "dungeon_50", "cat": "âš”ï¸ Combate", "name": "Mestre das Masmorras", "desc": "Complete 50 masmorras", "xp": 750, "special": "dungeons_50"},
    {"id": "legendary_drop", "cat": "âš”ï¸ Combate", "name": "Agraciado pelos Deuses", "desc": "Receba um item LendÃ¡rio de drop de boss", "xp": 450, "special": "legendary_drop"},
    {"id": "divine_drop", "cat": "âš”ï¸ Combate", "name": "Toque Divino", "desc": "Receba um item Divino de drop de boss", "xp": 1200, "special": "divine_drop"},
    {"id": "comeback_win", "cat": "âš”ï¸ Combate", "name": "VinganÃ§a Ã‰pica", "desc": "Derrote um boss apÃ³s usar o botÃ£o VinganÃ§a", "xp": 450, "special": "comeback_win"},
    {"id": "training_champion", "cat": "âš”ï¸ Combate", "name": "DedicaÃ§Ã£o Suprema", "desc": "Use o sistema de treinamento 10 vezes", "xp": 300, "special": "training_10"},
    # === EXPLORAÃ‡ÃƒO (20) ===
    {"id": "explore_1", "cat": "ğŸ—ºï¸ ExploraÃ§Ã£o", "name": "Aventureiro", "desc": "Explore pela primeira vez", "xp": 50, "stat": "areas_explored", "threshold": 1},
    {"id": "explore_10", "cat": "ğŸ—ºï¸ ExploraÃ§Ã£o", "name": "Explorador", "desc": "Explore 10 Ã¡reas", "xp": 100, "stat": "areas_explored", "threshold": 10},
    {"id": "explore_50", "cat": "ğŸ—ºï¸ ExploraÃ§Ã£o", "name": "Desbravador", "desc": "Explore 50 Ã¡reas", "xp": 300, "stat": "areas_explored", "threshold": 50},
    {"id": "explore_100", "cat": "ğŸ—ºï¸ ExploraÃ§Ã£o", "name": "CartÃ³grafo", "desc": "Explore 100 Ã¡reas", "xp": 600, "stat": "areas_explored", "threshold": 100},
    {"id": "explore_250", "cat": "ğŸ—ºï¸ ExploraÃ§Ã£o", "name": "Lenda dos Mapas", "desc": "Explore 250 Ã¡reas", "xp": 1200, "stat": "areas_explored", "threshold": 250},
    {"id": "world_2", "cat": "ğŸ—ºï¸ ExploraÃ§Ã£o", "name": "AlÃ©m das Fronteiras", "desc": "Desbloqueie o segundo mundo", "xp": 200, "special": "world_2"},
    {"id": "world_3", "cat": "ğŸ—ºï¸ ExploraÃ§Ã£o", "name": "Viajante dos Reinos", "desc": "Desbloqueie o terceiro mundo", "xp": 400, "special": "world_3"},
    {"id": "world_4", "cat": "ğŸ—ºï¸ ExploraÃ§Ã£o", "name": "Mestre dos Portais", "desc": "Desbloqueie o quarto mundo", "xp": 600, "special": "world_4"},
    {"id": "world_5", "cat": "ğŸ—ºï¸ ExploraÃ§Ã£o", "name": "Conquistador Dimensional", "desc": "Desbloqueie o quinto mundo", "xp": 900, "special": "world_5"},
    {"id": "all_worlds", "cat": "ğŸ—ºï¸ ExploraÃ§Ã£o", "name": "Senhor de Todos os Mundos", "desc": "Desbloqueie todos os mundos", "xp": 1800, "special": "all_worlds"},
    {"id": "secret_dungeon", "cat": "ğŸ—ºï¸ ExploraÃ§Ã£o", "name": "Descobridor do Abismo", "desc": "Encontre uma masmorra secreta", "xp": 300, "special": "secret_dungeon"},
    {"id": "mimic_survive", "cat": "ğŸ—ºï¸ ExploraÃ§Ã£o", "name": "Sobrevivente do MÃ­mico", "desc": "Sobreviva a um ataque de MÃ­mico", "xp": 200, "special": "mimic_survive"},
    {"id": "hunt_10", "cat": "ğŸ—ºï¸ ExploraÃ§Ã£o", "name": "CaÃ§ador do Reino", "desc": "Cace 10 vezes no mesmo reino", "xp": 150, "special": "hunt_10_same"},
    {"id": "full_map", "cat": "ğŸ—ºï¸ ExploraÃ§Ã£o", "name": "CartÃ³grafo Completo", "desc": "Descubra todas as localizaÃ§Ãµes de um mundo", "xp": 450, "special": "full_map_world"},
    {"id": "night_explorer", "cat": "ğŸ—ºï¸ ExploraÃ§Ã£o", "name": "Criatura da Noite", "desc": "Explore Ã s 3 da manhÃ£ (horÃ¡rio do servidor)", "xp": 100, "special": "night_explore"},
    {"id": "fast_explore", "cat": "ğŸ—ºï¸ ExploraÃ§Ã£o", "name": "RelÃ¢mpago", "desc": "Explore 5 Ã¡reas em uma hora", "xp": 150, "special": "fast_5_explore"},
    {"id": "dungeon_first_time", "cat": "ğŸ—ºï¸ ExploraÃ§Ã£o", "name": "Primeiro nas Sombras", "desc": "Entre em uma masmorra pela primeira vez", "xp": 100, "special": "first_dungeon"},
    {"id": "loot_100", "cat": "ğŸ—ºï¸ ExploraÃ§Ã£o", "name": "Saqueador", "desc": "Colete 100 itens no total", "xp": 300, "special": "loot_100"},
    {"id": "survive_trap", "cat": "ğŸ—ºï¸ ExploraÃ§Ã£o", "name": "Sortudo", "desc": "Sobreviva a 5 armadilhas em masmorras", "xp": 150, "special": "survive_5_traps"},
    {"id": "no_fail_explore", "cat": "ğŸ—ºï¸ ExploraÃ§Ã£o", "name": "Explorador Invicto", "desc": "Explore 10 vezes seguidas sem falhar", "xp": 400, "special": "explore_10_streak"},
    # === ECONOMIA (20) ===
    {"id": "coins_1k", "cat": "ğŸ’° Economia", "name": "Primeiras Moedas", "desc": "Ganhe 1.000 CSI no total", "xp": 100, "stat": "total_coins_earned", "threshold": 1000},
    {"id": "coins_10k", "cat": "ğŸ’° Economia", "name": "Comerciante", "desc": "Ganhe 10.000 CSI no total", "xp": 200, "stat": "total_coins_earned", "threshold": 10000},
    {"id": "coins_50k", "cat": "ğŸ’° Economia", "name": "Mercador Rico", "desc": "Ganhe 50.000 CSI no total", "xp": 450, "stat": "total_coins_earned", "threshold": 50000},
    {"id": "coins_100k", "cat": "ğŸ’° Economia", "name": "MilionÃ¡rio", "desc": "Ganhe 100.000 CSI no total", "xp": 900, "stat": "total_coins_earned", "threshold": 100000},
    {"id": "coins_500k", "cat": "ğŸ’° Economia", "name": "Magnata", "desc": "Ganhe 500.000 CSI no total", "xp": 1800, "stat": "total_coins_earned", "threshold": 500000},
    {"id": "buy_first_item", "cat": "ğŸ’° Economia", "name": "Primeira Compra", "desc": "Compre seu primeiro item na loja", "xp": 50, "special": "buy_first"},
    {"id": "buy_legendary", "cat": "ğŸ’° Economia", "name": "Comprador de Sonhos", "desc": "Compre um item LendÃ¡rio", "xp": 300, "special": "buy_legendary"},
    {"id": "sell_items", "cat": "ğŸ’° Economia", "name": "Comerciante Nato", "desc": "Venda 20 itens", "xp": 150, "special": "sell_20"},
    {"id": "equip_epic", "cat": "ğŸ’° Economia", "name": "Equipado para a Guerra", "desc": "Equipe um item Ã‰pico ou melhor", "xp": 150, "special": "equip_epic"},
    {"id": "equip_legendary", "cat": "ğŸ’° Economia", "name": "Escolhido pelos Deuses", "desc": "Equipe um item LendÃ¡rio", "xp": 450, "special": "equip_legendary"},
    {"id": "equip_divine", "cat": "ğŸ’° Economia", "name": "Avatar Divino", "desc": "Equipe um item Divino", "xp": 1200, "special": "equip_divine"},
    {"id": "full_set", "cat": "ğŸ’° Economia", "name": "Arsenal Completo", "desc": "Equipe arma e armadura ao mesmo tempo", "xp": 100, "special": "full_equip"},
    {"id": "inv_20", "cat": "ğŸ’° Economia", "name": "Colecionador", "desc": "Tenha 20 itens no inventÃ¡rio", "xp": 100, "special": "inv_20"},
    {"id": "inv_50", "cat": "ğŸ’° Economia", "name": "Acumulador", "desc": "Tenha 50 itens no inventÃ¡rio", "xp": 200, "special": "inv_50"},
    {"id": "potion_10", "cat": "ğŸ’° Economia", "name": "Alquimista", "desc": "Beba 10 poÃ§Ãµes", "xp": 100, "special": "potion_10"},
    {"id": "broke", "cat": "ğŸ’° Economia", "name": "Falido", "desc": "Fique com 0 moedas CSI", "xp": 50, "special": "broke"},
    {"id": "xp_10k", "cat": "ğŸ’° Economia", "name": "Veterano", "desc": "Acumule 10.000 XP no total", "xp": 150, "stat": "total_xp_earned", "threshold": 10000},
    {"id": "xp_100k", "cat": "ğŸ’° Economia", "name": "LendÃ¡rio do XP", "desc": "Acumule 100.000 XP no total", "xp": 750, "stat": "total_xp_earned", "threshold": 100000},
    {"id": "xp_500k", "cat": "ğŸ’° Economia", "name": "Transcendente", "desc": "Acumule 500.000 XP no total", "xp": 1800, "stat": "total_xp_earned", "threshold": 500000},
    {"id": "work_first", "cat": "ğŸ’° Economia", "name": "Trabalhador Honesto", "desc": "Trabalhe pela primeira vez", "xp": 50, "special": "work_first"},
    # === PROGRESSÃƒO (20) ===
    {"id": "level_5", "cat": "ğŸŒŸ ProgressÃ£o", "name": "Primeiros Passos", "desc": "Alcance o nÃ­vel 5", "xp": 100, "stat": "level", "threshold": 5},
    {"id": "level_10", "cat": "ğŸŒŸ ProgressÃ£o", "name": "Guerreiro dos Campos", "desc": "Alcance o nÃ­vel 10", "xp": 150, "stat": "level", "threshold": 10},
    {"id": "level_20", "cat": "ğŸŒŸ ProgressÃ£o", "name": "Cavaleiro do Reino", "desc": "Alcance o nÃ­vel 20", "xp": 300, "stat": "level", "threshold": 20},
    {"id": "level_30", "cat": "ğŸŒŸ ProgressÃ£o", "name": "HerÃ³i Consagrado", "desc": "Alcance o nÃ­vel 30", "xp": 500, "stat": "level", "threshold": 30},
    {"id": "level_40", "cat": "ğŸŒŸ ProgressÃ£o", "name": "CampeÃ£o dos Reinos", "desc": "Alcance o nÃ­vel 40", "xp": 750, "stat": "level", "threshold": 40},
    {"id": "level_50", "cat": "ğŸŒŸ ProgressÃ£o", "name": "Lenda Viva", "desc": "Alcance o nÃ­vel 50", "xp": 1200, "stat": "level", "threshold": 50},
    {"id": "level_60", "cat": "ğŸŒŸ ProgressÃ£o", "name": "Deus Mortal", "desc": "Alcance o nÃ­vel 60", "xp": 2250, "stat": "level", "threshold": 60},
    {"id": "level_100", "cat": "ğŸŒŸ ProgressÃ£o", "name": "CenturiÃ£o dos Reinos", "desc": "Alcance o nÃ­vel 100", "xp": 5000, "stat": "level", "threshold": 100},
    {"id": "level_150", "cat": "ğŸŒŸ ProgressÃ£o", "name": "Semideus Mortal", "desc": "Alcance o nÃ­vel 150", "xp": 10000, "stat": "level", "threshold": 150},
    {"id": "level_200", "cat": "ğŸŒŒ Reinos AvanÃ§ados", "name": "TrancendÃªncia Mortal", "desc": "Alcance o nÃ­vel 200 â€” entre nos Reinos AvanÃ§ados!", "xp": 20000, "stat": "level", "threshold": 200},
    {"id": "level_250", "cat": "ğŸŒŒ Reinos AvanÃ§ados", "name": "Pioneiro Dimensional", "desc": "Alcance o nÃ­vel 250", "xp": 35000, "stat": "level", "threshold": 250},
    {"id": "level_300", "cat": "ğŸŒŒ Reinos AvanÃ§ados", "name": "Conquistador dos Planos", "desc": "Alcance o nÃ­vel 300", "xp": 60000, "stat": "level", "threshold": 300},
    {"id": "level_350", "cat": "ğŸŒŒ Reinos AvanÃ§ados", "name": "Senhor dos Reinos AvanÃ§ados", "desc": "Alcance o nÃ­vel 350", "xp": 90000, "stat": "level", "threshold": 350},
    {"id": "level_400", "cat": "ğŸ’« DimensÃµes Superiores", "name": "Ser Dimensional", "desc": "Alcance o nÃ­vel 400 â€” entre nas DimensÃµes Superiores!", "xp": 150000, "stat": "level", "threshold": 400},
    {"id": "level_450", "cat": "ğŸ’« DimensÃµes Superiores", "name": "Entidade Dimensional", "desc": "Alcance o nÃ­vel 450", "xp": 200000, "stat": "level", "threshold": 450},
    {"id": "level_500", "cat": "â™¾ï¸ Planos Absolutos", "name": "Habitante do Absoluto", "desc": "Alcance o nÃ­vel 500 â€” entre nos Planos Absolutos!", "xp": 350000, "stat": "level", "threshold": 500},
    {"id": "level_550", "cat": "â™¾ï¸ Planos Absolutos", "name": "Ser Absoluto", "desc": "Alcance o nÃ­vel 550", "xp": 500000, "stat": "level", "threshold": 550},
    {"id": "level_600", "cat": "â™¾ï¸ Planos Absolutos", "name": "O Absoluto â€” NÃ­vel MÃ¡ximo", "desc": "Alcance o lendÃ¡rio nÃ­vel 600!", "xp": 1000000, "stat": "level", "threshold": 600},
    {"id": "class_chosen", "cat": "ğŸŒŸ ProgressÃ£o", "name": "O Chamado", "desc": "Escolha sua classe", "xp": 100, "special": "class_chosen"},
    {"id": "pet_first", "cat": "ğŸŒŸ ProgressÃ£o", "name": "Tamer", "desc": "Tenha seu primeiro pet", "xp": 100, "special": "pet_first"},
    {"id": "pet_rare", "cat": "ğŸŒŸ ProgressÃ£o", "name": "Dono de Raridades", "desc": "Capture um pet Raro ou melhor", "xp": 300, "special": "pet_rare"},
    {"id": "guild_join", "cat": "ğŸŒŸ ProgressÃ£o", "name": "Companheiro de Guilda", "desc": "Entre em uma guilda", "xp": 150, "special": "guild_join"},
    {"id": "guild_master", "cat": "ğŸŒŸ ProgressÃ£o", "name": "LÃ­der Supremo", "desc": "Crie ou lidere uma guilda", "xp": 450, "special": "guild_master"},
    {"id": "quest_1", "cat": "ğŸŒŸ ProgressÃ£o", "name": "MissÃ£o Aceita", "desc": "Complete sua primeira quest", "xp": 100, "special": "quest_1"},
    {"id": "quest_10", "cat": "ğŸŒŸ ProgressÃ£o", "name": "HerÃ³i das MissÃµes", "desc": "Complete 10 quests", "xp": 300, "special": "quest_10"},
    {"id": "quest_25", "cat": "ğŸŒŸ ProgressÃ£o", "name": "Lenda das Quests", "desc": "Complete 25 quests", "xp": 750, "special": "quest_25"},
    {"id": "alignment_hero", "cat": "ğŸŒŸ ProgressÃ£o", "name": "CoraÃ§Ã£o de HerÃ³i", "desc": "Alcance o alinhamento HerÃ³i", "xp": 300, "special": "alignment_hero"},
    {"id": "alignment_villain", "cat": "ğŸŒŸ ProgressÃ£o", "name": "Sombra do Caos", "desc": "Alcance o alinhamento VilÃ£o", "xp": 300, "special": "alignment_villain"},
    {"id": "job_first", "cat": "ğŸŒŸ ProgressÃ£o", "name": "Trabalhador da Cidade", "desc": "Aceite seu primeiro emprego", "xp": 100, "special": "job_first"},
    {"id": "defend_city", "cat": "ğŸŒŸ ProgressÃ£o", "name": "GuardiÃ£o das Muralhas", "desc": "Defenda a cidade pela primeira vez", "xp": 150, "special": "defend_city"},
    {"id": "farm_first_harvest", "cat": "ğŸŒŸ ProgressÃ£o", "name": "Fazendeiro", "desc": "FaÃ§a sua primeira colheita na fazenda", "xp": 100, "special": "farm_harvest"},
    # === SECRETAS (10) ===
    {"id": "death_cheat", "cat": "ğŸ”® Secreta", "name": "FrÃ¡gil Imortalidade", "desc": "Sobreviva com 1 HP em batalha", "xp": 750, "special": "zero_hp_survive"},
    {"id": "max_mana", "cat": "ğŸ”® Secreta", "name": "ReservatÃ³rio Arcano", "desc": "Use mana mÃ¡xima em uma Ãºnica batalha", "xp": 450, "special": "max_mana_battle"},
    {"id": "all_classes", "cat": "ğŸ”® Secreta", "name": "O Polivalente", "desc": "Mude de classe 3 vezes", "xp": 1200, "special": "all_classes_tried"},
    {"id": "midnight_boss", "cat": "ğŸ”® Secreta", "name": "Criatura da Meia-Noite", "desc": "Derrote um boss Ã  meia-noite", "xp": 600, "special": "boss_midnight"},
    {"id": "rich_broke", "cat": "ğŸ”® Secreta", "name": "Ciclo da Fortuna", "desc": "Acumule 10k CSI e depois fique com 0", "xp": 450, "special": "rich_then_broke"},
    {"id": "solo_all_bosses", "cat": "ğŸ”® Secreta", "name": "SolitÃ¡rio LendÃ¡rio", "desc": "Derrote todos os bosses de level sozinho", "xp": 1500, "special": "solo_all_bosses"},
    {"id": "perfect_boss", "cat": "ğŸ”® Secreta", "name": "Combate Perfeito", "desc": "Derrote um boss sem ser envenenado/atordoado", "xp": 900, "special": "perfect_boss_fight"},
    {"id": "first_message", "cat": "ğŸ”® Secreta", "name": "O ComeÃ§o", "desc": "Seja o primeiro jogador do servidor", "xp": 150, "special": "first_player"},
    {"id": "born_survivor", "cat": "ğŸ”® Secreta", "name": "Nascido para Sobreviver", "desc": "Sobreviva a 100 batalhas", "xp": 750, "special": "survived_100_battles"},
    {"id": "max_training", "cat": "ğŸ”® Secreta", "name": "AlÃ©m dos Limites", "desc": "Maximize todos os boosts de treinamento", "xp": 1200, "special": "max_all_training"},
]

TRAINING_OPTIONS = {
    "forca":      {"cost": 200,  "atk_boost": 5,  "emoji": "âš”ï¸", "desc": "Aumenta ATK em +5 permanentemente"},
    "defesa":     {"cost": 200,  "def_boost": 5,  "emoji": "ğŸ›¡ï¸", "desc": "Aumenta DEF em +5 permanentemente"},
    "vitalidade": {"cost": 200,  "hp_boost": 20,  "emoji": "â¤ï¸", "desc": "Aumenta HP MÃ¡ximo em +20 permanentemente"},
    "intensivo":  {"cost": 600, "atk_boost": 10, "def_boost": 10, "hp_boost": 35, "emoji": "ğŸ”¥", "desc": "Treino intensivo: +10 ATK, +10 DEF, +35 HP Max"},
    "mana":       {"cost": 200,  "mana_boost": 15, "emoji": "ğŸ’", "desc": "Aumenta Mana MÃ¡xima em +15 (requer Livro de FeitiÃ§os)"},
}
# Multiplicadores disponÃ­veis para treino em massa
TRAINING_MULTIPLIERS = [1, 2, 3, 5, 10, 20]

# ================= MONSTER EQUIPMENT DROPS =================
# Cada monstro pode dropar itens comuns ou incomuns especÃ­ficos
MONSTER_DROPS = {
    # Campos Iniciais
    "Slime": [
        {"name": "Gel de Slime", "type": "resource"},
        {"name": "Espada Enferrujada", "type": "weapon", "rarity": "Comum"},
    ],
    "Goblin": [
        {"name": "Faca de Goblin", "type": "weapon", "rarity": "Comum"},
        {"name": "Escudo de Madeira", "type": "armor", "rarity": "Comum"},
        {"name": "Espada Pequena", "type": "weapon", "rarity": "Incomum"},
    ],
    "Lobo": [
        {"name": "Pele de Lobo", "type": "resource"},
        {"name": "Garra de Lobo", "type": "resource"},
        {"name": "Colete de Couro", "type": "armor", "rarity": "Incomum"},
    ],
    "Esqueleto": [
        {"name": "Osso Afiado", "type": "weapon", "rarity": "Comum"},
        {"name": "Armadura Ã“ssea", "type": "armor", "rarity": "Incomum"},
        {"name": "Espada de Ferro", "type": "weapon", "rarity": "Incomum"},
    ],
    "Rato Selvagem": [
        {"name": "Pelo de Rato", "type": "resource"},
        {"name": "Adaga de Pedra", "type": "weapon", "rarity": "Comum"},
    ],
    # Floresta Ã‰lfica
    "Ent Menor": [
        {"name": "Galho MÃ¡gico", "type": "resource"},
        {"name": "Cajado de Madeira Viva", "type": "weapon", "rarity": "Incomum"},
        {"name": "Vestes de Batalha", "type": "armor", "rarity": "Incomum"},
    ],
    "Aranha Gigante": [
        {"name": "Seda Venenosa", "type": "resource"},
        {"name": "Adaga Venenosa", "type": "weapon", "rarity": "Raro"},
        {"name": "Capa de Sombras", "type": "armor", "rarity": "Raro"},
    ],
    "Elfo Renegado": [
        {"name": "Arco Ã‰lfic", "type": "weapon", "rarity": "Raro"},
        {"name": "Capa de Sombras", "type": "armor", "rarity": "Raro"},
        {"name": "Armadura Ã‰lfica", "type": "armor", "rarity": "Raro"},
    ],
    "EspÃ­rito Florestal": [
        {"name": "EssÃªncia EtÃ©rea", "type": "resource"},
        {"name": "Vestes Arcanas", "type": "armor", "rarity": "Raro"},
    ],
    # Deserto
    "MÃºmia": [
        {"name": "Ataduras MÃ¡gicas", "type": "resource"},
        {"name": "Cetro Antigo", "type": "weapon", "rarity": "Raro"},
        {"name": "Armadura de Ouro", "type": "armor", "rarity": "Ã‰pico"},
    ],
    "EscorpiÃ£o": [
        {"name": "Veneno de EscorpiÃ£o", "type": "resource"},
        {"name": "Garras de EscorpiÃ£o", "type": "weapon", "rarity": "Incomum"},
        {"name": "LanÃ§a do CaÃ§ador", "type": "weapon", "rarity": "Raro"},
    ],
    "EscorpiÃ£o Gigante": [
        {"name": "Veneno Concentrado", "type": "resource"},
        {"name": "LanÃ§a do CaÃ§ador", "type": "weapon", "rarity": "Raro"},
        {"name": "Armadura de Escamas", "type": "armor", "rarity": "Incomum"},
    ],
    # Tundra
    "Urso Glacial": [
        {"name": "Pele Ãrtica", "type": "resource"},
        {"name": "Machado de Gelo", "type": "weapon", "rarity": "Raro"},
        {"name": "Cota Encantada", "type": "armor", "rarity": "Raro"},
    ],
    "Troll de Gelo": [
        {"name": "Cristal de Gelo", "type": "resource"},
        {"name": "Armadura de Permafrost", "type": "armor", "rarity": "Ã‰pico"},
        {"name": "Clava TitÃ¢nica", "type": "weapon", "rarity": "Raro"},
    ],
    "Lobo Glacial": [
        {"name": "Pele de Gelo", "type": "resource"},
        {"name": "Machado RÃºnico", "type": "weapon", "rarity": "Raro"},
    ],
    # VulcÃ£o
    "Salamandra": [
        {"name": "Escama de Fogo", "type": "resource"},
        {"name": "LÃ¢mina Flamejante", "type": "weapon", "rarity": "Ã‰pico"},
        {"name": "Armadura Flamejante", "type": "armor", "rarity": "Ã‰pico"},
    ],
    "DemÃ´nio Menor": [
        {"name": "Fragmento Infernal", "type": "resource"},
        {"name": "Espada DemonÃ­aca", "type": "weapon", "rarity": "Ã‰pico"},
        {"name": "Armadura do Inferno", "type": "armor", "rarity": "Ã‰pico"},
        {"name": "Katana DemonÃ­aca", "type": "weapon", "rarity": "Ã‰pico"},
    ],
    "Elemental de Fogo": [
        {"name": "NÃºcleo de Magma", "type": "resource"},
        {"name": "Cajado Arcano", "type": "weapon", "rarity": "Ã‰pico"},
    ],
    # Clima especial
    "Vampiro": [
        {"name": "Sangue de Vampiro", "type": "resource"},
        {"name": "Foice Maldita", "type": "weapon", "rarity": "Raro"},
        {"name": "Armadura das Sombras", "type": "armor", "rarity": "Ã‰pico"},
    ],
    "Lobo LunÃ¡tico": [
        {"name": "Pele Lunar", "type": "resource"},
        {"name": "Garras da Lua", "type": "weapon", "rarity": "Raro"},
    ],
    "Espectro Noturno": [
        {"name": "EssÃªncia Sombria", "type": "resource"},
        {"name": "Vestes do SÃ¡bio", "type": "armor", "rarity": "Raro"},
    ],
    "Elemental do TrovÃ£o": [
        {"name": "NÃºcleo ElÃ©trico", "type": "resource"},
        {"name": "Katana RelÃ¢mpago", "type": "weapon", "rarity": "Raro"},
        {"name": "Armadura da Tempestade", "type": "armor", "rarity": "Ã‰pico"},
    ],
    "Fantasma": [
        {"name": "Ectoplasma", "type": "resource"},
        {"name": "Vestes Arcanas", "type": "armor", "rarity": "Raro"},
    ],
    # default fallback
    "default": [
        {"name": "Couro Bruto", "type": "resource"},
        {"name": "Dente de Monstro", "type": "resource"},
    ]
}

# ================= SISTEMA DE CHAVES DE DUNGEON SECRETA =================
# Chaves sÃ£o dropadas de baÃºs nas dungeons comuns e desbloqueiam dungeons secretas
# Tipos de chave disponÃ­veis:
# ğŸ—ï¸ Chave Antiga       â€” Reinos 1â€“10 (Terras Iniciais)
# ğŸ”‘ Chave Arcana       â€” Reinos 11â€“20 (NaÃ§Ãµes IntermediÃ¡rias)
# ğŸ—¡ï¸ Chave Sombria      â€” Reinos 21â€“30 (ImpÃ©rios AvanÃ§ados) + Reinos 31â€“35 (Terras Corrompidas)
# âœ¨ Chave Celestial    â€” Reinos 36â€“40 (Reinos Dimensionais) + DimensÃ£o Celestial
# ğŸŒ‘ Chave Abissal      â€” DimensÃ£o Infernal, Abissal e do Vazio
DUNGEON_KEY_DROP_CHANCE = 0.08  # 8% de sorte â€” chave tambÃ©m cai a cada 5 dungeons completadas

# Tipos de chave por faixa de nÃ­vel (para referÃªncia dos drops)
KEY_TYPE_BY_LEVEL = {
    (1,   100): ("ğŸ—ï¸ Chave Antiga",    "Antiga"),
    (101, 200): ("ğŸ”‘ Chave Arcana",    "Arcana"),
    (201, 350): ("ğŸ—¡ï¸ Chave Sombria",   "Sombria"),
    (351, 400): ("âœ¨ Chave Celestial", "Celestial"),
    (401, 999): ("ğŸŒ‘ Chave Abissal",   "Abissal"),
}

def get_world_secret_dungeon_keys(world_data):
    """Retorna lista de chaves de dungeons secretas do mundo atual."""
    keys = []
    for sd in world_data.get("secret_dungeons", []):
        if "key_name" in sd:
            keys.append(sd["key_name"])
    return keys

def player_has_key(player, key_name):
    """Verifica se o jogador tem a chave especificada."""
    return key_name in player.get("inventory", [])

def consume_key(player, key_name):
    """Remove a chave do inventÃ¡rio do jogador."""
    if key_name in player.get("inventory", []):
        player["inventory"].remove(key_name)
        return True
    return False

# Raridade de drop por tipo de monstro por dado
HUNT_DROP_CHANCE = {
    "resource": 0.40,           # 40% recurso
    "weapon_common": 0.15,      # 15% arma comum/incomum
    "weapon_rare": 0.05,        # 5% arma rara (do monstro)
    "weapon_epic": 0.02,        # 2% Ã©pico (sÃ³ monstros fortes)
    "weapon_legendary": 0.005,  # 0.5% lendÃ¡rio (monstros de elite em reinos altos)
    "weapon_mythic": 0.0005,    # 0.05% MÃ­tico (monstros de elite nos 13 novos reinos)
    # Ancestral/Divino/Primordial: apenas via boss especial de dungeon secreta
}

# Reinos avanÃ§ados (novas Ã¡reas) permitem drops mais raros de monstros
# Reinos 11-40 + DimensÃµes (400+) = drops mais raros permitidos
HIGH_LEVEL_WORLDS = {
    # NaÃ§Ãµes IntermediÃ¡rias (reinos 11â€“20)
    110, 120, 130, 140, 150, 160, 170, 180, 190, 200,
    # ImpÃ©rios AvanÃ§ados (reinos 21â€“30)
    210, 220, 230, 240, 250, 260, 270, 280, 290, 300,
    # Terras Corrompidas (reinos 31â€“35)
    310, 320, 330, 340, 350,
    # Reinos Dimensionais (reinos 36â€“40)
    360, 370, 380, 390, 400,
    # DimensÃµes (Celestial, Infernal, Badlands, Abissal, Vazio) â€” nÃ­vel 401â€“500
    410, 420, 430, 440, 450, 460, 470, 480, 490, 500,
    # Ciclo Absoluto (501â€“600)
    510, 520, 530, 540, 550, 560, 570, 580, 590
}
HIGH_LEVEL_DROP_BONUS = {
    "legendary": 0.008,   # 0.8% lendÃ¡rio em reinos avanÃ§ados
    "mythic": 0.001,      # 0.1% MÃ­tico em reinos avanÃ§ados
    "ancestral": 0.0002   # 0.02% Ancestral nos reinos mais altos (100+)
}

# ================= SISTEMA DE CLIMA =================
WEATHER_TYPES = {
    "sol": {
        "emoji": "â˜€ï¸", "name": "Sol Abrasador",
        "monster_boost": 1.0, "drop_boost": 1.0,
        "special_monsters": [],
        "desc": "O sol brilha forte â€” criaturas normais habitam a regiÃ£o."
    },
    "chuva": {
        "emoji": "ğŸŒ§ï¸", "name": "Chuva Torrencial",
        "monster_boost": 1.2, "drop_boost": 1.1,
        "special_monsters": ["Elemental da Ãgua", "Sapo Gigante", "Serpente Lodosa"],
        "desc": "A chuva atrai criaturas aquÃ¡ticas e torna os monstros mais agressivos!"
    },
    "noite": {
        "emoji": "ğŸŒ™", "name": "Noite Profunda",
        "monster_boost": 1.4, "drop_boost": 1.2,
        "special_monsters": ["Vampiro", "Lobo LunÃ¡tico", "Espectro Noturno"],
        "desc": "A escuridÃ£o acorda as criaturas mais perigosas..."
    },
    "tempestade": {
        "emoji": "â›ˆï¸", "name": "Tempestade ElÃ©trica",
        "monster_boost": 1.5, "drop_boost": 1.3,
        "special_monsters": ["Elemental do TrovÃ£o", "Grifo Tempestuoso"],
        "desc": "Raios caem ao redor â€” criaturas elÃ©tricas surgem das nuvens!"
    },
    "neblina": {
        "emoji": "ğŸŒ«ï¸", "name": "Neblina Arcana",
        "monster_boost": 1.3, "drop_boost": 1.4,
        "special_monsters": ["Fantasma", "Banshee", "Wisp Errante"],
        "desc": "A neblina mÃ¡gica esconde criaturas espectrais e segredos antigos..."
    },
    "lua_sangue": {
        "emoji": "ğŸ©¸ğŸŒ•", "name": "LUA DE SANGUE",
        "monster_boost": 2.5, "drop_boost": 2.0,
        "special_monsters": ["Lobo Colossal", "Vampiro AnciÃ£o", "DemÃ´nio de Sangue", "Boss da Lua de Sangue"],
        "desc": "âš ï¸ LUA DE SANGUE! Monstros extremamente poderosos surgem â€” mas as recompensas sÃ£o extraordinÃ¡rias!"
    }
}

# Clima atual (global, muda a cada X tempo)
CURRENT_WEATHER = {"type": "sol", "changed_at": 0}

# ================= SISTEMA DE PERÃODO (DIA/NOITE) =================
TIME_PERIODS = {
    "amanhecer": {
        "emoji": "ğŸŒ…", "name": "Amanhecer",
        "desc": "O sol nasce no horizonte. A nÃ©voa da noite se dissipa lentamente.",
        "xp_mult": 1.0, "coin_mult": 1.0, "special": "Monstros noturnos enfraquecem."
    },
    "dia": {
        "emoji": "â˜€ï¸", "name": "Dia",
        "desc": "Plena luz do dia. Criaturas da floresta se movem livremente.",
        "xp_mult": 1.1, "coin_mult": 1.1, "special": "ExploraÃ§Ã£o mais segura."
    },
    "entardecer": {
        "emoji": "ğŸŒ‡", "name": "Entardecer",
        "desc": "O sol se pÃµe. Criaturas crepusculares surgem nos arredores.",
        "xp_mult": 1.2, "coin_mult": 1.15, "special": "Chance maior de drops raros."
    },
    "noite": {
        "emoji": "ğŸŒ™", "name": "Noite",
        "desc": "A escuridÃ£o domina. Monstros mais fortes rondam os caminhos.",
        "xp_mult": 1.3, "coin_mult": 1.2, "special": "Monstros mais perigosos, recompensas maiores."
    },
    "meia_noite": {
        "emoji": "ğŸ•›", "name": "Meia-Noite",
        "desc": "O silÃªncio total... apenas os mais corajosos ousam agir agora.",
        "xp_mult": 1.5, "coin_mult": 1.4, "special": "Hora dos lendÃ¡rios! Drops especiais possÃ­veis."
    },
}
PERIOD_ORDER = ["amanhecer", "dia", "entardecer", "noite", "meia_noite"]
CURRENT_PERIOD = {"type": "dia", "changed_at": 0}

# ================= PET EVOLUTION SYSTEM =================
PET_EVOLUTIONS = {
    "Slime BebÃª": {
        "level_required": 5, "next": "Slime Adolescente",
        "next_data": {"name": "Slime Adolescente", "emoji": "ğŸ’§", "rarity": "Incomum", "bonus_hp": 25, "bonus_atk": 8}
    },
    "Slime Adolescente": {
        "level_required": 15, "next": "Slime Mestre",
        "next_data": {"name": "Slime Mestre", "emoji": "ğŸ’ ", "rarity": "Raro", "bonus_hp": 50, "bonus_atk": 18}
    },
    "Coelho MÃ¡gico": {
        "level_required": 8, "next": "Coelho Arcano",
        "next_data": {"name": "Coelho Arcano", "emoji": "ğŸ°", "rarity": "Raro", "bonus_hp": 35, "bonus_atk": 12}
    },
    "Coelho Arcano": {
        "level_required": 20, "next": "Lebre Celestial",
        "next_data": {"name": "Lebre Celestial", "emoji": "âœ¨", "rarity": "Ã‰pico", "bonus_hp": 65, "bonus_atk": 22}
    },
    "Fada da Floresta": {
        "level_required": 10, "next": "Fada Ã‰lfica",
        "next_data": {"name": "Fada Ã‰lfica", "emoji": "ğŸ§š", "rarity": "Ã‰pico", "bonus_hp": 45, "bonus_atk": 18}
    },
    "Fada Ã‰lfica": {
        "level_required": 25, "next": "Fada Primordial",
        "next_data": {"name": "Fada Primordial", "emoji": "ğŸŒŸ", "rarity": "MÃ­tico", "bonus_hp": 90, "bonus_atk": 40}
    },
    "Lobo Cinzento": {
        "level_required": 15, "next": "Lobo das Sombras",
        "next_data": {"name": "Lobo das Sombras", "emoji": "ğŸº", "rarity": "Raro", "bonus_hp": 50, "bonus_atk": 25}
    },
    "Lobo das Sombras": {
        "level_required": 28, "next": "Lobo Alpha LendÃ¡rio",
        "next_data": {"name": "Lobo Alpha LendÃ¡rio", "emoji": "ğŸº", "rarity": "LendÃ¡rio", "bonus_hp": 100, "bonus_atk": 55}
    },
    "Coruja Espectral": {
        "level_required": 18, "next": "Coruja do Destino",
        "next_data": {"name": "Coruja do Destino", "emoji": "ğŸ¦‰", "rarity": "Ã‰pico", "bonus_hp": 65, "bonus_atk": 30}
    },
    "Coruja do Destino": {
        "level_required": 32, "next": "Coruja Divina",
        "next_data": {"name": "Coruja Divina", "emoji": "ğŸ¦‰", "rarity": "MÃ­tico", "bonus_hp": 120, "bonus_atk": 60}
    },
    "DragÃ£o de Gelo BebÃª": {
        "level_required": 25, "next": "DragÃ£o de Gelo Jovem",
        "next_data": {"name": "DragÃ£o de Gelo Jovem", "emoji": "ğŸ‰", "rarity": "MÃ­tico", "bonus_hp": 140, "bonus_atk": 70}
    },
    "DragÃ£o de Gelo Jovem": {
        "level_required": 40, "next": "DragÃ£o de Gelo AnciÃ£o",
        "next_data": {"name": "DragÃ£o de Gelo AnciÃ£o", "emoji": "â„ï¸", "rarity": "Divino", "bonus_hp": 250, "bonus_atk": 120}
    },

    # â”€â”€ Mundo 10 â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    "EspÃ­rito da Floresta": {
        "level_required": 16, "next": "EspÃ­rito AnciÃ£o",
        "next_data": {"name": "EspÃ­rito AnciÃ£o", "emoji": "ğŸŒ²", "rarity": "LendÃ¡rio", "bonus_hp": 75, "bonus_atk": 35}
    },
    "EspÃ­rito AnciÃ£o": {
        "level_required": 30, "next": "EspÃ­rito Primordial",
        "next_data": {"name": "EspÃ­rito Primordial", "emoji": "ğŸŒ³", "rarity": "MÃ­tico", "bonus_hp": 140, "bonus_atk": 65}
    },

    # â”€â”€ Mundo 20 â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    "EscorpiÃ£o Dourado": {
        "level_required": 22, "next": "EscorpiÃ£o Carmesim",
        "next_data": {"name": "EscorpiÃ£o Carmesim", "emoji": "ğŸ¦‚", "rarity": "Ã‰pico", "bonus_hp": 65, "bonus_atk": 32}
    },
    "EscorpiÃ£o Carmesim": {
        "level_required": 35, "next": "EscorpiÃ£o LendÃ¡rio",
        "next_data": {"name": "EscorpiÃ£o LendÃ¡rio", "emoji": "ğŸ¦‚", "rarity": "LendÃ¡rio", "bonus_hp": 120, "bonus_atk": 58}
    },
    "Escaravelho MÃ­stico": {
        "level_required": 25, "next": "Escaravelho Sagrado",
        "next_data": {"name": "Escaravelho Sagrado", "emoji": "ğŸª²", "rarity": "LendÃ¡rio", "bonus_hp": 85, "bonus_atk": 42}
    },
    "Escaravelho Sagrado": {
        "level_required": 38, "next": "Escaravelho Divino",
        "next_data": {"name": "Escaravelho Divino", "emoji": "ğŸª²", "rarity": "MÃ­tico", "bonus_hp": 160, "bonus_atk": 80}
    },
    "Esfinge Menor": {
        "level_required": 28, "next": "Esfinge GuardiÃ£",
        "next_data": {"name": "Esfinge GuardiÃ£", "emoji": "ğŸ¦", "rarity": "MÃ­tico", "bonus_hp": 110, "bonus_atk": 55}
    },
    "Esfinge GuardiÃ£": {
        "level_required": 42, "next": "Esfinge Imortal",
        "next_data": {"name": "Esfinge Imortal", "emoji": "ğŸ¦", "rarity": "Divino", "bonus_hp": 210, "bonus_atk": 105}
    },

    # â”€â”€ Mundo 30 â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    "Raposa Ãrtica": {
        "level_required": 30, "next": "Raposa das Tempestades",
        "next_data": {"name": "Raposa das Tempestades", "emoji": "ğŸ¦Š", "rarity": "LendÃ¡rio", "bonus_hp": 95, "bonus_atk": 48}
    },
    "Raposa das Tempestades": {
        "level_required": 44, "next": "Raposa Celestial",
        "next_data": {"name": "Raposa Celestial", "emoji": "ğŸ¦Š", "rarity": "MÃ­tico", "bonus_hp": 175, "bonus_atk": 88}
    },
    "FÃªnix de Gelo": {
        "level_required": 32, "next": "FÃªnix de Cristal",
        "next_data": {"name": "FÃªnix de Cristal", "emoji": "ğŸ¦…", "rarity": "Divino", "bonus_hp": 180, "bonus_atk": 90}
    },
    "FÃªnix de Cristal": {
        "level_required": 46, "next": "FÃªnix Primordial",
        "next_data": {"name": "FÃªnix Primordial", "emoji": "ğŸ•Šï¸", "rarity": "Primordial", "bonus_hp": 320, "bonus_atk": 160}
    },

    # â”€â”€ Mundo 40 â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    "Salamandra de Fogo": {
        "level_required": 34, "next": "Salamandra DracÃ´nica",
        "next_data": {"name": "Salamandra DracÃ´nica", "emoji": "ğŸ¦", "rarity": "LendÃ¡rio", "bonus_hp": 110, "bonus_atk": 55}
    },
    "Salamandra DracÃ´nica": {
        "level_required": 47, "next": "Salamandra Divina",
        "next_data": {"name": "Salamandra Divina", "emoji": "ğŸ¦", "rarity": "MÃ­tico", "bonus_hp": 200, "bonus_atk": 100}
    },
    "FÃªnix Carmesim": {
        "level_required": 36, "next": "FÃªnix Solar",
        "next_data": {"name": "FÃªnix Solar", "emoji": "ğŸ”¥", "rarity": "MÃ­tico", "bonus_hp": 150, "bonus_atk": 75}
    },
    "FÃªnix Solar": {
        "level_required": 49, "next": "FÃªnix Eterna",
        "next_data": {"name": "FÃªnix Eterna", "emoji": "â˜€ï¸", "rarity": "Divino", "bonus_hp": 270, "bonus_atk": 135}
    },
    "DragÃ£o de Magma": {
        "level_required": 38, "next": "DragÃ£o VulcÃ¢nico",
        "next_data": {"name": "DragÃ£o VulcÃ¢nico", "emoji": "ğŸ²", "rarity": "Divino", "bonus_hp": 200, "bonus_atk": 100}
    },
    "DragÃ£o VulcÃ¢nico": {
        "level_required": 52, "next": "DragÃ£o Primordial do Caos",
        "next_data": {"name": "DragÃ£o Primordial do Caos", "emoji": "ğŸ‰", "rarity": "Primordial", "bonus_hp": 380, "bonus_atk": 190}
    },

    # â”€â”€ Mundo 50 â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    "Espectro Sombrio": {
        "level_required": 42, "next": "Espectro do Abismo",
        "next_data": {"name": "Espectro do Abismo", "emoji": "ğŸ‘¤", "rarity": "MÃ­tico", "bonus_hp": 170, "bonus_atk": 85}
    },
    "Espectro do Abismo": {
        "level_required": 54, "next": "Espectro Eterno",
        "next_data": {"name": "Espectro Eterno", "emoji": "ğŸŒ‘", "rarity": "Divino", "bonus_hp": 290, "bonus_atk": 145}
    },
    "Elemental do Vazio": {
        "level_required": 44, "next": "Elemental CÃ³smico",
        "next_data": {"name": "Elemental CÃ³smico", "emoji": "ğŸŒ€", "rarity": "Divino", "bonus_hp": 220, "bonus_atk": 110}
    },
    "Elemental CÃ³smico": {
        "level_required": 56, "next": "Elemental Primordial",
        "next_data": {"name": "Elemental Primordial", "emoji": "âš«", "rarity": "Primordial", "bonus_hp": 400, "bonus_atk": 200}
    },
    "Entidade CÃ³smica": {
        "level_required": 46, "next": "Entidade Astral",
        "next_data": {"name": "Entidade Astral", "emoji": "ğŸŒŸ", "rarity": "Divino", "bonus_hp": 300, "bonus_atk": 150}
    },
    "Entidade Astral": {
        "level_required": 58, "next": "Deus Primordial",
        "next_data": {"name": "Deus Primordial", "emoji": "âœ¨", "rarity": "Primordial", "bonus_hp": 500, "bonus_atk": 250}
    },

    # â”€â”€ Mundo 60 (jÃ¡ sÃ£o top, mas ganham 1 evoluÃ§Ã£o final cada) â”€â”€â”€â”€â”€â”€
    "Anjo GuardiÃ£o": {
        "level_required": 50, "next": "Arcanjo GuardiÃ£o",
        "next_data": {"name": "Arcanjo GuardiÃ£o", "emoji": "ğŸ‘¼", "rarity": "Primordial", "bonus_hp": 380, "bonus_atk": 190}
    },
    "Querubim Guerreiro": {
        "level_required": 52, "next": "Serafim Guerreiro",
        "next_data": {"name": "Serafim Guerreiro", "emoji": "ğŸ˜‡", "rarity": "Primordial", "bonus_hp": 450, "bonus_atk": 225}
    },
    "Arcanjo Primordial": {
        "level_required": 55, "next": "Deus da Guerra Celestial",
        "next_data": {"name": "Deus da Guerra Celestial", "emoji": "âš”ï¸", "rarity": "Primordial", "bonus_hp": 700, "bonus_atk": 350}
    },
}

# ================= SPELL BOOK / LIVRO DE FEITIÃ‡OS =================
MANA_CATEGORIES = [
    {"id": "goblin",     "name": "ğŸŸ¤ Goblin",       "level_req": 12, "mana_mult": 1.0, "desc": "Iniciante das artes mÃ¡gicas"},
    {"id": "aprendiz",   "name": "âšª Aprendiz",     "level_req": 16, "mana_mult": 1.1, "desc": "ComeÃ§a a entender os fundamentos"},
    {"id": "estudante",  "name": "ğŸŸ¢ Estudante",    "level_req": 20, "mana_mult": 1.2, "desc": "Progresso notÃ¡vel no estudo"},
    {"id": "praticante", "name": "ğŸ”µ Praticante",   "level_req": 25, "mana_mult": 1.35,"desc": "DomÃ­nio bÃ¡sico das magias"},
    {"id": "adepto",     "name": "ğŸŸ£ Adepto",       "level_req": 30, "mana_mult": 1.5, "desc": "FeitiÃ§os fluem naturalmente"},
    {"id": "veterano",   "name": "ğŸŸ¡ Veterano",     "level_req": 35, "mana_mult": 1.7, "desc": "Veterano das artes arcanas"},
    {"id": "mestre",     "name": "ğŸŸ  Mestre",       "level_req": 40, "mana_mult": 2.0, "desc": "Mestre indiscutÃ­vel da magia"},
    {"id": "arcano",     "name": "ğŸ”´ Arcano",       "level_req": 45, "mana_mult": 2.3, "desc": "Acessa planos superiores de poder"},
    {"id": "lendario",   "name": "â­ LendÃ¡rio",     "level_req": 52, "mana_mult": 2.7, "desc": "Lenda das artes mÃ¡gicas"},
    {"id": "supremo",    "name": "ğŸ’ Supremo",      "level_req": 58, "mana_mult": 3.5, "desc": "O pico absoluto do poder arcano"},
]

SPELL_BOOK_SKILLS = {
    "Mago": [
        {"cat": "goblin",     "name": "ğŸ”¥ Chispa Arcana",      "mana_cost": 5,  "dmg_mult": 1.2, "desc": "Uma centelha mÃ¡gica bÃ¡sica."},
        {"cat": "aprendiz",   "name": "â„ï¸ Flecha de Gelo",     "mana_cost": 12, "dmg_mult": 1.5, "slow": True, "desc": "Desacelera o inimigo."},
        {"cat": "estudante",  "name": "âš¡ Tempestade Arcana",  "mana_cost": 20, "dmg_mult": 1.8, "desc": "MÃºltiplos raios arcanos."},
        {"cat": "praticante", "name": "ğŸŒªï¸ TufÃ£o de Magia",    "mana_cost": 30, "dmg_mult": 2.2, "desc": "Vento mÃ¡gico devasta."},
        {"cat": "adepto",     "name": "ğŸ”® Singularidade",      "mana_cost": 40, "dmg_mult": 2.6, "ignore_def": True, "desc": "DestrÃ³i defesas."},
        {"cat": "veterano",   "name": "ğŸŒŒ Portal do Caos",     "mana_cost": 50, "dmg_mult": 3.0, "desc": "Abre uma fenda dimensional."},
        {"cat": "mestre",     "name": "â˜„ï¸ Meteoro Arcano",    "mana_cost": 60, "dmg_mult": 3.5, "desc": "Um meteoro mÃ¡gico devastador!"},
        {"cat": "arcano",     "name": "ğŸŒ  Colapso Estelar",   "mana_cost": 75, "dmg_mult": 4.0, "stun_chance": 0.4, "desc": "O poder das estrelas."},
        {"cat": "lendario",   "name": "ğŸ’¥ ExplosÃ£o CÃ³smica",  "mana_cost": 90, "dmg_mult": 4.8, "desc": "O universo colapsa no alvo."},
        {"cat": "supremo",    "name": "âš—ï¸ AniquilaÃ§Ã£o Total", "mana_cost": 120,"dmg_mult": 6.0, "ignore_def": True, "desc": "Poder absoluto e irresistÃ­vel!"},
    ],
    "Necromante": [
        {"cat": "goblin",     "name": "ğŸ’€ Toque da Morte",     "mana_cost": 5,  "dmg_mult": 1.2, "desc": "A morte roÃ§a o inimigo."},
        {"cat": "aprendiz",   "name": "ğŸ¦´ Esqueleto BÃ¡sico",   "mana_cost": 12, "dmg_mult": 1.4, "desc": "Invoca um guerreiro Ã³sseo."},
        {"cat": "estudante",  "name": "â˜ ï¸ Praga",              "mana_cost": 20, "dmg_mult": 1.6, "poison": True, "desc": "Praga que corrÃ³i a alma."},
        {"cat": "praticante", "name": "ğŸŒ‘ Escudo da Morte",    "mana_cost": 30, "dmg_mult": 1.2, "self_heal": 40, "desc": "Cura drenando o inimigo."},
        {"cat": "adepto",     "name": "ğŸ’€ ExÃ©rcito dos Mortos","mana_cost": 45, "dmg_mult": 2.5, "desc": "Horda de nÃ£o-mortos ataca!"},
        {"cat": "veterano",   "name": "ğŸŒ’ Eclipse Sombrio",    "mana_cost": 55, "dmg_mult": 3.0, "weaken": True, "desc": "EscuridÃ£o que enfraquece."},
        {"cat": "mestre",     "name": "âš°ï¸ RessurreiÃ§Ã£o CaÃ³tica","mana_cost": 65, "dmg_mult": 3.5, "self_heal": 60, "desc": "Drena vida em massa."},
        {"cat": "arcano",     "name": "ğŸ©¸ MarÃ© de Sangue",     "mana_cost": 80, "dmg_mult": 4.2, "poison": True, "desc": "Sangue que envenena a Ã¡rea."},
        {"cat": "lendario",   "name": "ğŸŒš VÃ©u da Morte",       "mana_cost": 95, "dmg_mult": 5.0, "desc": "A morte se materializa."},
        {"cat": "supremo",    "name": "ğŸ’€ ExterminaÃ§Ã£o",       "mana_cost": 130,"dmg_mult": 6.5, "ignore_def": True, "desc": "Nada escapa Ã  morte absoluta!"},
    ],
    "Paladino": [
        {"cat": "goblin",     "name": "âœ¨ BÃªnÃ§Ã£o Menor",       "mana_cost": 5,  "dmg_mult": 1.1, "self_heal": 10, "desc": "A luz cura levemente."},
        {"cat": "aprendiz",   "name": "â˜€ï¸ Raio Sagrado",       "mana_cost": 12, "dmg_mult": 1.5, "desc": "Um raio de luz divina."},
        {"cat": "estudante",  "name": "ğŸ›¡ï¸ Barreira Sagrada",   "mana_cost": 20, "dmg_mult": 1.0, "self_heal": 35, "def_bonus": 15, "desc": "Barreira protetora."},
        {"cat": "praticante", "name": "âš”ï¸ Espada da JustiÃ§a",  "mana_cost": 30, "dmg_mult": 2.0, "desc": "JustiÃ§a divina corporificada."},
        {"cat": "adepto",     "name": "ğŸŒŸ Nova de Luz",        "mana_cost": 40, "dmg_mult": 2.4, "stun_chance": 0.3, "desc": "ExplosÃ£o de luz sagrada."},
        {"cat": "veterano",   "name": "ğŸ‘¼ ProteÃ§Ã£o AngÃ©lica",  "mana_cost": 50, "dmg_mult": 1.5, "self_heal": 60, "desc": "Anjos protegem o paladino."},
        {"cat": "mestre",     "name": "â­ PurificaÃ§Ã£o Divina", "mana_cost": 65, "dmg_mult": 3.0, "desc": "Purifica toda maldade."},
        {"cat": "arcano",     "name": "â˜€ï¸ Arma Celestial",    "mana_cost": 80, "dmg_mult": 3.8, "ignore_def": True, "desc": "Arma forjada pelos cÃ©us."},
        {"cat": "lendario",   "name": "ğŸ•Šï¸ IntervenÃ§Ã£o Divina", "mana_cost": 100,"dmg_mult": 4.5, "self_heal": 80, "desc": "Os deuses intervÃªm pessoalmente."},
        {"cat": "supremo",    "name": "ğŸŒˆ JuÃ­zo Final",        "mana_cost": 140,"dmg_mult": 6.0, "stun_chance": 0.5, "desc": "O julgamento eterno cai!"},
    ],
    "Druida": [
        {"cat": "goblin",     "name": "ğŸŒ¿ Cura Menor",         "mana_cost": 5,  "dmg_mult": 1.0, "self_heal": 20, "desc": "A natureza cura."},
        {"cat": "aprendiz",   "name": "ğŸŒ± Espinhos Vivos",     "mana_cost": 12, "dmg_mult": 1.4, "poison": True, "desc": "Espinhos que envenenam."},
        {"cat": "estudante",  "name": "ğŸº Forma Animal",       "mana_cost": 20, "dmg_mult": 1.8, "desc": "Se transforma em besta."},
        {"cat": "praticante", "name": "ğŸŒªï¸ Tempestade Natural", "mana_cost": 30, "dmg_mult": 2.2, "desc": "A natureza se rebela."},
        {"cat": "adepto",     "name": "ğŸŒ³ RaÃ­zes Antigas",     "mana_cost": 40, "dmg_mult": 1.8, "stun_chance": 0.4, "desc": "RaÃ­zes antigas imobilizam."},
        {"cat": "veterano",   "name": "âš¡ RelÃ¢mpago Natural",  "mana_cost": 50, "dmg_mult": 2.8, "desc": "Raio convocado da natureza."},
        {"cat": "mestre",     "name": "ğŸŒŠ Tsunami Arcano",     "mana_cost": 65, "dmg_mult": 3.2, "desc": "Onda massiva de energia natural."},
        {"cat": "arcano",     "name": "ğŸ¦… Forma Celestial",    "mana_cost": 80, "dmg_mult": 3.8, "self_heal": 50, "desc": "Transforma-se em ser celestial."},
        {"cat": "lendario",   "name": "ğŸŒ Terremoto",          "mana_cost": 100,"dmg_mult": 4.6, "stun_chance": 0.5, "desc": "A terra se parte ao meio."},
        {"cat": "supremo",    "name": "ğŸŒ³ Ãrvore do Mundo",   "mana_cost": 150,"dmg_mult": 6.0, "self_heal": 100, "desc": "O poder da criaÃ§Ã£o inteira!"},
    ],
}

# Classes de suporte que podem curar aliados em grupo
SUPPORT_CLASSES = {"Paladino", "Druida", "Mago", "Bardo", "Necromante"}

# ================= KINGDOM SYSTEM (para Reis) =================
KINGDOM_DEFAULTS = {
    "name": None,  # Nome do reino do jogador
    "population": 100,
    "economy": "Neutra",  # Ruim / Neutra / Boa / Excelente
    "army": "Neutra",
    "resources": [],
    "bio": "",
    "wars_won": 0,
    "trades": 0,
}


# ================= RARITY DICE BONUS =================
RARITY_DICE_BONUS = {
    "Comum": 0,
    "Incomum": 0,
    "Raro": 1,
    "Ã‰pico": 1,
    "LendÃ¡rio": 2,
    "MÃ­tico": 2,
    "Divino": 3,
    "Primordial": 4,
}

# ================= RARIDADES (expandidas) =================
RARITIES = {
    "Comum": {"color": 0xAAAAAA, "emoji": "âšª"},
    "Incomum": {"color": 0x00FF00, "emoji": "ğŸŸ¢"},
    "Raro": {"color": 0x0000FF, "emoji": "ğŸ”µ"},
    "Ã‰pico": {"color": 0x800080, "emoji": "ğŸŸ£"},
    "LendÃ¡rio": {"color": 0xFFD700, "emoji": "ğŸŸ¡"},
    "MÃ­tico": {"color": 0xFF4400, "emoji": "ğŸ”´"},
    "Ancestral": {"color": 0xFF8C00, "emoji": "ğŸŸ "},
    "Divino": {"color": 0x00FFFF, "emoji": "ğŸ’"},
    "Primordial": {"color": 0xFF00FF, "emoji": "ğŸŒˆ"}
}

# ================= PETS POR MUNDO =================
PETS = {
    1: [
        {"name": "Slime BebÃª", "emoji": "ğŸ’§", "rarity": "Comum", "bonus_hp": 10, "bonus_atk": 3},
        {"name": "Rato Selvagem Domesticado", "emoji": "ğŸ€", "rarity": "Comum", "bonus_hp": 8, "bonus_atk": 4},
        {"name": "Lagarta Arcana", "emoji": "ğŸ›", "rarity": "Comum", "bonus_hp": 9, "bonus_atk": 3},
        {"name": "Fungo Espiritual", "emoji": "ğŸ„", "rarity": "Comum", "bonus_hp": 12, "bonus_atk": 2},
        {"name": "Coelho MÃ¡gico", "emoji": "ğŸ°", "rarity": "Incomum", "bonus_hp": 15, "bonus_atk": 5},
        {"name": "Fada da Floresta", "emoji": "ğŸ§š", "rarity": "Raro", "bonus_hp": 20, "bonus_atk": 8}
    ],
    10: [
        {"name": "Toupeira das Sombras", "emoji": "ğŸ¦¡", "rarity": "Comum", "bonus_hp": 18, "bonus_atk": 6},
        {"name": "Cogumelo Sombrio", "emoji": "ğŸ„", "rarity": "Comum", "bonus_hp": 16, "bonus_atk": 7},
        {"name": "Lobo Cinzento", "emoji": "ğŸº", "rarity": "Incomum", "bonus_hp": 25, "bonus_atk": 12},
        {"name": "Coruja Espectral", "emoji": "ğŸ¦‰", "rarity": "Raro", "bonus_hp": 30, "bonus_atk": 15},
        {"name": "EspÃ­rito da Floresta", "emoji": "ğŸ‘»", "rarity": "Ã‰pico", "bonus_hp": 40, "bonus_atk": 20}
    ],
    20: [
        {"name": "Besouro do Deserto", "emoji": "ğŸª²", "rarity": "Comum", "bonus_hp": 22, "bonus_atk": 9},
        {"name": "Cobra das Areias", "emoji": "ğŸ", "rarity": "Comum", "bonus_hp": 20, "bonus_atk": 11},
        {"name": "EscorpiÃ£o Dourado", "emoji": "ğŸ¦‚", "rarity": "Raro", "bonus_hp": 35, "bonus_atk": 18},
        {"name": "Escaravelho MÃ­stico", "emoji": "ğŸª²", "rarity": "Ã‰pico", "bonus_hp": 45, "bonus_atk": 23},
        {"name": "Esfinge Menor", "emoji": "ğŸ¦", "rarity": "LendÃ¡rio", "bonus_hp": 60, "bonus_atk": 30}
    ],
    30: [
        {"name": "Raposa Ãrtica", "emoji": "ğŸ¦Š", "rarity": "Ã‰pico", "bonus_hp": 50, "bonus_atk": 25},
        {"name": "DragÃ£o de Gelo BebÃª", "emoji": "ğŸ‰", "rarity": "LendÃ¡rio", "bonus_hp": 70, "bonus_atk": 35},
        {"name": "FÃªnix de Gelo", "emoji": "ğŸ¦…", "rarity": "MÃ­tico", "bonus_hp": 100, "bonus_atk": 50}
    ],
    40: [
        {"name": "Salamandra de Fogo", "emoji": "ğŸ¦", "rarity": "Ã‰pico", "bonus_hp": 55, "bonus_atk": 28},
        {"name": "FÃªnix Carmesim", "emoji": "ğŸ”¥", "rarity": "LendÃ¡rio", "bonus_hp": 80, "bonus_atk": 40},
        {"name": "DragÃ£o de Magma", "emoji": "ğŸ²", "rarity": "MÃ­tico", "bonus_hp": 120, "bonus_atk": 60}
    ],
    50: [
        {"name": "Espectro Sombrio", "emoji": "ğŸ‘¤", "rarity": "LendÃ¡rio", "bonus_hp": 90, "bonus_atk": 45},
        {"name": "Elemental do Vazio", "emoji": "ğŸŒ€", "rarity": "MÃ­tico", "bonus_hp": 130, "bonus_atk": 65},
        {"name": "Entidade CÃ³smica", "emoji": "âœ¨", "rarity": "Divino", "bonus_hp": 180, "bonus_atk": 90}
    ],
    60: [
        {"name": "Anjo GuardiÃ£o", "emoji": "ğŸ‘¼", "rarity": "Divino", "bonus_hp": 200, "bonus_atk": 100},
        {"name": "Querubim Guerreiro", "emoji": "ğŸ˜‡", "rarity": "Divino", "bonus_hp": 250, "bonus_atk": 120},
        {"name": "Arcanjo Primordial", "emoji": "ğŸ•Šï¸", "rarity": "Primordial", "bonus_hp": 400, "bonus_atk": 200}
    ]
}

# ================= PETS NOVOS (EXPANSÃƒO) =================
PETS_EXTRA = {
    1: [
        {"name": "Girino MÃ¡gico",     "emoji": "ğŸ¸", "rarity": "Comum",    "bonus_hp": 8,  "bonus_atk": 3,  "can_mount": False},
        {"name": "Borboleta de Cristal","emoji":"ğŸ¦‹","rarity": "Comum",    "bonus_hp": 9,  "bonus_atk": 2,  "can_mount": False},
        {"name": "Filhote de Urso",   "emoji": "ğŸ»", "rarity": "Incomum",  "bonus_hp": 18, "bonus_atk": 6,  "can_mount": True,  "mount_bonus_def": 5,  "mount_bonus_spd": 2},
        {"name": "Raposa das RuÃ­nas", "emoji": "ğŸ¦Š", "rarity": "Raro",     "bonus_hp": 22, "bonus_atk": 9,  "can_mount": True,  "mount_bonus_def": 8,  "mount_bonus_spd": 5},
        {"name": "UnicÃ³rnio BebÃª",    "emoji": "ğŸ¦„", "rarity": "Ã‰pico",    "bonus_hp": 40, "bonus_atk": 18, "can_mount": True,  "mount_bonus_def": 15, "mount_bonus_spd": 10},
    ],
    10: [
        {"name": "Morcego das Cavernas","emoji":"ğŸ¦‡","rarity": "Comum",    "bonus_hp": 14, "bonus_atk": 6,  "can_mount": False},
        {"name": "TritÃ£o Sombrio",    "emoji": "ğŸ¦", "rarity": "Incomum",  "bonus_hp": 22, "bonus_atk": 9,  "can_mount": False},
        {"name": "Cavalo Negro Ã‰lfico","emoji":"ğŸ´", "rarity": "Raro",     "bonus_hp": 30, "bonus_atk": 10, "can_mount": True,  "mount_bonus_def": 12, "mount_bonus_spd": 8},
        {"name": "Grifo Menor",       "emoji": "ğŸ¦…", "rarity": "Ã‰pico",    "bonus_hp": 45, "bonus_atk": 22, "can_mount": True,  "mount_bonus_def": 18, "mount_bonus_spd": 14},
    ],
    20: [
        {"name": "EscorpiÃ£o das Areias","emoji":"ğŸ¦‚","rarity": "Incomum",  "bonus_hp": 20, "bonus_atk": 10, "can_mount": False},
        {"name": "Camelo MÃ­stico",    "emoji": "ğŸª", "rarity": "Raro",     "bonus_hp": 32, "bonus_atk": 12, "can_mount": True,  "mount_bonus_def": 10, "mount_bonus_spd": 6},
        {"name": "Serpente FaraÃ´nica","emoji": "ğŸ", "rarity": "Ã‰pico",    "bonus_hp": 48, "bonus_atk": 24, "can_mount": True,  "mount_bonus_def": 20, "mount_bonus_spd": 12},
        {"name": "Roc das Dunas",     "emoji": "ğŸ¦…", "rarity": "LendÃ¡rio", "bonus_hp": 65, "bonus_atk": 33, "can_mount": True,  "mount_bonus_def": 30, "mount_bonus_spd": 20},
    ],
    30: [
        {"name": "Lobo do Ãrtico",    "emoji": "ğŸº", "rarity": "Raro",     "bonus_hp": 30, "bonus_atk": 15, "can_mount": True,  "mount_bonus_def": 12, "mount_bonus_spd": 9},
        {"name": "Urso Polar MÃ­stico","emoji": "ğŸ»", "rarity": "Ã‰pico",    "bonus_hp": 55, "bonus_atk": 27, "can_mount": True,  "mount_bonus_def": 22, "mount_bonus_spd": 10},
        {"name": "CÃ£o do Permafrost", "emoji": "â„ï¸", "rarity": "LendÃ¡rio", "bonus_hp": 75, "bonus_atk": 38, "can_mount": True,  "mount_bonus_def": 35, "mount_bonus_spd": 18},
    ],
    40: [
        {"name": "Lagartixa de Magma","emoji": "ğŸ¦", "rarity": "Raro",     "bonus_hp": 35, "bonus_atk": 17, "can_mount": False},
        {"name": "Touro de Fogo",     "emoji": "ğŸ‚", "rarity": "Ã‰pico",    "bonus_hp": 58, "bonus_atk": 29, "can_mount": True,  "mount_bonus_def": 24, "mount_bonus_spd": 8},
        {"name": "DragÃ£o de Cinzas",  "emoji": "ğŸ²", "rarity": "LendÃ¡rio", "bonus_hp": 88, "bonus_atk": 44, "can_mount": True,  "mount_bonus_def": 40, "mount_bonus_spd": 22},
        {"name": "FÃªnix Ancestral",   "emoji": "ğŸ”¥", "rarity": "MÃ­tico",   "bonus_hp": 130,"bonus_atk": 65, "can_mount": True,  "mount_bonus_def": 60, "mount_bonus_spd": 35},
    ],
    50: [
        {"name": "Sombra Equina",     "emoji": "ğŸŒ‘", "rarity": "Ã‰pico",    "bonus_hp": 55, "bonus_atk": 27, "can_mount": True,  "mount_bonus_def": 20, "mount_bonus_spd": 16},
        {"name": "Leviathan Menor",   "emoji": "ğŸ‹", "rarity": "LendÃ¡rio", "bonus_hp": 92, "bonus_atk": 46, "can_mount": True,  "mount_bonus_def": 42, "mount_bonus_spd": 18},
        {"name": "Cavalo do Vazio",   "emoji": "ğŸŒ€", "rarity": "MÃ­tico",   "bonus_hp": 140,"bonus_atk": 70, "can_mount": True,  "mount_bonus_def": 65, "mount_bonus_spd": 38},
    ],
    60: [
        {"name": "Cervo Celestial",   "emoji": "ğŸ¦Œ", "rarity": "Divino",   "bonus_hp": 210,"bonus_atk": 105,"can_mount": True,  "mount_bonus_def": 90, "mount_bonus_spd": 50},
        {"name": "DragÃ£o Primordial", "emoji": "ğŸ‰", "rarity": "Primordial","bonus_hp":420,"bonus_atk": 210,"can_mount": True,  "mount_bonus_def": 180,"mount_bonus_spd": 90},
    ],
    70: [
        {"name": "Lobo das Almas",        "emoji": "ğŸº", "rarity": "Ancestral",  "bonus_hp": 180, "bonus_atk": 90,  "can_mount": True,  "mount_bonus_def": 80,  "mount_bonus_spd": 45},
        {"name": "Hidra de Cristal",      "emoji": "ğŸ", "rarity": "Divino",     "bonus_hp": 260, "bonus_atk": 130, "can_mount": True,  "mount_bonus_def": 110, "mount_bonus_spd": 55},
        {"name": "LeviatÃ£ das Sombras",   "emoji": "ğŸŒŠ", "rarity": "Primordial", "bonus_hp": 500, "bonus_atk": 250, "can_mount": True,  "mount_bonus_def": 200, "mount_bonus_spd": 100},
        {"name": "Tartaruga Ancestre",    "emoji": "ğŸ¢", "rarity": "Ancestral",  "bonus_hp": 320, "bonus_atk": 60,  "can_mount": True,  "mount_bonus_def": 160, "mount_bonus_spd": 20},
    ],
    80: [
        {"name": "Pantera das Trevas",    "emoji": "ğŸ†", "rarity": "Divino",     "bonus_hp": 290, "bonus_atk": 145, "can_mount": True,  "mount_bonus_def": 120, "mount_bonus_spd": 65},
        {"name": "Grifo de Cristal",      "emoji": "ğŸ¦…", "rarity": "Divino",     "bonus_hp": 270, "bonus_atk": 155, "can_mount": True,  "mount_bonus_def": 125, "mount_bonus_spd": 70},
        {"name": "DragÃ£o dos Cristais",   "emoji": "ğŸ’", "rarity": "Primordial", "bonus_hp": 580, "bonus_atk": 290, "can_mount": True,  "mount_bonus_def": 230, "mount_bonus_spd": 110},
        {"name": "Espectro Equino",       "emoji": "ğŸ‘»", "rarity": "Ancestral",  "bonus_hp": 200, "bonus_atk": 110, "can_mount": True,  "mount_bonus_def": 95,  "mount_bonus_spd": 75},
    ],
    90: [
        {"name": "Corvo da Eternidade",   "emoji": "ğŸ¦", "rarity": "Divino",     "bonus_hp": 300, "bonus_atk": 160, "can_mount": False},
        {"name": "LeÃ£o das Tempestades",  "emoji": "ğŸ¦", "rarity": "Divino",     "bonus_hp": 310, "bonus_atk": 165, "can_mount": True,  "mount_bonus_def": 130, "mount_bonus_spd": 60},
        {"name": "FÃªnix das RelÃ¢mpagos",  "emoji": "âš¡", "rarity": "Primordial", "bonus_hp": 650, "bonus_atk": 325, "can_mount": True,  "mount_bonus_def": 260, "mount_bonus_spd": 120},
        {"name": "Touro do TrovÃ£o",       "emoji": "âš¡", "rarity": "Ancestral",  "bonus_hp": 240, "bonus_atk": 120, "can_mount": True,  "mount_bonus_def": 105, "mount_bonus_spd": 50},
    ],
    100: [
        {"name": "Golias das Montanhas",  "emoji": "ğŸ”ï¸", "rarity": "Divino",     "bonus_hp": 380, "bonus_atk": 180, "can_mount": True,  "mount_bonus_def": 150, "mount_bonus_spd": 40},
        {"name": "DragÃ£o Primordial de Pedra","emoji":"ğŸ‰","rarity":"Primordial","bonus_hp": 720, "bonus_atk": 360, "can_mount": True,  "mount_bonus_def": 290, "mount_bonus_spd": 90},
        {"name": "Wyvern CÃ³smico",        "emoji": "ğŸŒŒ", "rarity": "Primordial", "bonus_hp": 680, "bonus_atk": 380, "can_mount": True,  "mount_bonus_def": 280, "mount_bonus_spd": 130},
        {"name": "Urso Espectral",        "emoji": "ğŸ»", "rarity": "Divino",     "bonus_hp": 350, "bonus_atk": 140, "can_mount": True,  "mount_bonus_def": 145, "mount_bonus_spd": 45},
    ],
    110: [
        {"name": "Quimera Primordial",    "emoji": "ğŸ¦", "rarity": "Primordial", "bonus_hp": 800, "bonus_atk": 400, "can_mount": True,  "mount_bonus_def": 320, "mount_bonus_spd": 140},
        {"name": "FÃªnix do Primeiro Sol", "emoji": "â˜€ï¸", "rarity": "Primordial", "bonus_hp": 750, "bonus_atk": 420, "can_mount": True,  "mount_bonus_def": 310, "mount_bonus_spd": 150},
        {"name": "Kraken Jovem",          "emoji": "ğŸ™", "rarity": "Divino",     "bonus_hp": 420, "bonus_atk": 190, "can_mount": False},
        {"name": "Cavalo do Oceano Eterno","emoji":"ğŸŒŠ", "rarity": "Primordial", "bonus_hp": 780, "bonus_atk": 390, "can_mount": True,  "mount_bonus_def": 300, "mount_bonus_spd": 135},
    ],
    120: [
        {"name": "Basilisco Arcano",      "emoji": "ğŸ", "rarity": "Primordial", "bonus_hp": 880, "bonus_atk": 440, "can_mount": True,  "mount_bonus_def": 350, "mount_bonus_spd": 140},
        {"name": "TitÃ£ Equino",           "emoji": "ğŸ´", "rarity": "Primordial", "bonus_hp": 900, "bonus_atk": 450, "can_mount": True,  "mount_bonus_def": 360, "mount_bonus_spd": 155},
        {"name": "Salamandra CÃ³smica",    "emoji": "ğŸ”¥", "rarity": "Primordial", "bonus_hp": 840, "bonus_atk": 470, "can_mount": True,  "mount_bonus_def": 340, "mount_bonus_spd": 160},
    ],
    130: [
        {"name": "DragÃ£o do Caos",        "emoji": "ğŸŒ€", "rarity": "Primordial", "bonus_hp": 980, "bonus_atk": 490, "can_mount": True,  "mount_bonus_def": 390, "mount_bonus_spd": 165},
        {"name": "Grifo do Caos Eterno",  "emoji": "ğŸ¦…", "rarity": "Primordial", "bonus_hp": 960, "bonus_atk": 510, "can_mount": True,  "mount_bonus_def": 380, "mount_bonus_spd": 170},
        {"name": "Hidra do Caos",         "emoji": "ğŸ²", "rarity": "Primordial", "bonus_hp": 1050,"bonus_atk": 480, "can_mount": False},
    ],
    140: [
        {"name": "FÃªnix do Gelo Eterno",  "emoji": "â„ï¸", "rarity": "Primordial", "bonus_hp": 1100,"bonus_atk": 550, "can_mount": True,  "mount_bonus_def": 440, "mount_bonus_spd": 180},
        {"name": "DragÃ£o da ExtinÃ§Ã£o",    "emoji": "ğŸ’€", "rarity": "Primordial", "bonus_hp": 1200,"bonus_atk": 600, "can_mount": True,  "mount_bonus_def": 480, "mount_bonus_spd": 190},
    ],
    150: [
        {"name": "TitÃ£ da CivilizaÃ§Ã£o",   "emoji": "ğŸ›ï¸", "rarity": "Primordial", "bonus_hp": 1350,"bonus_atk": 675, "can_mount": True,  "mount_bonus_def": 540, "mount_bonus_spd": 200},
        {"name": "GuardiÃ£o da Arma Final","emoji": "âš”ï¸", "rarity": "Primordial", "bonus_hp": 1400,"bonus_atk": 700, "can_mount": True,  "mount_bonus_def": 560, "mount_bonus_spd": 210},
    ],
    160: [
        {"name": "DragÃ£o do Plano Astral","emoji": "ğŸŒŸ", "rarity": "Primordial", "bonus_hp": 1600,"bonus_atk": 800, "can_mount": True,  "mount_bonus_def": 640, "mount_bonus_spd": 230},
        {"name": "Basilisco do Cosmos",   "emoji": "ğŸŒŒ", "rarity": "Primordial", "bonus_hp": 1500,"bonus_atk": 820, "can_mount": True,  "mount_bonus_def": 620, "mount_bonus_spd": 240},
    ],
    170: [
        {"name": "A Besta AlÃ©m da ExistÃªncia","emoji":"ğŸ‘ï¸","rarity": "Primordial","bonus_hp": 1800,"bonus_atk": 900, "can_mount": False},
        {"name": "DragÃ£o do AlÃ©m de Tudo","emoji": "â™¾ï¸", "rarity": "Primordial", "bonus_hp": 1900,"bonus_atk": 950, "can_mount": True,  "mount_bonus_def": 760, "mount_bonus_spd": 270},
    ],
    180: [
        {"name": "FÃªnix da CriaÃ§Ã£o",      "emoji": "ğŸŒˆ", "rarity": "Primordial", "bonus_hp": 2100,"bonus_atk": 1050,"can_mount": True,  "mount_bonus_def": 840, "mount_bonus_spd": 300},
        {"name": "O DragÃ£o Primordial Final","emoji":"ğŸ‰","rarity":"Primordial", "bonus_hp": 2500,"bonus_atk": 1250,"can_mount": True,  "mount_bonus_def": 1000,"mount_bonus_spd": 350},
    ],
}

# Pets que jÃ¡ existiam no PETS original que tambÃ©m podem virar montaria
EXISTING_PETS_MOUNT = {
    "Lobo Cinzento":       {"can_mount": True,  "mount_bonus_def": 8,  "mount_bonus_spd": 5},
    "Raposa Ãrtica":       {"can_mount": True,  "mount_bonus_def": 14, "mount_bonus_spd": 9},
    "DragÃ£o de Gelo BebÃª": {"can_mount": True,  "mount_bonus_def": 20, "mount_bonus_spd": 12},
    "FÃªnix de Gelo":       {"can_mount": True,  "mount_bonus_def": 30, "mount_bonus_spd": 18},
    "Salamandra de Fogo":  {"can_mount": True,  "mount_bonus_def": 16, "mount_bonus_spd": 10},
    "FÃªnix Carmesim":      {"can_mount": True,  "mount_bonus_def": 25, "mount_bonus_spd": 16},
    "DragÃ£o de Magma":     {"can_mount": True,  "mount_bonus_def": 35, "mount_bonus_spd": 22},
    "Esfinge Menor":       {"can_mount": True,  "mount_bonus_def": 18, "mount_bonus_spd": 12},
    "Arcanjo Primordial":  {"can_mount": True,  "mount_bonus_def": 120,"mount_bonus_spd": 60},
    "Entidade CÃ³smica":    {"can_mount": True,  "mount_bonus_def": 55, "mount_bonus_spd": 30},
    "Anjo GuardiÃ£o":       {"can_mount": True,  "mount_bonus_def": 65, "mount_bonus_spd": 35},
    "Querubim Guerreiro":  {"can_mount": True,  "mount_bonus_def": 80, "mount_bonus_spd": 42},
}



# ================= PETS â€” NOVOS REINOS 11â€“40 + DIMENSÃ•ES =================
PETS_NOVOS_REINOS = {
    # â”€â”€ CAP. II: NaÃ§Ãµes IntermediÃ¡rias (nÃ­vel 101â€“200) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    90: [  # PlanÃ­cies do TrovÃ£o
        {"name": "Raposa do TrovÃ£o",          "emoji": "âš¡",  "rarity": "Raro",       "bonus_hp": 340,  "bonus_atk": 170,  "can_mount": True,  "mount_bonus_def": 140,  "mount_bonus_spd": 65},
        {"name": "Ãguia ElÃ©trica",            "emoji": "ğŸ¦…",  "rarity": "Divino",     "bonus_hp": 420,  "bonus_atk": 210,  "can_mount": True,  "mount_bonus_def": 175,  "mount_bonus_spd": 80},
        {"name": "DragÃ£o do RelÃ¢mpago",       "emoji": "ğŸŒ©ï¸", "rarity": "Primordial", "bonus_hp": 820,  "bonus_atk": 415,  "can_mount": True,  "mount_bonus_def": 330,  "mount_bonus_spd": 145},
    ],
    100: [  # Terra dos Gigantes
        {"name": "Filhote de Gigante",        "emoji": "ğŸ—¿",  "rarity": "Ã‰pico",      "bonus_hp": 480,  "bonus_atk": 200,  "can_mount": True,  "mount_bonus_def": 200,  "mount_bonus_spd": 30},
        {"name": "Golem de Pedra Vivo",       "emoji": "ğŸª¨",  "rarity": "Divino",     "bonus_hp": 580,  "bonus_atk": 220,  "can_mount": True,  "mount_bonus_def": 240,  "mount_bonus_spd": 25},
        {"name": "TitÃ£ BebÃª",                 "emoji": "ğŸ”ï¸", "rarity": "Primordial", "bonus_hp": 1100, "bonus_atk": 420,  "can_mount": True,  "mount_bonus_def": 440,  "mount_bonus_spd": 40},
    ],
    110: [  # Mar das Almas
        {"name": "Sereia das Profundezas",    "emoji": "ğŸ§œ",  "rarity": "Raro",       "bonus_hp": 360,  "bonus_atk": 185,  "can_mount": False},
        {"name": "TubarÃ£o Espectral",         "emoji": "ğŸ¦ˆ",  "rarity": "Divino",     "bonus_hp": 450,  "bonus_atk": 225,  "can_mount": True,  "mount_bonus_def": 185,  "mount_bonus_spd": 85},
        {"name": "Kraken das Almas",          "emoji": "ğŸ™",  "rarity": "Primordial", "bonus_hp": 1050, "bonus_atk": 480,  "can_mount": False},
        {"name": "Baleia Fantasma",           "emoji": "ğŸ‹",  "rarity": "Divino",     "bonus_hp": 500,  "bonus_atk": 200,  "can_mount": True,  "mount_bonus_def": 210,  "mount_bonus_spd": 60},
    ],
    120: [  # Reino do Caos
        {"name": "Elemental do Caos",         "emoji": "ğŸŒ€",  "rarity": "Ã‰pico",      "bonus_hp": 400,  "bonus_atk": 210,  "can_mount": False},
        {"name": "Imp do Caos",               "emoji": "ğŸ˜ˆ",  "rarity": "Divino",     "bonus_hp": 480,  "bonus_atk": 245,  "can_mount": True,  "mount_bonus_def": 195,  "mount_bonus_spd": 95},
        {"name": "DragÃ£o do Caos Menor",      "emoji": "ğŸ²",  "rarity": "Primordial", "bonus_hp": 1150, "bonus_atk": 500,  "can_mount": True,  "mount_bonus_def": 460,  "mount_bonus_spd": 150},
    ],
    130: [  # Jardim dos Deuses
        {"name": "LeÃ£o Celestial",            "emoji": "ğŸ¦",  "rarity": "Ã‰pico",      "bonus_hp": 420,  "bonus_atk": 220,  "can_mount": True,  "mount_bonus_def": 180,  "mount_bonus_spd": 60},
        {"name": "UnicÃ³rnio Sagrado",         "emoji": "ğŸ¦„",  "rarity": "Divino",     "bonus_hp": 510,  "bonus_atk": 260,  "can_mount": True,  "mount_bonus_def": 215,  "mount_bonus_spd": 100},
        {"name": "FÃªnix dos Deuses",          "emoji": "ğŸŒ¸",  "rarity": "Primordial", "bonus_hp": 1200, "bonus_atk": 540,  "can_mount": True,  "mount_bonus_def": 480,  "mount_bonus_spd": 160},
    ],
    140: [  # Reino do Gelo Eterno
        {"name": "Lobo do Gelo Eterno",       "emoji": "ğŸº",  "rarity": "Ã‰pico",      "bonus_hp": 440,  "bonus_atk": 230,  "can_mount": True,  "mount_bonus_def": 185,  "mount_bonus_spd": 70},
        {"name": "Urso Glacial Primordial",   "emoji": "ğŸ»",  "rarity": "Divino",     "bonus_hp": 540,  "bonus_atk": 270,  "can_mount": True,  "mount_bonus_def": 225,  "mount_bonus_spd": 55},
        {"name": "Wyvern do Permafrost",      "emoji": "â„ï¸",  "rarity": "Primordial", "bonus_hp": 1250, "bonus_atk": 560,  "can_mount": True,  "mount_bonus_def": 500,  "mount_bonus_spd": 130},
    ],
    150: [  # RuÃ­nas da CivilizaÃ§Ã£o Perdida
        {"name": "AutÃ´mato Antigo",           "emoji": "ğŸ¤–",  "rarity": "Raro",       "bonus_hp": 460,  "bonus_atk": 180,  "can_mount": False},
        {"name": "Construto de Mithril",      "emoji": "âš™ï¸",  "rarity": "Divino",     "bonus_hp": 560,  "bonus_atk": 240,  "can_mount": True,  "mount_bonus_def": 235,  "mount_bonus_spd": 45},
        {"name": "GuardiÃ£o Ancestral",        "emoji": "ğŸ›ï¸", "rarity": "Primordial", "bonus_hp": 1300, "bonus_atk": 520,  "can_mount": True,  "mount_bonus_def": 520,  "mount_bonus_spd": 80},
    ],
    160: [  # Plano Astral
        {"name": "EspÃ­rito Astral",           "emoji": "âœ¨",  "rarity": "Divino",     "bonus_hp": 580,  "bonus_atk": 290,  "can_mount": False},
        {"name": "DragÃ£o Astral",             "emoji": "ğŸŒŸ",  "rarity": "Primordial", "bonus_hp": 1350, "bonus_atk": 680,  "can_mount": True,  "mount_bonus_def": 540,  "mount_bonus_spd": 200},
        {"name": "Entidade Estelar",          "emoji": "ğŸ’«",  "rarity": "Primordial", "bonus_hp": 1400, "bonus_atk": 700,  "can_mount": True,  "mount_bonus_def": 560,  "mount_bonus_spd": 210},
    ],
    170: [  # AlÃ©m da ExistÃªncia
        {"name": "Ser do AlÃ©m",               "emoji": "ğŸ‘ï¸", "rarity": "Primordial", "bonus_hp": 1500, "bonus_atk": 750,  "can_mount": False},
        {"name": "DragÃ£o do AlÃ©m",            "emoji": "â™¾ï¸",  "rarity": "Primordial", "bonus_hp": 1600, "bonus_atk": 800,  "can_mount": True,  "mount_bonus_def": 640,  "mount_bonus_spd": 230},
    ],
    180: [  # O Trono Primordial
        {"name": "GuardiÃ£o do Trono",         "emoji": "ğŸ‘‘",  "rarity": "Primordial", "bonus_hp": 1800, "bonus_atk": 900,  "can_mount": True,  "mount_bonus_def": 720,  "mount_bonus_spd": 250},
        {"name": "FÃªnix Primordial MÃ¡xima",   "emoji": "ğŸŒˆ",  "rarity": "Primordial", "bonus_hp": 2000, "bonus_atk": 1000, "can_mount": True,  "mount_bonus_def": 800,  "mount_bonus_spd": 280},
    ],
    # â”€â”€ CAP. III: ImpÃ©rios AvanÃ§ados (nÃ­vel 201â€“300) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    190: [  # Reinos Mortais â€” Ãpice
        {"name": "CampeÃ£o das Trevas",        "emoji": "ğŸŒ‘",  "rarity": "Primordial", "bonus_hp": 2200, "bonus_atk": 1100, "can_mount": True,  "mount_bonus_def": 880,  "mount_bonus_spd": 300},
        {"name": "DragÃ£o do Ãpice",           "emoji": "ğŸ”±",  "rarity": "Primordial", "bonus_hp": 2400, "bonus_atk": 1200, "can_mount": True,  "mount_bonus_def": 960,  "mount_bonus_spd": 320},
    ],
    200: [  # Reinos AvanÃ§ados â€” Despertar
        {"name": "EspÃ­rito do Despertar",     "emoji": "âš¡",  "rarity": "Primordial", "bonus_hp": 2600, "bonus_atk": 1300, "can_mount": True,  "mount_bonus_def": 1040, "mount_bonus_spd": 340},
        {"name": "Wyvern do Despertar",       "emoji": "ğŸŒ ",  "rarity": "Primordial", "bonus_hp": 2800, "bonus_atk": 1400, "can_mount": True,  "mount_bonus_def": 1120, "mount_bonus_spd": 360},
    ],
    210: [  # VÃ³rtice dos Reinos
        {"name": "Elemental do VÃ³rtice",      "emoji": "ğŸŒ€",  "rarity": "Primordial", "bonus_hp": 3000, "bonus_atk": 1500, "can_mount": False},
        {"name": "DragÃ£o do VÃ³rtice",         "emoji": "ğŸ‰",  "rarity": "Primordial", "bonus_hp": 3200, "bonus_atk": 1600, "can_mount": True,  "mount_bonus_def": 1280, "mount_bonus_spd": 380},
    ],
    220: [  # Montanhas do AlÃ©m
        {"name": "Garuda das Alturas",        "emoji": "ğŸ”ï¸", "rarity": "Primordial", "bonus_hp": 3400, "bonus_atk": 1700, "can_mount": True,  "mount_bonus_def": 1360, "mount_bonus_spd": 390},
        {"name": "Roc Primordial",            "emoji": "ğŸ¦…",  "rarity": "Primordial", "bonus_hp": 3600, "bonus_atk": 1800, "can_mount": True,  "mount_bonus_def": 1440, "mount_bonus_spd": 410},
    ],
    230: [  # Oceano Dimensional
        {"name": "LeviatÃ£ Dimensional",       "emoji": "ğŸŒŠ",  "rarity": "Primordial", "bonus_hp": 3800, "bonus_atk": 1900, "can_mount": True,  "mount_bonus_def": 1520, "mount_bonus_spd": 400},
        {"name": "Sereia do Plano Oculto",    "emoji": "ğŸ§œ",  "rarity": "Primordial", "bonus_hp": 3600, "bonus_atk": 2000, "can_mount": False},
    ],
    240: [  # Forjas do Caos
        {"name": "Salamandra CaÃ³tica",        "emoji": "ğŸ”¥",  "rarity": "Primordial", "bonus_hp": 4000, "bonus_atk": 2000, "can_mount": True,  "mount_bonus_def": 1600, "mount_bonus_spd": 420},
        {"name": "Golem das Forjas",          "emoji": "âš—ï¸",  "rarity": "Primordial", "bonus_hp": 4200, "bonus_atk": 1800, "can_mount": True,  "mount_bonus_def": 1680, "mount_bonus_spd": 350},
    ],
    250: [  # Tundra Absoluta
        {"name": "Lobo da Tundra Eterna",     "emoji": "â„ï¸",  "rarity": "Primordial", "bonus_hp": 4400, "bonus_atk": 2200, "can_mount": True,  "mount_bonus_def": 1760, "mount_bonus_spd": 430},
        {"name": "DragÃ£o de Gelo Absoluto",   "emoji": "ğŸ‰",  "rarity": "Primordial", "bonus_hp": 4600, "bonus_atk": 2300, "can_mount": True,  "mount_bonus_def": 1840, "mount_bonus_spd": 450},
    ],
    260: [  # Alquimia das Eras
        {"name": "HomÃºnculo SÃ¡bio",           "emoji": "âš—ï¸",  "rarity": "Primordial", "bonus_hp": 4800, "bonus_atk": 2200, "can_mount": False},
        {"name": "Quimera AlquÃ­mica",         "emoji": "ğŸ§ª",  "rarity": "Primordial", "bonus_hp": 5000, "bonus_atk": 2400, "can_mount": True,  "mount_bonus_def": 2000, "mount_bonus_spd": 440},
    ],
    270: [  # GalÃ¡xia Interior
        {"name": "DragÃ£o da GalÃ¡xia",         "emoji": "ğŸŒŒ",  "rarity": "Primordial", "bonus_hp": 5200, "bonus_atk": 2600, "can_mount": True,  "mount_bonus_def": 2080, "mount_bonus_spd": 460},
        {"name": "Nebulosa Consciente",       "emoji": "ğŸ’«",  "rarity": "Primordial", "bonus_hp": 5000, "bonus_atk": 2800, "can_mount": False},
    ],
    280: [  # Tribunal do Cosmo
        {"name": "GuardiÃ£o do EquilÃ­brio",    "emoji": "âš–ï¸",  "rarity": "Primordial", "bonus_hp": 5500, "bonus_atk": 2750, "can_mount": True,  "mount_bonus_def": 2200, "mount_bonus_spd": 470},
        {"name": "Juiz CÃ³smico",              "emoji": "ğŸ›ï¸", "rarity": "Primordial", "bonus_hp": 5800, "bonus_atk": 2900, "can_mount": False},
    ],
    # â”€â”€ CAP. IV: Terras Corrompidas (nÃ­vel 301â€“350) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    290: [  # Arena dos Deuses Menores
        {"name": "Gladiador Espectral",       "emoji": "ğŸ—¡ï¸", "rarity": "Primordial", "bonus_hp": 6200, "bonus_atk": 3100, "can_mount": False},
        {"name": "DragÃ£o da Arena",           "emoji": "ğŸ²",  "rarity": "Primordial", "bonus_hp": 6500, "bonus_atk": 3250, "can_mount": True,  "mount_bonus_def": 2600, "mount_bonus_spd": 490},
    ],
    300: [  # O Olho do Multiverso
        {"name": "Observador do Vazio",       "emoji": "ğŸ‘ï¸", "rarity": "Primordial", "bonus_hp": 6800, "bonus_atk": 3400, "can_mount": False},
        {"name": "Serpente do Multiverso",    "emoji": "ğŸ",  "rarity": "Primordial", "bonus_hp": 7000, "bonus_atk": 3500, "can_mount": True,  "mount_bonus_def": 2800, "mount_bonus_spd": 500},
    ],
    310: [  # Plano Astral Inferior
        {"name": "Fantasma Astral Corrompido","emoji": "ğŸ‘»",  "rarity": "Primordial", "bonus_hp": 7200, "bonus_atk": 3600, "can_mount": False},
        {"name": "DragÃ£o Astral Corrompido",  "emoji": "ğŸŒ‘",  "rarity": "Primordial", "bonus_hp": 7500, "bonus_atk": 3750, "can_mount": True,  "mount_bonus_def": 3000, "mount_bonus_spd": 510},
    ],
    320: [  # Fortaleza de Cristal
        {"name": "Golem de Cristal Vivo",     "emoji": "ğŸ’",  "rarity": "Primordial", "bonus_hp": 7800, "bonus_atk": 3500, "can_mount": True,  "mount_bonus_def": 3120, "mount_bonus_spd": 460},
        {"name": "DragÃ£o de Cristal Negro",   "emoji": "ğŸ’",  "rarity": "Primordial", "bonus_hp": 8000, "bonus_atk": 4000, "can_mount": True,  "mount_bonus_def": 3200, "mount_bonus_spd": 520},
    ],
    330: [  # Lua Negra
        {"name": "Lobo da Lua Negra",         "emoji": "ğŸŒ‘",  "rarity": "Primordial", "bonus_hp": 8200, "bonus_atk": 4100, "can_mount": True,  "mount_bonus_def": 3280, "mount_bonus_spd": 530},
        {"name": "DragÃ£o da Lua Negra",       "emoji": "ğŸŒ‘",  "rarity": "Primordial", "bonus_hp": 8500, "bonus_atk": 4250, "can_mount": True,  "mount_bonus_def": 3400, "mount_bonus_spd": 540},
    ],
    # â”€â”€ CAP. V: Reinos Dimensionais (nÃ­vel 351â€“400) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    340: [  # CemitÃ©rio de Estrelas
        {"name": "EspÃ­rito de Estrela Morta", "emoji": "â˜„ï¸",  "rarity": "Primordial", "bonus_hp": 9000, "bonus_atk": 4500, "can_mount": False},
        {"name": "FÃªnix Estelar",             "emoji": "â­",  "rarity": "Primordial", "bonus_hp": 9500, "bonus_atk": 4750, "can_mount": True,  "mount_bonus_def": 3800, "mount_bonus_spd": 560},
    ],
    350: [  # CoraÃ§Ã£o Solar
        {"name": "Elemental Solar",           "emoji": "ğŸŒ",  "rarity": "Primordial", "bonus_hp": 10000,"bonus_atk": 5000, "can_mount": False},
        {"name": "DragÃ£o Solar",              "emoji": "â˜€ï¸",  "rarity": "Primordial", "bonus_hp": 10500,"bonus_atk": 5250, "can_mount": True,  "mount_bonus_def": 4200, "mount_bonus_spd": 580},
    ],
    360: [  # Buraco Negro Vivo
        {"name": "Sombra do Buraco Negro",    "emoji": "ğŸ•³ï¸", "rarity": "Primordial", "bonus_hp": 11000,"bonus_atk": 5500, "can_mount": False},
        {"name": "DragÃ£o do Vazio CÃ³smico",   "emoji": "ğŸŒŒ",  "rarity": "Primordial", "bonus_hp": 11500,"bonus_atk": 5750, "can_mount": True,  "mount_bonus_def": 4600, "mount_bonus_spd": 600},
    ],
    370: [  # Nexo das DimensÃµes
        {"name": "Entidade do Nexo",          "emoji": "ğŸŒ",  "rarity": "Primordial", "bonus_hp": 12000,"bonus_atk": 6000, "can_mount": False},
        {"name": "DragÃ£o do Nexo",            "emoji": "ğŸŒ€",  "rarity": "Primordial", "bonus_hp": 12500,"bonus_atk": 6250, "can_mount": True,  "mount_bonus_def": 5000, "mount_bonus_spd": 620},
    ],
    380: [  # Tempestade Interdimensional
        {"name": "DragÃ£o da Tempestade Interdimensional","emoji":"âš¡","rarity":"Primordial","bonus_hp":13000,"bonus_atk":6500,"can_mount":True,"mount_bonus_def":5200,"mount_bonus_spd":640},
        {"name": "FÃªnix da Tempestade Cosmica","emoji": "ğŸŒ©ï¸","rarity": "Primordial","bonus_hp": 13500,"bonus_atk": 6750,"can_mount": True,"mount_bonus_def": 5400,"mount_bonus_spd": 660},
    ],
    # â”€â”€ CAP. VI: As Cinco DimensÃµes (nÃ­vel 401â€“500) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    390: [  # DimensÃ£o Celestial
        {"name": "Serafim GuardiÃ£o",          "emoji": "ğŸ•Šï¸", "rarity": "Primordial", "bonus_hp": 14000,"bonus_atk": 7000, "can_mount": True,  "mount_bonus_def": 5600, "mount_bonus_spd": 680},
        {"name": "DragÃ£o Celestial Divino",   "emoji": "âœ¨",  "rarity": "Primordial", "bonus_hp": 15000,"bonus_atk": 7500, "can_mount": True,  "mount_bonus_def": 6000, "mount_bonus_spd": 700},
    ],
    400: [  # DimensÃ£o Infernal
        {"name": "DemÃ´nio Primordial Livre",  "emoji": "ğŸ”¥",  "rarity": "Primordial", "bonus_hp": 16000,"bonus_atk": 8000, "can_mount": True,  "mount_bonus_def": 6400, "mount_bonus_spd": 680},
        {"name": "DragÃ£o Infernal Eterno",    "emoji": "ğŸ²",  "rarity": "Primordial", "bonus_hp": 17000,"bonus_atk": 8500, "can_mount": True,  "mount_bonus_def": 6800, "mount_bonus_spd": 700},
    ],
    410: [  # DimensÃ£o das Badlands
        {"name": "Criatura do Caos Puro",     "emoji": "ğŸŒªï¸", "rarity": "Primordial", "bonus_hp": 18000,"bonus_atk": 9000, "can_mount": False},
        {"name": "DragÃ£o das Badlands",       "emoji": "ğŸ’€",  "rarity": "Primordial", "bonus_hp": 19000,"bonus_atk": 9500, "can_mount": True,  "mount_bonus_def": 7600, "mount_bonus_spd": 720},
    ],
    420: [  # DimensÃ£o Abissal
        {"name": "Horror Primordial",         "emoji": "ğŸŒ‘",  "rarity": "Primordial", "bonus_hp": 20000,"bonus_atk":10000, "can_mount": False},
        {"name": "DragÃ£o Abissal",            "emoji": "ğŸŒ‘",  "rarity": "Primordial", "bonus_hp": 21000,"bonus_atk":10500, "can_mount": True,  "mount_bonus_def": 8400, "mount_bonus_spd": 740},
    ],
    430: [  # DimensÃ£o do Vazio
        {"name": "O Nada com Forma",          "emoji": "ğŸŒ€",  "rarity": "Primordial", "bonus_hp": 22000,"bonus_atk":11000, "can_mount": False},
        {"name": "DragÃ£o do Vazio Absoluto",  "emoji": "â™¾ï¸",  "rarity": "Primordial", "bonus_hp": 25000,"bonus_atk":12500, "can_mount": True,  "mount_bonus_def":10000, "mount_bonus_spd": 800},
    ],
}


# ================= ITENS â€” NOVOS REINOS 11â€“40 + DIMENSÃ•ES =================
ITEMS_NOVOS_REINOS = {
    90: {"weapons": [  # PlanÃ­cies do TrovÃ£o
        {"name": "LanÃ§a do TrovÃ£o PerpÃ©tuo",     "rarity": "LendÃ¡rio",  "atk": 108},
        {"name": "Martelo de Plasma",            "rarity": "MÃ­tico",    "atk": 220},
        {"name": "Espada do RelÃ¢mpago Eterno",   "rarity": "Ancestral", "atk": 300},
    ], "armor": [
        {"name": "Armadura do Tempesteiro",      "rarity": "LendÃ¡rio",  "def": 88},
        {"name": "Vestes do TrovÃ£o PerpÃ©tuo",    "rarity": "MÃ­tico",    "def": 195},
        {"name": "Placas do Raio Eterno",        "rarity": "Ancestral", "def": 280},
    ]},
    100: {"weapons": [  # Terra dos Gigantes
        {"name": "Clava dos Gigantes",           "rarity": "LendÃ¡rio",  "atk": 112},
        {"name": "Machado dos Colossus",         "rarity": "MÃ­tico",    "atk": 225},
        {"name": "LanÃ§a dos TitÃ£s Primordiais",  "rarity": "Ancestral", "atk": 305},
    ], "armor": [
        {"name": "CouraÃ§a dos Colossus",         "rarity": "LendÃ¡rio",  "def": 90},
        {"name": "Pele do TitÃ£",                 "rarity": "MÃ­tico",    "def": 198},
        {"name": "Armadura dos Gigantes CaÃ­dos", "rarity": "Ancestral", "def": 285},
    ]},
    110: {"weapons": [  # Mar das Almas
        {"name": "Tridente das Almas",           "rarity": "LendÃ¡rio",  "atk": 110},
        {"name": "Harpe das Profundezas",        "rarity": "MÃ­tico",    "atk": 222},
        {"name": "Espada da MarÃ© Eterna",        "rarity": "Ancestral", "atk": 302},
    ], "armor": [
        {"name": "Armadura das Escamas Abissais","rarity": "LendÃ¡rio",  "def": 89},
        {"name": "Manto das Almas Perdidas",     "rarity": "MÃ­tico",    "def": 196},
        {"name": "CouraÃ§a das Profundezas",      "rarity": "Ancestral", "def": 282},
    ]},
    120: {"weapons": [  # Reino do Caos
        {"name": "Cajado do Caos Maior",         "rarity": "LendÃ¡rio",  "atk": 114},
        {"name": "Foice do Caos Primordial",     "rarity": "MÃ­tico",    "atk": 228},
        {"name": "LÃ¢mina do Caos Eterno",        "rarity": "Ancestral", "atk": 308},
    ], "armor": [
        {"name": "Vestes do Caos Maior",         "rarity": "LendÃ¡rio",  "def": 91},
        {"name": "Armadura do Caos Primordial",  "rarity": "MÃ­tico",    "def": 200},
        {"name": "Manto do Caos Eterno",         "rarity": "Ancestral", "def": 288},
    ]},
    130: {"weapons": [  # Jardim dos Deuses
        {"name": "Flecha Divina de Artemis",     "rarity": "LendÃ¡rio",  "atk": 116},
        {"name": "Cajado do Jardim Sagrado",     "rarity": "MÃ­tico",    "atk": 232},
        {"name": "LanÃ§a dos Deuses Maiores",     "rarity": "Ancestral", "atk": 312},
        {"name": "Arco do Olimpo Verdadeiro",    "rarity": "Divino",    "atk": 405},
    ], "armor": [
        {"name": "Vestes dos Deuses Menores",    "rarity": "LendÃ¡rio",  "def": 93},
        {"name": "Manto do Jardim Eterno",       "rarity": "MÃ­tico",    "def": 202},
        {"name": "Armadura OlÃ­mpica",            "rarity": "Ancestral", "def": 290},
        {"name": "Vestes dos Deuses Maiores",    "rarity": "Divino",    "def": 380},
    ]},
    140: {"weapons": [  # Reino do Gelo Eterno
        {"name": "Espada do Gelo Eterno",        "rarity": "LendÃ¡rio",  "atk": 118},
        {"name": "LanÃ§a do Permafrost Absoluto", "rarity": "MÃ­tico",    "atk": 235},
        {"name": "Machado do Inverno Eterno",    "rarity": "Ancestral", "atk": 315},
        {"name": "Arco do Gelo Primordial",      "rarity": "Divino",    "atk": 408},
    ], "armor": [
        {"name": "Armadura do Gelo Eterno",      "rarity": "LendÃ¡rio",  "def": 94},
        {"name": "CouraÃ§a do Permafrost",        "rarity": "MÃ­tico",    "def": 205},
        {"name": "Placas do Inverno Absoluto",   "rarity": "Ancestral", "def": 292},
        {"name": "Pele do Gelo Primordial",      "rarity": "Divino",    "def": 382},
    ]},
    150: {"weapons": [  # RuÃ­nas da CivilizaÃ§Ã£o Perdida
        {"name": "RelÃ­quia da CivilizaÃ§Ã£o",      "rarity": "LendÃ¡rio",  "atk": 120},
        {"name": "Arma da Era Perdida",          "rarity": "MÃ­tico",    "atk": 238},
        {"name": "Espada do Ãšltimo Rei",         "rarity": "Ancestral", "atk": 318},
        {"name": "Cajado dos Arquitetos Divinos","rarity": "Divino",    "atk": 412},
    ], "armor": [
        {"name": "Armadura da CivilizaÃ§Ã£o Perdida","rarity":"LendÃ¡rio", "def": 95},
        {"name": "Vestes da Era Perdida",        "rarity": "MÃ­tico",    "def": 207},
        {"name": "Placas do Ãšltimo GuardiÃ£o",    "rarity": "Ancestral", "def": 295},
        {"name": "Manto dos Arquitetos Divinos", "rarity": "Divino",    "def": 385},
    ]},
    160: {"weapons": [  # Plano Astral
        {"name": "Cajado Astral Supremo",        "rarity": "LendÃ¡rio",  "atk": 122},
        {"name": "LÃ¢mina da ConsciÃªncia Pura",   "rarity": "MÃ­tico",    "atk": 242},
        {"name": "Espada do Cosmos Astral",      "rarity": "Ancestral", "atk": 322},
        {"name": "Arco das Estrelas Astrais",    "rarity": "Divino",    "atk": 418},
        {"name": "Cetro do Plano Astral",        "rarity": "Primordial","atk": 810},
    ], "armor": [
        {"name": "Vestes do Plano Astral",       "rarity": "LendÃ¡rio",  "def": 97},
        {"name": "Armadura da ConsciÃªncia",      "rarity": "MÃ­tico",    "def": 210},
        {"name": "Manto do Cosmos",              "rarity": "Ancestral", "def": 298},
        {"name": "Placas do Plano Astral",       "rarity": "Divino",    "def": 388},
        {"name": "Vestes da ConsciÃªncia Pura",   "rarity": "Primordial","def": 760},
    ]},
    170: {"weapons": [  # AlÃ©m da ExistÃªncia
        {"name": "Arma do AlÃ©m da ExistÃªncia",   "rarity": "MÃ­tico",    "atk": 250},
        {"name": "Espada do NÃ£o-Ser",            "rarity": "Ancestral", "atk": 330},
        {"name": "LanÃ§a do AlÃ©m de Tudo",        "rarity": "Divino",    "atk": 425},
        {"name": "O Conceito de Arma",           "rarity": "Primordial","atk": 820},
    ], "armor": [
        {"name": "ProteÃ§Ã£o do AlÃ©m da ExistÃªncia","rarity":"MÃ­tico",    "def": 215},
        {"name": "Armadura do NÃ£o-Ser",          "rarity": "Ancestral", "def": 305},
        {"name": "Vestes do AlÃ©m de Tudo",       "rarity": "Divino",    "def": 395},
        {"name": "O Conceito de ProteÃ§Ã£o",       "rarity": "Primordial","def": 770},
    ]},
    180: {"weapons": [  # O Trono Primordial
        {"name": "Espada do Trono Primordial",   "rarity": "Divino",    "atk": 430},
        {"name": "Cetro do Criador Primordial",  "rarity": "Primordial","atk": 830},
        {"name": "Foice do Trono Final",         "rarity": "Primordial","atk": 850},
    ], "armor": [
        {"name": "Armadura do Trono Primordial", "rarity": "Divino",    "def": 400},
        {"name": "Vestes do Criador",            "rarity": "Primordial","def": 780},
        {"name": "CouraÃ§a do Trono Final",       "rarity": "Primordial","def": 800},
    ]},
    # CAP III â€” 201â€“300
    190: {"weapons": [{"name": "LÃ¢mina do Ãpice Mortal","rarity":"Divino","atk":440},{"name": "Cajado do Ãpice Supremo","rarity":"Primordial","atk":860}],
          "armor":   [{"name": "Armadura do Ãpice Mortal","rarity":"Divino","def":410},{"name": "Vestes do Ãpice Supremo","rarity":"Primordial","def":810}]},
    200: {"weapons": [{"name": "Espada do Despertar Dimensional","rarity":"Divino","atk":450},{"name": "Arco do Despertar Absoluto","rarity":"Primordial","atk":870}],
          "armor":   [{"name": "Armadura do Despertar","rarity":"Divino","def":420},{"name": "Placas do Despertar Absoluto","rarity":"Primordial","def":820}]},
    210: {"weapons": [{"name": "LanÃ§a do VÃ³rtice Eterno","rarity":"Divino","atk":460},{"name": "Cajado do VÃ³rtice Primordial","rarity":"Primordial","atk":880}],
          "armor":   [{"name": "Vestes do VÃ³rtice","rarity":"Divino","def":430},{"name": "Manto do VÃ³rtice Primordial","rarity":"Primordial","def":830}]},
    220: {"weapons": [{"name": "Machado das Montanhas do AlÃ©m","rarity":"Divino","atk":468},{"name": "LanÃ§a do Pico Absoluto","rarity":"Primordial","atk":890}],
          "armor":   [{"name": "CouraÃ§a das Montanhas do AlÃ©m","rarity":"Divino","def":438},{"name": "Armadura do Pico Absoluto","rarity":"Primordial","def":840}]},
    230: {"weapons": [{"name": "Tridente do Oceano Dimensional","rarity":"Divino","atk":476},{"name": "Espada das MarÃ©s Primordiais","rarity":"Primordial","atk":900}],
          "armor":   [{"name": "Armadura do Oceano Dimensional","rarity":"Divino","def":446},{"name": "Vestes das MarÃ©s Primordiais","rarity":"Primordial","def":850}]},
    240: {"weapons": [{"name": "Espada Forjada no Caos","rarity":"Divino","atk":484},{"name": "Martelo das Forjas Primordiais","rarity":"Primordial","atk":910}],
          "armor":   [{"name": "Armadura das Forjas do Caos","rarity":"Divino","def":454},{"name": "Placas das Forjas Primordiais","rarity":"Primordial","def":860}]},
    250: {"weapons": [{"name": "Espada da Tundra Absoluta","rarity":"Divino","atk":492},{"name": "LanÃ§a do Gelo Primordial","rarity":"Primordial","atk":920}],
          "armor":   [{"name": "Armadura da Tundra Absoluta","rarity":"Divino","def":462},{"name": "Vestes do Gelo Primordial","rarity":"Primordial","def":870}]},
    260: {"weapons": [{"name": "Cajado da Alquimia Suprema","rarity":"Divino","atk":500},{"name": "Pedra Filosofal Feita Arma","rarity":"Primordial","atk":930}],
          "armor":   [{"name": "Vestes da Alquimia das Eras","rarity":"Divino","def":470},{"name": "ProteÃ§Ã£o da Pedra Filosofal","rarity":"Primordial","def":880}]},
    270: {"weapons": [{"name": "Espada da GalÃ¡xia Interior","rarity":"Divino","atk":508},{"name": "Cajado da Nebulosa Primordial","rarity":"Primordial","atk":940}],
          "armor":   [{"name": "Armadura da GalÃ¡xia Interior","rarity":"Divino","def":478},{"name": "Manto da Nebulosa Primordial","rarity":"Primordial","def":890}]},
    280: {"weapons": [{"name": "Espada do Tribunal CÃ³smico","rarity":"Divino","atk":516},{"name": "Martelo do JuÃ­zo Primordial","rarity":"Primordial","atk":950}],
          "armor":   [{"name": "Armadura do Tribunal","rarity":"Divino","def":486},{"name": "Vestes do JuÃ­zo Primordial","rarity":"Primordial","def":900}]},
    # CAP IV â€” 301â€“350
    290: {"weapons": [{"name": "Espada dos Deuses Menores","rarity":"Divino","atk":525},{"name": "Tridente da Arena CÃ³smica","rarity":"Primordial","atk":960}],
          "armor":   [{"name": "Armadura da Arena dos Deuses","rarity":"Divino","def":495},{"name": "CouraÃ§a dos Gladiadores CÃ³smicos","rarity":"Primordial","def":910}]},
    300: {"weapons": [{"name": "LanÃ§a do Olho do Multiverso","rarity":"Divino","atk":534},{"name": "Cajado do Observador Primordial","rarity":"Primordial","atk":970}],
          "armor":   [{"name": "Vestes do Observador","rarity":"Divino","def":504},{"name": "Manto do Observador Primordial","rarity":"Primordial","def":920}]},
    310: {"weapons": [{"name": "Foice do Astral Inferior","rarity":"Divino","atk":542},{"name": "Espada do Astral Corrompido","rarity":"Primordial","atk":980}],
          "armor":   [{"name": "Armadura do Astral Inferior","rarity":"Divino","def":512},{"name": "Vestes do Astral Corrompido","rarity":"Primordial","def":930}]},
    320: {"weapons": [{"name": "Espada de Cristal Negro","rarity":"Divino","atk":550},{"name": "LanÃ§a da Fortaleza Cristalina","rarity":"Primordial","atk":990}],
          "armor":   [{"name": "Armadura da Fortaleza de Cristal","rarity":"Divino","def":520},{"name": "CouraÃ§a de Cristal Negro","rarity":"Primordial","def":940}]},
    330: {"weapons": [{"name": "Foice da Lua Negra","rarity":"Divino","atk":558},{"name": "Espada do PlenilÃºnio Negro","rarity":"Primordial","atk":1000}],
          "armor":   [{"name": "Armadura da Lua Negra","rarity":"Divino","def":528},{"name": "Vestes do PlenilÃºnio Negro","rarity":"Primordial","def":950}]},
    # CAP V â€” 351â€“400
    340: {"weapons": [{"name": "LanÃ§a da Estrela Morta","rarity":"Divino","atk":568},{"name": "Espada do CemitÃ©rio Estelar","rarity":"Primordial","atk":1020}],
          "armor":   [{"name": "Armadura das Estrelas Mortas","rarity":"Divino","def":538},{"name": "Manto do CemitÃ©rio Estelar","rarity":"Primordial","def":960}]},
    350: {"weapons": [{"name": "Espada do CoraÃ§Ã£o Solar","rarity":"Divino","atk":578},{"name": "LanÃ§a do Sol Primordial","rarity":"Primordial","atk":1040}],
          "armor":   [{"name": "Armadura do CoraÃ§Ã£o Solar","rarity":"Divino","def":548},{"name": "Placas do Sol Primordial","rarity":"Primordial","def":970}]},
    360: {"weapons": [{"name": "Foice do Buraco Negro","rarity":"Divino","atk":588},{"name": "Espada da Singularidade","rarity":"Primordial","atk":1060}],
          "armor":   [{"name": "Armadura da Singularidade","rarity":"Divino","def":558},{"name": "Vestes do Horizonte de Eventos","rarity":"Primordial","def":980}]},
    370: {"weapons": [{"name": "Cetro do Nexo Dimensional","rarity":"Divino","atk":598},{"name": "Espada do Nexo Primordial","rarity":"Primordial","atk":1080}],
          "armor":   [{"name": "Armadura do Nexo Dimensional","rarity":"Divino","def":568},{"name": "Vestes do Nexo Primordial","rarity":"Primordial","def":990}]},
    380: {"weapons": [{"name": "Espada da Tempestade Interdimensional","rarity":"Divino","atk":610},{"name": "Martelo da Tempestade Primordial","rarity":"Primordial","atk":1100}],
          "armor":   [{"name": "Armadura da Tempestade Interdimensional","rarity":"Divino","def":580},{"name": "CouraÃ§a da Tempestade Primordial","rarity":"Primordial","def":1000}]},
    # CAP VI â€” DimensÃµes 401â€“500
    390: {"weapons": [{"name": "Espada da Luz Celestial","rarity":"Primordial","atk":1120},{"name": "LanÃ§a do Serafim Supremo","rarity":"Primordial","atk":1150}],
          "armor":   [{"name": "Armadura Celestial Suprema","rarity":"Primordial","def":1020},{"name": "Vestes do Serafim Supremo","rarity":"Primordial","def":1050}]},
    400: {"weapons": [{"name": "LÃ¢mina do Inferno Eterno","rarity":"Primordial","atk":1180},{"name": "Cajado do Abismo Infernal","rarity":"Primordial","atk":1200}],
          "armor":   [{"name": "CouraÃ§a do Inferno Eterno","rarity":"Primordial","def":1080},{"name": "Armadura do Senhor Infernal","rarity":"Primordial","def":1100}]},
    410: {"weapons": [{"name": "Arma do Caos das Badlands","rarity":"Primordial","atk":1230},{"name": "Foice do Deserto CaÃ³tico","rarity":"Primordial","atk":1250}],
          "armor":   [{"name": "Armadura das Badlands","rarity":"Primordial","def":1130},{"name": "Vestes do Caos Puro","rarity":"Primordial","def":1150}]},
    420: {"weapons": [{"name": "LanÃ§a do Abismo Primordial","rarity":"Primordial","atk":1280},{"name": "Espada da Sanidade Perdida","rarity":"Primordial","atk":1300}],
          "armor":   [{"name": "Armadura do Abismo Eterno","rarity":"Primordial","def":1180},{"name": "ProteÃ§Ã£o do Horror Primordial","rarity":"Primordial","def":1200}]},
    430: {"weapons": [{"name": "O Vazio Feito Arma","rarity":"Primordial","atk":1350},{"name": "LÃ¢mina da NÃ£o-ExistÃªncia","rarity":"Primordial","atk":1400}],
          "armor":   [{"name": "Armadura do Vazio Absoluto","rarity":"Primordial","def":1250},{"name": "Manto da NÃ£o-ExistÃªncia","rarity":"Primordial","def":1300}]},
}


def register_new_world_content():
    """Registra pets e itens dos novos reinos nos dicts globais. Chamado na init."""
    for world_id, pets in PETS_NOVOS_REINOS.items():
        if world_id not in PETS_EXTRA:
            PETS_EXTRA[world_id] = []
        PETS_EXTRA[world_id].extend(pets)
    for world_id, data in ITEMS_NOVOS_REINOS.items():
        ITEMS["weapons"].extend(data.get("weapons", []))
        ITEMS["armor"].extend(data.get("armor", []))


def get_all_pets():
    """Retorna todos os pets (originais + extras) como lista flat por mundo"""
    all_pets = {}
    for world, pets in PETS.items():
        all_pets[world] = list(pets)
    for world, pets in PETS_EXTRA.items():
        if world not in all_pets:
            all_pets[world] = []
        all_pets[world].extend(pets)
    return all_pets

def get_pet_mount_data(pet_name):
    """Retorna dados de montaria de um pet, ou None se nÃ£o pode ser montaria"""
    # Checar pets extras
    for pets in PETS_EXTRA.values():
        for p in pets:
            if p["name"] == pet_name:
                if p.get("can_mount"):
                    return {"mount_bonus_def": p.get("mount_bonus_def", 0), "mount_bonus_spd": p.get("mount_bonus_spd", 0)}
                return None
    # Checar pets originais com montaria
    if pet_name in EXISTING_PETS_MOUNT:
        return EXISTING_PETS_MOUNT[pet_name]
    return None
POTIONS = {
    "PoÃ§Ã£o de Vida Menor": {"rarity": "Comum", "hp_restore": 30, "emoji": "ğŸ§ª"},
    "PoÃ§Ã£o de Vida": {"rarity": "Incomum", "hp_restore": 60, "emoji": "ğŸ§ª"},
    "PoÃ§Ã£o de Vida Maior": {"rarity": "Raro", "hp_restore": 100, "emoji": "ğŸ’Š"},
    "PoÃ§Ã£o de Vida Superior": {"rarity": "Ã‰pico", "hp_restore": 150, "emoji": "ğŸ’Š"},
    "Elixir da Vida": {"rarity": "LendÃ¡rio", "hp_restore": 250, "emoji": "âš—ï¸"},
    "Elixir Divino": {"rarity": "Divino", "hp_restore": 500, "emoji": "âœ¨"},
    "PoÃ§Ã£o de XP Menor": {"rarity": "Incomum", "xp_gain": 50, "emoji": "âœ¨"},
    "PoÃ§Ã£o de XP": {"rarity": "Raro", "xp_gain": 100, "emoji": "âœ¨"},
    "PoÃ§Ã£o de XP Maior": {"rarity": "Ã‰pico", "xp_gain": 200, "emoji": "ğŸ’«"},
    "Elixir de XP": {"rarity": "LendÃ¡rio", "xp_gain": 500, "emoji": "ğŸŒŸ"},
    "PoÃ§Ã£o de ForÃ§a": {"rarity": "Raro", "temp_atk": 20, "duration": 5, "emoji": "ğŸ’ª"},
    "PoÃ§Ã£o de Defesa": {"rarity": "Raro", "temp_def": 15, "duration": 5, "emoji": "ğŸ›¡ï¸"},
    "PoÃ§Ã£o de Sorte": {"rarity": "Ã‰pico", "luck_bonus": 2, "duration": 3, "emoji": "ğŸ€"},
    "AntÃ­doto": {"rarity": "Comum", "cure_poison": True, "emoji": "ğŸ’‰"},
    "PoÃ§Ã£o de RessurreiÃ§Ã£o": {"rarity": "MÃ­tico", "revive": True, "emoji": "ğŸ’€"}
}

# ================= SISTEMA DE QUESTS =================
QUESTS = {
    1: [  # Campos Iniciais
        {
            "id": "campos_001",
            "name": "ğŸ€ A Praga dos Ratos",
            "description": "Os aldeÃµes estÃ£o desesperados. Ratos selvagens invadiram os campos e destroem as colheitas. Elimine 5 Ratos Selvagens e traga paz Ã  regiÃ£o.",
            "type": "individual",
            "objective": "hunt",
            "target": "Rato Selvagem",
            "count": 5,
            "reward_xp": 450,
            "reward_coins": 90,
            "reward_item": "PoÃ§Ã£o de Vida",
            "lore": "Os aldeÃµes sussurram sobre uma criatura maior controlando os ratos... O Rato Rei.",
            "npc": "AldeÃ£o Theron",
            "difficulty": "FÃ¡cil"
        },
        {
            "id": "campos_002",
            "name": "ğŸŒ¿ Ervas do Curandeiro",
            "description": "O curandeiro da aldeia precisa de recursos para preparar remÃ©dios. Colete 8 recursos diferentes dos Campos Iniciais.",
            "type": "individual",
            "objective": "collect",
            "count": 8,
            "reward_xp": 300,
            "reward_coins": 60,
            "reward_item": "PoÃ§Ã£o de XP Menor",
            "lore": "O curandeiro menciona que as ervas desta regiÃ£o tÃªm propriedades mÃ¡gicas Ãºnicas desde a queda do primeiro meteoro.",
            "npc": "Curandeira Elara",
            "difficulty": "FÃ¡cil"
        },
        {
            "id": "campos_003",
            "name": "ğŸ‘‘ A CaÃ§a ao Slime Rei",
            "description": "Uma equipe de aventureiros deve unir forÃ§as para derrotar o Slime Rei que aterroriza a regiÃ£o. MissÃ£o para 2-3 jogadores.",
            "type": "team",
            "min_players": 2,
            "max_players": 3,
            "objective": "boss",
            "target": "Slime Rei",
            "reward_xp": 1200,
            "reward_coins": 240,
            "reward_item": "Espada de Ferro",
            "lore": "O Slime Rei absorveu a magia de um cristal antigo e agora Ã© imune a ataques solitÃ¡rios. Apenas a forÃ§a combinada pode parÃ¡-lo.",
            "npc": "CapitÃ£o Aldric",
            "difficulty": "MÃ©dio"
        },
        {
            "id": "campos_004",
            "name": "ğŸ“š O DiÃ¡rio Perdido",
            "description": "Um explorador perdeu seu diÃ¡rio precioso nos campos. Explore a regiÃ£o e encontre o artefato perdido.",
            "type": "individual",
            "objective": "explore",
            "count": 3,
            "reward_xp": 240,
            "reward_coins": 45,
            "reward_item": None,
            "lore": "O diÃ¡rio menciona uma rota secreta para as Montanhas Geladas... algo que nenhum mapa oficial mostra.",
            "npc": "Explorador Miko",
            "difficulty": "FÃ¡cil"
        }
    ],
    10: [  # Floresta Sombria
        {
            "id": "floresta_001",
            "name": "ğŸ•·ï¸ O Ninho Maldito",
            "description": "Aranhas Gigantes bloqueiam a passagem principal da floresta. Elimine-as para reabrir o caminho dos mercadores.",
            "type": "individual",
            "objective": "hunt",
            "target": "Aranha Gigante",
            "count": 6,
            "reward_xp": 1050,
            "reward_coins": 150,
            "reward_item": "PoÃ§Ã£o de Vida Maior",
            "lore": "As aranhas foram atraÃ­das por um artefato Ã©lfico enterrado nas profundezas da floresta.",
            "npc": "Mercador Brynn",
            "difficulty": "MÃ©dio"
        },
        {
            "id": "floresta_002",
            "name": "ğŸŒ² O Ent Adormecido",
            "description": "Uma equipe deve despertar e pacificar o Ent AnciÃ£o antes que sua fÃºria destrua a floresta inteira.",
            "type": "team",
            "min_players": 2,
            "max_players": 3,
            "objective": "boss",
            "target": "Ent AnciÃ£o",
            "reward_xp": 2700,
            "reward_coins": 450,
            "reward_item": "Armadura Ã‰lfica",
            "lore": "O Ent AnciÃ£o tem 3.000 anos. Ele guarda em sua memÃ³ria o segredo da origem da floresta.",
            "npc": "Druida Sylvara",
            "difficulty": "DifÃ­cil"
        },
        {
            "id": "floresta_003",
            "name": "ğŸ‘» Sussurros Espectrais",
            "description": "EspÃ­ritos Florestais perturbam a paz. Explore a floresta e descubra o que os inquieta.",
            "type": "individual",
            "objective": "explore",
            "count": 5,
            "reward_xp": 840,
            "reward_coins": 120,
            "reward_item": "PoÃ§Ã£o de XP",
            "lore": "Os espÃ­ritos mencionam uma 'Chave de Ã‰bano' escondida nas raÃ­zes da Ã¡rvore mais antiga.",
            "npc": "EspÃ­rito AnciÃ£o Vel",
            "difficulty": "MÃ©dio"
        }
    ],
    20: [  # Deserto das Almas
        {
            "id": "deserto_001",
            "name": "âš°ï¸ A MaldiÃ§Ã£o do FaraÃ³",
            "description": "MÃºmias emergem das tumbas atacando viajantes. TrÃªs guerreiros devem adentrar a pirÃ¢mide e quebrar a maldiÃ§Ã£o.",
            "type": "team",
            "min_players": 2,
            "max_players": 3,
            "objective": "boss",
            "target": "FaraÃ³ AmaldiÃ§oado",
            "reward_xp": 3600,
            "reward_coins": 600,
            "reward_item": "LÃ¢mina Flamejante",
            "lore": "O FaraÃ³ Kha-Mentu foi traÃ­do por seus sacerdotes e amaldiÃ§oado para guardar seus prÃ³prios tesouros por toda a eternidade.",
            "npc": "ArqueÃ³logo Ramses",
            "difficulty": "DifÃ­cil"
        },
        {
            "id": "deserto_002",
            "name": "ğŸº Artefatos da Dinastia",
            "description": "Colete recursos Ãºnicos do deserto para reconstituir um artefato sagrado da civilizaÃ§Ã£o perdida.",
            "type": "individual",
            "objective": "collect",
            "count": 10,
            "reward_xp": 1500,
            "reward_coins": 210,
            "reward_item": "PoÃ§Ã£o de Vida Superior",
            "lore": "Os artefatos da Dinastia de Ouro revelam que os humanos nÃ£o foram os primeiros a habitar este mundo.",
            "npc": "SÃ¡bia Nefertiri",
            "difficulty": "MÃ©dio"
        },
        {
            "id": "deserto_003",
            "name": "ğŸ¦‚ CaÃ§ador de EscorpiÃµes",
            "description": "Elimine EscorpiÃµes Gigantes que envenenaram o Ãºnico oÃ¡sis da regiÃ£o.",
            "type": "individual",
            "objective": "hunt",
            "target": "EscorpiÃ£o Gigante",
            "count": 8,
            "reward_xp": 1800,
            "reward_coins": 270,
            "reward_item": "AntÃ­doto",
            "lore": "O veneno dos escorpiÃµes, se processado corretamente, pode curar qualquer doenÃ§a conhecida.",
            "npc": "NÃ´made Hassan",
            "difficulty": "MÃ©dio"
        }
    ],
    30: [  # Montanhas Geladas
        {
            "id": "gelo_001",
            "name": "â„ï¸ O CoraÃ§Ã£o Congelado",
            "description": "O Yeti Colossal capturou trÃªs aldeÃµes. Uma equipe deve resgatÃ¡-los e derrotar a besta.",
            "type": "team",
            "min_players": 2,
            "max_players": 3,
            "objective": "boss",
            "target": "Yeti Colossal",
            "reward_xp": 5400,
            "reward_coins": 840,
            "reward_item": "Armadura RÃºnica",
            "lore": "O Yeti Colossal Ã© na verdade um guardiÃ£o criado pelos TitÃ£s do Gelo para proteger um segredo nas profundezas da montanha.",
            "npc": "AnciÃ£o da Montanha Bjorn",
            "difficulty": "Muito DifÃ­cil"
        },
        {
            "id": "gelo_002",
            "name": "ğŸ’ Cristais da Profundidade",
            "description": "Minere cristais de gelo raros das cavernas mais profundas para o ferreiro da fortaleza.",
            "type": "individual",
            "objective": "collect",
            "count": 12,
            "reward_xp": 2100,
            "reward_coins": 300,
            "reward_item": "PoÃ§Ã£o de XP Maior",
            "lore": "Os cristais de gelo desta regiÃ£o tÃªm memÃ³ria. Ao tocÃ¡-los, vocÃª vÃª fragmentos do passado.",
            "npc": "Ferreiro Helga",
            "difficulty": "MÃ©dio"
        }
    ],
    40: [  # Reino VulcÃ¢nico
        {
            "id": "vulcao_001",
            "name": "ğŸ² O DragÃ£o de Magma",
            "description": "O DragÃ£o de Magma desperta apÃ³s sÃ©culos de sono. TrÃªs herÃ³is devem uni-lo ou derrotÃ¡-lo.",
            "type": "team",
            "min_players": 3,
            "max_players": 3,
            "objective": "boss",
            "target": "DragÃ£o de Magma",
            "reward_xp": 7500,
            "reward_coins": 1200,
            "reward_item": "Excalibur",
            "lore": "O DragÃ£o de Magma Ignarius foi o primeiro ser criado quando o mundo era apenas fogo e pedra. Ele guarda a Chama Original.",
            "npc": "Profeta Ignar",
            "difficulty": "LendÃ¡rio"
        },
        {
            "id": "vulcao_002",
            "name": "ğŸŒ‹ A Forja Sagrada",
            "description": "Colete nÃºcleos de fogo da lava ativa para reacender a Forja Sagrada dos anÃµes.",
            "type": "individual",
            "objective": "collect",
            "count": 15,
            "reward_xp": 2700,
            "reward_coins": 390,
            "reward_item": "Martelo do TrovÃ£o",
            "lore": "A Forja Sagrada foi usada para criar as primeiras armas dos deuses. EstÃ¡ apagada hÃ¡ 1.000 anos.",
            "npc": "AnÃ£o-Mestre Doran",
            "difficulty": "DifÃ­cil"
        }
    ],
    50: [  # Abismo Arcano
        {
            "id": "abismo_001",
            "name": "ğŸŒ€ O Senhor das Sombras",
            "description": "O Senhor das Sombras ameaÃ§a consumir toda a realidade. TrÃªs campeÃµes devem confrontÃ¡-lo no coraÃ§Ã£o do abismo.",
            "type": "team",
            "min_players": 3,
            "max_players": 3,
            "objective": "boss",
            "target": "Senhor das Sombras",
            "reward_xp": 12000,
            "reward_coins": 1800,
            "reward_item": "Cetro da Eternidade",
            "lore": "O Senhor das Sombras Ã© um ser que existia antes do universo. Ele nÃ£o deseja destruiÃ§Ã£o â€” deseja retornar ao vazio primordial.",
            "npc": "Arquimago Zephyr",
            "difficulty": "MÃ­tico"
        },
        {
            "id": "abismo_002",
            "name": "ğŸ“– Tomos Proibidos",
            "description": "Recupere tomos de conhecimento proibido espalhados pelo Abismo Arcano antes que se corrompam.",
            "type": "individual",
            "objective": "explore",
            "count": 7,
            "reward_xp": 3600,
            "reward_coins": 480,
            "reward_item": "PoÃ§Ã£o de XP Maior",
            "lore": "Os tomos foram escritos por entidades que existiram antes dos deuses. Seu conteÃºdo pode enlouquecer mortais despreparados.",
            "npc": "BibliotecÃ¡ria Spectra",
            "difficulty": "Muito DifÃ­cil"
        }
    ],
    60: [  # Trono Celestial
        {
            "id": "celestial_001",
            "name": "ğŸ‘‘ O Imperador Astral",
            "description": "A batalha final. TrÃªs lendas vivas devem enfrentar o Imperador Astral pelo destino de todos os mundos.",
            "type": "team",
            "min_players": 3,
            "max_players": 3,
            "objective": "boss",
            "target": "Imperador Astral",
            "reward_xp": 30000,
            "reward_coins": 3000,
            "reward_item": "Armadura do Primeiro Deus",
            "lore": "O Imperador Astral nÃ£o Ã© um inimigo â€” Ã© um teste. Aqueles dignos de passar herdarÃ£o o trono do universo.",
            "npc": "Voz do Cosmos",
            "difficulty": "Primordial"
        },
        {
            "id": "celestial_002",
            "name": "ğŸŒŸ Fragmentos da CriaÃ§Ã£o",
            "description": "ReÃºna os Fragmentos Estelares espalhados pelo Trono Celestial para reconstruir o Cristal da Origem.",
            "type": "individual",
            "objective": "collect",
            "count": 20,
            "reward_xp": 9000,
            "reward_coins": 1500,
            "reward_item": "Elixir Divino",
            "lore": "O Cristal da Origem foi destruÃ­do durante a Primeira Guerra Celestial. Sua reconstruÃ§Ã£o poderia criar â€” ou destruir â€” um novo universo.",
            "npc": "GuardiÃ£o Estelar Auron",
            "difficulty": "LendÃ¡rio"
        }
    ]
}

# ================= EMPREGOS DO REINO =================
JOBS = {
    "Ferreiro": {
        "emoji": "âš’ï¸",
        "min_level": 5,
        "description": "Mestre das forjas. Cria e melhora equipamentos com materiais coletados.",
        "salary_coins": (40, 90),
        "salary_xp": (100, 240),
        "perks": [
            "Pode craftar armas Ãºnicas com `forjar arma`",
            "20% desconto ao comprar equipamentos na loja",
            "+2 bÃ´nus em dados ao coletar recursos de metal",
            "Pode identificar qualidade de itens com `inspecionar item`",
        ],
        "work_action": "VocÃª martela o ferro com maestria. FaÃ­scas voam enquanto uma lÃ¢mina toma forma.",
        "work_msgs": [
            "ğŸ”¨ VocÃª forja uma espada encomendada por um guarda. Trabalho limpo!",
            "âš’ï¸ Um anÃ£o visita sua forja e aprova sua tÃ©cnica â€” raro elogio!",
            "ğŸ”¥ O fogo da forja revela um inchaÃ§o no aÃ§o. VocÃª o reforja melhor ainda.",
            "âš™ï¸ VocÃª repara a armadura de um cavaleiro. Ele parte em silÃªncio, mas com respeito.",
            "â›ï¸ Uma lÃ¢mina perfeita sai da forja. VocÃª a guarda â€” ninguÃ©m ainda merece.",
        ],
        "levels": {
            1: {"name": "Ferreiro Aprendiz", "bonus": "+10 ATK permanente", "atk_bonus": 10, "salary_mult": 1.0},
            2: {"name": "Ferreiro Mestre",   "bonus": "+25 ATK, +10 DEF, acesso a forja Ã©lfica", "atk_bonus": 25, "def_bonus": 10, "salary_mult": 1.5, "req_work": 20},
            3: {"name": "Grande Ferreiro",   "bonus": "+50 ATK, +25 DEF, pode forjar armas lendÃ¡rias", "atk_bonus": 50, "def_bonus": 25, "salary_mult": 2.5, "req_work": 50},
        }
    },
    "Arcano": {
        "emoji": "ğŸ”®",
        "min_level": 5,
        "description": "Estudioso dos mistÃ©rios mÃ¡gicos. Pesquisa feitiÃ§os e fenÃ´menos sobrenaturais.",
        "salary_coins": (25, 60),
        "salary_xp": (160, 360),
        "perks": [
            "+15 de mana mÃ¡xima permanente",
            "Pode usar `estudar magia` para ganhar XP extra",
            "50% de chance de identificar itens mÃ¡gicos automaticamente",
            "Acesso Ã  `biblioteca arcana` com lore exclusivo",
        ],
        "work_action": "VocÃª mergulha em pergaminhos proibidos, decifrando runas antigas com os olhos vibrando.",
        "work_msgs": [
            "ğŸ“š VocÃª decifra um pergaminho que ninguÃ©m leu por 300 anos. RevelaÃ§Ã£o inquietante.",
            "âœ¨ Uma fÃ³rmula mÃ¡gica que vocÃª criou funciona pela primeira vez. Que satisfaÃ§Ã£o!",
            "ğŸŒ€ Uma anomalia arcana surge no laboratÃ³rio. VocÃª a contÃ©m por um fio.",
            "ğŸ”® VocÃª cataloga uma criatura mÃ¡gica nunca documentada. A academia vai amar isso.",
            "ğŸ’« Seus estudos sobre o Abismo revelam uma verdade que deveria permanecer escondida.",
        ],
        "levels": {
            1: {"name": "Aprendiz Arcano",  "bonus": "+15 Mana mÃ¡xima", "mana_bonus": 15, "salary_mult": 1.0},
            2: {"name": "Erudito Arcano",   "bonus": "+40 Mana, +XP de magia dobrado", "mana_bonus": 40, "salary_mult": 1.5, "req_work": 20},
            3: {"name": "Arquimago",         "bonus": "+80 Mana, acesso a feitiÃ§os proibidos", "mana_bonus": 80, "salary_mult": 2.5, "req_work": 50},
        }
    },
    "Curandeiro": {
        "emoji": "ğŸ’š",
        "min_level": 5,
        "description": "GuardiÃ£o da vida. Cura ferimentos e doenÃ§as usando ervas e magia de cura.",
        "salary_coins": (30, 70),
        "salary_xp": (80, 200),
        "perks": [
            "Regenera +10 HP ao usar `trabalhar` alÃ©m do salÃ¡rio",
            "PoÃ§Ãµes custam 30% menos na loja",
            "`curar` tem 25% de chance de curar completamente",
            "Pode usar `curar aliado @user` para curar outros jogadores",
        ],
        "work_action": "Suas mÃ£os brilham com energia de cura enquanto vocÃª atende os feridos.",
        "work_msgs": [
            "ğŸ’š VocÃª salva um mercador picado por uma aranha venenosa. Ele chora de alÃ­vio.",
            "ğŸŒ¿ Suas ervas curam uma crianÃ§a com febre arcana. A mÃ£e te abraÃ§a com forÃ§a.",
            "âš•ï¸ Um guerreiro chega quase morto. VocÃª trabalha a noite toda. Ele sobrevive.",
            "ğŸƒ VocÃª descobre uma combinaÃ§Ã£o de ervas que alivia veneno de drago. Anotado.",
            "ğŸ’Š VocÃª trata 12 aldeÃµes com gripe mÃ¡gica num sÃ³ dia. Exausto, mas feliz.",
        ],
        "levels": {
            1: {"name": "Curandeiro Iniciante", "bonus": "+10 HP ao trabalhar", "hp_regen_bonus": 10, "salary_mult": 1.0},
            2: {"name": "Curandeiro Experiente","bonus": "+25 HP ao trabalhar, cura de aliados aprimorada", "hp_regen_bonus": 25, "salary_mult": 1.5, "req_work": 20},
            3: {"name": "Curandeiro Sagrado",   "bonus": "+50 HP ao trabalhar, pode reviver aliados derrotados", "hp_regen_bonus": 50, "salary_mult": 2.5, "req_work": 50},
        }
    },
    "Mercador": {
        "emoji": "ğŸ’°",
        "min_level": 5,
        "description": "Comerciante astuto. Compra e vende itens obtendo lucro em cada transaÃ§Ã£o.",
        "salary_coins": (75, 150),
        "salary_xp": (40, 120),
        "perks": [
            "Vende itens por 25% a mais de valor",
            "Acesso a `mercado negro` com itens raros",
            "Pode `negociar` para reduzir custo de compras",
            "+5 coins extras ao concluir qualquer quest",
        ],
        "work_action": "VocÃª negocia com viajantes, comprando barato e vendendo caro com um sorriso encantador.",
        "work_msgs": [
            "ğŸ’° VocÃª compra uma gema por 3 moedas e vende por 30. Que dia excelente!",
            "ğŸ¤ Um nobre paga o triplo por um item comum â€” ele nem sabia que era comum.",
            "ğŸ“Š Sua rota comercial entre dois reinos rende 50% a mais este mÃªs.",
            "ğŸª Um rival tenta te sabotar. VocÃª sorri e leva o cliente dele embora.",
            "ğŸ’ VocÃª fareja um item raro num lote de bugigangas. Fortuna bem merecida.",
        ],
        "levels": {
            1: {"name": "Comerciante",      "bonus": "+25% ao vender itens", "sell_bonus": 0.25, "salary_mult": 1.0},
            2: {"name": "Mercador PrÃ³spero","bonus": "+50% venda, acesso mercado negro VIP", "sell_bonus": 0.50, "salary_mult": 1.5, "req_work": 20},
            3: {"name": "Magnata",          "bonus": "+75% venda, loja exclusiva, tributo passivo", "sell_bonus": 0.75, "salary_mult": 2.5, "req_work": 50},
        }
    },
    "Escriba": {
        "emoji": "ğŸ“œ",
        "min_level": 5,
        "description": "GuardiÃ£o do conhecimento. Registra histÃ³rias, armazena livros, coleta pergaminhos e decifra textos antigos.",
        "salary_coins": (20, 50),
        "salary_xp": (200, 440),
        "perks": [
            "Descobre locais no mapa 2x mais rÃ¡pido ao explorar",
            "Pode escrever `crÃ´nica` para ganhar XP bÃ´nus registrando aventuras",
            "Acesso a livros de lore exclusivos com `ler arquivo`",
            "Pode `mapear` Ã¡reas para revelar locais secretos",
            "Pode `coletar pergaminho` para encontrar pergaminhos especiais",
            "Pode `registrar npc [nome] [fala]` para registrar falas de NPCs",
            "Pode `armazenar livro [nome]` para guardar livros na biblioteca pessoal",
            "Pode `ver biblioteca` para ver livros e pergaminhos coletados",
        ],
        "work_action": "Sua pena raspa o pergaminho enquanto vocÃª registra histÃ³rias que outros esquecem.",
        "work_msgs": [
            "ğŸ“œ VocÃª traduz um mapa antigo e revela uma rota perdida hÃ¡ sÃ©culos.",
            "âœï¸ Um herÃ³i lendÃ¡rio te pede para escrever sua biografia. Honra inesperada.",
            "ğŸ—ºï¸ VocÃª completa o mapa de uma regiÃ£o inteira em uma semana. PerfeiÃ§Ã£o.",
            "ğŸ“– Seu arquivo sobre criaturas mÃ¡gicas se torna referÃªncia para todo o reino.",
            "ğŸ” VocÃª encontra uma inconsistÃªncia em crÃ´nicas antigas. A histÃ³ria foi alterada.",
            "ğŸ“š Um sÃ¡bio te confia sua coleÃ§Ã£o de livros raros para catalogar. Tesouros do conhecimento!",
            "ğŸ–Šï¸ VocÃª registra a fala de um anciÃ£o Ã©lfico que guarda segredos milenares.",
        ],
        "levels": {
            1: {"name": "Escriba Iniciante",  "bonus": "Armazena atÃ© 10 livros, coleta 1 pergaminho/dia", "max_books": 10, "scrolls_per_day": 1, "salary_mult": 1.0},
            2: {"name": "Escriba Erudito",    "bonus": "Armazena atÃ© 30 livros, coleta 3 pergaminhos/dia, registra falas de NPCs", "max_books": 30, "scrolls_per_day": 3, "salary_mult": 1.5, "req_work": 20},
            3: {"name": "Arquivista Supremo", "bonus": "Armazena livros ilimitados, coleta 5 pergaminhos/dia, acesso a textos proibidos", "max_books": 999, "scrolls_per_day": 5, "salary_mult": 2.5, "req_work": 50},
        }
    },
    "Cavaleiro": {
        "emoji": "âš”ï¸",
        "min_level": 10,
        "description": "Protetor jurado das cidades e do povo. Defende contra invasÃµes, patrulha e mantÃ©m a ordem.",
        "salary_coins": (50, 110),
        "salary_xp": (120, 280),
        "perks": [
            "+20 HP mÃ¡ximos permanentes",
            "Pode usar `patrulhar` para ganhar XP e defender a cidade",
            "Pode convocar atÃ© 2 jogadores em defesa com `convocar cavaleiros`",
            "ResistÃªncia a dano aumentada em 15% durante batalhas",
        ],
        "work_action": "VocÃª patrulha as ruas de armadura brilhante, a mÃ£o na espada, os olhos vigilantes.",
        "work_msgs": [
            "âš”ï¸ VocÃª intercepta ladrÃµes no mercado. Eles fogem ao ver sua armadura.",
            "ğŸ›¡ï¸ Uma crianÃ§a perdida chora no beco escuro. VocÃª a leva em seguranÃ§a para casa.",
            "ğŸ—¡ï¸ Um bÃªbado comeÃ§a uma briga na taverna. VocÃª a encerra com uma palavra firme.",
            "ğŸ° VocÃª escolta uma caravana real por 3 dias. Sem incidentes. Exatamente como deve ser.",
            "âš¡ Um bandido saca a espada. VocÃª a desarma em um movimento. Sem derramamento de sangue.",
        ],
        "levels": {
            1: {"name": "Cavaleiro",          "bonus": "+20 HP mÃ¡ximos", "hp_bonus": 20, "salary_mult": 1.0},
            2: {"name": "Cavaleiro Veterano", "bonus": "+50 HP, +15 DEF, invocaÃ§Ã£o de cavaleiros aprimorada", "hp_bonus": 50, "def_bonus": 15, "salary_mult": 1.5, "req_work": 20},
            3: {"name": "Cavaleiro LendÃ¡rio", "bonus": "+100 HP, +30 DEF, imune a efeitos de medo", "hp_bonus": 100, "def_bonus": 30, "salary_mult": 2.5, "req_work": 50},
        },
        "city_defense_cooldown": 3600  # 1 hora
    },
    "Guarda_Real": {
        "emoji": "ğŸ›¡ï¸",
        "min_level": 15,
        "description": "Elite da proteÃ§Ã£o real. Defende o reino com forÃ§a e lealdade absolutas.",
        "salary_coins": (75, 150),
        "salary_xp": (160, 360),
        "perks": [
            "+35 HP mÃ¡ximos permanentes",
            "Pode usar `defender reino` em invasÃµes de monstros",
            "Acesso a equipamentos da guarda real na loja",
            "Pode recrutar jogadores para a guarda com `recrutar guarda`",
        ],
        "work_action": "VocÃª fica em posiÃ§Ã£o de guarda nas portas do palÃ¡cio, imÃ³vel como uma estÃ¡tua de aÃ§o.",
        "work_msgs": [
            "ğŸ›¡ï¸ Uma espiÃ£ tenta se infiltrar. Seu instinto a detecta antes de qualquer dano.",
            "ğŸ‘‘ O rei te agradece pessoalmente por salvar sua filha de um sequestro.",
            "âš”ï¸ VocÃª treina recrutas por uma semana. Um deles tem talento genuÃ­no.",
            "ğŸ° Um ataque surpresa na madrugada Ã© repelido sob seu comando.",
            "ğŸ—¡ï¸ VocÃª desarma um assassino dentro do salÃ£o do trono. Silenciosamente.",
        ],
        "levels": {
            1: {"name": "Guarda Real",         "bonus": "+35 HP mÃ¡ximos", "hp_bonus": 35, "salary_mult": 1.0},
            2: {"name": "Guarda de Elite",     "bonus": "+70 HP, +20 ATK, acesso a arsenal real", "hp_bonus": 70, "atk_bonus": 20, "salary_mult": 1.5, "req_work": 20},
            3: {"name": "Comandante da Guarda","bonus": "+120 HP, +40 ATK, pode declarar alerta de guerra", "hp_bonus": 120, "atk_bonus": 40, "salary_mult": 2.5, "req_work": 50},
        }
    },
    "Rei": {
        "emoji": "ğŸ‘‘",
        "min_level": 30,
        "description": "Soberano de uma cidade. Governa, toma decisÃµes que afetam o povo e defende o reino.",
        "salary_coins": (0, 0),
        "salary_xp": (0, 0),
        "perks": [
            "Recebe tributo diÃ¡rio de coins baseado no nÃ­vel da cidade",
            "Pode `governar` para tomar decisÃµes que afetam eventos futuros",
            "Pode `decretar lei` com efeitos especiais no servidor",
            "Pode `convocar guerra` para batalhas massivas com outros jogadores",
            "Pode `nomear cavaleiro @user` para promover jogadores",
            "Recebe alertas de invasÃ£o antes de outros jogadores",
        ],
        "work_action": "VocÃª assina decretos, ouve petiÃ§Ãµes e toma decisÃµes que afetam milhares de vidas.",
        "work_msgs": [
            "ğŸ‘‘ VocÃª media uma disputa de terras entre dois nobres. DecisÃ£o salomÃ´nica.",
            "âš–ï¸ Uma petiÃ§Ã£o popular chega: o povo quer menos impostos. VocÃª considera.",
            "ğŸ° Um embaixador de outro reino chega. Diplomacia delicada se inicia.",
            "ğŸ“œ VocÃª assina um tratado de paz com os elfos. TrÃ©gua de 50 anos.",
            "ğŸ‘¥ O povo celebra nas ruas ao ouvir sua decisÃ£o de perdoar uma dÃ­vida coletiva.",
        ],
        "levels": {
            1: {"name": "Rei",          "bonus": "Tributo diÃ¡rio bÃ¡sico", "salary_mult": 1.0},
            2: {"name": "Rei Poderoso", "bonus": "Tributo dobrado, +2 decretos/dia", "salary_mult": 2.0, "req_work": 30},
            3: {"name": "Imperador",    "bonus": "Tributo x5, controle de mÃºltiplos reinos", "salary_mult": 5.0, "req_work": 70},
        }
    }
}

# ================= WEAPON DATABASE (para inspecionar arma) =================
WEAPON_DATABASE = {
    # Comuns
    "Espada Enferrujada":   {"type": "Espada", "rarity": "Comum",   "atk": 5,  "crit": 5,  "speed": 8,  "element": None,     "skill": "Golpe BÃ¡sico",      "skill_desc": "Ataque simples. +0% dano.", "lore": "Uma espada velha, cheia de ferrugem. Mas ainda corta."},
    "Faca de Goblin":       {"type": "Adaga",  "rarity": "Comum",   "atk": 4,  "crit": 8,  "speed": 12, "element": None,     "skill": "Perfurar",          "skill_desc": "Ataque rÃ¡pido. +10% chance de sangramento.", "lore": "Roubada de um goblin. Tem uma mancha que nÃ£o sai."},
    "Osso Afiado":          {"type": "Adaga",  "rarity": "Comum",   "atk": 3,  "crit": 6,  "speed": 10, "element": None,     "skill": "Perfurar",          "skill_desc": "Ataque rÃ¡pido.", "lore": "Improviso Ã³sseo. Funciona melhor do que deveria."},
    "Espada Pequena":       {"type": "Espada", "rarity": "Incomum", "atk": 8,  "crit": 7,  "speed": 10, "element": None,     "skill": "Golpe Duplo",       "skill_desc": "Dois ataques rÃ¡pidos. Cada um com 75% do dano base.", "lore": "Compacta e equilibrada. Favorita de viajantes espertos."},
    "Adaga de Pedra":       {"type": "Adaga",  "rarity": "Comum",   "atk": 4,  "crit": 7,  "speed": 11, "element": None,     "skill": "Perfurar",          "skill_desc": "Ataque rÃ¡pido bÃ¡sico.", "lore": "Talhada em pedra vulcÃ¢nica. Primitiva, mas eficaz."},
    # Incomuns
    "Espada de Ferro":      {"type": "Espada", "rarity": "Incomum", "atk": 12, "crit": 8,  "speed": 9,  "element": None,     "skill": "Golpe Cortante",    "skill_desc": "Ignora 10% da defesa inimiga.", "lore": "Forjada em ferro padrÃ£o. ConfiÃ¡vel e resistente."},
    "Cajado de Madeira Viva":{"type": "Cajado","rarity": "Incomum", "atk": 10, "crit": 6,  "speed": 7,  "element": "Natureza","skill": "Raiz Viva",        "skill_desc": "+20% dano contra inimigos imÃ³veis.", "lore": "A madeira ainda cresce. VocÃª pode sentir a seiva pulsando."},
    "Garras de EscorpiÃ£o":  {"type": "Garras", "rarity": "Incomum", "atk": 11, "crit": 12, "speed": 13, "element": "Veneno", "skill": "Veneno de EscorpiÃ£o","skill_desc": "15% chance de envenenar o inimigo por 3 turnos.", "lore": "Arrancar estas garras foi um erro do escorpiÃ£o."},
    # Raros
    "Adaga Venenosa":       {"type": "Adaga",  "rarity": "Raro",    "atk": 18, "crit": 15, "speed": 14, "element": "Veneno", "skill": "InoculaÃ§Ã£o Fatal",  "skill_desc": "25% chance de veneno devastador: -5% HP/turno.", "lore": "Destilada com o veneno de 100 aranhas da floresta negra."},
    "Arco Ã‰lfico":          {"type": "Arco",   "rarity": "Raro",    "atk": 20, "crit": 18, "speed": 15, "element": "Arcano", "skill": "Flecha Certeira",   "skill_desc": "+40% dano crÃ­tico. Nunca erra se concentrado.", "lore": "Encantado por elfos hÃ¡ sÃ©culos. Vibra ao mirar em inimigos."},
    "Cetro Antigo":         {"type": "Cetro",  "rarity": "Raro",    "atk": 22, "crit": 10, "speed": 6,  "element": "Arcano", "skill": "Pulso Arcano",      "skill_desc": "Dano mÃ¡gico que ignora 25% da DEF.", "lore": "Recuperado de uma tumba. Palavras inscritas nele pulsam Ã  noite."},
    "Machado de Gelo":      {"type": "Machado","rarity": "Raro",    "atk": 25, "crit": 9,  "speed": 6,  "element": "Gelo",   "skill": "Tempestade GÃ©lida", "skill_desc": "20% chance de congelar inimigo por 1 turno (perde aÃ§Ã£o).", "lore": "Forjado no coraÃ§Ã£o de uma avalanche. EstÃ¡ sempre frio ao toque."},
    "LanÃ§a do CaÃ§ador":     {"type": "LanÃ§a",  "rarity": "Raro",    "atk": 23, "crit": 11, "speed": 10, "element": None,     "skill": "Arremesso Preciso", "skill_desc": "Pode atacar Ã  distÃ¢ncia. +15% dano a distÃ¢ncia.", "lore": "Usada por caÃ§adores ancestrais. Ainda tem marcas de antigas presas."},
    "Foice Maldita":        {"type": "Foice",  "rarity": "Raro",    "atk": 21, "crit": 14, "speed": 9,  "element": "Sombra", "skill": "Ceifar Almas",      "skill_desc": "Drena 5% HP do inimigo por acerto.", "lore": "Ela nÃ£o foi forjada. Surgiu de um pacto que Ã© melhor nÃ£o repetir."},
    "Garras da Lua":        {"type": "Garras", "rarity": "Raro",    "atk": 20, "crit": 16, "speed": 14, "element": "Luz",    "skill": "FÃºria Lunar",       "skill_desc": "+30% ATK durante a noite no mundo.", "lore": "Criadas sob a lua cheia por lobisomens ancestrais."},
    "Katana RelÃ¢mpago":     {"type": "Katana", "rarity": "Raro",    "atk": 24, "crit": 17, "speed": 16, "element": "TrovÃ£o", "skill": "Corte RelÃ¢mpago",   "skill_desc": "Ataque extremamente rÃ¡pido, age antes do inimigo.", "lore": "Forjada com metal de um raio. Corta o ar com som de trovÃ£o."},
    "Machado RÃºnico":       {"type": "Machado","rarity": "Raro",    "atk": 26, "crit": 10, "speed": 7,  "element": "Arcano", "skill": "Runas de Poder",    "skill_desc": "+35% dano quando HP > 80%.", "lore": "Runas antigas gravadas por mÃ£os anÃ£s. Cada sÃ­mbolo tem um significado perdido."},
    # Ã‰picos
    "LÃ¢mina Flamejante":    {"type": "Espada", "rarity": "Ã‰pico",   "atk": 38, "crit": 14, "speed": 11, "element": "Fogo",   "skill": "ExplosÃ£o Flamejante","skill_desc": "Ataque de fogo: +50% dano, queima por 2 turnos.", "lore": "Forjada no nÃºcleo de um vulcÃ£o ativo. Nunca esfria completamente."},
    "Espada DemonÃ­aca":     {"type": "Espada", "rarity": "Ã‰pico",   "atk": 42, "crit": 16, "speed": 10, "element": "Trevas", "skill": "MaldiÃ§Ã£o Infernal",  "skill_desc": "Reduz regeneraÃ§Ã£o do inimigo em 50% por 3 turnos.", "lore": "Temperada no sangue de um demÃ´nio maior. Sussurra promessas ao portador."},
    "Katana DemonÃ­aca":     {"type": "Katana", "rarity": "Ã‰pico",   "atk": 40, "crit": 20, "speed": 14, "element": "Trevas", "skill": "DanÃ§a das Sombras",  "skill_desc": "3 ataques rÃ¡pidos, o Ãºltimo ignora toda a DEF.", "lore": "Uma katana que trocou de mÃ£o sete vezes â€” todos os donos morreram em batalha."},
    "Cajado Arcano":        {"type": "Cajado", "rarity": "Ã‰pico",   "atk": 35, "crit": 12, "speed": 8,  "element": "Arcano", "skill": "FeitiÃ§o Supremo",    "skill_desc": "+70% dano mÃ¡gico. Consome 30 de mana.", "lore": "CondensaÃ§Ã£o de anos de estudo arcano. Emite luz prÃ³pria."},
}

# Habilidades por tipo de arma
WEAPON_TYPE_SKILLS = {
    "Espada":  ["Golpe Cortante", "Redemoinho", "Parade e Riposte"],
    "Adaga":   ["Perfurar", "Ataque Furtivo", "Envenenar LÃ¢mina"],
    "Cajado":  ["Pulso Arcano", "Barreira MÃ¡gica", "CanalizaÃ§Ã£o"],
    "Arco":    ["Flecha Certeira", "Chuva de Flechas", "Flecha Perfurante"],
    "Machado": ["Golpe Devastador", "FÃºria BÃ¡rbara", "Corte em Arco"],
    "LanÃ§a":   ["Arremesso Preciso", "Investida", "Barreira de LanÃ§as"],
    "Katana":  ["Corte Veloz", "Iaijutsu", "Corte do Vento"],
    "Foice":   ["Ceifar", "Girar Foice", "Colheita das Almas"],
    "Garras":  ["Rasgar", "Ataque FrenÃ©tico", "Veneno das Garras"],
    "Cetro":   ["Pulso de Poder", "MaldiÃ§Ã£o", "InvocaÃ§Ã£o Menor"],
    "Martelo": ["Golpe Esmagador", "Terremoto", "Fortalecer"],
}

# ================= EVENTOS DE INVASÃƒO DE CIDADE =================
CITY_INVASION_EVENTS = {
    1: [
        {
            "id": "inv_campos_001",
            "title": "ğŸ— Horda de Javalis Raivosos",
            "description": "Uma horda de javalis gigantes avanÃ§a pela estrada principal! O mercado estÃ¡ sendo destruÃ­do!",
            "enemy": "Javali Enraivecido",
            "enemy_count": 8,
            "hp": 180,
            "atk": 18,
            "xp_reward": 800,
            "coins_reward": 40,
            "min_defenders": 1,
            "dialogue_options": [
                {"text": "ğŸŒ¾ Espalhar feno para distrair os javalis para longe", "success_chance": 0.65, "align": +5},
                {"text": "âš”ï¸ Atacar a lideranÃ§a da horda diretamente", "success_chance": 0.55, "align": +3},
                {"text": "ğŸ“¯ Tocar o alarme e evacuar os moradores", "success_chance": 0.80, "align": +8},
            ]
        },
        {
            "id": "inv_campos_002",
            "title": "ğŸ€ Praga de Ratos MÃ¡gicos",
            "description": "Ratos do tamanho de gatos estÃ£o invadindo os celeiros! As reservas de comida do inverno estÃ£o em risco!",
            "enemy": "Rato MÃ¡gico Gigante",
            "enemy_count": 15,
            "hp": 80,
            "atk": 10,
            "xp_reward": 600,
            "coins_reward": 30,
            "min_defenders": 1,
            "dialogue_options": [
                {"text": "ğŸ§€ Preparar iscas envenenadas nos celeiros", "success_chance": 0.75, "align": +3},
                {"text": "ğŸ”¥ Acender tochas para afugentar a praga", "success_chance": 0.60, "align": +5},
                {"text": "ğŸ± Recrutar gatos mÃ¡gicos da floresta", "success_chance": 0.85, "align": +7},
            ]
        },
    ],
    10: [
        {
            "id": "inv_floresta_001",
            "title": "ğŸ‘º Ataque Goblin Organizado",
            "description": "Uma tribo de goblins com tÃ¡ticas militares invade a aldeia florestal! Eles tÃªm catapultas improvisadas!",
            "enemy": "Guerreiro Goblin",
            "enemy_count": 12,
            "hp": 350,
            "atk": 28,
            "xp_reward": 1800,
            "coins_reward": 80,
            "min_defenders": 2,
            "dialogue_options": [
                {"text": "ğŸ¤ Tentar negociar â€” por que os goblins atacam?", "success_chance": 0.45, "align": +12},
                {"text": "ğŸ¹ Emboscada nas Ã¡rvores antes que avancem", "success_chance": 0.65, "align": +4},
                {"text": "ğŸ”¥ Destruir as catapultas primeiro", "success_chance": 0.70, "align": +2},
                {"text": "ğŸ’€ Ataque total sem misericÃ³rdia", "success_chance": 0.80, "align": -5},
            ]
        },
        {
            "id": "inv_floresta_002",
            "title": "ğŸ•·ï¸ Ninho de Aranhas Colossais",
            "description": "Um ninho de aranhas colossais foi perturbado e as criaturas invadem o acampamento!",
            "enemy": "Aranha Colossal",
            "enemy_count": 6,
            "hp": 500,
            "atk": 35,
            "xp_reward": 2000,
            "coins_reward": 90,
            "min_defenders": 2,
            "dialogue_options": [
                {"text": "ğŸ”¥ Fogo destrÃ³i a teia e afasta as aranhas", "success_chance": 0.75, "align": +3},
                {"text": "ğŸ§ª Usar antÃ­doto para atrair as aranhas para longe", "success_chance": 0.60, "align": +6},
                {"text": "âš”ï¸ Combate direto com as criaturas", "success_chance": 0.55, "align": +2},
            ]
        },
    ],
    20: [
        {
            "id": "inv_deserto_001",
            "title": "ğŸ’€ ExÃ©rcito de Mumificados",
            "description": "O selo de Kha-Mentu foi quebrado! Um exÃ©rcito de guerreiros mumificados marcha pelo deserto em direÃ§Ã£o ao OÃ¡sis!",
            "enemy": "Guerreiro Mumificado",
            "enemy_count": 20,
            "hp": 600,
            "atk": 42,
            "xp_reward": 3500,
            "coins_reward": 120,
            "min_defenders": 2,
            "dialogue_options": [
                {"text": "ğŸ“œ Recitar a prece de descanso dos mortos", "success_chance": 0.55, "align": +10},
                {"text": "ğŸº Quebrar o artefato que os controla", "success_chance": 0.65, "align": +5},
                {"text": "âš”ï¸ Confronto direto â€” sÃ£o mortos, sem negociaÃ§Ã£o", "success_chance": 0.70, "align": 0},
                {"text": "ğŸšª Evacuar o oÃ¡sis e deixÃ¡-los ir", "success_chance": 0.90, "align": +3},
            ]
        },
    ],
    30: [
        {
            "id": "inv_gelo_001",
            "title": "ğŸ¦£ Ataque dos Yetis Furiosos",
            "description": "Uma tempestade de neve trouxe Yetis famintos atÃ© a Fortaleza Permafrost! Eles arranham as portas!",
            "enemy": "Yeti Furioso",
            "enemy_count": 5,
            "hp": 900,
            "atk": 60,
            "xp_reward": 4500,
            "coins_reward": 150,
            "min_defenders": 2,
            "dialogue_options": [
                {"text": "ğŸ¥© Jogar comida para alÃ©m dos muros para atraÃ­-los", "success_chance": 0.70, "align": +8},
                {"text": "ğŸ”¥ Acender fogueiras nas paredes para afastÃ¡-los", "success_chance": 0.65, "align": +3},
                {"text": "âš”ï¸ Sair e enfrentar os Yetis um a um", "success_chance": 0.50, "align": +5},
                {"text": "â„ï¸ Usar magia para criar uma barreira de gelo maior", "success_chance": 0.75, "align": +4},
            ]
        },
    ],
    40: [
        {
            "id": "inv_vulcao_001",
            "title": "ğŸ² DragÃµes de Lava Jovens",
            "description": "A erupÃ§Ã£o acordou ninhadas de dragÃµes de lava! TrÃªs criaturas atacam a Cidadela Cinzenta!",
            "enemy": "DragÃ£o de Lava Jovem",
            "enemy_count": 3,
            "hp": 1500,
            "atk": 90,
            "xp_reward": 7000,
            "coins_reward": 200,
            "min_defenders": 3,
            "dialogue_options": [
                {"text": "ğŸ§Š Usar magia de gelo para acalmar as criaturas", "success_chance": 0.50, "align": +12},
                {"text": "ğŸ¥š Encontrar e proteger os ovos para negociar", "success_chance": 0.60, "align": +10},
                {"text": "âš”ï¸ Batalha total â€” dragÃµes ou cidadela", "success_chance": 0.65, "align": -2},
                {"text": "ğŸ’ Oferecer gemas como pagamento para recuo", "success_chance": 0.45, "align": +5},
            ]
        },
    ],
    50: [
        {
            "id": "inv_abismo_001",
            "title": "ğŸ‘ï¸ InvasÃ£o de Entidades do Vazio",
            "description": "Uma fenda no Abismo Arcano se abre! Entidades insanas emergem com fome de realidade!",
            "enemy": "Entidade do Vazio",
            "enemy_count": 4,
            "hp": 2000,
            "atk": 120,
            "xp_reward": 10000,
            "coins_reward": 300,
            "min_defenders": 3,
            "dialogue_options": [
                {"text": "ğŸ”® Ritual de fechamento da fenda (arriscado)", "success_chance": 0.45, "align": +15},
                {"text": "ğŸ“š Usar conhecimento arcano para comunicar com elas", "success_chance": 0.35, "align": +10},
                {"text": "âš”ï¸ Combate dimensional com tudo que tem", "success_chance": 0.60, "align": 0},
                {"text": "ğŸ’¥ Explodir a fenda com magia destrutiva", "success_chance": 0.70, "align": -5},
            ]
        },
    ],
    60: [
        {
            "id": "inv_celestial_001",
            "title": "ğŸ˜ˆ Queda de Anjos Corrompidos",
            "description": "Anjos caÃ­dos atacam o Trono Celestial! Seres de luz corrompida descem em chamas!",
            "enemy": "Anjo CaÃ­do",
            "enemy_count": 5,
            "hp": 3000,
            "atk": 160,
            "xp_reward": 20000,
            "coins_reward": 500,
            "min_defenders": 3,
            "dialogue_options": [
                {"text": "âœ¨ Tentar purificar a corrupÃ§Ã£o com luz celestial", "success_chance": 0.40, "align": +20},
                {"text": "ğŸ•Šï¸ Preces de redenÃ§Ã£o para os seres caÃ­dos", "success_chance": 0.35, "align": +15},
                {"text": "âš”ï¸ Batalha Ã©pica â€” eles escolheram a queda", "success_chance": 0.65, "align": +3},
                {"text": "ğŸŒŒ Usar o poder do Trono para bani-los de volta", "success_chance": 0.55, "align": +8},
            ]
        },
    ]
}

# ================= BOSSES VARIADOS POR REINO =================
WORLD_BOSSES_VARIANTS = {
    1: [
        {"name": "ğŸ‘‘ Slime Rei Corrompido", "hp": 200, "atk": 18, "xp": 350, "coins": (20, 45),
         "desc": "O Slime Rei foi infectado por magia negra. Seu corpo negro borbulha com veneno arcano.",
         "intro": "Uma massa negra e pulsante bloqueia seu caminho. Olhos vermelhos piscam do interior do lodo."},
        {"name": "ğŸ€ Rato dos Esgotos Ancestral", "hp": 170, "atk": 22, "xp": 300, "coins": (15, 35),
         "desc": "Um rato que viveu nos esgotos por 500 anos. Carrega doenÃ§as de cinco civilizaÃ§Ãµes.",
         "intro": "Um rato do tamanho de um cavalo emerge das profundezas. Sua pele estÃ¡ coberta de runas."},
        {"name": "ğŸŒªï¸ EspÃ­rito do Campo", "hp": 250, "atk": 15, "xp": 400, "coins": (25, 50),
         "desc": "O espÃ­rito protetor dos campos foi corrompido. Antes guardava a terra. Agora a devora.",
         "intro": "O vento para subitamente. Uma forma etÃ©rea verde e dourada materializa com olhos vazios."},
        {"name": "ğŸŒ± Ent Jovem Enraivecido", "hp": 300, "atk": 12, "xp": 380, "coins": (18, 40),
         "desc": "Um ent jovem cujas raÃ­zes foram contaminadas por poluiÃ§Ã£o arcana. Ele sofre e ataca.",
         "intro": "Um conjunto de Ã¡rvores se levanta e toma forma humanoide colossal. Ele geme ao se mover."},
    ],
    10: [
        {"name": "ğŸŒ² Ent AnciÃ£o das Profundezas", "hp": 450, "atk": 30, "xp": 600, "coins": (30, 70),
         "desc": "O mais antigo dos ents. Viu o mundo nascer e quer ver morrer.",
         "intro": "A floresta inteira treme. Um ent de 400 anos se ergue, sua face entalhada em sofrimento."},
        {"name": "ğŸ•·ï¸ MÃ£e das Aranhas", "hp": 380, "atk": 35, "xp": 550, "coins": (25, 60),
         "desc": "A aranha original. Todas as aranhas desta floresta desceram dela.",
         "intro": "Oito olhos vermelhos brilham na escuridÃ£o. Uma aranha colossal desce do teto da caverna."},
        {"name": "ğŸ‘º Rei Goblin Estrategista", "hp": 400, "atk": 28, "xp": 580, "coins": (28, 65),
         "desc": "NÃ£o Ã© apenas bruto â€” ele Ã© inteligente. E isso o torna o goblin mais perigoso jÃ¡ visto.",
         "intro": "Um goblin de armadura Ã©lfica roubada senta num trono de ossos. Ele te olha com interesse."},
        {"name": "ğŸŒ«ï¸ Espectro do HerÃ³i CaÃ­do", "hp": 350, "atk": 40, "xp": 620, "coins": (20, 55),
         "desc": "Um herÃ³i que morreu sem completar sua missÃ£o. Preso entre vivos e mortos pela raiva.",
         "intro": "Uma figura translÃºcida em armadura enferrujada empunha uma espada de luz mortiÃ§a."},
    ],
    20: [
        {"name": "ğŸ”º FaraÃ³ Kha-Mentu Ressurgido", "hp": 600, "atk": 45, "xp": 900, "coins": (40, 90),
         "desc": "O faraÃ³ da primeira civilizaÃ§Ã£o. Morreu traÃ­do por seus sacerdotes. Voltou com sede de vinganÃ§a.",
         "intro": "A pirÃ¢mide treme. Bandagens douradas flutuam pelo ar. O faraÃ³ abre os olhos dourados."},
        {"name": "ğŸ¦‚ Grande EscorpiÃ£o do Deserto", "hp": 550, "atk": 50, "xp": 850, "coins": (35, 80),
         "desc": "EscorpiÃ£o com veneno capaz de matar um elefante. Protege ruÃ­nas por sÃ©culos.",
         "intro": "As dunas explodem. Um escorpiÃ£o colossal surge do subsolo, pinÃ§as do tamanho de Ã¡rvores."},
        {"name": "ğŸŒªï¸ Djinn do Vento de Areia", "hp": 500, "atk": 55, "xp": 880, "coins": (30, 75),
         "desc": "GÃªnio aprisionado hÃ¡ milÃªnios. A raiva do cativeiro o transformou em algo incontrolÃ¡vel.",
         "intro": "Uma tempestade de areia para e toma forma humana. Olhos como tempestades te encarram."},
        {"name": "ğŸº Golem da Argila Sagrada", "hp": 700, "atk": 38, "xp": 920, "coins": (45, 95),
         "desc": "Criado para proteger o templo. Agora que o templo caiu, ele nÃ£o sabe o que proteger.",
         "intro": "Uma estÃ¡tua de argila de 5 metros pisca. Runas sagradas brilham em seu peito. Ele avanÃ§a."},
    ],
    30: [
        {"name": "â„ï¸ TitÃ£ do Gelo Eterno", "hp": 800, "atk": 60, "xp": 1200, "coins": (50, 110),
         "desc": "Um titÃ£ de gelo que dormia no coraÃ§Ã£o da montanha. Despertou com a invasÃ£o de aventureiros.",
         "intro": "Uma avalanche para no ar. Blocos de gelo se reorganizam numa forma colossal de 10 metros."},
        {"name": "ğŸ‰ DragÃ£o de Cristal", "hp": 750, "atk": 70, "xp": 1300, "coins": (55, 120),
         "desc": "Um dragÃ£o cujas escamas viraram cristal por uma maldiÃ§Ã£o. Belo e letal.",
         "intro": "Luz se refrata por toda a caverna. Um dragÃ£o translÃºcido de cristal azul te olha com curiosidade."},
        {"name": "ğŸ¦£ Rei dos Yetis", "hp": 900, "atk": 55, "xp": 1100, "coins": (45, 100),
         "desc": "O patriarca de toda a tribo Yeti. TÃ£o antigo que sua pelagem virou neve permanente.",
         "intro": "A temperatura cai 20 graus de repente. O maior ser que vocÃª jÃ¡ viu emerge da nevasca."},
        {"name": "ğŸŒŠ Elemental de Gelo Primordial", "hp": 680, "atk": 75, "xp": 1350, "coins": (60, 130),
         "desc": "Um elemental que existia antes de qualquer montanha ser formada. Ele Ã© a prÃ³pria neve.",
         "intro": "Flocos de neve flutuam em padrÃ£o impossÃ­vel. Eles se fundem numa entidade translÃºcida e feroz."},
    ],
    40: [
        {"name": "ğŸŒ‹ Ignarius, DragÃ£o de Magma AnciÃ£o", "hp": 1100, "atk": 85, "xp": 1800, "coins": (70, 150),
         "desc": "O primeiro ser criado quando o mundo era fogo. Guarda a Chama Original com ciÃºme eterno.",
         "intro": "O vulcÃ£o erupciona de dentro pra fora. Magma toma forma. Ignarius abre os olhos de brasa."},
        {"name": "âš’ï¸ Golem da Forja Corrompida", "hp": 950, "atk": 95, "xp": 1700, "coins": (65, 140),
         "desc": "A Forja Sagrada criou este golem para se defender. Mas a forja ficou louca.",
         "intro": "Ferramentas flutuam em espiral. O metal derretido toma forma de um guerreiro monstruoso."},
        {"name": "ğŸ’€ EspÃ­rito do Forjador TraÃ­do", "hp": 880, "atk": 100, "xp": 1900, "coins": (75, 160),
         "desc": "Um forjador anÃ£o que foi assassinado pela coroa. Sua raiva o manteve vivo em forma etÃ©rea.",
         "intro": "O ar cheira a metal e ranÃ§o. Uma figura translÃºcida com martelo de fogo surge do nada."},
        {"name": "ğŸ”¥ Salamandra Primordial", "hp": 1000, "atk": 90, "xp": 1750, "coins": (68, 145),
         "desc": "A salamandra que nasceu do primeiro fogo do universo. Criatura mais antiga do Reino.",
         "intro": "O chÃ£o de lava explode. Uma salamandra do tamanho de uma casa emerge, cantando em chamas."},
    ],
    50: [
        {"name": "ğŸŒ€ O Senhor das Sombras", "hp": 1500, "atk": 120, "xp": 2800, "coins": (90, 200),
         "desc": "Entidade que existia antes do universo. Quer apagar a realidade e retornar ao silÃªncio primordial.",
         "intro": "A luz some. NÃ£o hÃ¡ escuridÃ£o â€” hÃ¡ ausÃªncia de tudo. EntÃ£o ele fala: 'VocÃª tambÃ©m cansou de existir?'"},
        {"name": "ğŸ‘ï¸ Olho do Abismo", "hp": 1200, "atk": 140, "xp": 3000, "coins": (100, 220),
         "desc": "Um olho do tamanho de uma casa que observa desde o inÃ­cio dos tempos. Enlouquece quem o encontra.",
         "intro": "Uma pupila vertical de 3 metros se abre no teto do Abismo. VocÃª sente ser estudado atÃ© o DNA."},
        {"name": "ğŸŒŒ Arquimago Zephyr Corrompido", "hp": 1350, "atk": 110, "xp": 2600, "coins": (85, 190),
         "desc": "O maior mago do mundo se corrompeu estudando o Abismo. Agora Ã© parte dele.",
         "intro": "Uma silhueta familiar usa magias impossÃ­veis. VocÃª reconhece o rosto: Zephyr, com olhos vazios."},
        {"name": "â™¾ï¸ Loop Temporal", "hp": 1100, "atk": 130, "xp": 2900, "coins": (95, 210),
         "desc": "Uma entidade que Ã© o prÃ³prio tempo se loopando. Cada vez que vocÃª ataca, ela volta um segundo.",
         "intro": "VocÃª sente dÃ©jÃ  vu. E de novo. E de novo. Uma entidade surge com mÃºltiplas versÃµes de si mesma."},
    ],
    60: [
        {"name": "ğŸ‘‘ Imperador Astral", "hp": 2500, "atk": 180, "xp": 5000, "coins": (150, 350),
         "desc": "O governante do Trono Celestial. NÃ£o Ã© mau â€” Ã© o teste final. Aqueles dignos passarÃ£o.",
         "intro": "O Trono brilha com luz insuportÃ¡vel. Uma figura de luz pura desce. 'VocÃª chegou. Curioso.'"},
        {"name": "ğŸ˜ˆ Querubim Corrompido Makhael", "hp": 2000, "atk": 200, "xp": 5500, "coins": (160, 370),
         "desc": "O anjo mais belo que existiu, corrompido pela inveja. Sua queda criou um buraco no cÃ©u.",
         "intro": "Asas negras preenchem o horizonte. Um ser de beleza aterrorizante pousa, com espada de trevas."},
        {"name": "ğŸŒŒ VÃ¡cuo da CriaÃ§Ã£o", "hp": 3000, "atk": 150, "xp": 4500, "coins": (140, 320),
         "desc": "O espaÃ§o vazio onde a criaÃ§Ã£o comeÃ§a e termina. Ã‰ o nada que deseja ser algo.",
         "intro": "O Trono implode em silÃªncio. No centro do vÃ¡cuo, algo toma forma â€” ou talvez seja o vazio mesmo."},
        {"name": "â­ O Primeiro HerÃ³i (Corrompido)", "hp": 2200, "atk": 190, "xp": 5200, "coins": (155, 360),
         "desc": "O primeiro aventureiro que passou por todos os reinos. Corrompido pelo poder do Trono.",
         "intro": "VocÃª reconhece os equipamentos: os mesmos de todas as lendas antigas. Mas os olhos sÃ£o do Vazio."},
    ]
}

# ================= SISTEMA DE ALINHAMENTO MORAL =================
ALIGNMENT_TITLES = {
    "Heroi":      {"emoji": "âœ¨", "color": 0xFFD700, "desc": "Protetor dos inocentes, luz nas trevas."},
    "Anti-Heroi": {"emoji": "âš–ï¸", "color": 0x888888, "desc": "Nem bom, nem mau. Apenas pragmÃ¡tico."},
    "Vilao":      {"emoji": "ğŸ’€", "color": 0xFF0000, "desc": "O medo Ã© sua arma. O poder Ã© seu deus."},
    "Neutro":     {"emoji": "ğŸŒ‘", "color": 0x444444, "desc": "Ainda sem definiÃ§Ã£o. O destino aguarda."},
}

# Pontos: +10 = herÃ³i, -10 = vilÃ£o, zona neutra = anti-herÃ³i
ALIGNMENT_SCENARIOS = {
    1: [  # Campos
        {
            "id": "esc_campos_001",
            "emoji": "ğŸ˜ï¸",
            "title": "O AldeÃ£o Desesperado",
            "description": "Um aldeÃ£o idoso se ajoelha diante de vocÃª, com lÃ¡grimas nos olhos. Seus filhos foram capturados pelo Slime Rei. Ele oferece suas Ãºltimas 3 moedas em pagamento.",
            "choices": [
                {"text": "âœ¨ Aceitar a missÃ£o gratuitamente e ir resgatar os filhos",      "align": +10, "xp": 300, "coins": 0,   "result": "VocÃª salva os filhos sem pedir nada em troca. A aldeia inteira celebra seu nome."},
                {"text": "âš–ï¸ Aceitar as 3 moedas e completar a missÃ£o",                    "align": 0,   "xp": 200, "coins": 3,   "result": "Uma transaÃ§Ã£o justa. Os filhos sÃ£o salvos. O aldeÃ£o agradece com o que pÃ´de."},
                {"text": "ğŸ’€ Exigir todo o tesouro da aldeia para ajudar",                  "align": -10, "xp": 150, "coins": 15,  "result": "VocÃª extorque o aldeÃ£o. Os filhos sÃ£o salvos, mas vocÃª Ã© amaldiÃ§oado pelo sofrimento causado."},
                {"text": "ğŸƒ Ignorar o pedido e seguir em frente",                         "align": -5,  "xp": 0,   "coins": 0,   "result": "VocÃª passa direto. Os gritos do aldeÃ£o ecoam em sua mente por dias."},
            ]
        },
        {
            "id": "esc_campos_002",
            "emoji": "ğŸº",
            "title": "A Matilha Faminta",
            "description": "Uma matilha de lobos faminta bloqueia a estrada. Eles nÃ£o sÃ£o monstros â€” apenas animais com fome depois de uma seca prolongada. AldeÃµes assustados assistem de longe.",
            "choices": [
                {"text": "âœ¨ CaÃ§ar comida e alimentar os lobos para liberarem a estrada",   "align": +8,  "xp": 250, "coins": 0,   "result": "Os lobos comem e se dispersam. Os aldeÃµes nunca esquecerÃ£o o gesto."},
                {"text": "âš–ï¸ Assustar a matilha para longe sem ferir nenhum",               "align": +3,  "xp": 180, "coins": 0,   "result": "Com ruÃ­do e fogo, vocÃª afasta os lobos. Eficiente e sem sangue."},
                {"text": "ğŸ’€ Matar todos os lobos para garantir a estrada livre",            "align": -5,  "xp": 200, "coins": 5,   "result": "A estrada fica livre... e coberta de sangue. Os aldeÃµes ficam em silÃªncio."},
                {"text": "âš–ï¸ Cobrar dos aldeÃµes para abrir a passagem",                     "align": -2,  "xp": 100, "coins": 8,   "result": "NegÃ³cio Ã© negÃ³cio. VocÃª dispersa os lobos, os aldeÃµes pagam contrariados."},
            ]
        },
        {
            "id": "esc_campos_003",
            "emoji": "ğŸ’°",
            "title": "O Tesouro do LadrÃ£o",
            "description": "VocÃª encontra um ladrÃ£o inconsciente apÃ³s uma queda. Ao seu lado, uma bolsa com moedas roubadas de aldeÃµes. Uma nota diz para quem pertence cada moeda.",
            "choices": [
                {"text": "âœ¨ Devolver cada moeda ao dono certo usando a lista",              "align": +12, "xp": 200, "coins": 0,   "result": "Cada aldeÃ£o recebe de volta o que era seu. Sua honra cresce."},
                {"text": "âš–ï¸ Guardar metade e devolver metade anonimamente",                "align": -2,  "xp": 100, "coins": 12,  "result": "Alguns aldeÃµes recebem de volta algo. VocÃª fica com o resto."},
                {"text": "ğŸ’€ Ficar com tudo â€” o ladrÃ£o nÃ£o merecia mesmo",                   "align": -8,  "xp": 50,  "coins": 25,  "result": "VocÃª rouba do ladrÃ£o. O dinheiro Ã© seu agora, mas o karma nÃ£o esquece."},
                {"text": "ğŸ¥ Chamar um curandeiro para o ladrÃ£o e reportar Ã  guarda",       "align": +10, "xp": 180, "coins": 0,   "result": "JustiÃ§a Ã© feita. O ladrÃ£o recebe ajuda e responderÃ¡ pelo que fez."},
            ]
        },
        {
            "id": "esc_campos_004",
            "emoji": "ğŸ”¥",
            "title": "Celeiro em Chamas",
            "description": "Um celeiro pega fogo! Uma crianÃ§a estÃ¡ presa dentro. O dono tenta entrar mas Ã© segurado por outros. VocÃª pode agir.",
            "choices": [
                {"text": "âœ¨ Entrar correndo e salvar a crianÃ§a (perde 30 HP)",              "align": +15, "xp": 400, "coins": 0,   "result": "VocÃª entra pelas chamas. A crianÃ§a estÃ¡ viva. VocÃª sai queimado, mas vivo. HerÃ³i."},
                {"text": "âš–ï¸ Organizar um balde de Ã¡gua com os aldeÃµes antes",              "align": +5,  "xp": 200, "coins": 0,   "result": "Trabalho em equipe. A crianÃ§a Ã© salva com risco menor para todos."},
                {"text": "ğŸ’€ Observar sem agir â€” nÃ£o Ã© problema seu",                       "align": -12, "xp": 0,   "coins": 0,   "result": "VocÃª assiste. A crianÃ§a sobrevive por sorte. Os aldeÃµes nunca te perdoarÃ£o."},
                {"text": "âš–ï¸ Entrar SE receberem uma boa recompensa primeiro",              "align": -6,  "xp": 200, "coins": 20,  "result": "VocÃª negocia enquanto a crianÃ§a grita. Ela sobrevive. A aldeia fica dividida sobre vocÃª."},
            ]
        },
    ],
    10: [  # Floresta
        {
            "id": "esc_floresta_001",
            "emoji": "ğŸŒ²",
            "title": "O Acampamento Goblin",
            "description": "VocÃª descobre um acampamento goblin. Mas ao se aproximar, vÃª que sÃ£o goblins jovens â€” praticamente crianÃ§as â€” aprendendo a sobreviver sem adultos. Eles ficam com medo de vocÃª.",
            "choices": [
                {"text": "âœ¨ Ensinar as crianÃ§as a pescar e coletar alimentos",               "align": +12, "xp": 350, "coins": 0,   "result": "Os jovens goblins aprendem. DÃ©cadas depois, eles serÃ£o pacifistas que lembram do herÃ³i."},
                {"text": "âš–ï¸ Ignorar e passar sem interagir",                               "align": 0,   "xp": 0,   "coins": 0,   "result": "VocÃª nÃ£o ajuda, mas tambÃ©m nÃ£o prejudica. Eles continuam sua vida."},
                {"text": "ğŸ’€ Atacar o acampamento para 'eliminar uma ameaÃ§a futura'",        "align": -15, "xp": 300, "coins": 8,   "result": "VocÃª ataca crianÃ§as indefesas. XP fÃ¡cil, mas uma mancha irreparÃ¡vel na alma."},
                {"text": "âš–ï¸ Roubar os alimentos deles discretamente",                      "align": -8,  "xp": 50,  "coins": 10,  "result": "VocÃª rouba de crianÃ§as. Elas ficam com fome. O karma lembra."},
            ]
        },
        {
            "id": "esc_floresta_002",
            "emoji": "ğŸ‘ï¸",
            "title": "A EspiÃ£ da Floresta",
            "description": "Uma elfa te intercepta. Ela Ã© uma espiÃ£ da resistÃªncia contra um tirano que governa um vilarejo prÃ³ximo. Ela pede sua ajuda para entregar uma mensagem secreta.",
            "choices": [
                {"text": "âœ¨ Ajudar a entrega da mensagem pro bem da resistÃªncia",           "align": +10, "xp": 400, "coins": 0,   "result": "A mensagem chega. A resistÃªncia se fortalece. VocÃª fez parte da histÃ³ria."},
                {"text": "ğŸ’€ Trair a espiÃ£ ao tirano em troca de ouro",                     "align": -15, "xp": 100, "coins": 30,  "result": "A espiÃ£ Ã© capturada. O tirano te paga. A resistÃªncia cai por ora."},
                {"text": "âš–ï¸ Pedir pagamento para a entrega",                               "align": -3,  "xp": 250, "coins": 15,  "result": "ServiÃ§o prestado por moedas. A elfa suspira, mas aceita."},
                {"text": "âš–ï¸ Recusar â€” muito perigoso envolver-se em polÃ­tica",             "align": 0,   "xp": 0,   "coins": 0,   "result": "VocÃª recusa e segue. A resistÃªncia encontra outro mensageiro."},
            ]
        },
    ],
    20: [  # Deserto
        {
            "id": "esc_deserto_001",
            "emoji": "ğŸº",
            "title": "A Tumba Profanada",
            "description": "Um grupo de saqueadores estÃ¡ violando uma tumba sagrada, levando artefatos dos ancestrais. Um anciÃ£o nomade te pede para intervir.",
            "choices": [
                {"text": "âœ¨ Expulsar os saqueadores e devolver os artefatos ao anciÃ£o",    "align": +12, "xp": 500, "coins": 0,   "result": "Os artefatos voltam ao seu lugar. O anciÃ£o te abenÃ§oa com conhecimento antigo."},
                {"text": "âš–ï¸ Expulsar os saqueadores e ficar com metade",                   "align": -3,  "xp": 300, "coins": 25,  "result": "Meio certo, meio errado. O anciÃ£o fica com o suficiente para o ritual."},
                {"text": "ğŸ’€ Juntar-se aos saqueadores â€” mais dividido entre mais gente",   "align": -10, "xp": 200, "coins": 40,  "result": "VocÃª saqueia junto. Riqueza fÃ¡cil. A maldiÃ§Ã£o do faraÃ³ observa em silÃªncio."},
                {"text": "âš–ï¸ Negociar com os saqueadores para eles pararem",               "align": +5,  "xp": 200, "coins": 0,   "result": "Palavras no lugar de violÃªncia. Eles recuam. Alguns artefatos foram perdidos."},
            ]
        },
    ],
    30: [  # Montanhas
        {
            "id": "esc_gelo_001",
            "emoji": "ğŸ”ï¸",
            "title": "A Aldeia Sitiada",
            "description": "Uma aldeia nas montanhas estÃ¡ sitiada por bandidos que exigem tributo mensal. Os moradores estÃ£o famintos e com frio. Os bandidos sÃ£o 5, todos armados.",
            "choices": [
                {"text": "âœ¨ Enfrentar os 5 bandidos sozinho para libertar a aldeia",       "align": +15, "xp": 600, "coins": 0,   "result": "Batalha Ã©pica. VocÃª vence. A aldeia Ã© livre. Eles te constroem uma estÃ¡tua."},
                {"text": "âš–ï¸ Treinar os aldeÃµes para se defenderem sozinhos",               "align": +10, "xp": 500, "coins": 0,   "result": "VocÃª ensina a pescar. A aldeia aprende a se proteger para sempre."},
                {"text": "ğŸ’€ Fazer um acordo com os bandidos â€” eles te pagam para manter controle", "align": -12, "xp": 150, "coins": 35, "result": "VocÃª lucra com o sofrimento. Os aldeÃµes continuam pagando. Agora para vocÃª tambÃ©m."},
                {"text": "âš–ï¸ Negociar a saÃ­da dos bandidos com seu espÃ³lio de batalha",    "align": +3,  "xp": 300, "coins": 10,  "result": "Dinheiro muda mentes. Os bandidos partem. A aldeia respira aliviada."},
            ]
        },
    ],
    40: [  # VulcÃ£o
        {
            "id": "esc_vulcao_001",
            "emoji": "ğŸŒ‹",
            "title": "A Ãšltima CrianÃ§a AnÃ£",
            "description": "VocÃª encontra a Ãºnica crianÃ§a sobrevivente de uma civilizaÃ§Ã£o anÃ£ destruÃ­da pelo vulcÃ£o. Ela segura um mapa para um tesouro lendÃ¡rio de sua naÃ§Ã£o.",
            "choices": [
                {"text": "âœ¨ Adotar a crianÃ§a e protegÃª-la, esquecendo o tesouro",          "align": +15, "xp": 700, "coins": 0,   "result": "VocÃª escolhe uma vida acima do ouro. A crianÃ§a cresce para se tornar uma lenda."},
                {"text": "âš–ï¸ Ajudar a crianÃ§a a recuperar o tesouro de sua naÃ§Ã£o",          "align": +10, "xp": 600, "coins": 50,  "result": "Justo. O tesouro pertence a ela. VocÃª recebe uma parte como heranÃ§a da civilizaÃ§Ã£o."},
                {"text": "ğŸ’€ Roubar o mapa e deixar a crianÃ§a para trÃ¡s",                   "align": -15, "xp": 200, "coins": 80,  "result": "VocÃª rouba de uma Ã³rfÃ£. O tesouro Ã© seu. Mas o peso disso nunca sai."},
                {"text": "âš–ï¸ Levar ao acampamento mais prÃ³ximo e seguir adiante",           "align": +3,  "xp": 200, "coins": 0,   "result": "VocÃª a coloca em seguranÃ§a. NÃ£o ficou com o tesouro, mas tambÃ©m nÃ£o abandonou."},
            ]
        },
    ],
    50: [  # Abismo
        {
            "id": "esc_abismo_001",
            "emoji": "ğŸ‘ï¸",
            "title": "O Pacto das Sombras",
            "description": "Uma entidade do Abismo te oferece poder imenso. Tudo que precisa Ã© assinar um pacto â€” sacrificando a felicidade de trÃªs pessoas que nÃ£o te conhecem.",
            "choices": [
                {"text": "âœ¨ Recusar o pacto com firmeza e atacar a entidade",               "align": +15, "xp": 800, "coins": 0,   "result": "A entidade recua. VocÃª resiste Ã  tentaÃ§Ã£o. Raro. Muito raro."},
                {"text": "ğŸ’€ Assinar o pacto â€” poder acima de tudo",                        "align": -20, "xp": 1000, "coins": 100, "result": "O poder chega. Em algum lugar, trÃªs estranhos acordam com pesadelos eternos."},
                {"text": "âš–ï¸ Fingir aceitar e depois quebrar o pacto",                     "align": -5,  "xp": 500, "coins": 50,  "result": "VocÃª engana a entidade. Ela nÃ£o esquece facilmente."},
                {"text": "âš–ï¸ Negociar termos â€” sacrifÃ­cio menor, poder menor",             "align": -8,  "xp": 600, "coins": 60,  "result": "Um acordo menor. Poder moderado. Culpa moderada. Tudo moderado."},
            ]
        },
    ],
    60: [  # Trono
        {
            "id": "esc_celestial_001",
            "emoji": "ğŸ‘‘",
            "title": "O Julgamento Final",
            "description": "O Imperador Astral oferece a vocÃª o poder de reescrever a histÃ³ria de UMA pessoa â€” alguÃ©m que sofreu imerecidamente. Mas para isso, outra pessoa terÃ¡ que sofrer no lugar.",
            "choices": [
                {"text": "âœ¨ Recusar â€” o sofrimento nÃ£o deve ser transferido, deve ser curado", "align": +20, "xp": 2000, "coins": 0,  "result": "O Imperador sorri. 'Finalmente alguÃ©m entendeu.' VocÃª recebe a bÃªnÃ§Ã£o do Trono."},
                {"text": "ğŸ’€ Escolher quem sofre â€” transferir para um vilÃ£o conhecido",      "align": -5,  "xp": 1200, "coins": 200, "result": "Julgamento humano de sofrimento. A lÃ³gica parece boa... mas quem decide quem merece?"},
                {"text": "âš–ï¸ Perguntar se hÃ¡ uma terceira opÃ§Ã£o antes de decidir",          "align": +8,  "xp": 1500, "coins": 0,   "result": "Existe sempre. O Imperador abre um caminho alternativo de cura sem custo."},
                {"text": "ğŸ’€ Usar o poder em si mesmo â€” apagar seu prÃ³prio sofrimento",     "align": -10, "xp": 1000, "coins": 100, "result": "EgoÃ­sta. Funciona. Mas vocÃª perdeu a chance de ser verdadeiramente grande."},
            ]
        },
    ],
}

# ================= QUESTS ALINHAMENTO MORAL =================
ALIGNMENT_QUESTS = {
    "heroi": [
        {
            "id": "heroi_001",
            "name": "ğŸ›¡ï¸ Protetor das CrianÃ§as Perdidas",
            "description": "CrianÃ§as Ã³rfÃ£s estÃ£o sendo escravizadas por um mercador corrupto. Resgate 8 crianÃ§as das grades.",
            "type": "individual", "objective": "hunt", "target": "Mercador Corrupto",
            "count": 1, "reward_xp": 2000, "reward_coins": 50, "reward_item": "PoÃ§Ã£o de Vida Superior",
            "align_required": "Heroi", "align_gain": +10,
            "lore": "O mercador tem conexÃµes perigosas. Seja cuidadoso.",
            "npc": "Madre Celeste", "difficulty": "DifÃ­cil"
        },
        {
            "id": "heroi_002",
            "name": "âœ¨ A Cura da Aldeia AmaldiÃ§oada",
            "description": "Uma maldiÃ§Ã£o arcana infecta uma aldeia inteira. Colete 12 ingredientes para o ritual de cura.",
            "type": "individual", "objective": "collect", "count": 12,
            "reward_xp": 1800, "reward_coins": 30, "reward_item": "Elixir da Vida",
            "align_required": "Heroi", "align_gain": +8,
            "lore": "A maldiÃ§Ã£o foi lanÃ§ada por um mago que perdeu a famÃ­lia nesta aldeia. TragÃ©dia se alimenta de tragÃ©dia.",
            "npc": "Padre Elian", "difficulty": "MÃ©dio"
        },
    ],
    "anti_heroi": [
        {
            "id": "anti_001",
            "name": "âš–ï¸ O Trabalho Sujo",
            "description": "O prefeito precisa de alguÃ©m para 'resolver' um problema sem fazer perguntas. Explore a Ã¡rea e descubra.",
            "type": "individual", "objective": "explore", "count": 5,
            "reward_xp": 1500, "reward_coins": 100, "reward_item": None,
            "align_required": None, "align_gain": -2,
            "lore": "O prefeito nÃ£o diz o que quer. VocÃª nÃ£o pergunta. Esse Ã© o acordo.",
            "npc": "Prefeito Sombra", "difficulty": "MÃ©dio"
        },
        {
            "id": "anti_002",
            "name": "âš–ï¸ InformaÃ§Ãµes Valiosas",
            "description": "Colete 10 artefatos de locais proibidos. NinguÃ©m precisa saber de onde vieram.",
            "type": "individual", "objective": "collect", "count": 10,
            "reward_xp": 2000, "reward_coins": 80, "reward_item": "PoÃ§Ã£o de Sorte",
            "align_required": None, "align_gain": -3,
            "lore": "InformaÃ§Ã£o Ã© poder. E vocÃª estÃ¡ se tornando muito poderoso.",
            "npc": "Informante Xan", "difficulty": "DifÃ­cil"
        },
    ],
    "vilao": [
        {
            "id": "vilao_001",
            "name": "ğŸ’€ A Purga dos Campos",
            "description": "Um lorde sombrio quer os campos 'limpos' de aldeÃµes. Cace 10 monstros que 'protegem' as aldeias.",
            "type": "individual", "objective": "hunt", "target": None,
            "count": 10, "reward_xp": 2500, "reward_coins": 200, "reward_item": "Foice Maldita",
            "align_required": "Vilao", "align_gain": -10,
            "lore": "O Lorde Sombrio promete poder em troca de serviÃ§o. O preÃ§o Ã© a sua humanidade.",
            "npc": "Lorde Maldito Vorn", "difficulty": "MÃ©dio"
        },
        {
            "id": "vilao_002",
            "name": "ğŸŒ‘ Sabotar a ResistÃªncia",
            "description": "Explore acampamentos da resistÃªncia e plante informaÃ§Ãµes falsas. Visite 7 locais.",
            "type": "individual", "objective": "explore", "count": 7,
            "reward_xp": 3000, "reward_coins": 150, "reward_item": "PoÃ§Ã£o de Sorte",
            "align_required": "Vilao", "align_gain": -8,
            "lore": "A resistÃªncia luta pelo povo. VocÃª luta pelo poder. Apenas um pode vencer.",
            "npc": "Chanceler das Sombras", "difficulty": "DifÃ­cil"
        },
    ]
}

# ================= BAÃšS MIMIC =================
MIMIC_TIERS = [
    {
        "name": "BaÃº Comum",
        "emoji": "ğŸ“¦",
        "mimic_chance": 0.20,
        "loot_xp": (200, 400),
        "loot_coins": (5, 15),
        "loot_items": ["Comum", "Incomum"],
        "mimic_dmg": (20, 40),
        "mimic_xp_loss": (50, 100),
        "mimic_desc": "ğŸ’¥ O baÃº se abre e dentes enormes aparecem! O MIMIC te ataca!",
    },
    {
        "name": "BaÃº Ã‰lfico",
        "emoji": "ğŸ—ï¸",
        "mimic_chance": 0.30,
        "loot_xp": (500, 900),
        "loot_coins": (10, 25),
        "loot_items": ["Incomum", "Raro"],
        "mimic_dmg": (35, 65),
        "mimic_xp_loss": (120, 200),
        "mimic_desc": "ğŸ¦· O ornamento Ã©lfico era falso! Garras surgem das dobradiÃ§as! MIMIC Ã‰LFICO!",
    },
    {
        "name": "BaÃº RÃºnico",
        "emoji": "ğŸ”®",
        "mimic_chance": 0.35,
        "loot_xp": (1000, 2000),
        "loot_coins": (15, 40),
        "loot_items": ["Raro", "Ã‰pico"],
        "mimic_dmg": (50, 90),
        "mimic_xp_loss": (200, 350),
        "mimic_desc": "ğŸŒ‘ As runas pulsam com vida prÃ³pria! Um MIMIC RÃšNICO emerge com poder arcano!",
    },
    {
        "name": "BaÃº LendÃ¡rio",
        "emoji": "âšœï¸",
        "mimic_chance": 0.40,
        "loot_xp": (2000, 4000),
        "loot_coins": (20, 60),
        "loot_items": ["Ã‰pico", "LendÃ¡rio"],
        "mimic_dmg": (80, 130),
        "mimic_xp_loss": (400, 600),
        "mimic_desc": "ğŸ‘ï¸ Os olhos do baÃº se abrem. Um MIMIC LENDÃRIO! A criatura mais antiga desta dungeon!",
    },
]

# ================= SISTEMA DE MAPA =================
MAP_LOCATIONS = {
    # Cada mundo tem uma lista de locais descobrÃ­veis
    1: {
        "world_name": "ğŸŒ± Campos Iniciais",
        "locations": [
            {"id": "campos_vila", "name": "ğŸ˜ï¸ Vila dos Primeiros Passos", "type": "cidade", "discovered": True},
            {"id": "campos_pedreira", "name": "â›ï¸ Pedreira dos Iniciantes", "type": "recurso", "discovered": False},
            {"id": "campos_gruta", "name": "ğŸ•³ï¸ Gruta do Slime AnciÃ£o", "type": "dungeon", "discovered": False},
            {"id": "campos_floresta_borda", "name": "ğŸŒ¿ Borda da Floresta Proibida", "type": "portal", "discovered": False},
            {"id": "campos_torre", "name": "ğŸ—¼ Torre do Observador", "type": "npc_especial", "discovered": False},
        ]
    },
    10: {
        "world_name": "ğŸŒ² Floresta Sombria",
        "locations": [
            {"id": "floresta_acampamento", "name": "â›º Acampamento das Sombras", "type": "cidade", "discovered": True},
            {"id": "floresta_arvore_milenar", "name": "ğŸŒ³ Ãrvore Milenar do Ent", "type": "boss_local", "discovered": False},
            {"id": "floresta_rio_negro", "name": "ğŸ–¤ Rio das Ãguas Negras", "type": "recurso", "discovered": False},
            {"id": "floresta_ruinas", "name": "ğŸšï¸ RuÃ­nas do Reino Ã‰lfico", "type": "dungeon", "discovered": False},
            {"id": "floresta_claro", "name": "ğŸŒ™ Clareira da Lua", "type": "evento_especial", "discovered": False},
        ]
    },
    20: {
        "world_name": "ğŸœï¸ Deserto das Almas",
        "locations": [
            {"id": "deserto_oasis", "name": "ğŸŒ´ OÃ¡sis de Amun", "type": "cidade", "discovered": True},
            {"id": "deserto_piramide", "name": "ğŸ”º Grande PirÃ¢mide de Kha-Mentu", "type": "boss_local", "discovered": False},
            {"id": "deserto_mercado", "name": "ğŸª Mercado das Almas", "type": "loja", "discovered": False},
            {"id": "deserto_oasis_secreto", "name": "ğŸ’§ OÃ¡sis do Tempo", "type": "dungeon_secreta", "discovered": False},
            {"id": "deserto_ruinas_antigas", "name": "ğŸ›ï¸ RuÃ­nas da Primeira CivilizaÃ§Ã£o", "type": "lore", "discovered": False},
        ]
    },
    30: {
        "world_name": "â„ï¸ Montanhas Geladas",
        "locations": [
            {"id": "gelo_fortaleza", "name": "ğŸ° Fortaleza Permafrost", "type": "cidade", "discovered": True},
            {"id": "gelo_pico", "name": "ğŸ”ï¸ Pico dos TitÃ£s", "type": "boss_local", "discovered": False},
            {"id": "gelo_mina", "name": "â›ï¸ Mina dos Cristais Eternos", "type": "recurso", "discovered": False},
            {"id": "gelo_palacio", "name": "â„ï¸ PalÃ¡cio de Cristal Perdido", "type": "dungeon_secreta", "discovered": False},
            {"id": "gelo_portal", "name": "ğŸŒŒ Portal para o VulcÃ£o", "type": "portal", "discovered": False},
        ]
    },
    40: {
        "world_name": "ğŸŒ‹ Reino VulcÃ¢nico",
        "locations": [
            {"id": "vulcao_cidadela", "name": "ğŸ”¥ Cidadela Cinzenta", "type": "cidade", "discovered": True},
            {"id": "vulcao_cratera", "name": "ğŸŒ‹ Cratera Principal", "type": "boss_local", "discovered": False},
            {"id": "vulcao_forja", "name": "âš’ï¸ A Forja Sagrada dos AnÃµes", "type": "crafting", "discovered": False},
            {"id": "vulcao_camara", "name": "ğŸ”¥ CÃ¢mara da Chama Original", "type": "dungeon_secreta", "discovered": False},
            {"id": "vulcao_rio_lava", "name": "ğŸŒŠ Rio de Lava Eterna", "type": "recurso", "discovered": False},
        ]
    },
    50: {
        "world_name": "ğŸŒŒ Abismo Arcano",
        "locations": [
            {"id": "abismo_torre", "name": "ğŸ—¼ Torre do Conhecimento Perdido", "type": "cidade", "discovered": True},
            {"id": "abismo_vortex", "name": "ğŸŒ€ VÃ³rtice Central do Abismo", "type": "boss_local", "discovered": False},
            {"id": "abismo_biblioteca", "name": "ğŸ“š Biblioteca dos Tomos Proibidos", "type": "lore", "discovered": False},
            {"id": "abismo_loop", "name": "â™¾ï¸ Loop Temporal", "type": "dungeon_secreta", "discovered": False},
            {"id": "abismo_portal", "name": "âœ¨ Portal para o Trono", "type": "portal", "discovered": False},
        ]
    },
    60: {
        "world_name": "ğŸ‘‘ Trono Celestial",
        "locations": [
            {"id": "celestial_antecamara", "name": "ğŸ›ï¸ AntecÃ¢mara do Trono", "type": "cidade", "discovered": True},
            {"id": "celestial_trono", "name": "ğŸ‘‘ O Trono em Si", "type": "boss_local", "discovered": False},
            {"id": "celestial_alem", "name": "ğŸŒŒ AlÃ©m do Trono", "type": "dungeon_secreta", "discovered": False},
            {"id": "celestial_raiz", "name": "âœ¨ Raiz da CriaÃ§Ã£o", "type": "dungeon_secreta", "discovered": False},
            {"id": "celestial_arquivo", "name": "ğŸ“œ Arquivo do Destino", "type": "lore", "discovered": False},
        ]
    },
    62: {
        "world_name": "ğŸ’§ PÃ¢ntano Eterno",
        "locations": [
            {"id": "pantano_aldeia", "name": "ğŸ›– Aldeia dos Sobreviventes", "type": "cidade", "discovered": True},
            {"id": "pantano_coracao", "name": "ğŸŒ‘ CoraÃ§Ã£o do PÃ¢ntano", "type": "dungeon_secreta", "discovered": False},
            {"id": "pantano_templo", "name": "ğŸ’€ Templo Afundado de Morthak", "type": "dungeon_secreta", "discovered": False},
            {"id": "pantano_rio", "name": "ğŸŒ¿ Rio das Ãguas Negras", "type": "recurso", "discovered": False},
        ]
    },
    70: {
        "world_name": "ğŸ’ Montanhas dos Cristais",
        "locations": [
            {"id": "cristal_fortaleza", "name": "ğŸ”ï¸ Fortaleza dos Cristais", "type": "cidade", "discovered": True},
            {"id": "cristal_nucleo", "name": "ğŸŒŸ NÃºcleo Cristalino Primordial", "type": "dungeon_secreta", "discovered": False},
            {"id": "cristal_camara", "name": "ğŸ’  CÃ¢mara do Diamante Negro", "type": "dungeon_secreta", "discovered": False},
            {"id": "cristal_mina", "name": "â›ï¸ Mina Profunda dos Cristais", "type": "recurso", "discovered": False},
            {"id": "cristal_boss", "name": "ğŸ’ Sala do Cristal Vivo", "type": "boss_local", "discovered": False},
        ]
    },
    80: {
        "world_name": "ğŸŒ‘ Reino das Trevas Eternas",
        "locations": [
            {"id": "trevas_cidadela", "name": "ğŸ° Cidadela das Sombras", "type": "cidade", "discovered": True},
            {"id": "trevas_dungeon", "name": "ğŸŒ‘ Trevas Infinitas", "type": "dungeon_secreta", "discovered": False},
            {"id": "trevas_lich", "name": "ğŸ’€ Cripta do Lich Eterno", "type": "dungeon_secreta", "discovered": False},
            {"id": "trevas_boss", "name": "ğŸ‘‘ Trono das Sombras", "type": "boss_local", "discovered": False},
        ]
    },
    90: {
        "world_name": "âš¡ Planalto das Tempestades",
        "locations": [
            {"id": "tempestade_base", "name": "â›º Acampamento do RelÃ¢mpago", "type": "cidade", "discovered": True},
            {"id": "tempestade_dungeon1", "name": "ğŸŒ©ï¸ CÃ¢mara da Tempestade Eterna", "type": "dungeon_secreta", "discovered": False},
            {"id": "tempestade_dungeon2", "name": "âš¡ Fonte do Primeiro RelÃ¢mpago", "type": "dungeon_secreta", "discovered": False},
            {"id": "tempestade_boss", "name": "ğŸŒªï¸ Olho da Tempestade", "type": "boss_local", "discovered": False},
        ]
    },
    100: {
        "world_name": "ğŸŒ Terra Antiga dos TitÃ£s",
        "locations": [
            {"id": "titÃ£_cidade", "name": "ğŸ›ï¸ Cidade dos Antigos", "type": "cidade", "discovered": True},
            {"id": "titÃ£_dungeon1", "name": "ğŸŒ CÃ¢mara da Terra Antiga", "type": "dungeon_secreta", "discovered": False},
            {"id": "titÃ£_dungeon2", "name": "ğŸ—¿ SantuÃ¡rio do Primeiro Gigante", "type": "dungeon_secreta", "discovered": False},
            {"id": "titÃ£_boss", "name": "ğŸŒ‹ Colosseu dos TitÃ£s", "type": "boss_local", "discovered": False},
        ]
    },
    110: {
        "world_name": "ğŸŒŠ Abismo OceÃ¢nico Eterno",
        "locations": [
            {"id": "oceano_base", "name": "ğŸï¸ Ilha dos Ãšltimos Navegantes", "type": "cidade", "discovered": True},
            {"id": "oceano_dungeon1", "name": "ğŸŒŠ CÃ¢mara do Oceano Eterno", "type": "dungeon_secreta", "discovered": False},
            {"id": "oceano_dungeon2", "name": "ğŸ‹ Leito do LeviatÃ£ Primordial", "type": "dungeon_secreta", "discovered": False},
            {"id": "oceano_boss", "name": "ğŸŒ€ VÃ³rtice do Fim dos Mares", "type": "boss_local", "discovered": False},
        ]
    },
    120: {
        "world_name": "ğŸŒ€ Plano do Caos Primordial",
        "locations": [
            {"id": "caos_nexo", "name": "ğŸŒ€ Nexo do Caos", "type": "cidade", "discovered": True},
            {"id": "caos_dungeon1", "name": "ğŸŒ€ CÃ¢mara do Caos Primordial", "type": "dungeon_secreta", "discovered": False},
            {"id": "caos_dungeon2", "name": "â™¾ï¸ Portal do Caos Eterno", "type": "dungeon_secreta", "discovered": False},
            {"id": "caos_boss", "name": "ğŸ’¥ Centro do Caos em Pessoa", "type": "boss_local", "discovered": False},
        ]
    },
    130: {
        "world_name": "ğŸŒ¸ Jardim da Primeira Flor",
        "locations": [
            {"id": "jardim_sanctum", "name": "ğŸŒ¸ Sanctum da Primeira Flor", "type": "cidade", "discovered": True},
            {"id": "jardim_dungeon1", "name": "ğŸŒº CÃ¢mara da Primeira Flor", "type": "dungeon_secreta", "discovered": False},
            {"id": "jardim_dungeon2", "name": "ğŸŒ¿ Jardim Proibido", "type": "dungeon_secreta", "discovered": False},
            {"id": "jardim_boss", "name": "ğŸŒ³ Ãrvore da CriaÃ§Ã£o", "type": "boss_local", "discovered": False},
        ]
    },
    140: {
        "world_name": "â„ï¸ Reino do Gelo Primordial",
        "locations": [
            {"id": "gelo_trono", "name": "ğŸ§Š Trono do Gelo Eterno", "type": "cidade", "discovered": True},
            {"id": "gelo_dungeon1", "name": "â„ï¸ CÃ¢mara do Gelo Primordial", "type": "dungeon_secreta", "discovered": False},
            {"id": "gelo_dungeon2", "name": "ğŸ’€ CÃ¢mara da ExtinÃ§Ã£o Gelada", "type": "dungeon_secreta", "discovered": False},
            {"id": "gelo_boss", "name": "ğŸŒ¨ï¸ NÃºcleo do Inverno Primordial", "type": "boss_local", "discovered": False},
        ]
    },
    150: {
        "world_name": "ğŸ›ï¸ CivilizaÃ§Ã£o Proibida",
        "locations": [
            {"id": "civpro_ruins", "name": "ğŸšï¸ RuÃ­nas da CivilizaÃ§Ã£o Proibida", "type": "cidade", "discovered": True},
            {"id": "civpro_dungeon1", "name": "ğŸ›ï¸ CÃ¢mara da CivilizaÃ§Ã£o Proibida", "type": "dungeon_secreta", "discovered": False},
            {"id": "civpro_dungeon2", "name": "âš”ï¸ Arsenal da Arma Final", "type": "dungeon_secreta", "discovered": False},
            {"id": "civpro_boss", "name": "ğŸ¤– Centro de Controle do Rei-AutÃ´mato", "type": "boss_local", "discovered": False},
        ]
    },
    160: {
        "world_name": "ğŸŒŸ Plano Astral Superior",
        "locations": [
            {"id": "astral_portal", "name": "ğŸŒŸ Portal do Plano Astral", "type": "cidade", "discovered": True},
            {"id": "astral_dungeon1", "name": "ğŸŒŒ CÃ¢mara do CoraÃ§Ã£o do Cosmos", "type": "dungeon_secreta", "discovered": False},
            {"id": "astral_dungeon2", "name": "âœ¨ AlÃ©m da ExistÃªncia", "type": "dungeon_secreta", "discovered": False},
            {"id": "astral_boss", "name": "â™¾ï¸ Trono do Senhor do Plano Astral", "type": "boss_local", "discovered": False},
        ]
    },
    170: {
        "world_name": "âš« O Verdadeiro Fim",
        "locations": [
            {"id": "fim_portal", "name": "ğŸŒ‘ Portal do Verdadeiro Fim", "type": "cidade", "discovered": True},
            {"id": "fim_dungeon1", "name": "âš« CÃ¢mara do Verdadeiro Fim", "type": "dungeon_secreta", "discovered": False},
            {"id": "fim_dungeon2", "name": "â™¾ï¸ CÃ¢mara do Alpha e Omega", "type": "dungeon_secreta", "discovered": False},
            {"id": "fim_boss", "name": "ğŸ‘ï¸ Trono do Que Existe AlÃ©m de Tudo", "type": "boss_local", "discovered": False},
        ]
    },
    180: {
        "world_name": "ğŸŒŒ A Origem",
        "locations": [
            {"id": "origem_nexo", "name": "ğŸŒŒ Nexo da CriaÃ§Ã£o", "type": "cidade", "discovered": True},
            {"id": "origem_dungeon1", "name": "ğŸ’  CÃ¢mara do Caos Eterno Primordial", "type": "dungeon_secreta", "discovered": False},
            {"id": "origem_dungeon2", "name": "ğŸŒˆ CÃ¢mara do Jardim Final", "type": "dungeon_secreta", "discovered": False},
            {"id": "origem_boss", "name": "âœ¨ Trono do Criador Primordial", "type": "boss_local", "discovered": False},
        ]
    },
    190: {
        "world_name": "ğŸ”± Reinos Mortais â€” Ãpice",
        "locations": [
            {"id": "apice_cidade", "name": "ğŸ¯ Cidadela do Ãpice Mortal", "type": "cidade", "discovered": True},
            {"id": "apice_templo", "name": "ğŸ•³ï¸ Criptas do Ãšltimo Mortal", "type": "dungeon_secreta", "discovered": False},
            {"id": "apice_vault", "name": "ğŸ•³ï¸ CÃ¢mara do Destino Final Mortal", "type": "dungeon_secreta", "discovered": False},
            {"id": "apice_recurso", "name": "â›ï¸ Minas do Ãpice", "type": "recurso", "discovered": False},
            {"id": "apice_boss", "name": "ğŸ’€ Trono do GuardiÃ£o do Ãpice", "type": "boss_local", "discovered": False},
        ]
    },
    200: {
        "world_name": "âš¡ Reinos AvanÃ§ados â€” Despertar",
        "locations": [
            {"id": "desp_cidade", "name": "âš¡ Portal do Despertar", "type": "cidade", "discovered": True},
            {"id": "desp_dungeon1", "name": "ğŸŒ€ Abismo do Primeiro Despertar", "type": "dungeon_secreta", "discovered": False},
            {"id": "desp_dungeon2", "name": "ğŸŒ€ CÃ¢mara da TranscendÃªncia", "type": "dungeon_secreta", "discovered": False},
            {"id": "desp_recurso", "name": "âœ¨ Cristais do Despertar", "type": "recurso", "discovered": False},
            {"id": "desp_boss", "name": "ğŸ‘ï¸ Altar do Ser do AlÃ©m", "type": "boss_local", "discovered": False},
        ]
    },
    210: {
        "world_name": "ğŸŒ€ VÃ³rtice dos Reinos",
        "locations": [
            {"id": "vort_cidade", "name": "ğŸŒ€ Centro do VÃ³rtice", "type": "cidade", "discovered": True},
            {"id": "vort_dungeon1", "name": "ğŸŒ€ Espiral Interna do VÃ³rtice", "type": "dungeon_secreta", "discovered": False},
            {"id": "vort_dungeon2", "name": "ğŸŒ€ CÃ¢mara da DistorÃ§Ã£o Dimensional", "type": "dungeon_secreta", "discovered": False},
            {"id": "vort_recurso", "name": "â›ï¸ Fragmentos do VÃ³rtice", "type": "recurso", "discovered": False},
            {"id": "vort_boss", "name": "ğŸ‘ï¸ Olho do VÃ³rtice Eterno", "type": "boss_local", "discovered": False},
        ]
    },
    220: {
        "world_name": "ğŸ”ï¸ Montanhas do AlÃ©m",
        "locations": [
            {"id": "malem_cidade", "name": "ğŸ”ï¸ Fortaleza nas Nuvens do AlÃ©m", "type": "cidade", "discovered": True},
            {"id": "malem_dungeon1", "name": "ğŸŒ€ CÃ¢mara do Pico Interdimensional", "type": "dungeon_secreta", "discovered": False},
            {"id": "malem_dungeon2", "name": "ğŸŒ€ Abismo nas RaÃ­zes da Montanha", "type": "dungeon_secreta", "discovered": False},
            {"id": "malem_recurso", "name": "â›ï¸ Cristais das Alturas do AlÃ©m", "type": "recurso", "discovered": False},
            {"id": "malem_boss", "name": "ğŸ‘ï¸ Cume do TitÃ£ do AlÃ©m", "type": "boss_local", "discovered": False},
        ]
    },
    230: {
        "world_name": "ğŸŒŠ Oceano Dimensional",
        "locations": [
            {"id": "oceandim_cidade", "name": "ğŸï¸ Ilha Flutuante Dimensional", "type": "cidade", "discovered": True},
            {"id": "oceandim_dungeon1", "name": "ğŸŒ€ Abismo das Profundezas Dimensionais", "type": "dungeon_secreta", "discovered": False},
            {"id": "oceandim_dungeon2", "name": "ğŸŒŠ CÃ¢mara do LeviatÃ£ Dimensional", "type": "dungeon_secreta", "discovered": False},
            {"id": "oceandim_recurso", "name": "â›ï¸ PÃ©rolas do Oceano Dimensional", "type": "recurso", "discovered": False},
            {"id": "oceandim_boss", "name": "ğŸ‘ï¸ Trono do Senhor das MarÃ©s Dimensionais", "type": "boss_local", "discovered": False},
        ]
    },
    240: {
        "world_name": "ğŸ”¥ Forjas do Caos",
        "locations": [
            {"id": "forjas_cidade", "name": "ğŸ”¥ Grande Forja do Caos", "type": "cidade", "discovered": True},
            {"id": "forjas_dungeon1", "name": "ğŸŒ€ CÃ¢mara do Caos Forjado", "type": "dungeon_secreta", "discovered": False},
            {"id": "forjas_dungeon2", "name": "ğŸŒ€ Abismo da Chama CaÃ³tica", "type": "dungeon_secreta", "discovered": False},
            {"id": "forjas_recurso", "name": "â›ï¸ MinÃ©rio do Caos Puro", "type": "recurso", "discovered": False},
            {"id": "forjas_boss", "name": "ğŸ‘ï¸ CoraÃ§Ã£o da Forja do Caos", "type": "boss_local", "discovered": False},
        ]
    },
    250: {
        "world_name": "â„ï¸ Tundra Absoluta",
        "locations": [
            {"id": "tundra_cidade", "name": "â„ï¸ Acampamento da Tundra Absoluta", "type": "cidade", "discovered": True},
            {"id": "tundra_dungeon1", "name": "ğŸŒ€ CÃ¢mara do Gelo Dimensional", "type": "dungeon_secreta", "discovered": False},
            {"id": "tundra_dungeon2", "name": "ğŸŒ€ Abismo da Tundra Eterna", "type": "dungeon_secreta", "discovered": False},
            {"id": "tundra_recurso", "name": "â›ï¸ Cristais de Gelo Absoluto", "type": "recurso", "discovered": False},
            {"id": "tundra_boss", "name": "ğŸ‘ï¸ Trono da Imperatriz da Tundra", "type": "boss_local", "discovered": False},
        ]
    },
    260: {
        "world_name": "âš—ï¸ Alquimia das Eras",
        "locations": [
            {"id": "alq_cidade", "name": "âš—ï¸ LaboratÃ³rio das Eras", "type": "cidade", "discovered": True},
            {"id": "alq_dungeon1", "name": "ğŸŒ€ CÃ¢mara da Grande Alquimia", "type": "dungeon_secreta", "discovered": False},
            {"id": "alq_dungeon2", "name": "ğŸŒ€ Abismo da Pedra Filosofal Perdida", "type": "dungeon_secreta", "discovered": False},
            {"id": "alq_recurso", "name": "â›ï¸ Reagentes das Eras", "type": "recurso", "discovered": False},
            {"id": "alq_boss", "name": "ğŸ‘ï¸ Altar do Alquimista Primordial", "type": "boss_local", "discovered": False},
        ]
    },
    270: {
        "world_name": "ğŸŒŒ GalÃ¡xia Interior",
        "locations": [
            {"id": "galax_cidade", "name": "ğŸŒŒ EstaÃ§Ã£o Orbital da GalÃ¡xia Interior", "type": "cidade", "discovered": True},
            {"id": "galax_dungeon1", "name": "ğŸŒ€ CÃ¢mara do NÃºcleo GalÃ¡ctico", "type": "dungeon_secreta", "discovered": False},
            {"id": "galax_dungeon2", "name": "ğŸŒ€ Abismo das Estrelas Mortas", "type": "dungeon_secreta", "discovered": False},
            {"id": "galax_recurso", "name": "â›ï¸ Poeira das Estrelas Vivas", "type": "recurso", "discovered": False},
            {"id": "galax_boss", "name": "ğŸ‘ï¸ Trono do Senhor da GalÃ¡xia", "type": "boss_local", "discovered": False},
        ]
    },
    280: {
        "world_name": "âš–ï¸ Tribunal do Cosmo",
        "locations": [
            {"id": "trib_cidade", "name": "âš–ï¸ CÃ¢mara do Tribunal CÃ³smico", "type": "cidade", "discovered": True},
            {"id": "trib_dungeon1", "name": "ğŸŒ€ CÃ¢mara das SentenÃ§as Eternas", "type": "dungeon_secreta", "discovered": False},
            {"id": "trib_dungeon2", "name": "ğŸŒ€ Abismo do RÃ©u Eterno", "type": "dungeon_secreta", "discovered": False},
            {"id": "trib_recurso", "name": "â›ï¸ RelÃ­quias do Tribunal", "type": "recurso", "discovered": False},
            {"id": "trib_boss", "name": "ğŸ‘ï¸ Trono do Juiz do Cosmo", "type": "boss_local", "discovered": False},
        ]
    },
    290: {
        "world_name": "ğŸ—¡ï¸ Arena dos Deuses Menores",
        "locations": [
            {"id": "arena_cidade", "name": "ğŸ—¡ï¸ Coliseu dos Deuses Menores", "type": "cidade", "discovered": True},
            {"id": "arena_dungeon1", "name": "ğŸŒ€ CÃ¢mara dos CampeÃµes Esquecidos", "type": "dungeon_secreta", "discovered": False},
            {"id": "arena_dungeon2", "name": "ğŸŒ€ Abismo dos Deuses Derrotados", "type": "dungeon_secreta", "discovered": False},
            {"id": "arena_recurso", "name": "â›ï¸ Trofeus Dimensionais", "type": "recurso", "discovered": False},
            {"id": "arena_boss", "name": "ğŸ‘ï¸ Trono do CampeÃ£o Eterno", "type": "boss_local", "discovered": False},
        ]
    },
    300: {
        "world_name": "ğŸ‘ï¸ O Olho do Multiverso",
        "locations": [
            {"id": "olho_cidade", "name": "ğŸ‘ï¸ Pupila Central do Multiverso", "type": "cidade", "discovered": True},
            {"id": "olho_dungeon1", "name": "ğŸŒ€ CÃ¢mara da VisÃ£o Absoluta", "type": "dungeon_secreta", "discovered": False},
            {"id": "olho_dungeon2", "name": "ğŸŒ€ Abismo do Que NÃ£o Pode Ser Visto", "type": "dungeon_secreta", "discovered": False},
            {"id": "olho_recurso", "name": "â›ï¸ Fragmentos da Ãris do Multiverso", "type": "recurso", "discovered": False},
            {"id": "olho_boss", "name": "ğŸ‘ï¸ Nervo Ã“ptico do Multiverso", "type": "boss_local", "discovered": False},
        ]
    },
    310: {
        "world_name": "ğŸ”® Plano Astral Inferior",
        "locations": [
            {"id": "astrinf_cidade", "name": "ğŸ”® Nexo do Plano Astral Inferior", "type": "cidade", "discovered": True},
            {"id": "astrinf_dungeon1", "name": "ğŸŒ€ CÃ¢mara das Almas Astrais", "type": "dungeon_secreta", "discovered": False},
            {"id": "astrinf_dungeon2", "name": "ğŸŒ€ Abismo do Plano Astral Sombrio", "type": "dungeon_secreta", "discovered": False},
            {"id": "astrinf_recurso", "name": "â›ï¸ Cristais Astrais Inferiores", "type": "recurso", "discovered": False},
            {"id": "astrinf_boss", "name": "ğŸ‘ï¸ Senhor do Plano Astral Inferior", "type": "boss_local", "discovered": False},
        ]
    },
    320: {
        "world_name": "ğŸ’ Fortaleza de Cristal",
        "locations": [
            {"id": "fortcri_cidade", "name": "ğŸ’ Grande Fortaleza de Cristal", "type": "cidade", "discovered": True},
            {"id": "fortcri_dungeon1", "name": "ğŸŒ€ CÃ¢mara do Cristal Negro", "type": "dungeon_secreta", "discovered": False},
            {"id": "fortcri_dungeon2", "name": "ğŸŒ€ Abismo dos Cristais Sombrios", "type": "dungeon_secreta", "discovered": False},
            {"id": "fortcri_recurso", "name": "â›ï¸ Minas de Cristal Dimensional", "type": "recurso", "discovered": False},
            {"id": "fortcri_boss", "name": "ğŸ‘ï¸ CoraÃ§Ã£o da Fortaleza de Cristal", "type": "boss_local", "discovered": False},
        ]
    },
    330: {
        "world_name": "ğŸŒ‘ Lua Negra",
        "locations": [
            {"id": "lua_cidade", "name": "ğŸŒ‘ SuperfÃ­cie da Lua Negra", "type": "cidade", "discovered": True},
            {"id": "lua_dungeon1", "name": "ğŸŒ€ CÃ¢mara do NÃºcleo Lunar Negro", "type": "dungeon_secreta", "discovered": False},
            {"id": "lua_dungeon2", "name": "ğŸŒ€ Abismo da Face Oculta", "type": "dungeon_secreta", "discovered": False},
            {"id": "lua_recurso", "name": "â›ï¸ Fragmentos da Lua Negra", "type": "recurso", "discovered": False},
            {"id": "lua_boss", "name": "ğŸ‘ï¸ Senhor da Lua Negra", "type": "boss_local", "discovered": False},
        ]
    },
    340: {
        "world_name": "â˜„ï¸ CemitÃ©rio de Estrelas",
        "locations": [
            {"id": "cemit_cidade", "name": "â˜„ï¸ EstaÃ§Ã£o entre as Estrelas Mortas", "type": "cidade", "discovered": True},
            {"id": "cemit_dungeon1", "name": "ğŸŒ€ CÃ¢mara das MemÃ³rias Estelares", "type": "dungeon_secreta", "discovered": False},
            {"id": "cemit_dungeon2", "name": "ğŸŒ€ Abismo da Supernova Eterna", "type": "dungeon_secreta", "discovered": False},
            {"id": "cemit_recurso", "name": "â›ï¸ Cinzas de Estrelas Extintas", "type": "recurso", "discovered": False},
            {"id": "cemit_boss", "name": "ğŸ‘ï¸ GuardiÃ£o do CemitÃ©rio Estelar", "type": "boss_local", "discovered": False},
        ]
    },
    350: {
        "world_name": "ğŸŒ CoraÃ§Ã£o Solar",
        "locations": [
            {"id": "solar_cidade", "name": "ğŸŒ CÃ¢mara Central do CoraÃ§Ã£o Solar", "type": "cidade", "discovered": True},
            {"id": "solar_dungeon1", "name": "ğŸŒ€ CÃ¢mara do Plasma Primordial", "type": "dungeon_secreta", "discovered": False},
            {"id": "solar_dungeon2", "name": "ğŸŒ€ Abismo das Chamas Solares", "type": "dungeon_secreta", "discovered": False},
            {"id": "solar_recurso", "name": "â›ï¸ Cristais Solares Primordiais", "type": "recurso", "discovered": False},
            {"id": "solar_boss", "name": "ğŸ‘ï¸ Entidade do CoraÃ§Ã£o Solar", "type": "boss_local", "discovered": False},
        ]
    },
    360: {
        "world_name": "ğŸ•³ï¸ Buraco Negro Vivo",
        "locations": [
            {"id": "buraco_cidade", "name": "ğŸ•³ï¸ Beira do Evento Horizonte", "type": "cidade", "discovered": True},
            {"id": "buraco_dungeon1", "name": "ğŸŒ€ CÃ¢mara da Singularidade", "type": "dungeon_secreta", "discovered": False},
            {"id": "buraco_dungeon2", "name": "ğŸŒ€ Abismo alÃ©m do Horizonte", "type": "dungeon_secreta", "discovered": False},
            {"id": "buraco_recurso", "name": "â›ï¸ MatÃ©ria Comprimida", "type": "recurso", "discovered": False},
            {"id": "buraco_boss", "name": "ğŸ‘ï¸ ConsciÃªncia do Buraco Negro", "type": "boss_local", "discovered": False},
        ]
    },
    370: {
        "world_name": "ğŸŒ Nexo das DimensÃµes",
        "locations": [
            {"id": "nexo_cidade", "name": "ğŸŒ Centro do Nexo Dimensional", "type": "cidade", "discovered": True},
            {"id": "nexo_dungeon1", "name": "ğŸŒ€ CÃ¢mara das DimensÃµes Cruzadas", "type": "dungeon_secreta", "discovered": False},
            {"id": "nexo_dungeon2", "name": "ğŸŒ€ Abismo do Eixo Dimensional", "type": "dungeon_secreta", "discovered": False},
            {"id": "nexo_recurso", "name": "â›ï¸ Fragmentos do Nexo", "type": "recurso", "discovered": False},
            {"id": "nexo_boss", "name": "ğŸ‘ï¸ Arquiteto do Nexo das DimensÃµes", "type": "boss_local", "discovered": False},
        ]
    },
    380: {
        "world_name": "âš¡ Tempestade Interdimensional",
        "locations": [
            {"id": "tempinter_cidade", "name": "âš¡ Olho da Tempestade Interdimensional", "type": "cidade", "discovered": True},
            {"id": "tempinter_dungeon1", "name": "ğŸŒ€ CÃ¢mara do RelÃ¢mpago Dimensional", "type": "dungeon_secreta", "discovered": False},
            {"id": "tempinter_dungeon2", "name": "ğŸŒ€ Abismo da Tempestade Eterna", "type": "dungeon_secreta", "discovered": False},
            {"id": "tempinter_recurso", "name": "â›ï¸ Cristais da Tempestade", "type": "recurso", "discovered": False},
            {"id": "tempinter_boss", "name": "ğŸ‘ï¸ Senhor da Tempestade Interdimensional", "type": "boss_local", "discovered": False},
        ]
    },
    390: {
        "world_name": "ğŸ”± Trono dos Reinos AvanÃ§ados",
        "locations": [
            {"id": "tronoav_cidade", "name": "ğŸ”± AntecÃ¢mara do Trono AvanÃ§ado", "type": "cidade", "discovered": True},
            {"id": "tronoav_dungeon1", "name": "ğŸŒ€ CÃ¢mara dos GuardiÃµes do Trono", "type": "dungeon_secreta", "discovered": False},
            {"id": "tronoav_dungeon2", "name": "ğŸŒ€ Abismo sob o Trono AvanÃ§ado", "type": "dungeon_secreta", "discovered": False},
            {"id": "tronoav_recurso", "name": "â›ï¸ RelÃ­quias do Trono AvanÃ§ado", "type": "recurso", "discovered": False},
            {"id": "tronoav_boss", "name": "ğŸ‘ï¸ O Trono dos Reinos AvanÃ§ados", "type": "boss_local", "discovered": False},
        ]
    },
    400: {
        "world_name": "ğŸŒ  DimensÃµes Superiores â€” Entrada",
        "locations": [
            {"id": "dimsup_cidade", "name": "ğŸŒ  Portal de Entrada das DimensÃµes Superiores", "type": "cidade", "discovered": True},
            {"id": "dimsup_dungeon1", "name": "ğŸ’« CÃ¢mara da Primeira DimensÃ£o Superior", "type": "dungeon_secreta", "discovered": False},
            {"id": "dimsup_dungeon2", "name": "ğŸ’« Abismo da TranscendÃªncia Dimensional", "type": "dungeon_secreta", "discovered": False},
            {"id": "dimsup_recurso", "name": "â›ï¸ Cristais Dimensionais Superiores", "type": "recurso", "discovered": False},
            {"id": "dimsup_boss", "name": "ğŸŒ  GuardiÃ£o da Entrada Dimensional", "type": "boss_local", "discovered": False},
        ]
    },
    410: {
        "world_name": "ğŸ’« Nebulosa da ConsciÃªncia",
        "locations": [
            {"id": "nebulosa_cidade", "name": "ğŸ’« NÃºcleo da Nebulosa Consciente", "type": "cidade", "discovered": True},
            {"id": "nebulosa_dungeon1", "name": "ğŸ’« CÃ¢mara dos Pensamentos CÃ³smicos", "type": "dungeon_secreta", "discovered": False},
            {"id": "nebulosa_dungeon2", "name": "ğŸ’« Abismo da ConsciÃªncia Nebular", "type": "dungeon_secreta", "discovered": False},
            {"id": "nebulosa_recurso", "name": "â›ï¸ GÃ¡s Consciente Cristalizado", "type": "recurso", "discovered": False},
            {"id": "nebulosa_boss", "name": "ğŸŒ  Mente da Nebulosa", "type": "boss_local", "discovered": False},
        ]
    },
    420: {
        "world_name": "ğŸŒ€ VÃ³rtice Dimensional Supremo",
        "locations": [
            {"id": "vortdim_cidade", "name": "ğŸŒ€ Plataforma no VÃ³rtice Supremo", "type": "cidade", "discovered": True},
            {"id": "vortdim_dungeon1", "name": "ğŸ’« CÃ¢mara do VÃ³rtice Dimensional Supremo", "type": "dungeon_secreta", "discovered": False},
            {"id": "vortdim_dungeon2", "name": "ğŸ’« Abismo do Infinito Dimensional", "type": "dungeon_secreta", "discovered": False},
            {"id": "vortdim_recurso", "name": "â›ï¸ Fragmentos do VÃ³rtice Supremo", "type": "recurso", "discovered": False},
            {"id": "vortdim_boss", "name": "ğŸŒ  Senhor do VÃ³rtice Supremo", "type": "boss_local", "discovered": False},
        ]
    },
    430: {
        "world_name": "ğŸ›ï¸ Templo dos Deuses Maiores",
        "locations": [
            {"id": "tmpdeus_cidade", "name": "ğŸ›ï¸ Ãtrio do Templo dos Deuses Maiores", "type": "cidade", "discovered": True},
            {"id": "tmpdeus_dungeon1", "name": "ğŸ’« CÃ¢mara dos Rituais dos Deuses", "type": "dungeon_secreta", "discovered": False},
            {"id": "tmpdeus_dungeon2", "name": "ğŸ’« Abismo Sagrado dos Deuses Maiores", "type": "dungeon_secreta", "discovered": False},
            {"id": "tmpdeus_recurso", "name": "â›ï¸ Oferendas Sagradas dos Deuses", "type": "recurso", "discovered": False},
            {"id": "tmpdeus_boss", "name": "ğŸŒ  Conclave dos Deuses Maiores", "type": "boss_local", "discovered": False},
        ]
    },
    440: {
        "world_name": "â­ Estrela Primordial Viva",
        "locations": [
            {"id": "estrela_cidade", "name": "â­ SuperfÃ­cie da Estrela Primordial", "type": "cidade", "discovered": True},
            {"id": "estrela_dungeon1", "name": "ğŸ’« CÃ¢mara do NÃºcleo Estelar Primordial", "type": "dungeon_secreta", "discovered": False},
            {"id": "estrela_dungeon2", "name": "ğŸ’« Abismo Flamejante da Estrela Viva", "type": "dungeon_secreta", "discovered": False},
            {"id": "estrela_recurso", "name": "â›ï¸ Plasma Estelar Primordial", "type": "recurso", "discovered": False},
            {"id": "estrela_boss", "name": "ğŸŒ  ConsciÃªncia da Estrela Primordial", "type": "boss_local", "discovered": False},
        ]
    },
    450: {
        "world_name": "ğŸŒŒ Abismo CÃ³smico",
        "locations": [
            {"id": "abcos_cidade", "name": "ğŸŒŒ Borda do Abismo CÃ³smico", "type": "cidade", "discovered": True},
            {"id": "abcos_dungeon1", "name": "ğŸ’« CÃ¢mara do CoraÃ§Ã£o CÃ³smico", "type": "dungeon_secreta", "discovered": False},
            {"id": "abcos_dungeon2", "name": "ğŸ’« Profundezas do Abismo CÃ³smico", "type": "dungeon_secreta", "discovered": False},
            {"id": "abcos_recurso", "name": "â›ï¸ MatÃ©ria do Abismo CÃ³smico", "type": "recurso", "discovered": False},
            {"id": "abcos_boss", "name": "ğŸŒ  Entidade do Abismo CÃ³smico", "type": "boss_local", "discovered": False},
        ]
    },
    460: {
        "world_name": "âš¡ Plasma da CriaÃ§Ã£o",
        "locations": [
            {"id": "plasma_cidade", "name": "âš¡ CÃ¢mara Central do Plasma da CriaÃ§Ã£o", "type": "cidade", "discovered": True},
            {"id": "plasma_dungeon1", "name": "ğŸ’« CÃ¢mara do Plasma Primordial", "type": "dungeon_secreta", "discovered": False},
            {"id": "plasma_dungeon2", "name": "ğŸ’« Abismo do Plasma Sombrio", "type": "dungeon_secreta", "discovered": False},
            {"id": "plasma_recurso", "name": "â›ï¸ Cristais de Plasma Puro", "type": "recurso", "discovered": False},
            {"id": "plasma_boss", "name": "ğŸŒ  Entidade do Plasma da CriaÃ§Ã£o", "type": "boss_local", "discovered": False},
        ]
    },
    470: {
        "world_name": "ğŸ”± Olimpo Transcendente",
        "locations": [
            {"id": "olimpo_cidade", "name": "ğŸ”± Ãgora do Olimpo Transcendente", "type": "cidade", "discovered": True},
            {"id": "olimpo_dungeon1", "name": "ğŸ’« CÃ¢mara dos Deuses Transcendentes", "type": "dungeon_secreta", "discovered": False},
            {"id": "olimpo_dungeon2", "name": "ğŸ’« Abismo sob o Olimpo", "type": "dungeon_secreta", "discovered": False},
            {"id": "olimpo_recurso", "name": "â›ï¸ Ambrosia Transcendente", "type": "recurso", "discovered": False},
            {"id": "olimpo_boss", "name": "ğŸŒ  PanteÃ£o do Olimpo Transcendente", "type": "boss_local", "discovered": False},
        ]
    },
    480: {
        "world_name": "ğŸ’ Cristal do Universo",
        "locations": [
            {"id": "crisuniv_cidade", "name": "ğŸ’ CÃ¢mara Central do Cristal do Universo", "type": "cidade", "discovered": True},
            {"id": "crisuniv_dungeon1", "name": "ğŸ’« CÃ¢mara do Cristal Dimensional", "type": "dungeon_secreta", "discovered": False},
            {"id": "crisuniv_dungeon2", "name": "ğŸ’« Abismo do Cristal Sombrio", "type": "dungeon_secreta", "discovered": False},
            {"id": "crisuniv_recurso", "name": "â›ï¸ Fragmentos do Cristal Universal", "type": "recurso", "discovered": False},
            {"id": "crisuniv_boss", "name": "ğŸŒ  GuardiÃ£o do Cristal do Universo", "type": "boss_local", "discovered": False},
        ]
    },
    490: {
        "world_name": "ğŸŒ  Ãpice das DimensÃµes Superiores",
        "locations": [
            {"id": "apicdim_cidade", "name": "ğŸŒ  Patamar do Ãpice Dimensional", "type": "cidade", "discovered": True},
            {"id": "apicdim_dungeon1", "name": "ğŸ’« CÃ¢mara do Ãšltimo Teste Dimensional", "type": "dungeon_secreta", "discovered": False},
            {"id": "apicdim_dungeon2", "name": "ğŸ’« Abismo do Ãpice das DimensÃµes", "type": "dungeon_secreta", "discovered": False},
            {"id": "apicdim_recurso", "name": "â›ï¸ RelÃ­quias do Ãpice Dimensional", "type": "recurso", "discovered": False},
            {"id": "apicdim_boss", "name": "ğŸŒ  Sentinela do Ãpice Dimensional", "type": "boss_local", "discovered": False},
        ]
    },
    500: {
        "world_name": "â™¾ï¸ Planos Absolutos â€” Limiar",
        "locations": [
            {"id": "limiar_cidade", "name": "â™¾ï¸ Portal do Limiar Absoluto", "type": "cidade", "discovered": True},
            {"id": "limiar_dungeon1", "name": "â™¾ï¸ CÃ¢mara do Primeiro Absoluto", "type": "dungeon_secreta", "discovered": False},
            {"id": "limiar_dungeon2", "name": "â™¾ï¸ Abismo alÃ©m do Limiar", "type": "dungeon_secreta", "discovered": False},
            {"id": "limiar_recurso", "name": "â›ï¸ MatÃ©ria do Limiar Absoluto", "type": "recurso", "discovered": False},
            {"id": "limiar_boss", "name": "âš¡ GuardiÃ£o do Limiar dos Planos Absolutos", "type": "boss_local", "discovered": False},
        ]
    },
    510: {
        "world_name": "ğŸŒ‘ Trevas Absolutas",
        "locations": [
            {"id": "trevasabs_cidade", "name": "ğŸŒ‘ RefÃºgio nas Trevas Absolutas", "type": "cidade", "discovered": True},
            {"id": "trevasabs_dungeon1", "name": "â™¾ï¸ CÃ¢mara do CoraÃ§Ã£o das Trevas", "type": "dungeon_secreta", "discovered": False},
            {"id": "trevasabs_dungeon2", "name": "â™¾ï¸ Abismo das Trevas Infinitas", "type": "dungeon_secreta", "discovered": False},
            {"id": "trevasabs_recurso", "name": "â›ï¸ Cristais das Trevas Absolutas", "type": "recurso", "discovered": False},
            {"id": "trevasabs_boss", "name": "âš¡ Senhor das Trevas Absolutas", "type": "boss_local", "discovered": False},
        ]
    },
    520: {
        "world_name": "ğŸŒŸ Luz Absoluta",
        "locations": [
            {"id": "luzabs_cidade", "name": "ğŸŒŸ CÃ¢mara Central da Luz Absoluta", "type": "cidade", "discovered": True},
            {"id": "luzabs_dungeon1", "name": "â™¾ï¸ CÃ¢mara do Brilho que Cega", "type": "dungeon_secreta", "discovered": False},
            {"id": "luzabs_dungeon2", "name": "â™¾ï¸ Abismo da Luz Sombria", "type": "dungeon_secreta", "discovered": False},
            {"id": "luzabs_recurso", "name": "â›ï¸ FotÃ³ns Absolutos Cristalizados", "type": "recurso", "discovered": False},
            {"id": "luzabs_boss", "name": "âš¡ Entidade da Luz Absoluta", "type": "boss_local", "discovered": False},
        ]
    },
    530: {
        "world_name": "âš–ï¸ EquilÃ­brio Primordial",
        "locations": [
            {"id": "equil_cidade", "name": "âš–ï¸ SantuÃ¡rio do EquilÃ­brio Primordial", "type": "cidade", "discovered": True},
            {"id": "equil_dungeon1", "name": "â™¾ï¸ CÃ¢mara do EquilÃ­brio Rompido", "type": "dungeon_secreta", "discovered": False},
            {"id": "equil_dungeon2", "name": "â™¾ï¸ Abismo do DesequilÃ­brio Eterno", "type": "dungeon_secreta", "discovered": False},
            {"id": "equil_recurso", "name": "â›ï¸ Cristais do EquilÃ­brio Absoluto", "type": "recurso", "discovered": False},
            {"id": "equil_boss", "name": "âš¡ GuardiÃ£o do EquilÃ­brio Primordial", "type": "boss_local", "discovered": False},
        ]
    },
    540: {
        "world_name": "ğŸ”¥ Chama Eterna",
        "locations": [
            {"id": "chama_cidade", "name": "ğŸ”¥ CÃ¢mara da Chama Eterna", "type": "cidade", "discovered": True},
            {"id": "chama_dungeon1", "name": "â™¾ï¸ CÃ¢mara do Fogo Primordial", "type": "dungeon_secreta", "discovered": False},
            {"id": "chama_dungeon2", "name": "â™¾ï¸ Abismo da Chama Negra", "type": "dungeon_secreta", "discovered": False},
            {"id": "chama_recurso", "name": "â›ï¸ Brasas da Chama Eterna", "type": "recurso", "discovered": False},
            {"id": "chama_boss", "name": "âš¡ EspÃ­rito da Chama Eterna", "type": "boss_local", "discovered": False},
        ]
    },
    550: {
        "world_name": "ğŸŒŠ Oceano Primordial",
        "locations": [
            {"id": "oceanprim_cidade", "name": "ğŸŒŠ SuperfÃ­cie do Oceano Primordial", "type": "cidade", "discovered": True},
            {"id": "oceanprim_dungeon1", "name": "â™¾ï¸ CÃ¢mara das Profundezas Primordiais", "type": "dungeon_secreta", "discovered": False},
            {"id": "oceanprim_dungeon2", "name": "â™¾ï¸ Abismo do Oceano AlÃ©m do Tempo", "type": "dungeon_secreta", "discovered": False},
            {"id": "oceanprim_recurso", "name": "â›ï¸ Ãgua Primordial Cristalizada", "type": "recurso", "discovered": False},
            {"id": "oceanprim_boss", "name": "âš¡ LeviatÃ£ do Oceano Primordial", "type": "boss_local", "discovered": False},
        ]
    },
    560: {
        "world_name": "ğŸ’¨ Vento do Fim dos Tempos",
        "locations": [
            {"id": "vento_cidade", "name": "ğŸ’¨ Olho do Vento do Fim dos Tempos", "type": "cidade", "discovered": True},
            {"id": "vento_dungeon1", "name": "â™¾ï¸ CÃ¢mara das Correntes do Fim", "type": "dungeon_secreta", "discovered": False},
            {"id": "vento_dungeon2", "name": "â™¾ï¸ Abismo do Vento Eterno", "type": "dungeon_secreta", "discovered": False},
            {"id": "vento_recurso", "name": "â›ï¸ Ar Cristalizado do Fim dos Tempos", "type": "recurso", "discovered": False},
            {"id": "vento_boss", "name": "âš¡ EspÃ­rito do Vento do Fim", "type": "boss_local", "discovered": False},
        ]
    },
    570: {
        "world_name": "âš¡ TrovÃ£o da Origem",
        "locations": [
            {"id": "trovaorig_cidade", "name": "âš¡ Epicentro do TrovÃ£o da Origem", "type": "cidade", "discovered": True},
            {"id": "trovaorig_dungeon1", "name": "â™¾ï¸ CÃ¢mara do Primeiro RelÃ¢mpago", "type": "dungeon_secreta", "discovered": False},
            {"id": "trovaorig_dungeon2", "name": "â™¾ï¸ Abismo do TrovÃ£o Primordial", "type": "dungeon_secreta", "discovered": False},
            {"id": "trovaorig_recurso", "name": "â›ï¸ Cristais do TrovÃ£o da Origem", "type": "recurso", "discovered": False},
            {"id": "trovaorig_boss", "name": "âš¡ Entidade do TrovÃ£o da Origem", "type": "boss_local", "discovered": False},
        ]
    },
    580: {
        "world_name": "ğŸŒŒ Vazio AlÃ©m do Vazio",
        "locations": [
            {"id": "vaziabs_cidade", "name": "ğŸŒŒ Borda do Vazio AlÃ©m do Vazio", "type": "cidade", "discovered": True},
            {"id": "vaziabs_dungeon1", "name": "â™¾ï¸ CÃ¢mara do SilÃªncio Absoluto", "type": "dungeon_secreta", "discovered": False},
            {"id": "vaziabs_dungeon2", "name": "â™¾ï¸ Abismo alÃ©m do Nada", "type": "dungeon_secreta", "discovered": False},
            {"id": "vaziabs_recurso", "name": "â›ï¸ MatÃ©ria do PrÃ©-Vazio", "type": "recurso", "discovered": False},
            {"id": "vaziabs_boss", "name": "âš¡ O Vazio em Pessoa", "type": "boss_local", "discovered": False},
        ]
    },
    590: {
        "world_name": "â™¾ï¸ O Plano Absoluto Final",
        "locations": [
            {"id": "planofinal_cidade", "name": "â™¾ï¸ CÃ¢mara do Plano Absoluto Final", "type": "cidade", "discovered": True},
            {"id": "planofinal_dungeon1", "name": "â™¾ï¸ CÃ¢mara do Ãšltimo Teste da ExistÃªncia", "type": "dungeon_secreta", "discovered": False},
            {"id": "planofinal_dungeon2", "name": "â™¾ï¸ Abismo Final â€” AlÃ©m de Todo Conceito", "type": "dungeon_secreta", "discovered": False},
            {"id": "planofinal_recurso", "name": "â›ï¸ Fragmentos do Absoluto Final", "type": "recurso", "discovered": False},
            {"id": "planofinal_boss", "name": "âš¡ O Absoluto â€” Boss Final do Plano Absoluto", "type": "boss_local", "discovered": False},
        ]
    },

}

# ================= NOVOS NPCs COM LORE =================
WORLD_NPCS_EXTRA = {
    1: [
        {
            "name": "SÃ¡bio Pell",
            "role": "Historiador dos Campos",
            "emoji": "ğŸ“œ",
            "dialogues": [
                "Estudei os Campos por 40 anos. Cada pedra aqui Ã© uma pÃ¡gina de histÃ³ria.",
                "Sabia que o primeiro herÃ³i que passou por aqui era uma cozinheira? Ela matou o Slime Rei com uma frigideira.",
                "Os slimes tÃªm memÃ³ria coletiva. Quando vocÃª mata um, os outros sentem. Por isso ficam mais agressivos.",
                "Encontrei inscriÃ§Ãµes de 3.000 anos atrÃ¡s naquelas pedras. Dizem que 'o herÃ³i verdadeiro virÃ¡ dos campos'. Poderia ser vocÃª.",
                "Minha teoria: este campo foi um campo de batalha divino. Os slimes sÃ£o cicatrizes da guerra.",
            ]
        },
        {
            "name": "CrianÃ§a Miko",
            "role": "Garoto Curioso",
            "emoji": "ğŸ‘¦",
            "dialogues": [
                "VocÃª Ã© um aventureiro de verdade?! Isso Ã© incrÃ­vel! Quando crescer, vou ser como vocÃª!",
                "Vi um slime comer uma pedra inteira ontem. Por que eles comem pedra?",
                "Minha mÃ£e diz para nÃ£o falar com estranhos. Mas vocÃª nÃ£o parece estranho... parece Ã‰PICO!",
                "Encontrei uma moeda dourada no campo. Papai disse que pertencia a um herÃ³i antigo. Posso te mostrar?",
                "Ã€s vezes ouÃ§o o campo sussurrar Ã  noite. Papai diz que Ã© o vento. Mas eu sei que nÃ£o Ã©.",
            ]
        },
    ],
    10: [
        {
            "name": "EspÃ­rito AnciÃ£o Vel",
            "role": "GuardiÃ£o Espectral",
            "emoji": "ğŸ‘»",
            "dialogues": [
                "Morri aqui hÃ¡ 800 anos. A floresta me manteve aqui para guardar um segredo.",
                "O Ent e eu somos velhos amigos. Ele estava aqui antes de mim. E estarÃ¡ depois.",
                "HÃ¡ uma chave enterrada sob a Ã¡rvore maior. NÃ£o a procure ainda. VocÃª ainda nÃ£o estÃ¡ pronto.",
                "Na vida, fui guerreiro. Na morte, aprendi que a paz verdadeira nÃ£o vem da vitÃ³ria, mas da compreensÃ£o.",
                "Se vocÃª ouvir a floresta cantar Ã  meia-noite, nÃ£o responda. Nunca responda.",
            ]
        },
        {
            "name": "Bruxo das RaÃ­zes",
            "role": "MÃ­stico da Floresta",
            "emoji": "ğŸ§™",
            "dialogues": [
                "Cada Ã¡rvore desta floresta Ã© uma palavra num livro que nenhum humano escreveu.",
                "Posso ler seu destino nas raÃ­zes expostas. Quer ouvir? Cuidado â€” a verdade pesa.",
                "Os goblins nÃ£o sÃ£o maus por natureza. SÃ£o o reflexo de como os humanos os trataram.",
                "HÃ¡ 300 anos, esta floresta era um jardim celestial. O que aconteceu? Os deuses discordaram.",
                "Vejo em vocÃª algo que nÃ£o via hÃ¡ geraÃ§Ãµes. Uma chama que nÃ£o se apaga com facilidade.",
            ]
        },
    ],
    20: [
        {
            "name": "Fantasma do General",
            "role": "EspÃ­rito Guerreiro",
            "emoji": "âš”ï¸",
            "dialogues": [
                "Lutei na Ãºltima guerra do Deserto. Mil anos atrÃ¡s. Ainda nÃ£o sei quem venceu.",
                "A areia guarda os mortos melhor que qualquer tÃºmulo. Cada duna Ã© um cemitÃ©rio.",
                "O FaraÃ³ Kha-Mentu era meu general. Ele nÃ£o merecia o que fizeram com ele.",
                "HÃ¡ uma espada enterrada a 30 metros de profundidade aqui perto. Ela espera por alguÃ©m digno.",
                "No calor mais forte, quando a miragem aparece, olhe nos olhos dela. Ela mostra o futuro.",
            ]
        },
        {
            "name": "Mercante Ib",
            "role": "Comerciante NÃ´made",
            "emoji": "ğŸª",
            "dialogues": [
                "Viajei por todos os sete reinos. Este deserto Ã© o mais honesto â€” ele mata com calor, sem subterfÃºgios.",
                "JÃ¡ vendi uma estrela embalsamada uma vez. O cliente nunca descobriu que era falsa. Ou descobriu e nÃ£o se importou.",
                "O mercado das almas estÃ¡ trÃªs dunas ao norte. NÃ£o compre nada lÃ¡ que vocÃª nÃ£o possa pagar com algo alÃ©m de ouro.",
                "Ouvi que o FaraÃ³ Kha-Mentu tem uma cÃ¢mara com mapas de reinos que ainda nÃ£o existem.",
                "O escorpiÃ£o que te pica hoje pode salvar sua vida amanhÃ£. Aprendi isso do jeito difÃ­cil.",
            ]
        },
    ],
    30: [
        {
            "name": "Vidente das Neves",
            "role": "OrÃ¡culo das Montanhas",
            "emoji": "ğŸ”®",
            "dialogues": [
                "Vejo trÃªs futuros possÃ­veis para vocÃª. Todos difÃ­ceis. Um deles Ã© glorioso.",
                "O Yeti chorou uma vez. Eu vi. As lÃ¡grimas congelaram antes de chegar ao chÃ£o.",
                "Os TitÃ£s do Gelo me ensinaram que o frio nÃ£o mata â€” a resistÃªncia a ele sim.",
                "HÃ¡ uma crianÃ§a que vai mudar este mundo. Ela jÃ¡ nasceu. VocÃª pode ter passado por ela.",
                "Quando a montanha cantar, trÃªs vezes, em noite sem lua â€” Ã© hora do prÃ³ximo ciclo comeÃ§ar.",
            ]
        },
    ],
    40: [
        {
            "name": "AnÃ£o Sobrevivente Krug",
            "role": "Ãšltimo dos Forjadores",
            "emoji": "âš’ï¸",
            "dialogues": [
                "Sou o Ãºltimo da minha linhagem. Os outros se fundiram com Ignarius voluntariamente. Fui covarde. Sobrevivi.",
                "A Forja Sagrada nÃ£o estÃ¡ apagada â€” estÃ¡ esperando. Ela reconhece quem Ã© digno.",
                "Aprendi 12 segredos de forja que nenhum humano conhece. Morrerei com eles... a menos que prove ser digno.",
                "O DragÃ£o de Magma guarda as memÃ³rias da minha civilizaÃ§Ã£o. Quando vocÃª o derrotar... escute o rugido. HÃ¡ palavras lÃ¡.",
                "Fiz a espada mais perfeita do mundo uma vez. EntÃ£o a destruÃ­. NÃ£o havia ninguÃ©m digno de empunhÃ¡-la.",
            ]
        },
    ],
    50: [
        {
            "name": "Ex-Entidade do Vazio",
            "role": "Ser Primordial Aposentado",
            "emoji": "ğŸŒŒ",
            "dialogues": [
                "Existia antes do universo. Decidi me tornar mortal para entender o que Ã© ser frÃ¡gil. Arrependo? Ã€s vezes.",
                "O Senhor das Sombras Ã© meu irmÃ£o mais novo. Ele nunca entendeu que o vazio nÃ£o Ã© casa â€” Ã© solidÃ£o.",
                "Cada pensamento que vocÃª tem ecoa no Abismo por eternidades. Pense com cuidado.",
                "Vi o fim do universo em uma visÃ£o. NÃ£o era trÃ¡gico. Era... tranquilo. Como dormir.",
                "Se quiser falar com os mortos, o Abismo tem um bairro deles. Mas eles cobram memÃ³rias como entrada.",
            ]
        },
    ],
    60: [
        {
            "name": "Alma de HerÃ³i",
            "role": "EspÃ­rito de Aventureiro LendÃ¡rio",
            "emoji": "â­",
            "dialogues": [
                "Cheguei onde vocÃª estÃ¡. Passei pelo teste. O Imperador me perguntou o que eu mais queria. Disse 'nada'. E recebi tudo.",
                "O Trono nÃ£o Ã© um lugar. Ã‰ um estado de ser. VocÃª nÃ£o SOBE ao Trono. VocÃª SE TORNA o Trono.",
                "Meu maior erro foi achar que chegaria aqui mais forte. Na verdade, cheguei mais humano.",
                "HÃ¡ segredos alÃ©m do Trono que nem eu conheÃ§o. E estou aqui hÃ¡ 1.000 anos.",
                "O Imperador nÃ£o quer ser derrotado. Quer ser compreendido. HÃ¡ diferenÃ§a.",
            ]
        },
        {
            "name": "Arquiteto do Cosmos",
            "role": "Construtor do Universo",
            "emoji": "ğŸŒŒ",
            "dialogues": [
                "ConstruÃ­ este universo peÃ§a por peÃ§a. NÃ£o Ã© perfeito. Nenhuma criaÃ§Ã£o Ã©.",
                "Coloquei propositalmente as imperfeiÃ§Ãµes. Sem elas, nÃ£o haveria herÃ³is â€” nÃ£o haveria histÃ³ria.",
                "VocÃª chegou ao fim do mapa. Mas o mapa Ã© menor que o territÃ³rio.",
                "Vejo tudo que foi, Ã© e serÃ¡. E ainda assim, vocÃª me surpreende.",
                "Quando terminar aqui, se quiser, posso mostrar o que existe alÃ©m deste universo. A escolha Ã© sua.",
            ]
        },
    ]
}

# ================= NOVOS EVENTS EXPANDIDOS POR REINO =================
WORLD_EVENTS_EXTRA = {
    1: [
        "Um mercador suspeito oferece uma 'maÃ§Ã£ encantada' de graÃ§a. VocÃª aceita?",
        "Uma borboleta gigante te guia atÃ© um baÃº escondido no campo.",
        "VocÃª escorrega em um slime invisÃ­vel e cai no chÃ£o. Constrangedor.",
        "Uma velha anuncia que vocÃª Ã© 'o escolhido'. Mas ela diz isso para todos.",
        "Um slime se apega Ã  sua bota e nÃ£o larga. Parece estar te adotando.",
        "VocÃª encontra um mapa antigo rasgado pela metade.",
        "Uma fada minÃºscula te cutuca insistentemente apontando para uma direÃ§Ã£o.",
        "O vento traz o cheiro de uma batalha recente. Sangue e magia.",
        "VocÃª tropeÃ§a em uma pedra que ressoa como um sino ao ser tocada.",
        "Um corvo negro te segue por uma hora e depois desaparece.",
        "Uma crianÃ§a te pede para desenhar um mapa. VocÃª descobre um local novo.",
        "O chÃ£o balanÃ§a levemente â€” algo grande se move sob a terra.",
        "VocÃª encontra as cinzas de uma fogueira recente com sÃ­mbolos ao redor.",
        "Uma voz na sua cabeÃ§a diz 'olhe para cima'. No cÃ©u, forma de dragÃ£o nas nuvens.",
        "Um aventureiro mais experiente te dÃ¡ um conselho vago mas profundo.",
        "VocÃª acha um espelho partido. Reflete algo diferente do que estÃ¡ na sua frente.",
        "Uma erva rara brilha ao seu pÃ©. Parece Ãºtil para poÃ§Ãµes.",
        "Uma estÃ¡tua quebrada aponta na direÃ§Ã£o de uma dungeon desconhecida.",
        "Uma crianÃ§a corre atÃ© vocÃª com uma mensagem: 'NÃ£o confie em ninguÃ©m de capuz hoje'.",
        "O cÃ©u fica vermelho por um instante. O narrador nÃ£o explica por quÃª.",
    ],
    10: [
        "A floresta para completamente. Nenhum som. Por 30 segundos. EntÃ£o retorna.",
        "VocÃª ouve uma melodia linda vindo de lugar nenhum. Faz vocÃª sentir saudade de algo que nunca teve.",
        "Musgo cresce visivelmente enquanto vocÃª observa. A floresta estÃ¡ respondendo a vocÃª.",
        "Uma aranha do tamanho da sua cabeÃ§a te olha fixamente. Depois vai embora. Sem atacar.",
        "VocÃª encontra uma Ã¡rvore com nomes gravados. O Ãºltimo nome Ã© o seu.",
        "Folhas caem em padrÃ£o perfeitamente geomÃ©trico ao seu redor.",
        "Um ent jovem te estuda de longe com curiosidade antes de recuar.",
        "VocÃª descobre uma cabana abandonada com comida ainda fresca.",
        "BioluminescÃªncia ilumina seu caminho na escuridÃ£o da floresta.",
        "Um espÃ­rito triste te pede para entregar uma mensagem a alguÃ©m jÃ¡ morto.",
        "A floresta parece menor do que deveria. Como se algo a comprimisse.",
        "VocÃª encontra penas negras formando uma seta no chÃ£o.",
        "Um riacho subterrÃ¢neo burburinha com algo que parece palavras.",
        "Uma formaÃ§Ã£o de cogumelos forma um cÃ­rculo perfeito. Centro parece mais escuro.",
        "VocÃª acha armadilha de caÃ§ador humano. Para que tipo de criatura?",
        "Frutos estranhos caem de uma Ã¡rvore ao seu passar. Cheiram bem demais.",
        "Uma nÃ©voa roxa surge do chÃ£o e desaparece em segundos.",
        "VocÃª ouve risadas de crianÃ§as mas nÃ£o hÃ¡ ninguÃ©m.",
        "Uma serpente enorme cruza seu caminho sem te atacar. Ela carrega algo na boca.",
        "O sol entra pela copa das Ã¡rvores formando a silhueta de uma espada no chÃ£o.",
    ],
}

# ================= QUESTS EXTRAS COM MUITO XP =================
QUESTS_EXTRA = {
    1: [
        {
            "id": "campos_bonus_001",
            "name": "â­ O Grande Teste dos Campos",
            "description": "O SÃ¡bio Pell te desafia: cace 10 monstros diferentes, colete 10 recursos e explore 5 vezes â€” tudo para provar que Ã© um aventureiro completo.",
            "type": "individual", "objective": "hunt", "target": None,
            "count": 10, "reward_xp": 3000, "reward_coins": 100, "reward_item": "PoÃ§Ã£o de XP Maior",
            "lore": "Pell registra cada herÃ³i que passa pelos campos. Poucos completam o teste. VocÃª vai tentar?",
            "npc": "SÃ¡bio Pell", "difficulty": "Ã‰pico"
        },
    ],
    10: [
        {
            "id": "floresta_bonus_001",
            "name": "ğŸŒ² Pacificador da Floresta",
            "description": "Derrote 15 monstros da floresta para reduzir a agressividade das criaturas e restaurar o equilÃ­brio.",
            "type": "individual", "objective": "hunt", "target": None,
            "count": 15, "reward_xp": 5000, "reward_coins": 80, "reward_item": "Armadura Ã‰lfica",
            "lore": "A floresta estÃ¡ em desequilÃ­brio. Cada monstro que cai restaura um pouco da paz perdida.",
            "npc": "EspÃ­rito AnciÃ£o Vel", "difficulty": "Muito DifÃ­cil"
        },
    ],
    20: [
        {
            "id": "deserto_bonus_001",
            "name": "ğŸº Historiador do Deserto",
            "description": "Colete 20 recursos Ãºnicos do deserto para o museu ambulante do mercante Ib.",
            "type": "individual", "objective": "collect", "count": 20,
            "reward_xp": 6000, "reward_coins": 60, "reward_item": "PoÃ§Ã£o de XP Maior",
            "lore": "Ib coleta a histÃ³ria do deserto. Cada artefato Ã© uma memÃ³ria de civilizaÃ§Ãµes perdidas.",
            "npc": "Mercante Ib", "difficulty": "Ã‰pico"
        },
    ],
    30: [
        {
            "id": "gelo_bonus_001",
            "name": "â„ï¸ Conquistador das Alturas",
            "description": "Explore 10 vezes as Montanhas Geladas e descubra todos os segredos que elas escondem.",
            "type": "individual", "objective": "explore", "count": 10,
            "reward_xp": 7000, "reward_coins": 50, "reward_item": "Elixir de XP",
            "lore": "As montanhas revelam seus segredos apenas aos mais persistentes.",
            "npc": "Vidente das Neves", "difficulty": "Muito DifÃ­cil"
        },
    ],
    40: [
        {
            "id": "vulcao_bonus_001",
            "name": "ğŸ”¥ Herdeiro dos Forjadores",
            "description": "Colete 25 recursos do Reino VulcÃ¢nico para reconstruir a Forja Sagrada dos anÃµes.",
            "type": "individual", "objective": "collect", "count": 25,
            "reward_xp": 9000, "reward_coins": 40, "reward_item": "Martelo do TrovÃ£o",
            "lore": "Krug acredita que vocÃª pode restaurar o legado dos forjadores. Prove a ele.",
            "npc": "AnÃ£o Sobrevivente Krug", "difficulty": "LendÃ¡rio"
        },
    ],
    50: [
        {
            "id": "abismo_bonus_001",
            "name": "ğŸŒ€ Sobrevivente do Vazio",
            "description": "Explore o Abismo Arcano 15 vezes e retorne sempre. A maioria nÃ£o consegue.",
            "type": "individual", "objective": "explore", "count": 15,
            "reward_xp": 12000, "reward_coins": 30, "reward_item": "Cetro da Eternidade",
            "lore": "A Ex-Entidade do Vazio diz: 'Voltar do Abismo vivo 15 vezes significa que o universo ainda precisa de vocÃª.'",
            "npc": "Ex-Entidade do Vazio", "difficulty": "MÃ­tico"
        },
    ],
    60: [
        {
            "id": "celestial_bonus_001",
            "name": "ğŸ‘‘ A Saga Completa",
            "description": "Cace 20 guardiÃµes celestiais para provar que chegou ao Trono como lenda viva.",
            "type": "individual", "objective": "hunt", "target": None,
            "count": 20, "reward_xp": 25000, "reward_coins": 20, "reward_item": "Armadura do Primeiro Deus",
            "lore": "A Alma de HerÃ³i diz: 'A saga completa de um herÃ³i nÃ£o se mede em batalhas. Se mede em escolhas.'",
            "npc": "Alma de HerÃ³i", "difficulty": "Primordial"
        },
    ],
}

# ================= LIVROS DE LORE =================
LORE_BOOKS = {
    1: [
        {
            "title": "ğŸ“– CrÃ´nicas dos Campos â€” Vol. I",
            "content": """*PÃ¡ginas amareladas, mas legÃ­veis...*

**'A Origem dos Sete Reinos'**

No princÃ­pio, havia apenas o Vazio â€” um silÃªncio perfeito e eterno.
EntÃ£o, a Primeira Chama surgiu do nada, e com ela nasceu o Mundo.

Os Campos Iniciais foram o primeiro solo a se solidificar das cinzas da criaÃ§Ã£o.
Aqui, os primeiros seres vivos deram seus primeiros passos trÃªmulos.

Os antigos chamavam este lugar de 'BerÃ§o' â€” pois todo herÃ³i, 
independente de sua grandeza futura, comeÃ§a aqui.

*'O guerreiro mais poderoso que existiu comeÃ§ou matando um slime,'* 
dizia o SÃ¡bio Aldren. *'NÃ£o se envergonhe do seu comeÃ§o.'*

â€” CrÃ´nicas dos Campos, escrito pelo Historiador Pell, Ano 1 da Nova Era"""
        },
        {
            "title": "ğŸ“– DiÃ¡rio de um Aventureiro",
            "content": """*Rabiscado Ã s pressas em tinta quase seca...*

**Dia 1:**
Cheguei aos Campos. Parece simples demais para ser perigoso.
Estava errado. Um coelho me mordeu.

**Dia 7:**
Encontrei outros aventureiros. Formamos um grupo.
Derrotamos o Slime Rei juntos. Nunca me senti tÃ£o vivo.

**Dia 15:**
A Floresta Sombria chama. Dizem que os que entram mudam para sempre.
Vou descobrir por quÃª.

*â€” Assinado: 'O HerÃ³i Sem Nome', encontrado nos Campos Iniciais*"""
        }
    ],
    10: [
        {
            "title": "ğŸ“– Sussurros da Floresta â€” Tomo Antigo",
            "content": """*Escrito em folhas de Ã¡rvore, palavras que parecem vivas...*

**'A Floresta que Respira'**

A Floresta Sombria nÃ£o Ã© apenas uma floresta.
Ela Ã© um ser vivo, consciente, e muito, muito antiga.

O Ent AnciÃ£o que habita seu coraÃ§Ã£o tem 3.000 anos de memÃ³ria.
Ele viu o mundo mudar, viu reinos nascer e morrer.

*Dizem os druidas que quem escuta a floresta com o coraÃ§Ã£o aberto 
pode ouvir ela contar histÃ³rias do tempo em que os dragÃµes ainda 
voavam livres sobre todos os reinos.*

Mas cuidado â€” a floresta tambÃ©m ouve vocÃª.
E ela lembra de tudo.

â€” Coletado pelo Druida Sylvara, GuardiÃ£ da Floresta"""
        }
    ],
    20: [
        {
            "title": "ğŸ“– HierÃ³glifos Traduzidos â€” Fragmento VII",
            "content": """*TraduÃ§Ã£o de hierÃ³glifos encontrados em uma pirÃ¢mide semi-enterrada...*

**'O Testamento do FaraÃ³ Kha-Mentu'**

Eu, Kha-Mentu, FaraÃ³ da DÃ©cima Dinastia, escrevo isto em minha Ãºltima hora.

Meus sacerdotes me traÃ­ram. Eles queriam o Olho de Ra para si mesmos.
LanÃ§aram sobre mim uma maldiÃ§Ã£o: guardar meus prÃ³prios tesouros por toda eternidade.

Mas hÃ¡ uma saÃ­da. O Olho de Ra ainda pulsa no centro da Grande PirÃ¢mide.
Aquele que o recuperar pode quebrar qualquer maldiÃ§Ã£o.

*Procure o herÃ³i que vier depois de mim. Diga-lhe: o segredo estÃ¡ 
onde o sol nunca brilha â€” mas a verdade sempre ilumina.*

â€” Kha-Mentu, FaraÃ³ Eterno, condenado a aguardar"""
        }
    ],
    30: [
        {
            "title": "ğŸ“– CanÃ§Ãµes do Gelo â€” Manuscrito",
            "content": """*Escrito em pergaminho congelado, as palavras tremem...*

**'A Balada do Yeti'**

Nem sempre o Yeti foi uma besta selvagem.

HÃ¡ mil anos, Krom era um guardiÃ£o gentil das montanhas,
criado pelos TitÃ£s do Gelo para proteger o Cristal do Inverno Eterno.

EntÃ£o vieram os primeiros humanos, gananciosos e ignorantes.
Eles tentaram roubar o Cristal para vender seu poder.

Krom os deteve â€” mas algo quebrou dentro dele naquele dia.
O guardiÃ£o gentil tornou-se a besta que todos temem agora.

*O Cristal do Inverno Eterno ainda estÃ¡ lÃ¡, no coraÃ§Ã£o da montanha.
Ainda aguarda um guardiÃ£o digno.*

â€” Cantado pelos Bardos das Montanhas, transmitido oralmente por geraÃ§Ãµes"""
        }
    ],
    40: [
        {
            "title": "ğŸ“– TÃ¡buas de Pedra VulcÃ¢nica â€” TranscriÃ§Ã£o",
            "content": """*Gravado em pedra por mÃ£os que suportaram o calor das chamas...*

**'A Origem do Fogo'**

No segundo dia apÃ³s a criaÃ§Ã£o do mundo, a Primeira Chama se dividiu.

Uma parte tornou-se o sol.
Outra parte afundou nas profundezas e tornou-se o magma.
A terceira parte... tomou forma. Tornou-se Ignarius.

O DragÃ£o de Magma nÃ£o Ã© uma criatura â€” Ã© um elemento.
TÃ£o fundamental quanto Ã¡gua, terra e ar.

*Matar Ignarius nÃ£o destrÃ³i o fogo. Apenas o libera de sua forma.
Mas poucos compreendem isto antes de ser tarde demais.*

â€” Profeta Ignar, GuardiÃ£o da Chama Primordial"""
        }
    ],
    50: [
        {
            "title": "ğŸ“– Fragmentos do Vazio â€” Texto Corrompido",
            "content": """*As palavras parecem se mover enquanto vocÃª lÃª...*

**'O Que Existe Antes do ComeÃ§o'**

[TEXTO PARCIALMENTE ILEGÃVEL]

...antes dos deuses, havia o Vazio...
...o Senhor das Sombras nÃ£o Ã© o vilÃ£o desta histÃ³ria...
...ele apenas quer voltar para casa...
...o 'lar' dele Ã© o nada absoluto...
...e se ele conseguir, tudo que existe...

[TEXTO RASGADO]

...a Ãºnica forma de detÃª-lo Ã© mostrar-lhe que a existÃªncia...
...vale mais que o silÃªncio do vazio...

[FIM DO FRAGMENTO]

*Nota da BibliotecÃ¡ria Spectra: 'Leiam com cuidado. Este texto muda quem o lÃª.'*"""
        }
    ],
    60: [
        {
            "title": "ğŸ“– O Livro do Destino â€” PÃ¡gina Final",
            "content": """*Este livro parece ter sido escrito para vocÃª especificamente...*

**'A Profecia do HerÃ³i Final'**

HaverÃ¡ um dia em que o Trono Celestial receberÃ¡ um mortal.

NÃ£o um deus. NÃ£o um anjo. Um ser que comeÃ§ou nos Campos,
que sangrou na Floresta, que queimou no VulcÃ£o,
que sobreviveu ao Abismo â€” e que chegou aqui.

O Imperador Astral nÃ£o Ã© um inimigo.
Ele Ã© o Ãºltimo teste antes da ascensÃ£o.

*'O verdadeiro poder nÃ£o Ã© destruir os outros.
Ã‰ ter o poder de destruir e escolher nÃ£o fazÃª-lo.'*

O Trono aguarda.
A histÃ³ria foi escrita.
Apenas vocÃª pode decidir como ela termina.

â€” O Livro do Destino, autor desconhecido, data desconhecida"""
        },
        {
            "title": "ğŸ“– MemÃ³rias dos Deuses â€” Tomo Proibido",
            "content": """*As pÃ¡ginas brilham com luz sobrenatural...*

**'O Que os Deuses Temem'**

Os deuses nÃ£o sÃ£o imortais. SÃ£o apenas muito, muito velhos.

O Imperador Astral sabe disso. Por isso ele testa os mortais â€”
buscando aquele que possa um dia carregÃ¡-lo
quando ele mesmo estiver pronto para descansar.

HÃ¡ segredos que os deuses escondem:
â€” O Primeiro Deus nÃ£o criou o universo. Ele *encontrou* ele.
â€” A morte nÃ£o Ã© o fim. Ã‰ uma porta. Mas nem todos sabem abri-la.
â€” O verdadeiro nome do Vazio Ã© amor. Um amor que consumiu tudo.

*'Se vocÃª leu atÃ© aqui, vocÃª jÃ¡ nÃ£o Ã© mais o mesmo.'*

â€” Arquivos da Biblioteca Celestial, acesso nÃ­vel Divino"""
        },
        {
            "title": "ğŸ“– CrÃ´nicas da Guerra Primordial",
            "content": """*Escrito em luz solidificada, impossÃ­vel de destruir...*

**'A Batalha Antes do Tempo'**

Antes que o universo existisse, houve uma guerra.

De um lado: a Luz Primordial, que queria existÃªncia, forma, vida.
Do outro: o Vazio Eterno, que queria silÃªncio, paz, nada.

Eles lutaram por uma eternidade que nÃ£o tinha nome ainda.

A batalha terminou sem vencedor â€” ambos exaustos,
fizeram um acordo: criariam algo novo.
Algo que contivesse os dois.

Chamaram isso de *Universo*.

E plantaram dentro de cada ser vivo uma centelha de cada lado.
Ã‰ por isso que todo ser carrega tanto amor quanto destruiÃ§Ã£o.

*A guerra nÃ£o terminou. Apenas mudou de palco.*

â€” Fragmento encontrado no 'AlÃ©m do Trono'"""
        }
    ]
}

# ================= LIVROS DE LORE EXTRAS (por mundo) =================
LORE_BOOKS_EXTRA = {
    1: [
        {
            "title": "ğŸ“– O BestiÃ¡rio dos Campos â€” CapÃ­tulo I",
            "content": """*IlustraÃ§Ãµes detalhadas e notas Ã  margem...*

**'Sobre os Slimes'**

Os slimes sÃ£o os seres mais mal compreendidos dos Campos.

Eles nÃ£o sÃ£o criaturas â€” sÃ£o memÃ³rias.
Cada slime Ã© formado quando uma emoÃ§Ã£o humana intensa Ã© derramada no solo:
lÃ¡grimas, sangue, esperanÃ§a, desespero.

O Slime Rei Ã© formado das memÃ³rias de centenas de herÃ³is que falharam.
Ele nÃ£o Ã© mal. Ele Ã© *acumulado*.

*'Olhe nos olhos de um slime. VocÃª pode ver algo familiar?'*

Por isso matar um slime Ã© sempre um pouco triste.
VocÃª estÃ¡ apagando uma memÃ³ria do mundo.

â€” Naturalista Pell, Campos Iniciais, Ano 23"""
        },
        {
            "title": "ğŸ“– Cartas Para NinguÃ©m â€” Vol. 1",
            "content": """*Cartas sem destinatÃ¡rio, amarradas com fita vermelha...*

**Carta #1:**
*'Para quem vier depois de mim,'*

Eu estava onde vocÃª estÃ¡ agora. Com medo, sem saber nada.
Matei meu primeiro slime e quase chorei. Parece ridÃ­culo agora.

Saiba: cada derrota Ã© um professor rigoroso.
Cada cicatriz Ã© um capÃ­tulo da sua histÃ³ria.

Quando vocÃª chegar ao Trono Celestial
(e vocÃª chegarÃ¡, se persistir),
olhe para trÃ¡s e lembre do primeiro slime.

*'Quem ri do comeÃ§o humilde nÃ£o entende de grandeza.'*

Com amor,
â€” Um aventureiro que passou por aqui antes"""
        }
    ],
    10: [
        {
            "title": "ğŸ“– O GrimÃ³rio da Floresta â€” PÃ¡gina Arrancada",
            "content": """*Manchas de seiva verde nas bordas rasgadas...*

**'Os Segredos das Trevas Verdes'**

A Floresta Sombria tem trÃªs camadas.

**A Primeira:** onde os aventureiros entram. Com goblins, aranhas, perigos visÃ­veis.
**A Segunda:** onde apenas os experientes chegam. Os espÃ­ritos moram aqui.
**A Terceira:** onde ninguÃ©m volta. LÃ¡ fica o coraÃ§Ã£o da floresta.

No coraÃ§Ã£o existe uma Ã¡rvore tÃ£o antiga que seus galhos tocam outros mundos.
Seus frutos concedem visÃµes do passado e do futuro.

*Um fruto faz vocÃª ver tudo que jÃ¡ foi.*
*O outro, tudo que ainda serÃ¡.*
*O terceiro... ninguÃ©m sabe. NinguÃ©m comeu e se lembrou.*

â€” Druida Vel, desaparecido"""
        },
        {
            "title": "ğŸ“– DiÃ¡rio da Druida Sylvara â€” Entradas Escolhidas",
            "content": """*Escrito com tinta feita de seiva e terra...*

**Entrada 47:**
O Ent AnciÃ£o falou comigo hoje. Em 30 anos, Ã© a segunda vez.

Ele disse: *'A floresta sangra.'*

Perguntei por quÃª. Ele disse: *'Porque os humanos esqueceram como ouvir.'*

Fiquei em silÃªncio por um longo tempo.

Depois ele disse algo que nÃ£o consigo parar de pensar:
*'NÃ£o temo o fogo, nem o machado. Temo o esquecimento.
Porque uma Ã¡rvore que ninguÃ©m lembra jamais existiu.'*

**Entrada 89:**
Hoje um aventureiro perguntou se a floresta Ã© perigosa.
Respondi: *'A floresta Ã© justa. Ela trata vocÃª como vocÃª a trata.'*
Ele nÃ£o entendeu. Talvez entenda quando sair.

â€” Sylvara, GuardiÃ£"""
        }
    ],
    20: [
        {
            "title": "ğŸ“– O Papiro da Eternidade â€” TraduÃ§Ã£o Incompleta",
            "content": """*Caracteres dourados sobre papiro preservado por magia...*

**'O Ciclo das Eras'**

O Deserto das Almas nÃ£o Ã© um deserto natural.

HÃ¡ 5.000 anos, era um jardim. O mais belo do mundo.
Havia rios, florestas, cidades de ouro e cristal.

EntÃ£o veio a MaldiÃ§Ã£o do FaraÃ³ Kha-Mentu â€”
mas nÃ£o como puniÃ§Ã£o. Como *proteÃ§Ã£o*.

Kha-Mentu transformou o paraÃ­so em deserto
para que os invasores nÃ£o desejassem mais conquistÃ¡-lo.
Sacrificou a beleza para salvar os segredos.

*'O maior ato de amor pode parecer destruiÃ§Ã£o para quem nÃ£o entende.'*

Sob as areias ainda dormem as maravilhas do jardim original.
Esperando por alguÃ©m digno de acordÃ¡-las.

â€” Fragmento da Biblioteca do FaraÃ³, NÃ­vel -7"""
        },
        {
            "title": "ğŸ“– O Livro dos EspÃ­ritos â€” CapÃ­tulo das MÃºmias",
            "content": """*PÃ¡ginas que parecem sugar o calor das suas mÃ£os...*

**'Por Que os Mortos Caminham'**

As mÃºmias nÃ£o sÃ£o monstros. SÃ£o guardas.

Cada mÃºmia foi uma pessoa real que, em vida,
jurou proteger algo atÃ© o fim dos tempos.
Quando morreram, o juramento continuou.

O problema Ã© que elas esqueceram o quÃª estÃ£o protegendo.
Lembram apenas do juramento.

*'Uma mÃºmia que lembra o que protege se ajoelha diante do digno.
Uma mÃºmia que esqueceu ataca tudo que se move.'*

Se vocÃª encontrar uma mÃºmia que para e te olha sem atacar â€”
ela estÃ¡ lembrando. NÃ£o a interrompa.

Talvez ela encontre o que procura em vocÃª.

â€” Nefertiri, GuardiÃ£ dos Conhecimentos"""
        }
    ],
    30: [
        {
            "title": "ğŸ“– Sagas do Gelo â€” Volume III",
            "content": """*Pergaminho enrijecido pelo frio, mas legÃ­vel...*

**'Os TitÃ£s do Gelo'**

Antes dos humanos existirem, os TitÃ£s do Gelo governavam estas montanhas.

Eram seres de 30 metros de altura, feitos de cristal e vento,
com memÃ³rias que se estendiam por eras geolÃ³gicas.

Eles nÃ£o lutavam. Criavam.
Cada TitÃ£ era responsÃ¡vel por uma lei da natureza:
â€” Boreas: o frio
â€” Glacius: o tempo (no sentido meteorolÃ³gico)
â€” Permafrost: a permanÃªncia das coisas

Os humanos os confundiram com inimigos e atacaram.
Os TitÃ£s, confusos com tamanha agressividade em seres tÃ£o pequenos,
*recuaram*.

Eles ainda estÃ£o aqui. Apenas menores. Esperando ser compreendidos.
O Yeti Colossal Ã© um eco da memÃ³ria deles.

â€” Bjorn, AnciÃ£os das Montanhas"""
        },
        {
            "title": "ğŸ“– O Cristal do Inverno â€” Lenda Completa",
            "content": """*Glifos rÃºnicos que parecem pulsar com frio azul...*

**'O Segredo nas Profundezas'**

O Cristal do Inverno Eterno nÃ£o Ã© apenas uma joia.

Ã‰ um arquivo. Um registro de tudo que jÃ¡ existiu e morreu no frio.
Cada criatura que morreu nestas montanhas tem sua memÃ³ria guardada ali.

Por isso os TitÃ£s do Gelo o protegiam com tanto cuidado.
Era a *biblioteca da morte* deles.

O Yeti Colossal, Krom, sente cada memÃ³ria armazenada
como se fossem suas prÃ³prias. Sente a dor de cada ser.
Ã‰ por isso que estÃ¡ sempre em sofrimento.

*'Quem derrotar Krom com compaixÃ£o, nÃ£o com Ã³dio,
pode ouvir ele sussurrar o nome do ser que mais sente falta.'*

Dizem que Ã© sempre o mesmo nome.
Mas ninguÃ©m que ouviu jamais revelou qual Ã©.

â€” Fragmento, Fortaleza Permafrost"""
        }
    ],
    40: [
        {
            "title": "ğŸ“– O CÃ³dice do Fogo â€” Primeira RevelaÃ§Ã£o",
            "content": """*Gravado em obsidiana, legÃ­vel apenas Ã  luz do fogo...*

**'A Profecia de Ignarius'**

No dia em que o Ãºltimo vulcÃ£o se apagar,
o dragÃ£o retornarÃ¡ ao fogo primordial.

Mas antes disso, ele testarÃ¡ os guerreiros:
*'Apenas quem sobreviver ao fogo sem se tornar cinza
merece carregar a Chama Original em seu coraÃ§Ã£o.'*

A Chama Original nÃ£o Ã© uma arma. Ã‰ uma responsabilidade.
Quem a carrega sente o peso de tudo que foi criado com fogo:
cada estrela, cada vida, cada sonho que aqueceu alguÃ©m na noite fria.

Os AnÃµes que forjaram as primeiras armas dos deuses carregavam essa chama.
Por isso suas criaÃ§Ãµes eram imortais.

*'Forja com fogo do coraÃ§Ã£o, nÃ£o das mÃ£os.'*

â€” Profeta Ignar, Ãºltima visÃ£o antes de se tornar cinzas"""
        },
        {
            "title": "ğŸ“– MemÃ³rias de Lava â€” Registro VulcÃ¢nico",
            "content": """*Palavras que parecem ainda quentes ao toque...*

**'CivilizaÃ§Ã£o Antes do Fogo'**

Poucos sabem que o Reino VulcÃ¢nico foi habitado por uma civilizaÃ§Ã£o avanÃ§ada.

Os Forjadores â€” assim eram chamados â€” dominavam a metalurgia mÃ¡gica.
Criavam objetos que tinham *alma*: que sentiam, que pensavam, que escolhiam seus donos.

Quando Ignarius despertou pela Ãºltima vez, eles nÃ£o fugiram.
Fizeram uma escolha coletiva: fundir-se com o dragÃ£o.
Voluntariamente.

Agora Ignarius carrega dentro de si as memÃ³rias de toda uma civilizaÃ§Ã£o.
Cada rugido Ã© uma canÃ§Ã£o em idioma extinto.
Cada chama Ã© um nome que nÃ£o existe mais.

*'Quando vocÃª derrota Ignarius, vocÃª libera as almas presas nele.
NÃ£o Ã© uma batalha. Ã‰ um funeral que durou 1.000 anos.'*

â€” Doran, Mestre-Ferreiro, herdeiro da tradiÃ§Ã£o"""
        }
    ],
    50: [
        {
            "title": "ğŸ“– O Tratado do Vazio â€” TraduÃ§Ã£o Proibida",
            "content": """*As palavras se movem enquanto vocÃª as lÃª. Literalmente.*

**'O Que Existe Antes do Nada'**

FilÃ³sofos debatem hÃ¡ milÃªnios sobre o que existe apÃ³s a morte.
Poucos perguntam o que existia antes do nascimento.

A resposta Ã© o Abismo Arcano.

Cada alma que nasce vem do Abismo.
Cada alma que morre retorna ao Abismo.
O Senhor das Sombras nÃ£o Ã© um vilÃ£o â€” Ã© um *administrador*.

Ele cuida das almas em trÃ¢nsito.
Ordena o caos entre o antes e o depois.

O problema Ã© que hÃ¡ almas que nÃ£o querem ir embora.
Que querem ficar no Abismo para sempre.
E o Senhor das Sombras nÃ£o tem autoridade para forÃ§Ã¡-las.

*'Todo monstro que vocÃª enfrenta no Abismo
era uma vez uma alma que tinha medo de seguir em frente.'*

â€” Spectra, BibliotecÃ¡ria do Abismo"""
        },
        {
            "title": "ğŸ“– Cartas do Arquimago Zephyr â€” CorrespondÃªncia Final",
            "content": """*Letras que brilham e se apagam alternadamente...*

**Para meu sucessor, seja vocÃª quem for:**

Passei 200 anos estudando o Abismo Arcano.
Aprendi uma coisa: quanto mais vocÃª sabe, mais vocÃª entende que nÃ£o sabe nada.

As entidades do Vazio nÃ£o sÃ£o mÃ¡s.
SÃ£o *antigas*. E antigas demais para entender coisas novas como vocÃª.

Quando encontrares o Senhor das Sombras,
nÃ£o o trate como inimigo.
Trate-o como um ser que estÃ¡ aqui hÃ¡ muito mais tempo que vocÃª
e estÃ¡ muito, muito cansado.

Ã€s vezes o maior ato de compaixÃ£o Ã© dar descanso a quem nÃ£o pode morrer.

*'O verdadeiro poder do Abismo nÃ£o Ã© destruiÃ§Ã£o. Ã‰ transformaÃ§Ã£o.'*

Com esperanÃ§a no futuro,
Arquimago Zephyr
P.S.: Meu livro de magias estÃ¡ escondido na DimensÃ£o Invertida. VocÃª vai precisar."""
        }
    ]
}

# ================= NPCs POR CIDADE =================
CITY_NPCS = {
    1: {
        "city_name": "ğŸ˜ï¸ Vila dos Primeiros Passos",
        "npcs": [
            {
                "name": "AldeÃ£o Theron",
                "role": "Fazendeiro",
                "emoji": "ğŸ‘¨â€ğŸŒ¾",
                "dialogues": [
                    "Bem-vindo, viajante! Estes campos parecem simples, mas escondem mais segredos do que imaginamos.",
                    "Meu avÃ´ dizia que o primeiro Slime a aparecer nestes campos nasceu de uma lÃ¡grima do cÃ©u.",
                    "VocÃª parece forte. Talvez pudesse ajudar com a praga dos ratos? Os Campos precisam de herÃ³is como vocÃª.",
                    "Dizem que nas noites de lua cheia, o Slime Rei aparece no centro do campo. NinguÃ©m voltou para confirmar... ainda."
                ]
            },
            {
                "name": "Curandeira Elara",
                "role": "Curandeira da Vila",
                "emoji": "ğŸ‘©â€âš•ï¸",
                "dialogues": [
                    "As ervas destes campos tÃªm propriedades mÃ¡gicas. Cada planta guarda uma histÃ³ria.",
                    "Aprendi a curar com minha mÃ£e, que aprendeu com a sua. A arte de curar Ã© tÃ£o antiga quanto a dor.",
                    "Cuidado com as vespas gigantes ao norte. Seu veneno nÃ£o mata rapidamente, mas faz vocÃª desejar que matasse.",
                    "Se precisar de uma poÃ§Ã£o, posso preparar algo... mas os ingredientes sÃ£o raros por aqui."
                ]
            },
            {
                "name": "CapitÃ£o Aldric",
                "role": "Guarda da Vila",
                "emoji": "ğŸ’‚",
                "dialogues": [
                    "Fui aventureiro antes de ser guarda. Aprendi que trabalho em equipe salva mais vidas do que forÃ§a individual.",
                    "O Slime Rei foi derrotado uma vez, hÃ¡ 50 anos. Mas os slimes absorvem a magia da terra e renascem.",
                    "Recrute companheiros se quiser enfrentar os grandes perigos. Nenhum herÃ³i conquista o mundo sozinho.",
                    "Minha espada estÃ¡ enferrujada agora. Mas jÃ¡ matei um boss com ela. Os tempos bons..."
                ]
            }
        ]
    },
    10: {
        "city_name": "ğŸŒ² Acampamento das Sombras",
        "npcs": [
            {
                "name": "Druida Sylvara",
                "role": "GuardiÃ£ da Floresta",
                "emoji": "ğŸ§™â€â™€ï¸",
                "dialogues": [
                    "A floresta fala para aqueles que sabem ouvir. VocÃª consegue ouvi-la?",
                    "O Ent AnciÃ£o estÃ¡ inquieto. Algo perturba seu sono milenar. Temo o que pode acontecer se ele despertar com raiva.",
                    "Cada Ã¡rvore aqui tem um nome. Eu os conheÃ§o todos. SÃ£o minha famÃ­lia.",
                    "Os goblins desta floresta nÃ£o sÃ£o naturalmente maus. Algo os corrompeu. Descubra o que Ã© e talvez encontre paz."
                ]
            },
            {
                "name": "Mercador Brynn",
                "role": "Comerciante Errante",
                "emoji": "ğŸ§”",
                "dialogues": [
                    "ComÃ©rcio Ã© a Ãºnica linguagem universal. AtÃ© monstros tÃªm preÃ§o.",
                    "Passei por aqui hÃ¡ um mÃªs. A floresta estava diferente. Mais... viva. NÃ£o da forma boa.",
                    "Procuro a Teia MÃ¡gica das Aranhas Gigantes. Pago bem. Muito bem.",
                    "Ei, vocÃª nÃ£o parece daqui. De onde veio? Dos Campos? Ah, a nostalgia..."
                ]
            }
        ]
    },
    20: {
        "city_name": "ğŸœï¸ OÃ¡sis de Amun",
        "npcs": [
            {
                "name": "SÃ¡bia Nefertiri",
                "role": "GuardiÃ£ dos Conhecimentos Antigos",
                "emoji": "ğŸ‘‘",
                "dialogues": [
                    "Os hierÃ³glifos nas pirÃ¢mides nÃ£o sÃ£o decoraÃ§Ã£o. SÃ£o advertÃªncias. Poucos tomam o cuidado de lÃª-las.",
                    "O FaraÃ³ Kha-Mentu nÃ£o era um vilÃ£o. Era um rei traÃ­do. HÃ¡ diferenÃ§a.",
                    "Esta areia foi mar profundo uma vez. Tudo muda. Tudo passa. AtÃ© o deserto.",
                    "VocÃª busca riquezas? As maiores riquezas deste deserto sÃ£o os conhecimentos enterrados junto com os mortos."
                ]
            },
            {
                "name": "NÃ´made Hassan",
                "role": "Guia do Deserto",
                "emoji": "ğŸ§•",
                "dialogues": [
                    "O deserto testa cada viajante de forma diferente. Ele sabe o que vocÃª mais teme.",
                    "Minha famÃ­lia guia viajantes nestas areias hÃ¡ sete geraÃ§Ãµes. Perdemos apenas trÃªs. NÃ£o foi culpa nossa.",
                    "HÃ¡ uma tempestade chegando. De areia ou de destino, nÃ£o sei dizer. Mas algo estÃ¡ por vir.",
                    "O escorpiÃ£o que te pica Ã© o mesmo que te salva do veneno de outro. A vida no deserto Ã© assim."
                ]
            }
        ]
    },
    30: {
        "city_name": "â„ï¸ Fortaleza Permafrost",
        "npcs": [
            {
                "name": "AnciÃ£o da Montanha Bjorn",
                "role": "LÃ­der Tribal",
                "emoji": "ğŸ§“",
                "dialogues": [
                    "Vivi 80 invernos nestas montanhas. O frio nÃ£o Ã© inimigo â€” Ã© professor.",
                    "O Yeti nÃ£o Ã© um monstro. Ã‰ um guardiÃ£o mal compreendido. Mas compreender nÃ£o significa que ele nÃ£o vai te matar.",
                    "HÃ¡ uma passagem secreta atravÃ©s das montanhas. Apenas os dignos a encontram. VocÃª tem o que Ã© necessÃ¡rio?",
                    "Meu pai viu os TitÃ£s do Gelo uma vez. Disse que eram lindos e aterrorizantes ao mesmo tempo."
                ]
            },
            {
                "name": "Ferreiro Helga",
                "role": "Ferreria das Montanhas",
                "emoji": "âš’ï¸",
                "dialogues": [
                    "Armas feitas com cristal de gelo nunca enferrujam. Nunca quebram. Nunca esquecem o sangue que derramaram.",
                    "Trabalhei para reis. Trabalhei para herÃ³is. Nenhum deles agradeceu como vocÃª agradece com moedas.",
                    "O segredo de uma boa armadura nÃ£o Ã© a dureza. Ã‰ a flexibilidade. Como a vida.",
                    "Preciso de mais cristais de gelo. Os das profundezas. Os outros nÃ£o tÃªm poder suficiente."
                ]
            }
        ]
    },
    40: {
        "city_name": "ğŸŒ‹ Cidadela Cinzenta",
        "npcs": [
            {
                "name": "Profeta Ignar",
                "role": "Profeta do Fogo",
                "emoji": "ğŸ”¥",
                "dialogues": [
                    "O fogo nÃ£o destrÃ³i. Transforma. HÃ¡ diferenÃ§a fundamental entre os dois.",
                    "Ignarius desperta a cada geraÃ§Ã£o para testar se a humanidade evoluiu. Ela nunca evolui.",
                    "Vejo em suas chamas um destino extraordinÃ¡rio. Ou uma morte extraordinÃ¡ria. DifÃ­cil distinguir.",
                    "A Forja Sagrada Ã© real. Eu a vi. Uma vez. Durou um segundo que pareceu uma eternidade."
                ]
            },
            {
                "name": "AnÃ£o-Mestre Doran",
                "role": "Mestre Ferreiro Divino",
                "emoji": "âš™ï¸",
                "dialogues": [
                    "Em 300 anos de forja, nunca criei algo que nÃ£o pudesse ser melhorado. Incluindo eu mesmo.",
                    "As melhores armas tÃªm nomes. VocÃª saberia como nomear a sua?",
                    "A Forja Sagrada foi criada pelos prÃ³prios deuses. ReacendÃª-la... bem. Que coisa seria essa.",
                    "AnÃµes nÃ£o temem a morte. Tememos morrer antes de terminar nossa obra-prima."
                ]
            }
        ]
    },
    50: {
        "city_name": "ğŸŒŒ Torre do Conhecimento Perdido",
        "npcs": [
            {
                "name": "Arquimago Zephyr",
                "role": "Arquimago do Abismo",
                "emoji": "ğŸ§™",
                "dialogues": [
                    "A magia nÃ£o Ã© poder. Ã‰ responsabilidade. O poder vem da sabedoria de quando nÃ£o usar a magia.",
                    "Estudei o Senhor das Sombras por 200 anos. Quanto mais entendo, mais temo. E mais o compreendo.",
                    "O Abismo Arcano distorce a realidade, mas tambÃ©m revela verdades que a realidade normal esconde.",
                    "VocÃª chegou atÃ© aqui. Isso significa que estÃ¡ pronto â€” ou Ã© inconsciente demais para saber que nÃ£o estÃ¡."
                ]
            },
            {
                "name": "BibliotecÃ¡ria Spectra",
                "role": "GuardiÃ£ dos Tomos Proibidos",
                "emoji": "ğŸ“š",
                "dialogues": [
                    "Cada livro proibido foi proibido por uma razÃ£o. Geralmente por pessoas que queriam o conhecimento sÃ³ para si.",
                    "Li um texto que descrevia o fim do universo. Depois disso, o chÃ¡ nunca mais teve o mesmo gosto.",
                    "Conhecimento nÃ£o Ã© perigoso. O que fazemos com ele Ã© que pode ser.",
                    "Procura algum livro em especial? Tenho... categorias especiais. Para visitantes especiais."
                ]
            }
        ]
    },
    60: {
        "city_name": "ğŸ‘‘ AntecÃ¢mara do Trono",
        "npcs": [
            {
                "name": "GuardiÃ£o Estelar Auron",
                "role": "GuardiÃ£o do Trono Celestial",
                "emoji": "âšœï¸",
                "dialogues": [
                    "Poucos chegam atÃ© aqui. Menos ainda estÃ£o prontos para o que vem a seguir.",
                    "O Imperador Astral conhece seu nome desde o dia em que vocÃª nasceu. Ele esteve esperando.",
                    "NÃ£o venho aqui para dissuadi-lo. Venho para honrar sua jornada. O que vocÃª fez foi extraordinÃ¡rio.",
                    "O Trono Celestial nÃ£o Ã© um lugar. Ã‰ um estado de ser. VocÃª estÃ¡ se tornando algo alÃ©m de mortal."
                ]
            },
            {
                "name": "Alma de HerÃ³i LendÃ¡rio",
                "role": "EspÃ­rito dos Que Vieram Antes",
                "emoji": "ğŸ‘»",
                "dialogues": [
                    "Cheguei aqui antes de vocÃª. Falhei. Mas minha falha abriu o caminho para o seu sucesso.",
                    "NÃ£o tenho arrependimentos. Cada escolha que fiz me trouxe atÃ© aqui â€” mesmo depois da morte.",
                    "O Imperador... nÃ£o Ã© o que parece. Esteja preparado para a surpresa de sua vida.",
                    "Lute bem. Lute com honra. E quando terminar â€” nÃ£o esqueÃ§a de onde veio."
                ]
            }
        ]
    }
}

# ================= MUNDOS E EVENTOS =================
WORLDS = {
    1: {
        "name": "ğŸŒ± Campos Iniciais",
        "emoji": "ğŸŒ±",
        "xp_loss_multiplier": 0.3,
        "monsters": {
            "Slime": {"xp": (10, 20), "hp": 30, "atk": 5, "coins": (1, 3)},
            "Rato Selvagem": {"xp": (12, 22), "hp": 25, "atk": 7, "coins": (1, 4)},
            "Coelho Raivoso": {"xp": (11, 21), "hp": 20, "atk": 6, "coins": (1, 3)},
            "Javali Jovem": {"xp": (13, 23), "hp": 35, "atk": 8, "coins": (2, 5)},
            "Vespa Gigante": {"xp": (12, 22), "hp": 22, "atk": 7, "coins": (1, 4)}
        },
        "boss": {"name": "Slime Rei", "hp": 567, "atk": 49, "xp": 500, "level": 9, "coins": (50, 100)},
        "resources": ["Pedra fraca", "Grama mÃ¡gica", "Couro de rato", "Flor silvestre", "Mel selvagem"],
        "dungeons": [
            {"name": "Caverna dos Slimes", "level": 1, "boss": "Slime AnciÃ£o"},
            {"name": "Toca dos Ratos", "level": 2, "boss": "Rato Rei"},
            {"name": "Ninho de Vespas", "level": 3, "boss": "Vespa Rainha"}
        ],
        "secret_dungeons": [
            {"name": "ğŸ•³ï¸ Gruta Esquecida", "level": 1, "boss": "GuardiÃ£o Primordial dos Campos", "secret": True, "special_boss_drop": "Raro", "key_name": "ğŸ—ï¸ Chave da Gruta Esquecida"},
            {"name": "ğŸŒ€ Buraco no Tecido da Realidade", "level": 2, "boss": "Anomalia Viva", "secret": True, "special_boss_drop": "Ã‰pico", "key_name": "ğŸ—ï¸ Chave da Anomalia"}
        ],
        "events": [
            "VocÃª encontra um riacho cristalino. A Ã¡gua brilha sob o sol.",
            "Um bando de pÃ¡ssaros voa sobre vocÃª, cantando melodias antigas.",
            "VocÃª tropeÃ§a em uma pedra e cai de cara no chÃ£o.",
            "Uma borboleta dourada pousa em seu ombro por um instante.",
            "O vento carrega o aroma de flores silvestres.",
            "VocÃª ouve risadas ao longe, mas nÃ£o vÃª ninguÃ©m.",
            "Pegadas estranhas marcam o solo Ã  sua frente.",
            "Uma nÃ©voa suave cobre o campo por alguns momentos.",
            "VocÃª encontra um velho cajado abandonado no caminho.",
            "Um arco-Ã­ris surge apÃ³s uma chuva rÃ¡pida.",
            "VocÃª pisa em um espinho e sente uma dor aguda.",
            "Uma placa enferrujada aponta para direÃ§Ãµes desconhecidas.",
            "VocÃª encontra moedas espalhadas pelo chÃ£o.",
            "Um esquilo rouba sua comida e foge para uma Ã¡rvore.",
            "VocÃª sente uma presenÃ§a te observando entre a grama alta.",
            "Uma crianÃ§a perdida pede ajuda para encontrar o caminho.",
            "VocÃª encontra um diÃ¡rio rasgado com histÃ³rias antigas.",
            "O sol se pÃµe, pintando o cÃ©u de laranja e roxo.",
            "VocÃª encontra uma fonte antiga com Ã¡gua mÃ¡gica.",
            "Um mercador errante oferece itens misteriosos.",
            "VocÃª ouve o som de uma batalha ao longe.",
            "Pegadas de sangue levam a uma caverna escura."
        ]
    },
    10: {
        "name": "ğŸŒ² Floresta Sombria",
        "emoji": "ğŸŒ²",
        "xp_loss_multiplier": 0.5,
        "monsters": {
            "Goblin": {"xp": (25, 40), "hp": 60, "atk": 12, "coins": (3, 8)},
            "Lobo Negro": {"xp": (28, 45), "hp": 70, "atk": 15, "coins": (4, 9)},
            "Aranha Gigante": {"xp": (30, 43), "hp": 65, "atk": 14, "coins": (3, 8)},
            "Ogro Menor": {"xp": (32, 47), "hp": 80, "atk": 16, "coins": (5, 10)},
            "Espectro Florestal": {"xp": (29, 44), "hp": 55, "atk": 13, "coins": (4, 9)}
        },
        "boss": {"name": "Ent AnciÃ£o", "hp": 1134, "atk": 81, "xp": 900, "level": 19, "coins": (100, 200)},
        "resources": ["Madeira escura", "Ervas raras", "Pele de lobo", "Teia mÃ¡gica", "Musgo brilhante"],
        "dungeons": [
            {"name": "Covil dos Goblins", "level": 4, "boss": "Chefe Goblin"},
            {"name": "Ninho de Aranhas", "level": 5, "boss": "Aranha Rainha"},
            {"name": "Caverna do Ogro", "level": 6, "boss": "Ogro Cruel"}
        ],
        "secret_dungeons": [
            {"name": "ğŸŒ‘ Floresta Invertida", "level": 4, "boss": "Reflexo Sombrio", "secret": True, "special_boss_drop": "Raro", "key_name": "ğŸ—ï¸ Chave da Floresta Invertida"},
            {"name": "ğŸ„ Reino dos Cogumelos", "level": 5, "boss": "Rei FÃºngico", "secret": True, "special_boss_drop": "Ã‰pico", "key_name": "ğŸ—ï¸ Chave do Reino FÃºngico"}
        ],
        "events": [
            "Galhos se movem sozinhos ao seu redor, como se estivessem vivos.",
            "VocÃª ouve sussurros entre as Ã¡rvores, mas nÃ£o entende as palavras.",
            "Uma coruja de olhos vermelhos te observa de um galho alto.",
            "RaÃ­zes tentam prender seus pÃ©s enquanto vocÃª caminha.",
            "VocÃª encontra um cÃ­rculo de cogumelos brilhantes.",
            "Neblina densa obscurece sua visÃ£o por alguns minutos.",
            "Um veado fantasmagÃ³rico atravessa seu caminho e desaparece.",
            "VocÃª tropeÃ§a e cai em um buraco coberto de folhas.",
            "Luzes misteriosas danÃ§am entre as Ã¡rvores.",
            "VocÃª encontra um altar antigo coberto de musgo.",
            "Corvos negros grasnam alto, como se estivessem te alertando.",
            "Uma Ã¡rvore cai perto de vocÃª com um estrondo.",
            "VocÃª encontra marcas de garras profundas em um tronco.",
            "Um caminho de pÃ©talas negras aparece misteriosamente.",
            "VocÃª ouve o choro de uma crianÃ§a, mas nÃ£o encontra ninguÃ©m.",
            "Aranhas gigantes tecem teias bloqueando seu caminho.",
            "VocÃª encontra um esqueleto segurando um mapa antigo.",
            "A lua cheia ilumina clareiras entre as Ã¡rvores.",
            "VocÃª encontra uma casa abandonada com a porta entreaberta.",
            "Olhos brilhantes te observam da escuridÃ£o.",
            "VocÃª sente algo te seguindo, mas ao olhar nÃ£o vÃª nada.",
            "Um portal de energia aparece brevemente e desaparece."
        ]
    },
    20: {
        "name": "ğŸœï¸ Deserto das Almas",
        "emoji": "ğŸœï¸",
        "xp_loss_multiplier": 0.7,
        "monsters": {
            "EscorpiÃ£o Gigante": {"xp": (40, 60), "hp": 100, "atk": 20, "coins": (5, 12)},
            "MÃºmia": {"xp": (45, 65), "hp": 120, "atk": 22, "coins": (6, 13)},
            "Serpente de Areia": {"xp": (43, 63), "hp": 110, "atk": 21, "coins": (5, 12)},
            "GuardiÃ£o de Tumba": {"xp": (47, 67), "hp": 130, "atk": 24, "coins": (7, 14)},
            "EspÃ­rito do Deserto": {"xp": (44, 64), "hp": 105, "atk": 20, "coins": (5, 12)}
        },
        "boss": {"name": "FaraÃ³ AmaldiÃ§oado", "hp": 1890, "atk": 127, "xp": 1400, "level": 29, "coins": (180, 350)},
        "resources": ["Areia mÃ¡gica", "Ossos antigos", "Vendas mÃ­sticas", "Escaravelho dourado", "Papiro antigo"],
        "dungeons": [
            {"name": "PirÃ¢mide Perdida", "level": 7, "boss": "FaraÃ³ Esquecido"},
            {"name": "Tumba dos Reis", "level": 8, "boss": "AnÃºbis Menor"},
            {"name": "Templo SubterrÃ¢neo", "level": 9, "boss": "Esfinge GuardiÃ£"}
        ],
        "secret_dungeons": [
            {"name": "â­ OÃ¡sis do Tempo Invertido", "level": 7, "boss": "GuardiÃ£o do Paradoxo", "secret": True},
            {"name": "ğŸº Catacumba dos FaraÃ³s Esquecidos", "level": 8, "boss": "FaraÃ³ Primordial", "secret": True}
        ],
        "events": [
            "Uma tempestade de areia surge do nada, cegando vocÃª temporariamente.",
            "VocÃª afunda na areia movediÃ§a e luta para sair.",
            "Miragens de oÃ¡sis aparecem ao longe, tentando te enganar.",
            "VocÃª encontra uma pirÃ¢mide semi-enterrada na areia.",
            "HierÃ³glifos brilhantes aparecem nas dunas ao seu redor.",
            "Um escorpiÃ£o gigante emerge da areia perto de vocÃª.",
            "VocÃª encontra um sarcÃ³fago aberto e vazio.",
            "O sol escaldante te deixa exausto e sedento.",
            "VocÃª ouve cÃ¢nticos ancestrais vindos das dunas.",
            "Uma caravana de espÃ­ritos passa por vocÃª sem te notar.",
            "VocÃª encontra joias espalhadas entre ossos antigos.",
            "Um redemoinho de areia forma uma figura humanÃ³ide.",
            "VocÃª cai em uma armadilha antiga cheia de flechas.",
            "Marcas de antigas batalhas cobrem as ruÃ­nas ao redor.",
            "A lua ilumina hierÃ³glifos que contam histÃ³rias perdidas.",
            "VocÃª encontra um oÃ¡sis real com Ã¡gua fresca.",
            "Serpentes de areia deslizam rapidamente ao seu redor.",
            "VocÃª vÃª vultos de mÃºmias caminhando ao longe.",
            "Uma maldiÃ§Ã£o antiga faz vocÃª sentir fraqueza.",
            "VocÃª encontra um amuleto enterrado na areia.",
            "Templos subterrÃ¢neos sÃ£o revelados por ventos fortes.",
            "VocÃª ouve o rugido de algo gigantesco sob a areia."
        ]
    },
    30: {
        "name": "â„ï¸ Montanhas Geladas",
        "emoji": "â„ï¸",
        "xp_loss_multiplier": 0.9,
        "monsters": {
            "Lobo de Gelo": {"xp": (60, 80), "hp": 150, "atk": 28, "coins": (7, 15)},
            "Golem de Neve": {"xp": (65, 85), "hp": 180, "atk": 30, "coins": (8, 16)},
            "Ogro Glacial": {"xp": (63, 83), "hp": 160, "atk": 29, "coins": (7, 15)},
            "DragÃ£o de Gelo Jovem": {"xp": (70, 90), "hp": 200, "atk": 32, "coins": (10, 18)},
            "Elemental de Gelo": {"xp": (67, 87), "hp": 170, "atk": 31, "coins": (8, 16)}
        },
        "boss": {"name": "Yeti Colossal", "hp": 2835, "atk": 172, "xp": 2000, "level": 39, "coins": (280, 500)},
        "resources": ["Cristal de gelo", "MinÃ©rio frio", "Pele de yeti", "Neve eterna", "Gema congelada"],
        "dungeons": [
            {"name": "Caverna Congelada", "level": 10, "boss": "GuardiÃ£o do Gelo"},
            {"name": "Fortaleza de Gelo", "level": 11, "boss": "Rei do Inverno"},
            {"name": "Abismo Glacial", "level": 12, "boss": "DragÃ£o Ancestral"}
        ],
        "secret_dungeons": [
            {"name": "ğŸŒ¨ï¸ NÃºcleo do Inverno Eterno", "level": 10, "boss": "TitÃ£ do Gelo", "secret": True},
            {"name": "â„ï¸ PalÃ¡cio de Cristal Perdido", "level": 11, "boss": "Rainha das Neves", "secret": True}
        ],
        "events": [
            "Uma avalanche desce pela montanha em sua direÃ§Ã£o.",
            "VocÃª escorrega em gelo fino e cai em uma fenda.",
            "O frio intenso congela suas roupas e mÃºsculos.",
            "VocÃª encontra um viajante congelado segurando um mapa.",
            "Cristais de gelo cantam melodias com o vento.",
            "Uma tempestade de neve bloqueia completamente sua visÃ£o.",
            "VocÃª encontra uma caverna quente com fontes termais.",
            "Pegadas gigantescas estÃ£o impressas na neve.",
            "VocÃª ouve rugidos ecoando entre os picos.",
            "Estalactites de gelo caem perigosamente perto de vocÃª.",
            "VocÃª encontra um monastÃ©rio abandonado no topo.",
            "EspÃ­ritos congelados aparecem brevemente na nevasca.",
            "VocÃª cai atravÃ©s de neve falsa em uma caverna.",
            "Lobos uivam ao longe sob a lua cheia.",
            "VocÃª encontra equipamentos de expediÃ§Ãµes antigas.",
            "O vento forma figuras assustadoras com a neve.",
            "VocÃª sente a montanha tremer levemente.",
            "Cristais gigantes emergem do gelo Ã  sua frente.",
            "VocÃª encontra marcas de batalha antigas no gelo.",
            "Uma ponte de gelo quebra sob seus pÃ©s.",
            "VocÃª vÃª uma silhueta gigantesca no topo da montanha.",
            "A temperatura cai drasticamente de repente."
        ]
    },
    40: {
        "name": "ğŸŒ‹ Reino VulcÃ¢nico",
        "emoji": "ğŸŒ‹",
        "xp_loss_multiplier": 1.2,
        "monsters": {
            "Salamandra": {"xp": (80, 100), "hp": 200, "atk": 38, "coins": (10, 20)},
            "DemÃ´nio de Lava": {"xp": (85, 105), "hp": 230, "atk": 42, "coins": (12, 22)},
            "Elemental de Fogo": {"xp": (83, 103), "hp": 210, "atk": 40, "coins": (11, 21)},
            "Hidra de Magma": {"xp": (90, 110), "hp": 250, "atk": 45, "coins": (13, 23)},
            "FÃªnix Negra": {"xp": (87, 107), "hp": 220, "atk": 43, "coins": (12, 22)}
        },
        "boss": {"name": "DragÃ£o de Magma", "hp": 4252, "atk": 236, "xp": 2800, "level": 49, "coins": (400, 700)},
        "resources": ["Pedra vulcÃ¢nica", "NÃºcleo de fogo", "Escamas de dragÃ£o", "Obsidiana pura", "Cinza sagrada"],
        "dungeons": [
            {"name": "CaldeirÃ£o de Lava", "level": 13, "boss": "Senhor do Fogo"},
            {"name": "Forja Infernal", "level": 14, "boss": "TitÃ£ Flamejante"},
            {"name": "CoraÃ§Ã£o do VulcÃ£o", "level": 15, "boss": "Ifrit Primordial"}
        ],
        "secret_dungeons": [
            {"name": "ğŸ”¥ CÃ¢mara da Chama Original", "level": 13, "boss": "Aspecto do Fogo Primordial", "secret": True},
            {"name": "ğŸŒ‹ Ventre do VulcÃ£o Vivo", "level": 14, "boss": "EspÃ­rito do VulcÃ£o", "secret": True}
        ],
        "events": [
            "Lava jorra de uma fissura bem ao seu lado.",
            "O chÃ£o racha e revela rios de magma abaixo.",
            "Gases tÃ³xicos sobem de buracos fumegantes.",
            "VocÃª tropeÃ§a e quase cai em um poÃ§o de lava.",
            "Um gÃªiser de lava explode prÃ³ximo a vocÃª.",
            "Pedras incandescentes chovem do cÃ©u.",
            "VocÃª encontra ruÃ­nas de uma civilizaÃ§Ã£o antiga queimada.",
            "O calor derrete parcialmente seu equipamento.",
            "Salamandras gigantes nadam livremente na lava.",
            "VocÃª ouve rugidos vindos de cavernas profundas.",
            "Um vulcÃ£o ao longe entra em erupÃ§Ã£o.",
            "VocÃª encontra cristais de fogo pulsantes.",
            "DemÃ´nios observam vocÃª das sombras flamejantes.",
            "Pontes de pedra desmoronam sob seus pÃ©s.",
            "VocÃª vÃª esqueletos de aventureiros anteriores.",
            "Chamas azuis danÃ§am misteriosamente ao redor.",
            "VocÃª encontra um altar dedicado ao deus do fogo.",
            "A fumaÃ§a densa te faz tossir e perder a direÃ§Ã£o.",
            "VocÃª sente tremores constantes sob seus pÃ©s.",
            "Criaturas de magma emergem das profundezas.",
            "VocÃª encontra um ovo de dragÃ£o rachado e vazio.",
            "Asas gigantescas bloqueiam brevemente o sol vermelho."
        ]
    },
    50: {
        "name": "ğŸŒŒ Abismo Arcano",
        "emoji": "ğŸŒŒ",
        "xp_loss_multiplier": 1.5,
        "monsters": {
            "Espectro": {"xp": (100, 130), "hp": 280, "atk": 48, "coins": (12, 22)},
            "Mago Sombrio": {"xp": (105, 135), "hp": 300, "atk": 52, "coins": (14, 24)},
            "Devorador de Almas": {"xp": (103, 133), "hp": 290, "atk": 50, "coins": (13, 23)},
            "Lich": {"xp": (110, 140), "hp": 320, "atk": 55, "coins": (15, 25)},
            "Golem Arcano": {"xp": (107, 137), "hp": 310, "atk": 53, "coins": (14, 24)}
        },
        "boss": {"name": "Senhor das Sombras", "hp": 6615, "atk": 318, "xp": 4000, "level": 59, "coins": (600, 1000)},
        "resources": ["EssÃªncia arcana", "Fragmento sombrio", "Cristal do vazio", "Poeira estelar", "Runa mÃ­stica"],
        "dungeons": [
            {"name": "Torre Arcana", "level": 16, "boss": "Arquimago Corrupto"},
            {"name": "DimensÃ£o Sombria", "level": 17, "boss": "Entidade do Vazio"},
            {"name": "Biblioteca Proibida", "level": 18, "boss": "GuardiÃ£o do Conhecimento"}
        ],
        "secret_dungeons": [
            {"name": "â™¾ï¸ Loop Temporal Permanente", "level": 16, "boss": "Eco de Si Mesmo", "secret": True},
            {"name": "ğŸŒ€ DimensÃ£o Invertida", "level": 17, "boss": "Anti-MatÃ©ria Viva", "secret": True}
        ],
        "events": [
            "A gravidade inverte e vocÃª flutua sem controle.",
            "Portais dimensionais abrem e fecham ao seu redor.",
            "VocÃª vÃª versÃµes alternativas de si mesmo passando.",
            "O tempo parece congelar por alguns segundos.",
            "Sussurros de milhares de vozes ecoam em sua mente.",
            "VocÃª atravessa uma cortina de energia e sente dor.",
            "Estrelas cadentes atravessam o vazio infinito.",
            "VocÃª encontra fragmentos de realidades destruÃ­das.",
            "Sombras ganham vida e tentam te tocar.",
            "VocÃª vÃª memÃ³rias de pessoas desconhecidas.",
            "A realidade se distorce formando figuras impossÃ­veis.",
            "VocÃª sente sua essÃªncia sendo puxada do corpo.",
            "Criaturas do vazio te observam da escuridÃ£o.",
            "VocÃª encontra um livro que escreve sozinho.",
            "Pontes de energia aparecem e desaparecem.",
            "VocÃª ouve profecias sobre seu futuro.",
            "Magos mortos oferecem conhecimento proibido.",
            "VocÃª cai em um loop temporal por instantes.",
            "Olhos gigantes se abrem no cÃ©u escuro.",
            "VocÃª encontra artefatos de eras esquecidas.",
            "A linha entre sonho e realidade desaparece.",
            "Uma entidade cÃ³smica nota sua presenÃ§a."
        ]
    },
    60: {
        "name": "ğŸ‘‘ Trono Celestial",
        "emoji": "ğŸ‘‘",
        "xp_loss_multiplier": 2.0,
        "monsters": {
            "GuardiÃ£o Celestial": {"xp": (140, 180), "hp": 400, "atk": 65, "coins": (15, 28)},
            "Anjo CaÃ­do": {"xp": (145, 185), "hp": 420, "atk": 68, "coins": (16, 30)},
            "Serafim Corrompido": {"xp": (150, 190), "hp": 450, "atk": 70, "coins": (18, 32)},
            "Querubim Guerreiro": {"xp": (155, 195), "hp": 480, "atk": 73, "coins": (19, 34)},
            "Arcanjo Negro": {"xp": (160, 200), "hp": 500, "atk": 75, "coins": (20, 35)}
        },
        "boss": {"name": "Imperador Astral", "hp": 3375, "atk": 130, "xp": 2500, "level": 60, "coins": (80, 160)},
        "resources": ["EssÃªncia celestial", "Fragmento estelar", "Coroa divina", "LÃ¡grima de deus", "Pluma sagrada"],
        "dungeons": [
            {"name": "SantuÃ¡rio Celestial", "level": 19, "boss": "Avatar Divino"},
            {"name": "PalÃ¡cio Estelar", "level": 20, "boss": "Deus Menor"},
            {"name": "Portal da Eternidade", "level": 21, "boss": "GuardiÃ£o Final"}
        ],
        "secret_dungeons": [
            {"name": "ğŸŒŒ AlÃ©m do Trono", "level": 19, "boss": "O Que NÃ£o Tem Nome", "secret": True},
            {"name": "âœ¨ Raiz da CriaÃ§Ã£o", "level": 20, "boss": "Deus Esquecido", "secret": True}
        ],
        "events": [
            "Raios divinos atravessam as nuvens douradas.",
            "VocÃª caminha sobre um chÃ£o de estrelas solidificadas.",
            "Anjos cantam hinos em lÃ­nguas antigas.",
            "VocÃª sente o peso de mil olhares celestiais.",
            "PortÃµes gigantescos se abrem revelando o infinito.",
            "Suas feridas curam instantaneamente por luz divina.",
            "VocÃª vÃª deuses antigos esculpidos em ouro.",
            "Colunas de mÃ¡rmore sustentam o prÃ³prio cÃ©u.",
            "VocÃª encontra armas que mataram divindades.",
            "O trono vazio pulsa com poder incompreensÃ­vel.",
            "GuardiÃµes imortais testam sua dignidade.",
            "VocÃª ouve profecias sobre o fim de todas as coisas.",
            "Asas de luz brotam temporariamente de suas costas.",
            "VocÃª vÃª a criaÃ§Ã£o e destruiÃ§Ã£o de mundos.",
            "Energias primordiais fluem atravÃ©s de vocÃª.",
            "VocÃª encontra o livro do destino aberto.",
            "Almas de herÃ³is lendÃ¡rios te cumprimentam.",
            "VocÃª sente o conhecimento de tudo por um instante.",
            "O Imperador te observa do trono distante.",
            "VocÃª encontra a espada que cortou a primeira estrela.",
            "Sua mortalidade Ã© questionada pela prÃ³pria existÃªncia.",
            "VocÃª estÃ¡ a um passo de se tornar uma lenda eterna."
        ]
    },
    # â”€â”€â”€ REINO 8: PÃ‚NTANO DAS ALMAS PERDIDAS (desbloqueado no nÃ­vel 62) â”€â”€â”€
    62: {
        "name": "ğŸŒ¿ PÃ¢ntano das Almas Perdidas",
        "emoji": "ğŸŒ¿",
        "xp_loss_multiplier": 2.1,
        "monsters": {
            "Criatura do PÃ¢ntano": {"xp": (170, 210), "hp": 520, "atk": 78, "coins": (22, 38)},
            "EspÃ­rito Lamacento": {"xp": (175, 215), "hp": 540, "atk": 80, "coins": (23, 40)},
            "Serpente das Profundezas": {"xp": (180, 220), "hp": 560, "atk": 83, "coins": (24, 42)},
            "Bruxo das Trevas Ãšmidas": {"xp": (185, 225), "hp": 580, "atk": 85, "coins": (25, 44)},
            "JacarÃ© Arcano": {"xp": (190, 230), "hp": 600, "atk": 88, "coins": (26, 46)}
        },
        "boss": {"name": "Hidra das Almas", "hp": 11475, "atk": 416, "xp": 6000, "level": 69, "coins": (900, 1600)},
        "resources": ["Lama mÃ¡gica", "EssÃªncia pantanosa", "Pele de serpente ancestral", "Cogumelo sombrio", "Raiz corrompida"],
        "dungeons": [
            {"name": "Covil da Hidra Menor", "level": 22, "boss": "Hidra Jovem"},
            {"name": "RuÃ­nas Submersas", "level": 23, "boss": "GuardiÃ£o Submerso"},
            {"name": "CÃ¢mara das Almas Presas", "level": 24, "boss": "Necromante do PÃ¢ntano"}
        ],
        "secret_dungeons": [
            {"name": "ğŸŒ‘ CoraÃ§Ã£o do PÃ¢ntano Eterno", "level": 22, "boss": "Entidade das Ãguas Negras", "secret": True,
             "special_boss_drop": "Ancestral", "key_name": "ğŸ—ï¸ Chave do PÃ¢ntano Eterno"},
            {"name": "ğŸ’€ Templo Afundado de Morthak", "level": 23, "boss": "Morthak, o Imortal Pantanoso", "secret": True,
             "special_boss_drop": "Ancestral", "key_name": "ğŸ—ï¸ Chave de Morthak"}
        ],
        "events": [
            "Bolhas negras sobem Ã  superfÃ­cie lamacenta.", "VocÃª sente seus pÃ©s afundando na lama.",
            "Fogos-fÃ¡tuos guiam vocÃª para um caminho perigoso.", "Um espÃ­rito perdido pede que vocÃª entregue uma mensagem.",
            "A lama parece ter consciÃªncia prÃ³pria.", "Criaturas invisÃ­veis se movem sob as Ã¡guas escuras.",
            "VocÃª encontra um barco afundado com tesouro dentro.", "O ar fÃ©tido envenena seus pulmÃµes.",
            "Uma caravana de mortos-vivos marcha em silÃªncio.", "RaÃ­zes gigantes tentam te prender."
        ],
        "exclusive_drops": {
            "weapons": ["Cajado das Almas Perdidas", "LÃ¢mina Pantanosa"],
            "armor": ["Manto das Almas", "CouraÃ§a do PÃ¢ntano"]
        }
    },
    # â”€â”€â”€ REINO 9: FLORESTA CRISTALINA (desbloqueado no nÃ­vel 70) â”€â”€â”€
    70: {
        "name": "ğŸ’ Floresta Cristalina",
        "emoji": "ğŸ’",
        "xp_loss_multiplier": 2.3,
        "monsters": {
            "Golem de Cristal": {"xp": (200, 250), "hp": 650, "atk": 92, "coins": (28, 50)},
            "Fada de Diamante": {"xp": (205, 255), "hp": 620, "atk": 90, "coins": (27, 48)},
            "Elemental Cristalino": {"xp": (210, 260), "hp": 670, "atk": 95, "coins": (29, 52)},
            "DragÃ£o de Quartzo": {"xp": (220, 270), "hp": 700, "atk": 98, "coins": (31, 55)},
            "GuardiÃ£o de Safira": {"xp": (215, 265), "hp": 680, "atk": 96, "coins": (30, 53)}
        },
        "boss": {"name": "Senhor dos Cristais", "hp": 16200, "atk": 494, "xp": 8000, "level": 79, "coins": (1100, 2000)},
        "resources": ["Cristal puro", "Fragmento de diamante", "EssÃªncia cristalina", "PÃ³ de safira", "NÃºcleo de quartzo"],
        "dungeons": [
            {"name": "Caverna das Gemas Vivas", "level": 25, "boss": "GuardiÃ£o das Gemas"},
            {"name": "PalÃ¡cio de Diamante", "level": 26, "boss": "Rei Cristalino"},
            {"name": "Labirinto de Esmeralda", "level": 27, "boss": "AraÃ±a de Rubi"}
        ],
        "secret_dungeons": [
            {"name": "ğŸŒŸ NÃºcleo Cristalino Primordial", "level": 25, "boss": "Entidade do Cristal Vivo", "secret": True,
             "special_boss_drop": "Ancestral", "key_name": "ğŸ—ï¸ Chave do Cristal Primordial"},
            {"name": "ğŸ’  CÃ¢mara do Diamante Negro", "level": 26, "boss": "Sombra Cristalizada", "secret": True,
             "special_boss_drop": "MÃ­tico", "key_name": "ğŸ—ï¸ Chave do Diamante Negro"}
        ],
        "events": [
            "Ãrvores de cristal cantam com o vento.", "Seu reflexo se move sozinho nos cristais.",
            "Um cristal explode liberando energia pura.", "VocÃª encontra uma floresta de estalactites coloridas.",
            "Luz se refrata criando arco-Ã­ris em todas as direÃ§Ãµes.", "Um elemental cristalino te oferece um fragmento.",
            "VocÃª vÃª o futuro refletido em um cristal gigante.", "Cristais pulsam com batimentos cardÃ­acos."
        ],
        "exclusive_drops": {
            "weapons": ["Espada de Diamante Negro", "Cajado Cristalino"],
            "armor": ["Armadura de Cristal Vivo", "Manto de Safira"]
        }
    },
    # â”€â”€â”€ REINO 10: REINO DAS SOMBRAS ETERNAS (desbloqueado no nÃ­vel 80) â”€â”€â”€
    80: {
        "name": "ğŸŒ‘ Reino das Sombras Eternas",
        "emoji": "ğŸŒ‘",
        "xp_loss_multiplier": 2.5,
        "monsters": {
            "Sombra Viva": {"xp": (240, 290), "hp": 720, "atk": 105, "coins": (32, 58)},
            "Espectro Eterno": {"xp": (245, 295), "hp": 740, "atk": 108, "coins": (33, 60)},
            "Lich Ancestral": {"xp": (250, 300), "hp": 760, "atk": 112, "coins": (35, 63)},
            "DemÃ´nio das Trevas": {"xp": (255, 305), "hp": 780, "atk": 115, "coins": (36, 65)},
            "Senhor das Sombras Menor": {"xp": (260, 310), "hp": 800, "atk": 118, "coins": (38, 68)}
        },
        "boss": {"name": "Rei das Sombras Eternas", "hp": 21600, "atk": 585, "xp": 10000, "level": 89, "coins": (1400, 2500)},
        "resources": ["EssÃªncia das trevas", "Cristal da sombra", "NÃºcleo espectral", "Poeira negra", "LÃ¡grima de espectro"],
        "dungeons": [
            {"name": "Torre do Vazio", "level": 28, "boss": "Arquimago das Trevas"},
            {"name": "Catacumba Eterna", "level": 29, "boss": "Lich Supremo"},
            {"name": "Portal das Sombras", "level": 30, "boss": "GuardiÃ£o do Vazio"}
        ],
        "secret_dungeons": [
            {"name": "â™¾ï¸ CoraÃ§Ã£o das Trevas Infinitas", "level": 28, "boss": "Entidade Sem Forma", "secret": True,
             "special_boss_drop": "Ancestral", "key_name": "ğŸ—ï¸ Chave das Trevas Infinitas"},
            {"name": "ğŸ’€ Trono do Lich Eterno", "level": 29, "boss": "Lich da Eternidade", "secret": True,
             "special_boss_drop": "Divino", "key_name": "ğŸ—ï¸ Chave do Lich Eterno"}
        ],
        "events": [
            "A escuridÃ£o aqui Ã© diferente â€” ela te observa.", "Suas prÃ³prias sombras tentam te prender.",
            "Vozes dos mortos sussurram seus maiores medos.", "Luz nÃ£o existe aqui â€” apenas graus de escuridÃ£o.",
            "Um portal para o vazio se abre brevemente.", "Espectros de aventureiros mortos vagam perdidos.",
            "VocÃª sente sua essÃªncia sendo drenada.", "O tempo aqui se move de forma diferente."
        ],
        "exclusive_drops": {
            "weapons": ["Foice das Sombras Eternas", "Cajado do Vazio Profundo"],
            "armor": ["Manto da EscuridÃ£o Absoluta", "Armadura Espectral"]
        }
    },
    # â”€â”€â”€ REINO 11: PLANÃCIES DO TROVÃƒO (desbloqueado no nÃ­vel 90) â”€â”€â”€
    90: {
        "name": "âš¡ PlanÃ­cies do TrovÃ£o",
        "emoji": "âš¡",
        "xp_loss_multiplier": 2.7,
        "monsters": {
            "Elemental do TrovÃ£o": {"xp": (270, 320), "hp": 820, "atk": 122, "coins": (40, 70)},
            "Gigante da Tempestade": {"xp": (275, 325), "hp": 850, "atk": 125, "coins": (42, 73)},
            "Grifo da RelÃ¢mpago": {"xp": (280, 330), "hp": 870, "atk": 128, "coins": (43, 75)},
            "TitÃ£ do Vento": {"xp": (285, 335), "hp": 900, "atk": 132, "coins": (45, 78)},
            "DragÃ£o do TrovÃ£o": {"xp": (290, 340), "hp": 920, "atk": 135, "coins": (46, 80)}
        },
        "boss": {"name": "Zeus Menor, o Trovejante", "hp": 27000, "atk": 676, "xp": 12000, "level": 99, "coins": (1700, 3000)},
        "resources": ["EssÃªncia do trovÃ£o", "Cristal elÃ©trico", "Pena de grifo", "NÃºcleo da tempestade", "RelÃ¢mpago engarrafado"],
        "dungeons": [
            {"name": "Fortaleza da Tempestade", "level": 31, "boss": "Lorde da Tempestade"},
            {"name": "Caverna do Raio", "level": 32, "boss": "Elemental de Plasma"},
            {"name": "Pico do TrovÃ£o", "level": 33, "boss": "Grifo AnciÃ£o"}
        ],
        "secret_dungeons": [
            {"name": "âš¡ Olho da Tempestade Eterna", "level": 31, "boss": "A Tempestade Consciente", "secret": True,
             "special_boss_drop": "Divino", "key_name": "ğŸ—ï¸ Chave da Tempestade Eterna"},
            {"name": "ğŸŒ©ï¸ CÃ¢mara do Primeiro RelÃ¢mpago", "level": 32, "boss": "RelÃ¢mpago Primordial Vivo", "secret": True,
             "special_boss_drop": "Ancestral", "key_name": "ğŸ—ï¸ Chave do Primeiro RelÃ¢mpago"}
        ],
        "events": [
            "RelÃ¢mpagos caem ao seu redor sem parar.", "O chÃ£o conduz eletricidade â€” cada passo doi.",
            "Uma tempestade eterna bloqueia a visÃ£o.", "VocÃª vÃª figuras de trovÃ£o no cÃ©u.",
            "Grifos gigantes duelam acima de vocÃª.", "O ar cheira a ozÃ´nio e morte.",
            "Um raio atinge o chÃ£o perto de vocÃª criando uma cratera.", "TitÃ£s da tempestade marcham ao longe."
        ],
        "exclusive_drops": {
            "weapons": ["LanÃ§a do TrovÃ£o Divino", "Martelo de Zeus"],
            "armor": ["Armadura da Tempestade", "Manto do RelÃ¢mpago"]
        }
    },
    # â”€â”€â”€ REINO 12: TERRA DOS GIGANTES (desbloqueado no nÃ­vel 100) â”€â”€â”€
    100: {
        "name": "ğŸ—¿ Terra dos Gigantes",
        "emoji": "ğŸ—¿",
        "xp_loss_multiplier": 3.0,
        "monsters": {
            "Gigante de Pedra": {"xp": (300, 360), "hp": 1000, "atk": 145, "coins": (50, 88)},
            "TitÃ£ da Terra": {"xp": (310, 370), "hp": 1050, "atk": 150, "coins": (53, 92)},
            "Golias das RuÃ­nas": {"xp": (320, 380), "hp": 1100, "atk": 155, "coins": (56, 96)},
            "Colosso Antigo": {"xp": (330, 390), "hp": 1150, "atk": 160, "coins": (58, 100)},
            "Gigante de Gelo e Fogo": {"xp": (340, 400), "hp": 1200, "atk": 165, "coins": (60, 105)}
        },
        "boss": {"name": "Primeiro Gigante Primordial", "hp": 33750, "atk": 780, "xp": 15000, "level": 109, "coins": (2000, 3500)},
        "resources": ["Osso de gigante", "Pedra colossal", "Couro de titÃ£", "EssÃªncia primordial", "Cinza de colossus"],
        "dungeons": [
            {"name": "Fortaleza Colossal", "level": 34, "boss": "GuardiÃ£o Colossus"},
            {"name": "Sepultura dos Gigantes", "level": 35, "boss": "EspÃ­rito Gigante"},
            {"name": "PalÃ¡cio do TitÃ£", "level": 36, "boss": "TitÃ£ Guerreiro"}
        ],
        "secret_dungeons": [
            {"name": "ğŸ—¿ CoraÃ§Ã£o da Terra Antiga", "level": 34, "boss": "TitÃ£ da CriaÃ§Ã£o", "secret": True,
             "special_boss_drop": "Divino", "key_name": "ğŸ—ï¸ Chave da Terra Antiga"},
            {"name": "ğŸ’€ MausolÃ©u do Primeiro Gigante", "level": 35, "boss": "Alma do Primeiro Gigante", "secret": True,
             "special_boss_drop": "Divino", "key_name": "ğŸ—ï¸ Chave do Primeiro Gigante"}
        ],
        "events": [
            "Pegadas do tamanho de lagos marcam o solo.", "Um gigante dorme e sua respiraÃ§Ã£o causa ventos.",
            "Montanhas sÃ£o na verdade gigantes adormecidos.", "VocÃª Ã© pequeno demais para ser notado.",
            "Uma batalha de gigantes sacode o chÃ£o.", "Os ossos dos gigantes caÃ­dos formam colinas.",
            "Um gigante jovem te confunde com um inseto.", "A terra treme com cada passo dos colossos."
        ],
        "exclusive_drops": {
            "weapons": ["Clava do TitÃ£ Primordial", "LanÃ§a Colossal"],
            "armor": ["Placas do Primeiro Gigante", "CouraÃ§a Colossal"]
        }
    },
    # â”€â”€â”€ REINO 13: MAR DAS ALMAS (desbloqueado no nÃ­vel 110) â”€â”€â”€
    110: {
        "name": "ğŸŒŠ Mar das Almas",
        "emoji": "ğŸŒŠ",
        "xp_loss_multiplier": 3.2,
        "monsters": {
            "Kraken Jovem": {"xp": (350, 420), "hp": 1250, "atk": 170, "coins": (62, 110)},
            "Sereia Maldita": {"xp": (355, 425), "hp": 1200, "atk": 168, "coins": (60, 108)},
            "LeviatÃ£ Menor": {"xp": (360, 430), "hp": 1300, "atk": 175, "coins": (65, 115)},
            "Fantasma Marinho": {"xp": (365, 435), "hp": 1250, "atk": 172, "coins": (63, 112)},
            "GuardiÃ£o das Profundezas": {"xp": (370, 440), "hp": 1350, "atk": 178, "coins": (67, 118)}
        },
        "boss": {"name": "LeviatÃ£ das Almas", "hp": 40500, "atk": 884, "xp": 18000, "level": 119, "coins": (2300, 4000)},
        "resources": ["Escama de leviatÃ£", "PÃ©rola das profundezas", "EssÃªncia oceÃ¢nica", "Coral mÃ¡gico", "Ãgua das almas"],
        "dungeons": [
            {"name": "Navio Fantasma", "level": 37, "boss": "CapitÃ£o Espectral"},
            {"name": "Templo Submerso", "level": 38, "boss": "Sacerdote do Mar"},
            {"name": "Abismo OceÃ¢nico", "level": 39, "boss": "Kraken AnciÃ£o"}
        ],
        "secret_dungeons": [
            {"name": "ğŸŒŠ CoraÃ§Ã£o do Oceano Eterno", "level": 37, "boss": "O Mar Consciente", "secret": True,
             "special_boss_drop": "Divino", "key_name": "ğŸ—ï¸ Chave do Oceano Eterno"},
            {"name": "ğŸ™ CÃ¢mara do LeviatÃ£ Primordial", "level": 38, "boss": "LeviatÃ£ Primordial", "secret": True,
             "special_boss_drop": "Divino", "key_name": "ğŸ—ï¸ Chave do LeviatÃ£ Primordial"}
        ],
        "events": [
            "Ondas gigantescas surgem do nada.", "VocÃª vÃª cidades afundadas nas profundezas.",
            "Sereias cantam tentando te hipnotizar.", "Um kraken emerge brevemente.",
            "O mar muda de cor para vermelho sangue.", "Almas de marinheiros mortos pedem ajuda.",
            "Um vÃ³rtice gigante se forma ao longe.", "Criaturas abissais sobem Ã  superfÃ­cie."
        ],
        "exclusive_drops": {
            "weapons": ["Tridente do LeviatÃ£", "LanÃ§a das Profundezas"],
            "armor": ["Armadura das Almas Marinhas", "Manto do Oceano Eterno"]
        }
    },
    # â”€â”€â”€ REINO 14: REINO DO CAOS (desbloqueado no nÃ­vel 120) â”€â”€â”€
    120: {
        "name": "ğŸŒ€ Reino do Caos",
        "emoji": "ğŸŒ€",
        "xp_loss_multiplier": 3.5,
        "monsters": {
            "Entidade do Caos": {"xp": (400, 480), "hp": 1400, "atk": 190, "coins": (70, 125)},
            "Fragmento de Realidade": {"xp": (410, 490), "hp": 1350, "atk": 185, "coins": (68, 122)},
            "DemÃ´nio do Vazio CaÃ³tico": {"xp": (420, 500), "hp": 1450, "atk": 195, "coins": (72, 128)},
            "Paradoxo Vivo": {"xp": (430, 510), "hp": 1500, "atk": 200, "coins": (75, 132)},
            "ContradiÃ§Ã£o Manifesta": {"xp": (440, 520), "hp": 1550, "atk": 205, "coins": (78, 136)}
        },
        "boss": {"name": "O Caos em Pessoa", "hp": 51300, "atk": 1014, "xp": 22000, "level": 129, "coins": (2800, 4800)},
        "resources": ["EssÃªncia caÃ³tica", "Fragmento de paradoxo", "Cristal do vazio caÃ³tico", "PÃ³ dimensional", "Runa do caos"],
        "dungeons": [
            {"name": "Nexo CaÃ³tico", "level": 40, "boss": "GuardiÃ£o do Nexo"},
            {"name": "DimensÃ£o Fragmentada", "level": 41, "boss": "Entidade Fragmentada"},
            {"name": "CÃ¢mara do Paradoxo", "level": 42, "boss": "O Paradoxo Absoluto"}
        ],
        "secret_dungeons": [
            {"name": "ğŸŒ€ Epicentro do Caos Primordial", "level": 40, "boss": "Caos Puro Manifestado", "secret": True,
             "special_boss_drop": "Divino", "key_name": "ğŸ—ï¸ Chave do Caos Primordial"},
            {"name": "â™¾ï¸ Loop do Caos Eterno", "level": 41, "boss": "O Infinito Consciente", "secret": True,
             "special_boss_drop": "Primordial", "key_name": "ğŸ—ï¸ Chave do Caos Eterno"}
        ],
        "events": [
            "A realidade se dobra ao seu redor.", "VocÃª existe em dois lugares ao mesmo tempo.",
            "O passado e o futuro se misturam.", "Criaturas impossÃ­veis vagam livres.",
            "VocÃª vÃª sua prÃ³pria morte â€” mas em outra linha temporal.", "A gravidade muda de direÃ§Ã£o.",
            "Cores impossÃ­veis preenchem o horizonte.", "Tudo aqui viola as leis da fÃ­sica."
        ],
        "exclusive_drops": {
            "weapons": ["LÃ¢mina do Caos Absoluto", "Cetro da Entropia"],
            "armor": ["Vestes do Caos Vivente", "Armadura do Paradoxo"]
        }
    },
    # â”€â”€â”€ REINO 15: JARDIM DOS DEUSES (desbloqueado no nÃ­vel 130) â”€â”€â”€
    130: {
        "name": "ğŸŒ¸ Jardim dos Deuses",
        "emoji": "ğŸŒ¸",
        "xp_loss_multiplier": 3.8,
        "monsters": {
            "GuardiÃ£o Divino Menor": {"xp": (460, 550), "hp": 1600, "atk": 215, "coins": (82, 145)},
            "Criatura do ParaÃ­so": {"xp": (470, 560), "hp": 1650, "atk": 220, "coins": (85, 150)},
            "Anjo Renegado": {"xp": (480, 570), "hp": 1700, "atk": 225, "coins": (88, 155)},
            "Serafim CaÃ­do": {"xp": (490, 580), "hp": 1750, "atk": 230, "coins": (90, 160)},
            "Querubim Corrompido": {"xp": (500, 590), "hp": 1800, "atk": 235, "coins": (93, 165)}
        },
        "boss": {"name": "Jardineiro Divino", "hp": 62100, "atk": 1144, "xp": 26000, "level": 139, "coins": (3300, 5600)},
        "resources": ["PÃ©tala divina", "Semente celestial", "NÃ©ctar dos deuses", "Espinho sagrado", "Raiz do paraÃ­so"],
        "dungeons": [
            {"name": "Labirinto do ParaÃ­so", "level": 43, "boss": "GuardiÃ£o do Labirinto"},
            {"name": "Templo da Deusa Floral", "level": 44, "boss": "Avatar da Deusa"},
            {"name": "CÃ¢mara das Sementes Proibidas", "level": 45, "boss": "EspÃ­rito da Natureza Divina"}
        ],
        "secret_dungeons": [
            {"name": "ğŸŒ¸ CÃ¢mara da Primeira Flor", "level": 43, "boss": "A Primeira Flor Consciente", "secret": True,
             "special_boss_drop": "Divino", "key_name": "ğŸ—ï¸ Chave da Primeira Flor"},
            {"name": "âœ¨ NÃºcleo do Jardim Proibido", "level": 44, "boss": "Deus Jardineiro Oculto", "secret": True,
             "special_boss_drop": "Primordial", "key_name": "ğŸ—ï¸ Chave do Jardim Proibido"}
        ],
        "events": [
            "Flores que cantam te rodeiam.", "Frutos proibidos brilham convidativamente.",
            "Anjos fazem rondas pelo jardim.", "Uma fonte de Ã¡gua da vida surge no caminho.",
            "O perfume de mil flores te envolve.", "Um deus menor passeia distraÃ­do.",
            "Ãrvores da vida crescem atÃ© o cÃ©u.", "VocÃª sente paz absoluta â€” e perigo absoluto."
        ],
        "exclusive_drops": {
            "weapons": ["Espada da Primeira Flor", "Arco do ParaÃ­so"],
            "armor": ["Vestes do Jardim Divino", "Armadura de PÃ©talas Sagradas"]
        }
    },
    # â”€â”€â”€ REINO 16: REINO DO GELO ETERNO (desbloqueado no nÃ­vel 140) â”€â”€â”€
    140: {
        "name": "ğŸ§Š Reino do Gelo Eterno",
        "emoji": "ğŸ§Š",
        "xp_loss_multiplier": 4.0,
        "monsters": {
            "DragÃ£o de Gelo AnciÃ£o": {"xp": (520, 620), "hp": 1900, "atk": 248, "coins": (96, 170)},
            "TitÃ£ do Gelo": {"xp": (530, 630), "hp": 1950, "atk": 252, "coins": (98, 174)},
            "Colosso Glacial": {"xp": (540, 640), "hp": 2000, "atk": 256, "coins": (100, 178)},
            "Elemental do Gelo Eterno": {"xp": (550, 650), "hp": 2050, "atk": 260, "coins": (102, 182)},
            "Rainha das Banshees": {"xp": (560, 660), "hp": 2100, "atk": 265, "coins": (105, 186)}
        },
        "boss": {"name": "Imperadora do Gelo Eterno", "hp": 74250, "atk": 1274, "xp": 30000, "level": 149, "coins": (3800, 6500)},
        "resources": ["Gelo eterno", "Cristal do frio absoluto", "Fragmento glacial divino", "Alma congelada", "NÃºcleo do inverno eterno"],
        "dungeons": [
            {"name": "Fortaleza do Gelo Eterno", "level": 46, "boss": "General Glacial"},
            {"name": "CÃ¢mara da Rainha das Neves", "level": 47, "boss": "Rainha das Neves"},
            {"name": "NÃºcleo do Inverno Absoluto", "level": 48, "boss": "EspÃ­rito do Inverno Eterno"}
        ],
        "secret_dungeons": [
            {"name": "ğŸ§Š CoraÃ§Ã£o do Gelo Primordial", "level": 46, "boss": "Gelo Primordial Consciente", "secret": True,
             "special_boss_drop": "Divino", "key_name": "ğŸ—ï¸ Chave do Gelo Primordial"},
            {"name": "â„ï¸ CÃ¢mara da ExtinÃ§Ã£o Gelada", "level": 47, "boss": "O Frio Absoluto", "secret": True,
             "special_boss_drop": "Primordial", "key_name": "ğŸ—ï¸ Chave da ExtinÃ§Ã£o Gelada"}
        ],
        "events": [
            "O frio aqui congela os prÃ³prios pensamentos.", "DragÃµes de gelo dormem em torno de vocÃª.",
            "Tudo que vocÃª toca vira gelo.", "A temperatura Ã© impossÃ­vel para mortais suportarem.",
            "Cristais de gelo formam figuras de antigas batalhas.", "VocÃª encontra herÃ³is congelados no tempo.",
            "Uma tempestade de gelo absoluto surge.", "O reino inteiro parece respirar frio."
        ],
        "exclusive_drops": {
            "weapons": ["LanÃ§a do Gelo Eterno", "Espada da ExtinÃ§Ã£o Glacial"],
            "armor": ["Armadura do Inverno Absoluto", "Vestes da Imperadora Glacial"]
        }
    },
    # â”€â”€â”€ REINO 17: RUÃNAS DA CIVILIZAÃ‡ÃƒO PERDIDA (desbloqueado no nÃ­vel 150) â”€â”€â”€
    150: {
        "name": "ğŸ›ï¸ RuÃ­nas da CivilizaÃ§Ã£o Perdida",
        "emoji": "ğŸ›ï¸",
        "xp_loss_multiplier": 4.3,
        "monsters": {
            "GuardiÃ£o AutÃ´mato": {"xp": (580, 690), "hp": 2200, "atk": 275, "coins": (108, 192)},
            "Construto Arcano": {"xp": (590, 700), "hp": 2250, "atk": 280, "coins": (110, 196)},
            "Seninela Antiga": {"xp": (600, 710), "hp": 2300, "atk": 285, "coins": (112, 200)},
            "Arma Viva Abandonada": {"xp": (610, 720), "hp": 2350, "atk": 290, "coins": (115, 205)},
            "EspÃ­rito do Inventor": {"xp": (620, 730), "hp": 2400, "atk": 295, "coins": (118, 210)}
        },
        "boss": {"name": "Rei-AutÃ´mato da CivilizaÃ§Ã£o Perdida", "hp": 87750, "atk": 1430, "xp": 35000, "level": 159, "coins": (4400, 7500)},
        "resources": ["Engrenagem arcana", "Metal da era perdida", "Cristal de memÃ³ria", "Runa esquecida", "NÃºcleo de construto"],
        "dungeons": [
            {"name": "FÃ¡brica de Golens Arcanos", "level": 49, "boss": "Mestre Construtor"},
            {"name": "Biblioteca da CivilizaÃ§Ã£o Perdida", "level": 50, "boss": "GuardiÃ£o do Conhecimento Perdido"},
            {"name": "CÃ¢mara do Ãšltimo Rei", "level": 51, "boss": "Fantasma do Ãšltimo Rei"}
        ],
        "secret_dungeons": [
            {"name": "ğŸ›ï¸ CoraÃ§Ã£o da CivilizaÃ§Ã£o Proibida", "level": 49, "boss": "O Criador Esquecido", "secret": True,
             "special_boss_drop": "Primordial", "key_name": "ğŸ—ï¸ Chave da CivilizaÃ§Ã£o Proibida"},
            {"name": "âš™ï¸ CÃ¢mara da Arma Final", "level": 50, "boss": "A Arma que Destruiu Tudo", "secret": True,
             "special_boss_drop": "Primordial", "key_name": "ğŸ—ï¸ Chave da Arma Final"}
        ],
        "events": [
            "MÃ¡quinas antigas ainda funcionam sem operadores.", "Hologramas de uma civilizaÃ§Ã£o florescente.",
            "Registros de uma civilizaÃ§Ã£o mais avanÃ§ada que a atual.", "AutÃ´matos te saÃºdam como se vocÃª fosse seu mestre.",
            "VocÃª encontra a memÃ³ria coletiva de uma civilizaÃ§Ã£o.", "Armas proibidas estÃ£o guardadas aqui.",
            "A tecnologia aqui Ã© incompreensÃ­vel para os atuais.", "VocÃª lÃª profecias que jÃ¡ se realizaram."
        ],
        "exclusive_drops": {
            "weapons": ["Arma da CivilizaÃ§Ã£o Perdida", "Cajado do Ãšltimo Mago"],
            "armor": ["Armadura do Rei-AutÃ´mato", "Vestes do Inventor Supremo"]
        }
    },
    # â”€â”€â”€ REINO 18: PLANO ASTRAL (desbloqueado no nÃ­vel 160) â”€â”€â”€
    160: {
        "name": "âœ¨ Plano Astral",
        "emoji": "âœ¨",
        "xp_loss_multiplier": 4.6,
        "monsters": {
            "Ser Astral": {"xp": (650, 770), "hp": 2500, "atk": 310, "coins": (122, 218)},
            "Entidade CÃ³smica Menor": {"xp": (660, 780), "hp": 2550, "atk": 315, "coins": (125, 222)},
            "GuardiÃ£o da Realidade": {"xp": (670, 790), "hp": 2600, "atk": 320, "coins": (128, 226)},
            "Viajante entre Mundos": {"xp": (680, 800), "hp": 2650, "atk": 325, "coins": (130, 230)},
            "Avatar Astral": {"xp": (690, 810), "hp": 2700, "atk": 330, "coins": (133, 235)}
        },
        "boss": {"name": "Senhor do Plano Astral", "hp": 105300, "atk": 1625, "xp": 42000, "level": 169, "coins": (5200, 9000)},
        "resources": ["EssÃªncia astral pura", "Cristal da consciÃªncia", "Fragmento cÃ³smico", "Luz das estrelas mortas", "NÃºcleo astral"],
        "dungeons": [
            {"name": "Nexo das ConsciÃªncias", "level": 52, "boss": "Mente Coletiva"},
            {"name": "Portal das Estrelas Mortas", "level": 53, "boss": "GuardiÃ£o das Estrelas"},
            {"name": "CÃ¢mara da ExistÃªncia", "level": 54, "boss": "Entidade da ExistÃªncia"}
        ],
        "secret_dungeons": [
            {"name": "âœ¨ CoraÃ§Ã£o do Cosmos", "level": 52, "boss": "O Cosmos em Pessoa", "secret": True,
             "special_boss_drop": "Primordial", "key_name": "ğŸ—ï¸ Chave do CoraÃ§Ã£o do Cosmos"},
            {"name": "ğŸŒŒ CÃ¢mara AlÃ©m da ExistÃªncia", "level": 53, "boss": "O Que Existe AlÃ©m", "secret": True,
             "special_boss_drop": "Primordial", "key_name": "ğŸ—ï¸ Chave do AlÃ©m da ExistÃªncia"}
        ],
        "events": [
            "VocÃª flutua entre estrelas e galÃ¡xias.", "Seu corpo astral se separa do fÃ­sico.",
            "VocÃª vÃª todos os mundos simultaneamente.", "Entidades cÃ³smicas conversam sobre vocÃª.",
            "O tempo nÃ£o existe aqui â€” tudo Ã© eterno.", "VocÃª encontra sua prÃ³pria alma.",
            "GalÃ¡xias nascem e morrem ao seu redor.", "O universo inteiro parece ser um ser vivo."
        ],
        "exclusive_drops": {
            "weapons": ["Espada do Cosmos", "Cajado da ConsciÃªncia Universal"],
            "armor": ["Armadura do Plano Astral", "Vestes da Entidade CÃ³smica"]
        }
    },
    # â”€â”€â”€ REINO 19: ALÃ‰M DA EXISTÃŠNCIA (desbloqueado no nÃ­vel 170) â”€â”€â”€
    170: {
        "name": "ğŸŒŒ AlÃ©m da ExistÃªncia",
        "emoji": "ğŸŒŒ",
        "xp_loss_multiplier": 5.0,
        "monsters": {
            "Conceito Vivo": {"xp": (720, 860), "hp": 2900, "atk": 350, "coins": (138, 248)},
            "Ideia Manifestada": {"xp": (730, 870), "hp": 2950, "atk": 355, "coins": (140, 252)},
            "Possibilidade Mortal": {"xp": (740, 880), "hp": 3000, "atk": 360, "coins": (142, 256)},
            "Destino em Forma": {"xp": (750, 890), "hp": 3050, "atk": 365, "coins": (145, 260)},
            "O Fim Personificado": {"xp": (760, 900), "hp": 3100, "atk": 370, "coins": (148, 265)}
        },
        "boss": {"name": "O Que Existe AlÃ©m de Tudo", "hp": 128250, "atk": 1885, "xp": 52000, "level": 179, "coins": (6200, 10800)},
        "resources": ["EssÃªncia do nada", "Fragmento do alÃ©m", "Cristal da nÃ£o-existÃªncia", "PÃ³ do antes do comeÃ§o", "NÃºcleo da possibilidade"],
        "dungeons": [
            {"name": "CÃ¢mara do Nada Absoluto", "level": 55, "boss": "GuardiÃ£o do Nada"},
            {"name": "Portal para o AlÃ©m", "level": 56, "boss": "Aquele que Guarda a Porta"},
            {"name": "O Fim de Tudo", "level": 57, "boss": "A Morte em Pessoa"}
        ],
        "secret_dungeons": [
            {"name": "ğŸŒŒ O Verdadeiro Fim", "level": 55, "boss": "A Ãšltima Coisa que Existe", "secret": True,
             "special_boss_drop": "Primordial", "key_name": "ğŸ—ï¸ Chave do Verdadeiro Fim"},
            {"name": "â™¾ï¸ CÃ¢mara do ComeÃ§o e do Fim", "level": 56, "boss": "O Alpha e o Omega", "secret": True,
             "special_boss_drop": "Primordial", "key_name": "ğŸ—ï¸ Chave do Alpha e Omega"}
        ],
        "events": [
            "VocÃª existe mas nÃ£o deveria.", "Suas memÃ³rias comeÃ§am a desaparecer.",
            "O nada te chama pelo nome.", "VocÃª vÃª o fim de todas as coisas.",
            "Conceitos se materializam e te atacam.", "A linguagem nÃ£o consegue descrever o que vocÃª vÃª.",
            "VocÃª encontra coisas que ainda nÃ£o foram criadas.", "O prÃ³prio universo parece terminar aqui."
        ],
        "exclusive_drops": {
            "weapons": ["Espada do AlÃ©m", "Cetro da NÃ£o-ExistÃªncia"],
            "armor": ["Armadura do Nada Absoluto", "Vestes do Conceito de Poder"]
        }
    },
    # â”€â”€â”€ REINO 20: O TRONO PRIMORDIAL (desbloqueado no nÃ­vel 180) â”€â”€â”€
    180: {
        "name": "â­ O Trono Primordial",
        "emoji": "â­",
        "xp_loss_multiplier": 6.0,
        "monsters": {
            "GuardiÃ£o Primordial": {"xp": (800, 960), "hp": 3500, "atk": 420, "coins": (160, 285)},
            "Entidade Anterior Ã  CriaÃ§Ã£o": {"xp": (820, 980), "hp": 3600, "atk": 430, "coins": (165, 292)},
            "Ser do Antes do Tempo": {"xp": (840, 1000), "hp": 3700, "atk": 440, "coins": (170, 300)},
            "Conceito de Divindade": {"xp": (860, 1020), "hp": 3800, "atk": 450, "coins": (175, 308)},
            "A PrÃ³pria CriaÃ§Ã£o": {"xp": (880, 1040), "hp": 3900, "atk": 460, "coins": (180, 316)}
        },
        "boss": {"name": "O Criador Primordial", "hp": 202500, "atk": 2600, "xp": 80000, "level": 200, "coins": (10000, 18000)},
        "resources": ["EssÃªncia da criaÃ§Ã£o", "Fragmento primordial puro", "Cristal do antes do comeÃ§o", "Luz da primeira estrela", "Semente de universo"],
        "dungeons": [
            {"name": "CÃ¢mara do Primeiro Ser", "level": 58, "boss": "O Primeiro Ser"},
            {"name": "Trono da CriaÃ§Ã£o", "level": 59, "boss": "GuardiÃ£o do Trono"},
            {"name": "O Centro de Tudo", "level": 60, "boss": "A Fonte de Todo Poder"}
        ],
        "secret_dungeons": [
            {"name": "â­ O Verdadeiro Trono Primordial", "level": 58, "boss": "O Criador Oculto", "secret": True,
             "special_boss_drop": "Primordial", "key_name": "ğŸ—ï¸ Chave do Trono Primordial"},
            {"name": "ğŸŒŒ CÃ¢mara do Criador Esquecido", "level": 59, "boss": "Aquele que Criou os Criadores", "secret": True,
             "special_boss_drop": "Primordial", "key_name": "ğŸ—ï¸ Chave do Criador Esquecido"}
        ],
        "events": [
            "VocÃª estÃ¡ no centro de toda existÃªncia.", "O Criador te testa silenciosamente.",
            "Universos nascem ao seu redor como bolhas.", "VocÃª ouve a voz que disse 'que haja luz'.",
            "Tudo que vocÃª tocou foi criado por uma vontade superior.", "O trono estÃ¡ vazio â€” esperando.",
            "VocÃª vÃª o plano de toda a existÃªncia.", "A prÃ³pria realidade te reverencia.",
            "VocÃª encontra o sentido de tudo.", "Sua chegada aqui era esperada desde o inÃ­cio.",
            "O Criador sorri. VocÃª chegou atÃ© aqui.", "A Ãºltima aventura comeÃ§a agora."
        ],
        "exclusive_drops": {
            "weapons": ["Espada do Criador Primordial", "O Cetro que Criou Tudo"],
            "armor": ["Armadura da CriaÃ§Ã£o Absoluta", "Vestes do GuardiÃ£o do Trono"]
        }
    },
    190: {
        "name": "ğŸ”± ğŸ”± Reinos Mortais â€” Ãpice",
        "emoji": "ğŸ”±",
        "xp_loss_multiplier": 8.0,
        "monsters": {
            "Soberanos Mortais Alpha": {"xp": (660, 880), "hp": 2200, "atk": 490, "coins": (38, 63)},
            "Soberanos Mortais Supremo": {"xp": (680, 905), "hp": 2250, "atk": 495, "coins": (40, 68)},
            "Elite Soberanos Mortais": {"xp": (700, 930), "hp": 2300, "atk": 500, "coins": (42, 73)},
            "Soberanos Mortais AnciÃ£o": {"xp": (720, 955), "hp": 2350, "atk": 505, "coins": (44, 78)},
            "Soberanos Mortais LendÃ¡rio": {"xp": (740, 980), "hp": 2400, "atk": 510, "coins": (46, 83)},
        },
        "boss": {"name": "Soberano Mortal Supremo", "hp": 95000, "atk": 3000, "xp": 150000, "level": 199, "coins": (21000, 37800)},
        "resources": ['EssÃªncia do NÃ­vel 190', 'Fragmento Dimensional 1', 'Cristal do Ciclo 1', 'Runa Absoluta', 'PÃ³ Primordial AvanÃ§ado'],
        "dungeons": [
            {"name": "Masmorra ğŸ”± Reinos Mortais â€” Ãpice I", "level": 20, "boss": "GuardiÃ£o Interno 190"},
            {"name": "Masmorra ğŸ”± Reinos Mortais â€” Ãpice II", "level": 21, "boss": "GuardiÃ£o Sombrio 190"},
            {"name": "SantuÃ¡rio do NÃ­vel 190", "level": 22, "boss": "Senhor do SantuÃ¡rio 190"}
        ],
        "secret_dungeons": [
            {"name": "ğŸ” CÃ¢mara Secreta ğŸ”± Reinos Mortais â€” Ãpice", "level": 20, "boss": "GuardiÃ£o Oculto 190", "secret": True, "special_boss_drop": "Absoluto", "key_name": "ğŸ—ï¸ Chave de ğŸ”± Reinos Mortais â€” Ãpice"},
            {"name": "ğŸŒŒ Portal Dimensional 190", "level": 21, "boss": "Entidade Portal 190", "secret": True, "special_boss_drop": "Transcendente", "key_name": "ğŸ—ï¸ Chave Portal 190"}
        ],
        "events": [
            "VocÃª sente o peso do nÃ­vel 190 ao seu redor.", "A realidade aqui Ã© diferente de tudo que vocÃª conhecia.",
            "Criaturas de poder incompreensÃ­vel observam sua passagem.", "Cada passo aqui Ã© uma conquista sem precedentes.",
            "O ar vibra com energia Mortal Supremo.", "VocÃª estÃ¡ entre os mais fortes jÃ¡ registrados neste plano.",
            "O horizonte aqui nÃ£o existe â€” sÃ³ poder infinito.", "Sua presenÃ§a aqui altera o tecido da realidade.",
            "Nenhum mortal comum sobreviveria neste lugar.", "VocÃª forjou seu prÃ³prio destino chegando atÃ© aqui.",
            "Os GuardiÃµes te testam constantemente.", "Cada batalha aqui redefine seus limites.",
        ],
        "exclusive_drops": {
            "weapons": ["Arma do Plano Mortal Supremo 190", "LÃ¢mina Dimensional NÃ­vel 190"],
            "armor": ["Armadura Mortal Supremo 190", "Vestes do Ciclo 1"]
        }
    },
    200: {
        "name": "âš¡ âš¡ Reinos AvanÃ§ados â€” Despertar",
        "emoji": "âš¡",
        "xp_loss_multiplier": 8.5,
        "monsters": {
            "Sentinelas AvanÃ§adas Alpha": {"xp": (720, 960), "hp": 2400, "atk": 510, "coins": (40, 66)},
            "Sentinelas AvanÃ§adas Supremo": {"xp": (740, 985), "hp": 2450, "atk": 515, "coins": (42, 71)},
            "Elite Sentinelas AvanÃ§adas": {"xp": (760, 1010), "hp": 2500, "atk": 520, "coins": (44, 76)},
            "Sentinelas AvanÃ§adas AnciÃ£o": {"xp": (780, 1035), "hp": 2550, "atk": 525, "coins": (46, 81)},
            "Sentinelas AvanÃ§adas LendÃ¡rio": {"xp": (800, 1060), "hp": 2600, "atk": 530, "coins": (48, 86)},
        },
        "boss": {"name": "Despertar do AlÃ©m", "hp": 110000, "atk": 3200, "xp": 160000, "level": 209, "coins": (23000, 41400)},
        "resources": ['EssÃªncia do NÃ­vel 200', 'Fragmento Dimensional 2', 'Cristal do Ciclo 2', 'Runa Absoluta', 'PÃ³ Primordial AvanÃ§ado'],
        "dungeons": [
            {"name": "Masmorra âš¡ Reinos AvanÃ§ados â€” Despertar I", "level": 21, "boss": "GuardiÃ£o Interno 200"},
            {"name": "Masmorra âš¡ Reinos AvanÃ§ados â€” Despertar II", "level": 22, "boss": "GuardiÃ£o Sombrio 200"},
            {"name": "SantuÃ¡rio do NÃ­vel 200", "level": 23, "boss": "Senhor do SantuÃ¡rio 200"}
        ],
        "secret_dungeons": [
            {"name": "ğŸ” CÃ¢mara Secreta âš¡ Reinos AvanÃ§ados â€” Despertar", "level": 21, "boss": "GuardiÃ£o Oculto 200", "secret": True, "special_boss_drop": "Absoluto", "key_name": "ğŸ—ï¸ Chave de âš¡ Reinos AvanÃ§ados â€” Despertar"},
            {"name": "ğŸŒŒ Portal Dimensional 200", "level": 22, "boss": "Entidade Portal 200", "secret": True, "special_boss_drop": "Transcendente", "key_name": "ğŸ—ï¸ Chave Portal 200"}
        ],
        "events": [
            "VocÃª sente o peso do nÃ­vel 200 ao seu redor.", "A realidade aqui Ã© diferente de tudo que vocÃª conhecia.",
            "Criaturas de poder incompreensÃ­vel observam sua passagem.", "Cada passo aqui Ã© uma conquista sem precedentes.",
            "O ar vibra com energia AvanÃ§ado.", "VocÃª estÃ¡ entre os mais fortes jÃ¡ registrados neste plano.",
            "O horizonte aqui nÃ£o existe â€” sÃ³ poder infinito.", "Sua presenÃ§a aqui altera o tecido da realidade.",
            "Nenhum mortal comum sobreviveria neste lugar.", "VocÃª forjou seu prÃ³prio destino chegando atÃ© aqui.",
            "Os GuardiÃµes te testam constantemente.", "Cada batalha aqui redefine seus limites.",
        ],
        "exclusive_drops": {
            "weapons": ["Arma do Plano AvanÃ§ado 200", "LÃ¢mina Dimensional NÃ­vel 200"],
            "armor": ["Armadura AvanÃ§ado 200", "Vestes do Ciclo 2"]
        }
    },
    210: {
        "name": "ğŸŒ€ ğŸŒ€ VÃ³rtice dos Reinos",
        "emoji": "ğŸŒ€",
        "xp_loss_multiplier": 9.0,
        "monsters": {
            "Fragmentos de Realidade Alpha": {"xp": (780, 1040), "hp": 2600, "atk": 540, "coins": (42, 70)},
            "Fragmentos de Realidade Supremo": {"xp": (800, 1065), "hp": 2650, "atk": 545, "coins": (44, 75)},
            "Elite Fragmentos de Realidade": {"xp": (820, 1090), "hp": 2700, "atk": 550, "coins": (46, 80)},
            "Fragmentos de Realidade AnciÃ£o": {"xp": (840, 1115), "hp": 2750, "atk": 555, "coins": (48, 85)},
            "Fragmentos de Realidade LendÃ¡rio": {"xp": (860, 1140), "hp": 2800, "atk": 560, "coins": (50, 90)},
        },
        "boss": {"name": "Deus do VÃ³rtice", "hp": 130000, "atk": 3500, "xp": 170000, "level": 219, "coins": (25000, 45000)},
        "resources": ['EssÃªncia do NÃ­vel 210', 'Fragmento Dimensional 2', 'Cristal do Ciclo 2', 'Runa Absoluta', 'PÃ³ Primordial AvanÃ§ado'],
        "dungeons": [
            {"name": "Masmorra ğŸŒ€ VÃ³rtice dos Reinos I", "level": 22, "boss": "GuardiÃ£o Interno 210"},
            {"name": "Masmorra ğŸŒ€ VÃ³rtice dos Reinos II", "level": 23, "boss": "GuardiÃ£o Sombrio 210"},
            {"name": "SantuÃ¡rio do NÃ­vel 210", "level": 24, "boss": "Senhor do SantuÃ¡rio 210"}
        ],
        "secret_dungeons": [
            {"name": "ğŸ” CÃ¢mara Secreta ğŸŒ€ VÃ³rtice dos Reinos", "level": 22, "boss": "GuardiÃ£o Oculto 210", "secret": True, "special_boss_drop": "Absoluto", "key_name": "ğŸ—ï¸ Chave de ğŸŒ€ VÃ³rtice dos Reinos"},
            {"name": "ğŸŒŒ Portal Dimensional 210", "level": 23, "boss": "Entidade Portal 210", "secret": True, "special_boss_drop": "Transcendente", "key_name": "ğŸ—ï¸ Chave Portal 210"}
        ],
        "events": [
            "VocÃª sente o peso do nÃ­vel 210 ao seu redor.", "A realidade aqui Ã© diferente de tudo que vocÃª conhecia.",
            "Criaturas de poder incompreensÃ­vel observam sua passagem.", "Cada passo aqui Ã© uma conquista sem precedentes.",
            "O ar vibra com energia AvanÃ§ado.", "VocÃª estÃ¡ entre os mais fortes jÃ¡ registrados neste plano.",
            "O horizonte aqui nÃ£o existe â€” sÃ³ poder infinito.", "Sua presenÃ§a aqui altera o tecido da realidade.",
            "Nenhum mortal comum sobreviveria neste lugar.", "VocÃª forjou seu prÃ³prio destino chegando atÃ© aqui.",
            "Os GuardiÃµes te testam constantemente.", "Cada batalha aqui redefine seus limites.",
        ],
        "exclusive_drops": {
            "weapons": ["Arma do Plano AvanÃ§ado 210", "LÃ¢mina Dimensional NÃ­vel 210"],
            "armor": ["Armadura AvanÃ§ado 210", "Vestes do Ciclo 2"]
        }
    },
    220: {
        "name": "ğŸ”ï¸ ğŸ”ï¸ Montanhas do AlÃ©m",
        "emoji": "ğŸ”ï¸",
        "xp_loss_multiplier": 9.0,
        "monsters": {
            "TitÃ£s das Alturas Alpha": {"xp": (840, 1120), "hp": 2800, "atk": 570, "coins": (44, 73)},
            "TitÃ£s das Alturas Supremo": {"xp": (860, 1145), "hp": 2850, "atk": 575, "coins": (46, 78)},
            "Elite TitÃ£s das Alturas": {"xp": (880, 1170), "hp": 2900, "atk": 580, "coins": (48, 83)},
            "TitÃ£s das Alturas AnciÃ£o": {"xp": (900, 1195), "hp": 2950, "atk": 585, "coins": (50, 88)},
            "TitÃ£s das Alturas LendÃ¡rio": {"xp": (920, 1220), "hp": 3000, "atk": 590, "coins": (52, 93)},
        },
        "boss": {"name": "TitÃ£ das Alturas Eternas", "hp": 155000, "atk": 3800, "xp": 185000, "level": 229, "coins": (28000, 50400)},
        "resources": ['EssÃªncia do NÃ­vel 220', 'Fragmento Dimensional 2', 'Cristal do Ciclo 2', 'Runa Absoluta', 'PÃ³ Primordial AvanÃ§ado'],
        "dungeons": [
            {"name": "Masmorra ğŸ”ï¸ Montanhas do AlÃ©m I", "level": 23, "boss": "GuardiÃ£o Interno 220"},
            {"name": "Masmorra ğŸ”ï¸ Montanhas do AlÃ©m II", "level": 24, "boss": "GuardiÃ£o Sombrio 220"},
            {"name": "SantuÃ¡rio do NÃ­vel 220", "level": 25, "boss": "Senhor do SantuÃ¡rio 220"}
        ],
        "secret_dungeons": [
            {"name": "ğŸ” CÃ¢mara Secreta ğŸ”ï¸ Montanhas do AlÃ©m", "level": 23, "boss": "GuardiÃ£o Oculto 220", "secret": True, "special_boss_drop": "Absoluto", "key_name": "ğŸ—ï¸ Chave de ğŸ”ï¸ Montanhas do AlÃ©m"},
            {"name": "ğŸŒŒ Portal Dimensional 220", "level": 24, "boss": "Entidade Portal 220", "secret": True, "special_boss_drop": "Transcendente", "key_name": "ğŸ—ï¸ Chave Portal 220"}
        ],
        "events": [
            "VocÃª sente o peso do nÃ­vel 220 ao seu redor.", "A realidade aqui Ã© diferente de tudo que vocÃª conhecia.",
            "Criaturas de poder incompreensÃ­vel observam sua passagem.", "Cada passo aqui Ã© uma conquista sem precedentes.",
            "O ar vibra com energia AvanÃ§ado.", "VocÃª estÃ¡ entre os mais fortes jÃ¡ registrados neste plano.",
            "O horizonte aqui nÃ£o existe â€” sÃ³ poder infinito.", "Sua presenÃ§a aqui altera o tecido da realidade.",
            "Nenhum mortal comum sobreviveria neste lugar.", "VocÃª forjou seu prÃ³prio destino chegando atÃ© aqui.",
            "Os GuardiÃµes te testam constantemente.", "Cada batalha aqui redefine seus limites.",
        ],
        "exclusive_drops": {
            "weapons": ["Arma do Plano AvanÃ§ado 220", "LÃ¢mina Dimensional NÃ­vel 220"],
            "armor": ["Armadura AvanÃ§ado 220", "Vestes do Ciclo 2"]
        }
    },
    230: {
        "name": "ğŸŒŠ ğŸŒŠ Oceano Dimensional",
        "emoji": "ğŸŒŠ",
        "xp_loss_multiplier": 9.5,
        "monsters": {
            "Criaturas Interdimensionais Alpha": {"xp": (900, 1200), "hp": 3000, "atk": 600, "coins": (46, 76)},
            "Criaturas Interdimensionais Supremo": {"xp": (920, 1225), "hp": 3050, "atk": 605, "coins": (48, 81)},
            "Elite Criaturas Interdimensionais": {"xp": (940, 1250), "hp": 3100, "atk": 610, "coins": (50, 86)},
            "Criaturas Interdimensionais AnciÃ£o": {"xp": (960, 1275), "hp": 3150, "atk": 615, "coins": (52, 91)},
            "Criaturas Interdimensionais LendÃ¡rio": {"xp": (980, 1300), "hp": 3200, "atk": 620, "coins": (54, 96)},
        },
        "boss": {"name": "LeviatÃ£ Dimensional", "hp": 180000, "atk": 4100, "xp": 200000, "level": 239, "coins": (31000, 55800)},
        "resources": ['EssÃªncia do NÃ­vel 230', 'Fragmento Dimensional 2', 'Cristal do Ciclo 2', 'Runa Absoluta', 'PÃ³ Primordial AvanÃ§ado'],
        "dungeons": [
            {"name": "Masmorra ğŸŒŠ Oceano Dimensional I", "level": 24, "boss": "GuardiÃ£o Interno 230"},
            {"name": "Masmorra ğŸŒŠ Oceano Dimensional II", "level": 25, "boss": "GuardiÃ£o Sombrio 230"},
            {"name": "SantuÃ¡rio do NÃ­vel 230", "level": 26, "boss": "Senhor do SantuÃ¡rio 230"}
        ],
        "secret_dungeons": [
            {"name": "ğŸ” CÃ¢mara Secreta ğŸŒŠ Oceano Dimensional", "level": 24, "boss": "GuardiÃ£o Oculto 230", "secret": True, "special_boss_drop": "Absoluto", "key_name": "ğŸ—ï¸ Chave de ğŸŒŠ Oceano Dimensional"},
            {"name": "ğŸŒŒ Portal Dimensional 230", "level": 25, "boss": "Entidade Portal 230", "secret": True, "special_boss_drop": "Transcendente", "key_name": "ğŸ—ï¸ Chave Portal 230"}
        ],
        "events": [
            "VocÃª sente o peso do nÃ­vel 230 ao seu redor.", "A realidade aqui Ã© diferente de tudo que vocÃª conhecia.",
            "Criaturas de poder incompreensÃ­vel observam sua passagem.", "Cada passo aqui Ã© uma conquista sem precedentes.",
            "O ar vibra com energia AvanÃ§ado.", "VocÃª estÃ¡ entre os mais fortes jÃ¡ registrados neste plano.",
            "O horizonte aqui nÃ£o existe â€” sÃ³ poder infinito.", "Sua presenÃ§a aqui altera o tecido da realidade.",
            "Nenhum mortal comum sobreviveria neste lugar.", "VocÃª forjou seu prÃ³prio destino chegando atÃ© aqui.",
            "Os GuardiÃµes te testam constantemente.", "Cada batalha aqui redefine seus limites.",
        ],
        "exclusive_drops": {
            "weapons": ["Arma do Plano AvanÃ§ado 230", "LÃ¢mina Dimensional NÃ­vel 230"],
            "armor": ["Armadura AvanÃ§ado 230", "Vestes do Ciclo 2"]
        }
    },
    240: {
        "name": "ğŸ”¥ ğŸ”¥ Forjas do Caos",
        "emoji": "ğŸ”¥",
        "xp_loss_multiplier": 9.5,
        "monsters": {
            "Forjadores do Caos Alpha": {"xp": (960, 1280), "hp": 3200, "atk": 630, "coins": (48, 80)},
            "Forjadores do Caos Supremo": {"xp": (980, 1305), "hp": 3250, "atk": 635, "coins": (50, 85)},
            "Elite Forjadores do Caos": {"xp": (1000, 1330), "hp": 3300, "atk": 640, "coins": (52, 90)},
            "Forjadores do Caos AnciÃ£o": {"xp": (1020, 1355), "hp": 3350, "atk": 645, "coins": (54, 95)},
            "Forjadores do Caos LendÃ¡rio": {"xp": (1040, 1380), "hp": 3400, "atk": 650, "coins": (56, 100)},
        },
        "boss": {"name": "Senhor do Caos Ardente", "hp": 210000, "atk": 4500, "xp": 220000, "level": 249, "coins": (35000, 63000)},
        "resources": ['EssÃªncia do NÃ­vel 240', 'Fragmento Dimensional 2', 'Cristal do Ciclo 2', 'Runa Absoluta', 'PÃ³ Primordial AvanÃ§ado'],
        "dungeons": [
            {"name": "Masmorra ğŸ”¥ Forjas do Caos I", "level": 25, "boss": "GuardiÃ£o Interno 240"},
            {"name": "Masmorra ğŸ”¥ Forjas do Caos II", "level": 26, "boss": "GuardiÃ£o Sombrio 240"},
            {"name": "SantuÃ¡rio do NÃ­vel 240", "level": 27, "boss": "Senhor do SantuÃ¡rio 240"}
        ],
        "secret_dungeons": [
            {"name": "ğŸ” CÃ¢mara Secreta ğŸ”¥ Forjas do Caos", "level": 25, "boss": "GuardiÃ£o Oculto 240", "secret": True, "special_boss_drop": "Absoluto", "key_name": "ğŸ—ï¸ Chave de ğŸ”¥ Forjas do Caos"},
            {"name": "ğŸŒŒ Portal Dimensional 240", "level": 26, "boss": "Entidade Portal 240", "secret": True, "special_boss_drop": "Transcendente", "key_name": "ğŸ—ï¸ Chave Portal 240"}
        ],
        "events": [
            "VocÃª sente o peso do nÃ­vel 240 ao seu redor.", "A realidade aqui Ã© diferente de tudo que vocÃª conhecia.",
            "Criaturas de poder incompreensÃ­vel observam sua passagem.", "Cada passo aqui Ã© uma conquista sem precedentes.",
            "O ar vibra com energia AvanÃ§ado.", "VocÃª estÃ¡ entre os mais fortes jÃ¡ registrados neste plano.",
            "O horizonte aqui nÃ£o existe â€” sÃ³ poder infinito.", "Sua presenÃ§a aqui altera o tecido da realidade.",
            "Nenhum mortal comum sobreviveria neste lugar.", "VocÃª forjou seu prÃ³prio destino chegando atÃ© aqui.",
            "Os GuardiÃµes te testam constantemente.", "Cada batalha aqui redefine seus limites.",
        ],
        "exclusive_drops": {
            "weapons": ["Arma do Plano AvanÃ§ado 240", "LÃ¢mina Dimensional NÃ­vel 240"],
            "armor": ["Armadura AvanÃ§ado 240", "Vestes do Ciclo 2"]
        }
    },
    250: {
        "name": "â„ï¸ â„ï¸ Tundra Absoluta",
        "emoji": "â„ï¸",
        "xp_loss_multiplier": 10.0,
        "monsters": {
            "Fantasmas do Gelo Eterno Alpha": {"xp": (1020, 1360), "hp": 3400, "atk": 660, "coins": (50, 83)},
            "Fantasmas do Gelo Eterno Supremo": {"xp": (1040, 1385), "hp": 3450, "atk": 665, "coins": (52, 88)},
            "Elite Fantasmas do Gelo Eterno": {"xp": (1060, 1410), "hp": 3500, "atk": 670, "coins": (54, 93)},
            "Fantasmas do Gelo Eterno AnciÃ£o": {"xp": (1080, 1435), "hp": 3550, "atk": 675, "coins": (56, 98)},
            "Fantasmas do Gelo Eterno LendÃ¡rio": {"xp": (1100, 1460), "hp": 3600, "atk": 680, "coins": (58, 103)},
        },
        "boss": {"name": "EspÃ­rito do Gelo Primordial", "hp": 245000, "atk": 4900, "xp": 240000, "level": 259, "coins": (39000, 70200)},
        "resources": ['EssÃªncia do NÃ­vel 250', 'Fragmento Dimensional 2', 'Cristal do Ciclo 2', 'Runa Absoluta', 'PÃ³ Primordial AvanÃ§ado'],
        "dungeons": [
            {"name": "Masmorra â„ï¸ Tundra Absoluta I", "level": 26, "boss": "GuardiÃ£o Interno 250"},
            {"name": "Masmorra â„ï¸ Tundra Absoluta II", "level": 27, "boss": "GuardiÃ£o Sombrio 250"},
            {"name": "SantuÃ¡rio do NÃ­vel 250", "level": 28, "boss": "Senhor do SantuÃ¡rio 250"}
        ],
        "secret_dungeons": [
            {"name": "ğŸ” CÃ¢mara Secreta â„ï¸ Tundra Absoluta", "level": 26, "boss": "GuardiÃ£o Oculto 250", "secret": True, "special_boss_drop": "Absoluto", "key_name": "ğŸ—ï¸ Chave de â„ï¸ Tundra Absoluta"},
            {"name": "ğŸŒŒ Portal Dimensional 250", "level": 27, "boss": "Entidade Portal 250", "secret": True, "special_boss_drop": "Transcendente", "key_name": "ğŸ—ï¸ Chave Portal 250"}
        ],
        "events": [
            "VocÃª sente o peso do nÃ­vel 250 ao seu redor.", "A realidade aqui Ã© diferente de tudo que vocÃª conhecia.",
            "Criaturas de poder incompreensÃ­vel observam sua passagem.", "Cada passo aqui Ã© uma conquista sem precedentes.",
            "O ar vibra com energia AvanÃ§ado.", "VocÃª estÃ¡ entre os mais fortes jÃ¡ registrados neste plano.",
            "O horizonte aqui nÃ£o existe â€” sÃ³ poder infinito.", "Sua presenÃ§a aqui altera o tecido da realidade.",
            "Nenhum mortal comum sobreviveria neste lugar.", "VocÃª forjou seu prÃ³prio destino chegando atÃ© aqui.",
            "Os GuardiÃµes te testam constantemente.", "Cada batalha aqui redefine seus limites.",
        ],
        "exclusive_drops": {
            "weapons": ["Arma do Plano AvanÃ§ado 250", "LÃ¢mina Dimensional NÃ­vel 250"],
            "armor": ["Armadura AvanÃ§ado 250", "Vestes do Ciclo 2"]
        }
    },
    260: {
        "name": "âš—ï¸ âš—ï¸ Alquimia das Eras",
        "emoji": "âš—ï¸",
        "xp_loss_multiplier": 10.0,
        "monsters": {
            "Transmutadores Arcanos Alpha": {"xp": (1080, 1440), "hp": 3600, "atk": 700, "coins": (52, 86)},
            "Transmutadores Arcanos Supremo": {"xp": (1100, 1465), "hp": 3650, "atk": 705, "coins": (54, 91)},
            "Elite Transmutadores Arcanos": {"xp": (1120, 1490), "hp": 3700, "atk": 710, "coins": (56, 96)},
            "Transmutadores Arcanos AnciÃ£o": {"xp": (1140, 1515), "hp": 3750, "atk": 715, "coins": (58, 101)},
            "Transmutadores Arcanos LendÃ¡rio": {"xp": (1160, 1540), "hp": 3800, "atk": 720, "coins": (60, 106)},
        },
        "boss": {"name": "Grande Transmutador", "hp": 285000, "atk": 5300, "xp": 265000, "level": 269, "coins": (43000, 77400)},
        "resources": ['EssÃªncia do NÃ­vel 260', 'Fragmento Dimensional 2', 'Cristal do Ciclo 2', 'Runa Absoluta', 'PÃ³ Primordial AvanÃ§ado'],
        "dungeons": [
            {"name": "Masmorra âš—ï¸ Alquimia das Eras I", "level": 27, "boss": "GuardiÃ£o Interno 260"},
            {"name": "Masmorra âš—ï¸ Alquimia das Eras II", "level": 28, "boss": "GuardiÃ£o Sombrio 260"},
            {"name": "SantuÃ¡rio do NÃ­vel 260", "level": 29, "boss": "Senhor do SantuÃ¡rio 260"}
        ],
        "secret_dungeons": [
            {"name": "ğŸ” CÃ¢mara Secreta âš—ï¸ Alquimia das Eras", "level": 27, "boss": "GuardiÃ£o Oculto 260", "secret": True, "special_boss_drop": "Absoluto", "key_name": "ğŸ—ï¸ Chave de âš—ï¸ Alquimia das Eras"},
            {"name": "ğŸŒŒ Portal Dimensional 260", "level": 28, "boss": "Entidade Portal 260", "secret": True, "special_boss_drop": "Transcendente", "key_name": "ğŸ—ï¸ Chave Portal 260"}
        ],
        "events": [
            "VocÃª sente o peso do nÃ­vel 260 ao seu redor.", "A realidade aqui Ã© diferente de tudo que vocÃª conhecia.",
            "Criaturas de poder incompreensÃ­vel observam sua passagem.", "Cada passo aqui Ã© uma conquista sem precedentes.",
            "O ar vibra com energia AvanÃ§ado.", "VocÃª estÃ¡ entre os mais fortes jÃ¡ registrados neste plano.",
            "O horizonte aqui nÃ£o existe â€” sÃ³ poder infinito.", "Sua presenÃ§a aqui altera o tecido da realidade.",
            "Nenhum mortal comum sobreviveria neste lugar.", "VocÃª forjou seu prÃ³prio destino chegando atÃ© aqui.",
            "Os GuardiÃµes te testam constantemente.", "Cada batalha aqui redefine seus limites.",
        ],
        "exclusive_drops": {
            "weapons": ["Arma do Plano AvanÃ§ado 260", "LÃ¢mina Dimensional NÃ­vel 260"],
            "armor": ["Armadura AvanÃ§ado 260", "Vestes do Ciclo 2"]
        }
    },
    270: {
        "name": "ğŸŒŒ ğŸŒŒ GalÃ¡xia Interior",
        "emoji": "ğŸŒŒ",
        "xp_loss_multiplier": 10.5,
        "monsters": {
            "Estrelas Sencientes Alpha": {"xp": (1140, 1520), "hp": 3800, "atk": 740, "coins": (54, 90)},
            "Estrelas Sencientes Supremo": {"xp": (1160, 1545), "hp": 3850, "atk": 745, "coins": (56, 95)},
            "Elite Estrelas Sencientes": {"xp": (1180, 1570), "hp": 3900, "atk": 750, "coins": (58, 100)},
            "Estrelas Sencientes AnciÃ£o": {"xp": (1200, 1595), "hp": 3950, "atk": 755, "coins": (60, 105)},
            "Estrelas Sencientes LendÃ¡rio": {"xp": (1220, 1620), "hp": 4000, "atk": 760, "coins": (62, 110)},
        },
        "boss": {"name": "Astro Senciente", "hp": 330000, "atk": 5800, "xp": 290000, "level": 279, "coins": (48000, 86400)},
        "resources": ['EssÃªncia do NÃ­vel 270', 'Fragmento Dimensional 2', 'Cristal do Ciclo 2', 'Runa Absoluta', 'PÃ³ Primordial AvanÃ§ado'],
        "dungeons": [
            {"name": "Masmorra ğŸŒŒ GalÃ¡xia Interior I", "level": 28, "boss": "GuardiÃ£o Interno 270"},
            {"name": "Masmorra ğŸŒŒ GalÃ¡xia Interior II", "level": 29, "boss": "GuardiÃ£o Sombrio 270"},
            {"name": "SantuÃ¡rio do NÃ­vel 270", "level": 30, "boss": "Senhor do SantuÃ¡rio 270"}
        ],
        "secret_dungeons": [
            {"name": "ğŸ” CÃ¢mara Secreta ğŸŒŒ GalÃ¡xia Interior", "level": 28, "boss": "GuardiÃ£o Oculto 270", "secret": True, "special_boss_drop": "Absoluto", "key_name": "ğŸ—ï¸ Chave de ğŸŒŒ GalÃ¡xia Interior"},
            {"name": "ğŸŒŒ Portal Dimensional 270", "level": 29, "boss": "Entidade Portal 270", "secret": True, "special_boss_drop": "Transcendente", "key_name": "ğŸ—ï¸ Chave Portal 270"}
        ],
        "events": [
            "VocÃª sente o peso do nÃ­vel 270 ao seu redor.", "A realidade aqui Ã© diferente de tudo que vocÃª conhecia.",
            "Criaturas de poder incompreensÃ­vel observam sua passagem.", "Cada passo aqui Ã© uma conquista sem precedentes.",
            "O ar vibra com energia AvanÃ§ado.", "VocÃª estÃ¡ entre os mais fortes jÃ¡ registrados neste plano.",
            "O horizonte aqui nÃ£o existe â€” sÃ³ poder infinito.", "Sua presenÃ§a aqui altera o tecido da realidade.",
            "Nenhum mortal comum sobreviveria neste lugar.", "VocÃª forjou seu prÃ³prio destino chegando atÃ© aqui.",
            "Os GuardiÃµes te testam constantemente.", "Cada batalha aqui redefine seus limites.",
        ],
        "exclusive_drops": {
            "weapons": ["Arma do Plano AvanÃ§ado 270", "LÃ¢mina Dimensional NÃ­vel 270"],
            "armor": ["Armadura AvanÃ§ado 270", "Vestes do Ciclo 2"]
        }
    },
    280: {
        "name": "âš–ï¸ âš–ï¸ Tribunal do Cosmo",
        "emoji": "âš–ï¸",
        "xp_loss_multiplier": 10.5,
        "monsters": {
            "JuÃ­zes CÃ³smicos Alpha": {"xp": (1200, 1600), "hp": 4000, "atk": 780, "coins": (56, 93)},
            "JuÃ­zes CÃ³smicos Supremo": {"xp": (1220, 1625), "hp": 4050, "atk": 785, "coins": (58, 98)},
            "Elite JuÃ­zes CÃ³smicos": {"xp": (1240, 1650), "hp": 4100, "atk": 790, "coins": (60, 103)},
            "JuÃ­zes CÃ³smicos AnciÃ£o": {"xp": (1260, 1675), "hp": 4150, "atk": 795, "coins": (62, 108)},
            "JuÃ­zes CÃ³smicos LendÃ¡rio": {"xp": (1280, 1700), "hp": 4200, "atk": 800, "coins": (64, 113)},
        },
        "boss": {"name": "Juiz CÃ³smico Supremo", "hp": 380000, "atk": 6300, "xp": 320000, "level": 289, "coins": (53000, 95400)},
        "resources": ['EssÃªncia do NÃ­vel 280', 'Fragmento Dimensional 2', 'Cristal do Ciclo 2', 'Runa Absoluta', 'PÃ³ Primordial AvanÃ§ado'],
        "dungeons": [
            {"name": "Masmorra âš–ï¸ Tribunal do Cosmo I", "level": 29, "boss": "GuardiÃ£o Interno 280"},
            {"name": "Masmorra âš–ï¸ Tribunal do Cosmo II", "level": 30, "boss": "GuardiÃ£o Sombrio 280"},
            {"name": "SantuÃ¡rio do NÃ­vel 280", "level": 31, "boss": "Senhor do SantuÃ¡rio 280"}
        ],
        "secret_dungeons": [
            {"name": "ğŸ” CÃ¢mara Secreta âš–ï¸ Tribunal do Cosmo", "level": 29, "boss": "GuardiÃ£o Oculto 280", "secret": True, "special_boss_drop": "Absoluto", "key_name": "ğŸ—ï¸ Chave de âš–ï¸ Tribunal do Cosmo"},
            {"name": "ğŸŒŒ Portal Dimensional 280", "level": 30, "boss": "Entidade Portal 280", "secret": True, "special_boss_drop": "Transcendente", "key_name": "ğŸ—ï¸ Chave Portal 280"}
        ],
        "events": [
            "VocÃª sente o peso do nÃ­vel 280 ao seu redor.", "A realidade aqui Ã© diferente de tudo que vocÃª conhecia.",
            "Criaturas de poder incompreensÃ­vel observam sua passagem.", "Cada passo aqui Ã© uma conquista sem precedentes.",
            "O ar vibra com energia AvanÃ§ado.", "VocÃª estÃ¡ entre os mais fortes jÃ¡ registrados neste plano.",
            "O horizonte aqui nÃ£o existe â€” sÃ³ poder infinito.", "Sua presenÃ§a aqui altera o tecido da realidade.",
            "Nenhum mortal comum sobreviveria neste lugar.", "VocÃª forjou seu prÃ³prio destino chegando atÃ© aqui.",
            "Os GuardiÃµes te testam constantemente.", "Cada batalha aqui redefine seus limites.",
        ],
        "exclusive_drops": {
            "weapons": ["Arma do Plano AvanÃ§ado 280", "LÃ¢mina Dimensional NÃ­vel 280"],
            "armor": ["Armadura AvanÃ§ado 280", "Vestes do Ciclo 2"]
        }
    },
    290: {
        "name": "ğŸ—¡ï¸ ğŸ—¡ï¸ Arena dos Deuses Menores",
        "emoji": "ğŸ—¡ï¸",
        "xp_loss_multiplier": 11.0,
        "monsters": {
            "Deidades Menores Alpha": {"xp": (1260, 1680), "hp": 4200, "atk": 820, "coins": (58, 96)},
            "Deidades Menores Supremo": {"xp": (1280, 1705), "hp": 4250, "atk": 825, "coins": (60, 101)},
            "Elite Deidades Menores": {"xp": (1300, 1730), "hp": 4300, "atk": 830, "coins": (62, 106)},
            "Deidades Menores AnciÃ£o": {"xp": (1320, 1755), "hp": 4350, "atk": 835, "coins": (64, 111)},
            "Deidades Menores LendÃ¡rio": {"xp": (1340, 1780), "hp": 4400, "atk": 840, "coins": (66, 116)},
        },
        "boss": {"name": "Arquiduque Dimensional", "hp": 440000, "atk": 6900, "xp": 355000, "level": 299, "coins": (59000, 106200)},
        "resources": ['EssÃªncia do NÃ­vel 290', 'Fragmento Dimensional 2', 'Cristal do Ciclo 2', 'Runa Absoluta', 'PÃ³ Primordial AvanÃ§ado'],
        "dungeons": [
            {"name": "Masmorra ğŸ—¡ï¸ Arena dos Deuses Menores I", "level": 30, "boss": "GuardiÃ£o Interno 290"},
            {"name": "Masmorra ğŸ—¡ï¸ Arena dos Deuses Menores II", "level": 31, "boss": "GuardiÃ£o Sombrio 290"},
            {"name": "SantuÃ¡rio do NÃ­vel 290", "level": 32, "boss": "Senhor do SantuÃ¡rio 290"}
        ],
        "secret_dungeons": [
            {"name": "ğŸ” CÃ¢mara Secreta ğŸ—¡ï¸ Arena dos Deuses Menores", "level": 30, "boss": "GuardiÃ£o Oculto 290", "secret": True, "special_boss_drop": "Absoluto", "key_name": "ğŸ—ï¸ Chave de ğŸ—¡ï¸ Arena dos Deuses Menores"},
            {"name": "ğŸŒŒ Portal Dimensional 290", "level": 31, "boss": "Entidade Portal 290", "secret": True, "special_boss_drop": "Transcendente", "key_name": "ğŸ—ï¸ Chave Portal 290"}
        ],
        "events": [
            "VocÃª sente o peso do nÃ­vel 290 ao seu redor.", "A realidade aqui Ã© diferente de tudo que vocÃª conhecia.",
            "Criaturas de poder incompreensÃ­vel observam sua passagem.", "Cada passo aqui Ã© uma conquista sem precedentes.",
            "O ar vibra com energia AvanÃ§ado.", "VocÃª estÃ¡ entre os mais fortes jÃ¡ registrados neste plano.",
            "O horizonte aqui nÃ£o existe â€” sÃ³ poder infinito.", "Sua presenÃ§a aqui altera o tecido da realidade.",
            "Nenhum mortal comum sobreviveria neste lugar.", "VocÃª forjou seu prÃ³prio destino chegando atÃ© aqui.",
            "Os GuardiÃµes te testam constantemente.", "Cada batalha aqui redefine seus limites.",
        ],
        "exclusive_drops": {
            "weapons": ["Arma do Plano AvanÃ§ado 290", "LÃ¢mina Dimensional NÃ­vel 290"],
            "armor": ["Armadura AvanÃ§ado 290", "Vestes do Ciclo 2"]
        }
    },
    300: {
        "name": "ğŸ‘ï¸ ğŸ‘ï¸ O Olho do Multiverso",
        "emoji": "ğŸ‘ï¸",
        "xp_loss_multiplier": 11.0,
        "monsters": {
            "Entidades do Multiverso Alpha": {"xp": (1320, 1760), "hp": 4400, "atk": 860, "coins": (60, 100)},
            "Entidades do Multiverso Supremo": {"xp": (1340, 1785), "hp": 4450, "atk": 865, "coins": (62, 105)},
            "Elite Entidades do Multiverso": {"xp": (1360, 1810), "hp": 4500, "atk": 870, "coins": (64, 110)},
            "Entidades do Multiverso AnciÃ£o": {"xp": (1380, 1835), "hp": 4550, "atk": 875, "coins": (66, 115)},
            "Entidades do Multiverso LendÃ¡rio": {"xp": (1400, 1860), "hp": 4600, "atk": 880, "coins": (68, 120)},
        },
        "boss": {"name": "Divindade do Multiverso", "hp": 510000, "atk": 7500, "xp": 390000, "level": 309, "coins": (65000, 117000)},
        "resources": ['EssÃªncia do NÃ­vel 300', 'Fragmento Dimensional 3', 'Cristal do Ciclo 2', 'Runa Absoluta', 'PÃ³ Primordial AvanÃ§ado'],
        "dungeons": [
            {"name": "Masmorra ğŸ‘ï¸ O Olho do Multiverso I", "level": 31, "boss": "GuardiÃ£o Interno 300"},
            {"name": "Masmorra ğŸ‘ï¸ O Olho do Multiverso II", "level": 32, "boss": "GuardiÃ£o Sombrio 300"},
            {"name": "SantuÃ¡rio do NÃ­vel 300", "level": 33, "boss": "Senhor do SantuÃ¡rio 300"}
        ],
        "secret_dungeons": [
            {"name": "ğŸ” CÃ¢mara Secreta ğŸ‘ï¸ O Olho do Multiverso", "level": 31, "boss": "GuardiÃ£o Oculto 300", "secret": True, "special_boss_drop": "Absoluto", "key_name": "ğŸ—ï¸ Chave de ğŸ‘ï¸ O Olho do Multiverso"},
            {"name": "ğŸŒŒ Portal Dimensional 300", "level": 32, "boss": "Entidade Portal 300", "secret": True, "special_boss_drop": "Transcendente", "key_name": "ğŸ—ï¸ Chave Portal 300"}
        ],
        "events": [
            "VocÃª sente o peso do nÃ­vel 300 ao seu redor.", "A realidade aqui Ã© diferente de tudo que vocÃª conhecia.",
            "Criaturas de poder incompreensÃ­vel observam sua passagem.", "Cada passo aqui Ã© uma conquista sem precedentes.",
            "O ar vibra com energia AvanÃ§ado.", "VocÃª estÃ¡ entre os mais fortes jÃ¡ registrados neste plano.",
            "O horizonte aqui nÃ£o existe â€” sÃ³ poder infinito.", "Sua presenÃ§a aqui altera o tecido da realidade.",
            "Nenhum mortal comum sobreviveria neste lugar.", "VocÃª forjou seu prÃ³prio destino chegando atÃ© aqui.",
            "Os GuardiÃµes te testam constantemente.", "Cada batalha aqui redefine seus limites.",
        ],
        "exclusive_drops": {
            "weapons": ["Arma do Plano AvanÃ§ado 300", "LÃ¢mina Dimensional NÃ­vel 300"],
            "armor": ["Armadura AvanÃ§ado 300", "Vestes do Ciclo 3"]
        }
    },
    310: {
        "name": "ğŸ”® ğŸ”® Plano Astral Inferior",
        "emoji": "ğŸ”®",
        "xp_loss_multiplier": 11.5,
        "monsters": {
            "EspÃ­ritos Astrais Alpha": {"xp": (1380, 1840), "hp": 4600, "atk": 900, "coins": (62, 103)},
            "EspÃ­ritos Astrais Supremo": {"xp": (1400, 1865), "hp": 4650, "atk": 905, "coins": (64, 108)},
            "Elite EspÃ­ritos Astrais": {"xp": (1420, 1890), "hp": 4700, "atk": 910, "coins": (66, 113)},
            "EspÃ­ritos Astrais AnciÃ£o": {"xp": (1440, 1915), "hp": 4750, "atk": 915, "coins": (68, 118)},
            "EspÃ­ritos Astrais LendÃ¡rio": {"xp": (1460, 1940), "hp": 4800, "atk": 920, "coins": (70, 123)},
        },
        "boss": {"name": "Arcanista Astral", "hp": 590000, "atk": 8200, "xp": 430000, "level": 319, "coins": (72000, 129600)},
        "resources": ['EssÃªncia do NÃ­vel 310', 'Fragmento Dimensional 3', 'Cristal do Ciclo 2', 'Runa Absoluta', 'PÃ³ Primordial AvanÃ§ado'],
        "dungeons": [
            {"name": "Masmorra ğŸ”® Plano Astral Inferior I", "level": 32, "boss": "GuardiÃ£o Interno 310"},
            {"name": "Masmorra ğŸ”® Plano Astral Inferior II", "level": 33, "boss": "GuardiÃ£o Sombrio 310"},
            {"name": "SantuÃ¡rio do NÃ­vel 310", "level": 34, "boss": "Senhor do SantuÃ¡rio 310"}
        ],
        "secret_dungeons": [
            {"name": "ğŸ” CÃ¢mara Secreta ğŸ”® Plano Astral Inferior", "level": 32, "boss": "GuardiÃ£o Oculto 310", "secret": True, "special_boss_drop": "Absoluto", "key_name": "ğŸ—ï¸ Chave de ğŸ”® Plano Astral Inferior"},
            {"name": "ğŸŒŒ Portal Dimensional 310", "level": 33, "boss": "Entidade Portal 310", "secret": True, "special_boss_drop": "Transcendente", "key_name": "ğŸ—ï¸ Chave Portal 310"}
        ],
        "events": [
            "VocÃª sente o peso do nÃ­vel 310 ao seu redor.", "A realidade aqui Ã© diferente de tudo que vocÃª conhecia.",
            "Criaturas de poder incompreensÃ­vel observam sua passagem.", "Cada passo aqui Ã© uma conquista sem precedentes.",
            "O ar vibra com energia AvanÃ§ado.", "VocÃª estÃ¡ entre os mais fortes jÃ¡ registrados neste plano.",
            "O horizonte aqui nÃ£o existe â€” sÃ³ poder infinito.", "Sua presenÃ§a aqui altera o tecido da realidade.",
            "Nenhum mortal comum sobreviveria neste lugar.", "VocÃª forjou seu prÃ³prio destino chegando atÃ© aqui.",
            "Os GuardiÃµes te testam constantemente.", "Cada batalha aqui redefine seus limites.",
        ],
        "exclusive_drops": {
            "weapons": ["Arma do Plano AvanÃ§ado 310", "LÃ¢mina Dimensional NÃ­vel 310"],
            "armor": ["Armadura AvanÃ§ado 310", "Vestes do Ciclo 3"]
        }
    },
    320: {
        "name": "ğŸ’ ğŸ’ Fortaleza de Cristal",
        "emoji": "ğŸ’",
        "xp_loss_multiplier": 11.5,
        "monsters": {
            "GuardiÃµes Cristalinos Alpha": {"xp": (1440, 1920), "hp": 4800, "atk": 940, "coins": (64, 106)},
            "GuardiÃµes Cristalinos Supremo": {"xp": (1460, 1945), "hp": 4850, "atk": 945, "coins": (66, 111)},
            "Elite GuardiÃµes Cristalinos": {"xp": (1480, 1970), "hp": 4900, "atk": 950, "coins": (68, 116)},
            "GuardiÃµes Cristalinos AnciÃ£o": {"xp": (1500, 1995), "hp": 4950, "atk": 955, "coins": (70, 121)},
            "GuardiÃµes Cristalinos LendÃ¡rio": {"xp": (1520, 2020), "hp": 5000, "atk": 960, "coins": (72, 126)},
        },
        "boss": {"name": "Cristal Vivente", "hp": 680000, "atk": 9000, "xp": 475000, "level": 329, "coins": (80000, 144000)},
        "resources": ['EssÃªncia do NÃ­vel 320', 'Fragmento Dimensional 3', 'Cristal do Ciclo 2', 'Runa Absoluta', 'PÃ³ Primordial AvanÃ§ado'],
        "dungeons": [
            {"name": "Masmorra ğŸ’ Fortaleza de Cristal I", "level": 33, "boss": "GuardiÃ£o Interno 320"},
            {"name": "Masmorra ğŸ’ Fortaleza de Cristal II", "level": 34, "boss": "GuardiÃ£o Sombrio 320"},
            {"name": "SantuÃ¡rio do NÃ­vel 320", "level": 35, "boss": "Senhor do SantuÃ¡rio 320"}
        ],
        "secret_dungeons": [
            {"name": "ğŸ” CÃ¢mara Secreta ğŸ’ Fortaleza de Cristal", "level": 33, "boss": "GuardiÃ£o Oculto 320", "secret": True, "special_boss_drop": "Absoluto", "key_name": "ğŸ—ï¸ Chave de ğŸ’ Fortaleza de Cristal"},
            {"name": "ğŸŒŒ Portal Dimensional 320", "level": 34, "boss": "Entidade Portal 320", "secret": True, "special_boss_drop": "Transcendente", "key_name": "ğŸ—ï¸ Chave Portal 320"}
        ],
        "events": [
            "VocÃª sente o peso do nÃ­vel 320 ao seu redor.", "A realidade aqui Ã© diferente de tudo que vocÃª conhecia.",
            "Criaturas de poder incompreensÃ­vel observam sua passagem.", "Cada passo aqui Ã© uma conquista sem precedentes.",
            "O ar vibra com energia AvanÃ§ado.", "VocÃª estÃ¡ entre os mais fortes jÃ¡ registrados neste plano.",
            "O horizonte aqui nÃ£o existe â€” sÃ³ poder infinito.", "Sua presenÃ§a aqui altera o tecido da realidade.",
            "Nenhum mortal comum sobreviveria neste lugar.", "VocÃª forjou seu prÃ³prio destino chegando atÃ© aqui.",
            "Os GuardiÃµes te testam constantemente.", "Cada batalha aqui redefine seus limites.",
        ],
        "exclusive_drops": {
            "weapons": ["Arma do Plano AvanÃ§ado 320", "LÃ¢mina Dimensional NÃ­vel 320"],
            "armor": ["Armadura AvanÃ§ado 320", "Vestes do Ciclo 3"]
        }
    },
    330: {
        "name": "ğŸŒ‘ ğŸŒ‘ Lua Negra",
        "emoji": "ğŸŒ‘",
        "xp_loss_multiplier": 12.0,
        "monsters": {
            "Vampiros Lunares Supremos Alpha": {"xp": (1500, 2000), "hp": 5000, "atk": 980, "coins": (66, 110)},
            "Vampiros Lunares Supremos Supremo": {"xp": (1520, 2025), "hp": 5050, "atk": 985, "coins": (68, 115)},
            "Elite Vampiros Lunares Supremos": {"xp": (1540, 2050), "hp": 5100, "atk": 990, "coins": (70, 120)},
            "Vampiros Lunares Supremos AnciÃ£o": {"xp": (1560, 2075), "hp": 5150, "atk": 995, "coins": (72, 125)},
            "Vampiros Lunares Supremos LendÃ¡rio": {"xp": (1580, 2100), "hp": 5200, "atk": 1000, "coins": (74, 130)},
        },
        "boss": {"name": "Lua Negra Encarnada", "hp": 780000, "atk": 9800, "xp": 525000, "level": 339, "coins": (88000, 158400)},
        "resources": ['EssÃªncia do NÃ­vel 330', 'Fragmento Dimensional 3', 'Cristal do Ciclo 2', 'Runa Absoluta', 'PÃ³ Primordial AvanÃ§ado'],
        "dungeons": [
            {"name": "Masmorra ğŸŒ‘ Lua Negra I", "level": 34, "boss": "GuardiÃ£o Interno 330"},
            {"name": "Masmorra ğŸŒ‘ Lua Negra II", "level": 35, "boss": "GuardiÃ£o Sombrio 330"},
            {"name": "SantuÃ¡rio do NÃ­vel 330", "level": 36, "boss": "Senhor do SantuÃ¡rio 330"}
        ],
        "secret_dungeons": [
            {"name": "ğŸ” CÃ¢mara Secreta ğŸŒ‘ Lua Negra", "level": 34, "boss": "GuardiÃ£o Oculto 330", "secret": True, "special_boss_drop": "Absoluto", "key_name": "ğŸ—ï¸ Chave de ğŸŒ‘ Lua Negra"},
            {"name": "ğŸŒŒ Portal Dimensional 330", "level": 35, "boss": "Entidade Portal 330", "secret": True, "special_boss_drop": "Transcendente", "key_name": "ğŸ—ï¸ Chave Portal 330"}
        ],
        "events": [
            "VocÃª sente o peso do nÃ­vel 330 ao seu redor.", "A realidade aqui Ã© diferente de tudo que vocÃª conhecia.",
            "Criaturas de poder incompreensÃ­vel observam sua passagem.", "Cada passo aqui Ã© uma conquista sem precedentes.",
            "O ar vibra com energia AvanÃ§ado.", "VocÃª estÃ¡ entre os mais fortes jÃ¡ registrados neste plano.",
            "O horizonte aqui nÃ£o existe â€” sÃ³ poder infinito.", "Sua presenÃ§a aqui altera o tecido da realidade.",
            "Nenhum mortal comum sobreviveria neste lugar.", "VocÃª forjou seu prÃ³prio destino chegando atÃ© aqui.",
            "Os GuardiÃµes te testam constantemente.", "Cada batalha aqui redefine seus limites.",
        ],
        "exclusive_drops": {
            "weapons": ["Arma do Plano AvanÃ§ado 330", "LÃ¢mina Dimensional NÃ­vel 330"],
            "armor": ["Armadura AvanÃ§ado 330", "Vestes do Ciclo 3"]
        }
    },
    340: {
        "name": "â˜„ï¸ â˜„ï¸ CemitÃ©rio de Estrelas",
        "emoji": "â˜„ï¸",
        "xp_loss_multiplier": 12.0,
        "monsters": {
            "CadÃ¡veres de Estrelas Alpha": {"xp": (1560, 2080), "hp": 5200, "atk": 1020, "coins": (68, 113)},
            "CadÃ¡veres de Estrelas Supremo": {"xp": (1580, 2105), "hp": 5250, "atk": 1025, "coins": (70, 118)},
            "Elite CadÃ¡veres de Estrelas": {"xp": (1600, 2130), "hp": 5300, "atk": 1030, "coins": (72, 123)},
            "CadÃ¡veres de Estrelas AnciÃ£o": {"xp": (1620, 2155), "hp": 5350, "atk": 1035, "coins": (74, 128)},
            "CadÃ¡veres de Estrelas LendÃ¡rio": {"xp": (1640, 2180), "hp": 5400, "atk": 1040, "coins": (76, 133)},
        },
        "boss": {"name": "Estrela Morta Senciente", "hp": 900000, "atk": 10700, "xp": 580000, "level": 349, "coins": (97000, 174600)},
        "resources": ['EssÃªncia do NÃ­vel 340', 'Fragmento Dimensional 3', 'Cristal do Ciclo 2', 'Runa Absoluta', 'PÃ³ Primordial AvanÃ§ado'],
        "dungeons": [
            {"name": "Masmorra â˜„ï¸ CemitÃ©rio de Estrelas I", "level": 35, "boss": "GuardiÃ£o Interno 340"},
            {"name": "Masmorra â˜„ï¸ CemitÃ©rio de Estrelas II", "level": 36, "boss": "GuardiÃ£o Sombrio 340"},
            {"name": "SantuÃ¡rio do NÃ­vel 340", "level": 37, "boss": "Senhor do SantuÃ¡rio 340"}
        ],
        "secret_dungeons": [
            {"name": "ğŸ” CÃ¢mara Secreta â˜„ï¸ CemitÃ©rio de Estrelas", "level": 35, "boss": "GuardiÃ£o Oculto 340", "secret": True, "special_boss_drop": "Absoluto", "key_name": "ğŸ—ï¸ Chave de â˜„ï¸ CemitÃ©rio de Estrelas"},
            {"name": "ğŸŒŒ Portal Dimensional 340", "level": 36, "boss": "Entidade Portal 340", "secret": True, "special_boss_drop": "Transcendente", "key_name": "ğŸ—ï¸ Chave Portal 340"}
        ],
        "events": [
            "VocÃª sente o peso do nÃ­vel 340 ao seu redor.", "A realidade aqui Ã© diferente de tudo que vocÃª conhecia.",
            "Criaturas de poder incompreensÃ­vel observam sua passagem.", "Cada passo aqui Ã© uma conquista sem precedentes.",
            "O ar vibra com energia AvanÃ§ado.", "VocÃª estÃ¡ entre os mais fortes jÃ¡ registrados neste plano.",
            "O horizonte aqui nÃ£o existe â€” sÃ³ poder infinito.", "Sua presenÃ§a aqui altera o tecido da realidade.",
            "Nenhum mortal comum sobreviveria neste lugar.", "VocÃª forjou seu prÃ³prio destino chegando atÃ© aqui.",
            "Os GuardiÃµes te testam constantemente.", "Cada batalha aqui redefine seus limites.",
        ],
        "exclusive_drops": {
            "weapons": ["Arma do Plano AvanÃ§ado 340", "LÃ¢mina Dimensional NÃ­vel 340"],
            "armor": ["Armadura AvanÃ§ado 340", "Vestes do Ciclo 3"]
        }
    },
    350: {
        "name": "ğŸŒ ğŸŒ CoraÃ§Ã£o Solar",
        "emoji": "ğŸŒ",
        "xp_loss_multiplier": 12.5,
        "monsters": {
            "Elementais Solares Alpha": {"xp": (1620, 2160), "hp": 5400, "atk": 1060, "coins": (70, 116)},
            "Elementais Solares Supremo": {"xp": (1640, 2185), "hp": 5450, "atk": 1065, "coins": (72, 121)},
            "Elite Elementais Solares": {"xp": (1660, 2210), "hp": 5500, "atk": 1070, "coins": (74, 126)},
            "Elementais Solares AnciÃ£o": {"xp": (1680, 2235), "hp": 5550, "atk": 1075, "coins": (76, 131)},
            "Elementais Solares LendÃ¡rio": {"xp": (1700, 2260), "hp": 5600, "atk": 1080, "coins": (78, 136)},
        },
        "boss": {"name": "CoraÃ§Ã£o do Sol", "hp": 1040000, "atk": 11700, "xp": 640000, "level": 359, "coins": (107000, 192600)},
        "resources": ['EssÃªncia do NÃ­vel 350', 'Fragmento Dimensional 3', 'Cristal do Ciclo 2', 'Runa Absoluta', 'PÃ³ Primordial AvanÃ§ado'],
        "dungeons": [
            {"name": "Masmorra ğŸŒ CoraÃ§Ã£o Solar I", "level": 36, "boss": "GuardiÃ£o Interno 350"},
            {"name": "Masmorra ğŸŒ CoraÃ§Ã£o Solar II", "level": 37, "boss": "GuardiÃ£o Sombrio 350"},
            {"name": "SantuÃ¡rio do NÃ­vel 350", "level": 38, "boss": "Senhor do SantuÃ¡rio 350"}
        ],
        "secret_dungeons": [
            {"name": "ğŸ” CÃ¢mara Secreta ğŸŒ CoraÃ§Ã£o Solar", "level": 36, "boss": "GuardiÃ£o Oculto 350", "secret": True, "special_boss_drop": "Absoluto", "key_name": "ğŸ—ï¸ Chave de ğŸŒ CoraÃ§Ã£o Solar"},
            {"name": "ğŸŒŒ Portal Dimensional 350", "level": 37, "boss": "Entidade Portal 350", "secret": True, "special_boss_drop": "Transcendente", "key_name": "ğŸ—ï¸ Chave Portal 350"}
        ],
        "events": [
            "VocÃª sente o peso do nÃ­vel 350 ao seu redor.", "A realidade aqui Ã© diferente de tudo que vocÃª conhecia.",
            "Criaturas de poder incompreensÃ­vel observam sua passagem.", "Cada passo aqui Ã© uma conquista sem precedentes.",
            "O ar vibra com energia AvanÃ§ado.", "VocÃª estÃ¡ entre os mais fortes jÃ¡ registrados neste plano.",
            "O horizonte aqui nÃ£o existe â€” sÃ³ poder infinito.", "Sua presenÃ§a aqui altera o tecido da realidade.",
            "Nenhum mortal comum sobreviveria neste lugar.", "VocÃª forjou seu prÃ³prio destino chegando atÃ© aqui.",
            "Os GuardiÃµes te testam constantemente.", "Cada batalha aqui redefine seus limites.",
        ],
        "exclusive_drops": {
            "weapons": ["Arma do Plano AvanÃ§ado 350", "LÃ¢mina Dimensional NÃ­vel 350"],
            "armor": ["Armadura AvanÃ§ado 350", "Vestes do Ciclo 3"]
        }
    },
    360: {
        "name": "ğŸ•³ï¸ ğŸ•³ï¸ Buraco Negro Vivo",
        "emoji": "ğŸ•³ï¸",
        "xp_loss_multiplier": 12.5,
        "monsters": {
            "Absorvedores de Luz Alpha": {"xp": (1680, 2240), "hp": 5600, "atk": 1100, "coins": (72, 120)},
            "Absorvedores de Luz Supremo": {"xp": (1700, 2265), "hp": 5650, "atk": 1105, "coins": (74, 125)},
            "Elite Absorvedores de Luz": {"xp": (1720, 2290), "hp": 5700, "atk": 1110, "coins": (76, 130)},
            "Absorvedores de Luz AnciÃ£o": {"xp": (1740, 2315), "hp": 5750, "atk": 1115, "coins": (78, 135)},
            "Absorvedores de Luz LendÃ¡rio": {"xp": (1760, 2340), "hp": 5800, "atk": 1120, "coins": (80, 140)},
        },
        "boss": {"name": "Singularidade Consciente", "hp": 1200000, "atk": 12800, "xp": 705000, "level": 369, "coins": (118000, 212400)},
        "resources": ['EssÃªncia do NÃ­vel 360', 'Fragmento Dimensional 3', 'Cristal do Ciclo 2', 'Runa Absoluta', 'PÃ³ Primordial AvanÃ§ado'],
        "dungeons": [
            {"name": "Masmorra ğŸ•³ï¸ Buraco Negro Vivo I", "level": 37, "boss": "GuardiÃ£o Interno 360"},
            {"name": "Masmorra ğŸ•³ï¸ Buraco Negro Vivo II", "level": 38, "boss": "GuardiÃ£o Sombrio 360"},
            {"name": "SantuÃ¡rio do NÃ­vel 360", "level": 39, "boss": "Senhor do SantuÃ¡rio 360"}
        ],
        "secret_dungeons": [
            {"name": "ğŸ” CÃ¢mara Secreta ğŸ•³ï¸ Buraco Negro Vivo", "level": 37, "boss": "GuardiÃ£o Oculto 360", "secret": True, "special_boss_drop": "Absoluto", "key_name": "ğŸ—ï¸ Chave de ğŸ•³ï¸ Buraco Negro Vivo"},
            {"name": "ğŸŒŒ Portal Dimensional 360", "level": 38, "boss": "Entidade Portal 360", "secret": True, "special_boss_drop": "Transcendente", "key_name": "ğŸ—ï¸ Chave Portal 360"}
        ],
        "events": [
            "VocÃª sente o peso do nÃ­vel 360 ao seu redor.", "A realidade aqui Ã© diferente de tudo que vocÃª conhecia.",
            "Criaturas de poder incompreensÃ­vel observam sua passagem.", "Cada passo aqui Ã© uma conquista sem precedentes.",
            "O ar vibra com energia AvanÃ§ado.", "VocÃª estÃ¡ entre os mais fortes jÃ¡ registrados neste plano.",
            "O horizonte aqui nÃ£o existe â€” sÃ³ poder infinito.", "Sua presenÃ§a aqui altera o tecido da realidade.",
            "Nenhum mortal comum sobreviveria neste lugar.", "VocÃª forjou seu prÃ³prio destino chegando atÃ© aqui.",
            "Os GuardiÃµes te testam constantemente.", "Cada batalha aqui redefine seus limites.",
        ],
        "exclusive_drops": {
            "weapons": ["Arma do Plano AvanÃ§ado 360", "LÃ¢mina Dimensional NÃ­vel 360"],
            "armor": ["Armadura AvanÃ§ado 360", "Vestes do Ciclo 3"]
        }
    },
    370: {
        "name": "ğŸŒ ğŸŒ Nexo das DimensÃµes",
        "emoji": "ğŸŒ",
        "xp_loss_multiplier": 13.0,
        "monsters": {
            "Convergentes Eternos Alpha": {"xp": (1740, 2320), "hp": 5800, "atk": 1140, "coins": (74, 123)},
            "Convergentes Eternos Supremo": {"xp": (1760, 2345), "hp": 5850, "atk": 1145, "coins": (76, 128)},
            "Elite Convergentes Eternos": {"xp": (1780, 2370), "hp": 5900, "atk": 1150, "coins": (78, 133)},
            "Convergentes Eternos AnciÃ£o": {"xp": (1800, 2395), "hp": 5950, "atk": 1155, "coins": (80, 138)},
            "Convergentes Eternos LendÃ¡rio": {"xp": (1820, 2420), "hp": 6000, "atk": 1160, "coins": (82, 143)},
        },
        "boss": {"name": "Convergente Eterno", "hp": 1380000, "atk": 14000, "xp": 780000, "level": 379, "coins": (130000, 234000)},
        "resources": ['EssÃªncia do NÃ­vel 370', 'Fragmento Dimensional 3', 'Cristal do Ciclo 2', 'Runa Absoluta', 'PÃ³ Primordial AvanÃ§ado'],
        "dungeons": [
            {"name": "Masmorra ğŸŒ Nexo das DimensÃµes I", "level": 38, "boss": "GuardiÃ£o Interno 370"},
            {"name": "Masmorra ğŸŒ Nexo das DimensÃµes II", "level": 39, "boss": "GuardiÃ£o Sombrio 370"},
            {"name": "SantuÃ¡rio do NÃ­vel 370", "level": 40, "boss": "Senhor do SantuÃ¡rio 370"}
        ],
        "secret_dungeons": [
            {"name": "ğŸ” CÃ¢mara Secreta ğŸŒ Nexo das DimensÃµes", "level": 38, "boss": "GuardiÃ£o Oculto 370", "secret": True, "special_boss_drop": "Absoluto", "key_name": "ğŸ—ï¸ Chave de ğŸŒ Nexo das DimensÃµes"},
            {"name": "ğŸŒŒ Portal Dimensional 370", "level": 39, "boss": "Entidade Portal 370", "secret": True, "special_boss_drop": "Transcendente", "key_name": "ğŸ—ï¸ Chave Portal 370"}
        ],
        "events": [
            "VocÃª sente o peso do nÃ­vel 370 ao seu redor.", "A realidade aqui Ã© diferente de tudo que vocÃª conhecia.",
            "Criaturas de poder incompreensÃ­vel observam sua passagem.", "Cada passo aqui Ã© uma conquista sem precedentes.",
            "O ar vibra com energia AvanÃ§ado.", "VocÃª estÃ¡ entre os mais fortes jÃ¡ registrados neste plano.",
            "O horizonte aqui nÃ£o existe â€” sÃ³ poder infinito.", "Sua presenÃ§a aqui altera o tecido da realidade.",
            "Nenhum mortal comum sobreviveria neste lugar.", "VocÃª forjou seu prÃ³prio destino chegando atÃ© aqui.",
            "Os GuardiÃµes te testam constantemente.", "Cada batalha aqui redefine seus limites.",
        ],
        "exclusive_drops": {
            "weapons": ["Arma do Plano AvanÃ§ado 370", "LÃ¢mina Dimensional NÃ­vel 370"],
            "armor": ["Armadura AvanÃ§ado 370", "Vestes do Ciclo 3"]
        }
    },
    380: {
        "name": "âš¡ âš¡ Tempestade Interdimensional",
        "emoji": "âš¡",
        "xp_loss_multiplier": 13.0,
        "monsters": {
            "RelÃ¢mpagos Sencientes Alpha": {"xp": (1800, 2400), "hp": 6000, "atk": 1180, "coins": (76, 126)},
            "RelÃ¢mpagos Sencientes Supremo": {"xp": (1820, 2425), "hp": 6050, "atk": 1185, "coins": (78, 131)},
            "Elite RelÃ¢mpagos Sencientes": {"xp": (1840, 2450), "hp": 6100, "atk": 1190, "coins": (80, 136)},
            "RelÃ¢mpagos Sencientes AnciÃ£o": {"xp": (1860, 2475), "hp": 6150, "atk": 1195, "coins": (82, 141)},
            "RelÃ¢mpagos Sencientes LendÃ¡rio": {"xp": (1880, 2500), "hp": 6200, "atk": 1200, "coins": (84, 146)},
        },
        "boss": {"name": "Tempestade Dimensional Viva", "hp": 1590000, "atk": 15300, "xp": 860000, "level": 389, "coins": (143000, 257400)},
        "resources": ['EssÃªncia do NÃ­vel 380', 'Fragmento Dimensional 3', 'Cristal do Ciclo 2', 'Runa Absoluta', 'PÃ³ Primordial AvanÃ§ado'],
        "dungeons": [
            {"name": "Masmorra âš¡ Tempestade Interdimensional I", "level": 39, "boss": "GuardiÃ£o Interno 380"},
            {"name": "Masmorra âš¡ Tempestade Interdimensional II", "level": 40, "boss": "GuardiÃ£o Sombrio 380"},
            {"name": "SantuÃ¡rio do NÃ­vel 380", "level": 41, "boss": "Senhor do SantuÃ¡rio 380"}
        ],
        "secret_dungeons": [
            {"name": "ğŸ” CÃ¢mara Secreta âš¡ Tempestade Interdimensional", "level": 39, "boss": "GuardiÃ£o Oculto 380", "secret": True, "special_boss_drop": "Absoluto", "key_name": "ğŸ—ï¸ Chave de âš¡ Tempestade Interdimensional"},
            {"name": "ğŸŒŒ Portal Dimensional 380", "level": 40, "boss": "Entidade Portal 380", "secret": True, "special_boss_drop": "Transcendente", "key_name": "ğŸ—ï¸ Chave Portal 380"}
        ],
        "events": [
            "VocÃª sente o peso do nÃ­vel 380 ao seu redor.", "A realidade aqui Ã© diferente de tudo que vocÃª conhecia.",
            "Criaturas de poder incompreensÃ­vel observam sua passagem.", "Cada passo aqui Ã© uma conquista sem precedentes.",
            "O ar vibra com energia AvanÃ§ado.", "VocÃª estÃ¡ entre os mais fortes jÃ¡ registrados neste plano.",
            "O horizonte aqui nÃ£o existe â€” sÃ³ poder infinito.", "Sua presenÃ§a aqui altera o tecido da realidade.",
            "Nenhum mortal comum sobreviveria neste lugar.", "VocÃª forjou seu prÃ³prio destino chegando atÃ© aqui.",
            "Os GuardiÃµes te testam constantemente.", "Cada batalha aqui redefine seus limites.",
        ],
        "exclusive_drops": {
            "weapons": ["Arma do Plano AvanÃ§ado 380", "LÃ¢mina Dimensional NÃ­vel 380"],
            "armor": ["Armadura AvanÃ§ado 380", "Vestes do Ciclo 3"]
        }
    },
    390: {
        "name": "ğŸ”± ğŸ”± Trono dos Reinos AvanÃ§ados",
        "emoji": "ğŸ”±",
        "xp_loss_multiplier": 13.5,
        "monsters": {
            "Soberanos Dimensionais Alpha": {"xp": (1860, 2480), "hp": 6200, "atk": 1220, "coins": (78, 130)},
            "Soberanos Dimensionais Supremo": {"xp": (1880, 2505), "hp": 6250, "atk": 1225, "coins": (80, 135)},
            "Elite Soberanos Dimensionais": {"xp": (1900, 2530), "hp": 6300, "atk": 1230, "coins": (82, 140)},
            "Soberanos Dimensionais AnciÃ£o": {"xp": (1920, 2555), "hp": 6350, "atk": 1235, "coins": (84, 145)},
            "Soberanos Dimensionais LendÃ¡rio": {"xp": (1940, 2580), "hp": 6400, "atk": 1240, "coins": (86, 150)},
        },
        "boss": {"name": "Senhor dos Reinos AvanÃ§ados", "hp": 1830000, "atk": 16700, "xp": 950000, "level": 399, "coins": (158000, 284400)},
        "resources": ['EssÃªncia do NÃ­vel 390', 'Fragmento Dimensional 3', 'Cristal do Ciclo 2', 'Runa Absoluta', 'PÃ³ Primordial AvanÃ§ado'],
        "dungeons": [
            {"name": "Masmorra ğŸ”± Trono dos Reinos AvanÃ§ados I", "level": 40, "boss": "GuardiÃ£o Interno 390"},
            {"name": "Masmorra ğŸ”± Trono dos Reinos AvanÃ§ados II", "level": 41, "boss": "GuardiÃ£o Sombrio 390"},
            {"name": "SantuÃ¡rio do NÃ­vel 390", "level": 42, "boss": "Senhor do SantuÃ¡rio 390"}
        ],
        "secret_dungeons": [
            {"name": "ğŸ” CÃ¢mara Secreta ğŸ”± Trono dos Reinos AvanÃ§ados", "level": 40, "boss": "GuardiÃ£o Oculto 390", "secret": True, "special_boss_drop": "Absoluto", "key_name": "ğŸ—ï¸ Chave de ğŸ”± Trono dos Reinos AvanÃ§ados"},
            {"name": "ğŸŒŒ Portal Dimensional 390", "level": 41, "boss": "Entidade Portal 390", "secret": True, "special_boss_drop": "Transcendente", "key_name": "ğŸ—ï¸ Chave Portal 390"}
        ],
        "events": [
            "VocÃª sente o peso do nÃ­vel 390 ao seu redor.", "A realidade aqui Ã© diferente de tudo que vocÃª conhecia.",
            "Criaturas de poder incompreensÃ­vel observam sua passagem.", "Cada passo aqui Ã© uma conquista sem precedentes.",
            "O ar vibra com energia AvanÃ§ado.", "VocÃª estÃ¡ entre os mais fortes jÃ¡ registrados neste plano.",
            "O horizonte aqui nÃ£o existe â€” sÃ³ poder infinito.", "Sua presenÃ§a aqui altera o tecido da realidade.",
            "Nenhum mortal comum sobreviveria neste lugar.", "VocÃª forjou seu prÃ³prio destino chegando atÃ© aqui.",
            "Os GuardiÃµes te testam constantemente.", "Cada batalha aqui redefine seus limites.",
        ],
        "exclusive_drops": {
            "weapons": ["Arma do Plano AvanÃ§ado 390", "LÃ¢mina Dimensional NÃ­vel 390"],
            "armor": ["Armadura AvanÃ§ado 390", "Vestes do Ciclo 3"]
        }
    },
    400: {
        "name": "ğŸŒ  ğŸŒ  DimensÃµes Superiores â€” Entrada",
        "emoji": "ğŸŒ ",
        "xp_loss_multiplier": 14.0,
        "monsters": {
            "GuardiÃµes da TransiÃ§Ã£o Alpha": {"xp": (1950, 2600), "hp": 6500, "atk": 1270, "coins": (80, 133)},
            "GuardiÃµes da TransiÃ§Ã£o Supremo": {"xp": (1970, 2625), "hp": 6550, "atk": 1275, "coins": (82, 138)},
            "Elite GuardiÃµes da TransiÃ§Ã£o": {"xp": (1990, 2650), "hp": 6600, "atk": 1280, "coins": (84, 143)},
            "GuardiÃµes da TransiÃ§Ã£o AnciÃ£o": {"xp": (2010, 2675), "hp": 6650, "atk": 1285, "coins": (86, 148)},
            "GuardiÃµes da TransiÃ§Ã£o LendÃ¡rio": {"xp": (2030, 2700), "hp": 6700, "atk": 1290, "coins": (88, 153)},
        },
        "boss": {"name": "GuardiÃ£o da TransiÃ§Ã£o", "hp": 2100000, "atk": 18200, "xp": 1050000, "level": 409, "coins": (174000, 313200)},
        "resources": ['EssÃªncia do NÃ­vel 400', 'Fragmento Dimensional 4', 'Cristal do Ciclo 3', 'Runa Absoluta', 'PÃ³ Primordial AvanÃ§ado'],
        "dungeons": [
            {"name": "Masmorra ğŸŒ  DimensÃµes Superiores â€” Entrada I", "level": 41, "boss": "GuardiÃ£o Interno 400"},
            {"name": "Masmorra ğŸŒ  DimensÃµes Superiores â€” Entrada II", "level": 42, "boss": "GuardiÃ£o Sombrio 400"},
            {"name": "SantuÃ¡rio do NÃ­vel 400", "level": 43, "boss": "Senhor do SantuÃ¡rio 400"}
        ],
        "secret_dungeons": [
            {"name": "ğŸ” CÃ¢mara Secreta ğŸŒ  DimensÃµes Superiores â€” Entrada", "level": 41, "boss": "GuardiÃ£o Oculto 400", "secret": True, "special_boss_drop": "Absoluto", "key_name": "ğŸ—ï¸ Chave de ğŸŒ  DimensÃµes Superiores â€” Entrada"},
            {"name": "ğŸŒŒ Portal Dimensional 400", "level": 42, "boss": "Entidade Portal 400", "secret": True, "special_boss_drop": "Transcendente", "key_name": "ğŸ—ï¸ Chave Portal 400"}
        ],
        "events": [
            "VocÃª sente o peso do nÃ­vel 400 ao seu redor.", "A realidade aqui Ã© diferente de tudo que vocÃª conhecia.",
            "Criaturas de poder incompreensÃ­vel observam sua passagem.", "Cada passo aqui Ã© uma conquista sem precedentes.",
            "O ar vibra com energia Superior.", "VocÃª estÃ¡ entre os mais fortes jÃ¡ registrados neste plano.",
            "O horizonte aqui nÃ£o existe â€” sÃ³ poder infinito.", "Sua presenÃ§a aqui altera o tecido da realidade.",
            "Nenhum mortal comum sobreviveria neste lugar.", "VocÃª forjou seu prÃ³prio destino chegando atÃ© aqui.",
            "Os GuardiÃµes te testam constantemente.", "Cada batalha aqui redefine seus limites.",
        ],
        "exclusive_drops": {
            "weapons": ["Arma do Plano Superior 400", "LÃ¢mina Dimensional NÃ­vel 400"],
            "armor": ["Armadura Superior 400", "Vestes do Ciclo 4"]
        }
    },
    410: {
        "name": "ğŸ’« ğŸ’« Nebulosa da ConsciÃªncia",
        "emoji": "ğŸ’«",
        "xp_loss_multiplier": 14.0,
        "monsters": {
            "Pensamentos Vivos Alpha": {"xp": (2040, 2720), "hp": 6800, "atk": 1320, "coins": (82, 136)},
            "Pensamentos Vivos Supremo": {"xp": (2060, 2745), "hp": 6850, "atk": 1325, "coins": (84, 141)},
            "Elite Pensamentos Vivos": {"xp": (2080, 2770), "hp": 6900, "atk": 1330, "coins": (86, 146)},
            "Pensamentos Vivos AnciÃ£o": {"xp": (2100, 2795), "hp": 6950, "atk": 1335, "coins": (88, 151)},
            "Pensamentos Vivos LendÃ¡rio": {"xp": (2120, 2820), "hp": 7000, "atk": 1340, "coins": (90, 156)},
        },
        "boss": {"name": "Mente CÃ³smica", "hp": 2400000, "atk": 19800, "xp": 1160000, "level": 419, "coins": (192000, 345600)},
        "resources": ['EssÃªncia do NÃ­vel 410', 'Fragmento Dimensional 4', 'Cristal do Ciclo 3', 'Runa Absoluta', 'PÃ³ Primordial AvanÃ§ado'],
        "dungeons": [
            {"name": "Masmorra ğŸ’« Nebulosa da ConsciÃªncia I", "level": 42, "boss": "GuardiÃ£o Interno 410"},
            {"name": "Masmorra ğŸ’« Nebulosa da ConsciÃªncia II", "level": 43, "boss": "GuardiÃ£o Sombrio 410"},
            {"name": "SantuÃ¡rio do NÃ­vel 410", "level": 44, "boss": "Senhor do SantuÃ¡rio 410"}
        ],
        "secret_dungeons": [
            {"name": "ğŸ” CÃ¢mara Secreta ğŸ’« Nebulosa da ConsciÃªncia", "level": 42, "boss": "GuardiÃ£o Oculto 410", "secret": True, "special_boss_drop": "Absoluto", "key_name": "ğŸ—ï¸ Chave de ğŸ’« Nebulosa da ConsciÃªncia"},
            {"name": "ğŸŒŒ Portal Dimensional 410", "level": 43, "boss": "Entidade Portal 410", "secret": True, "special_boss_drop": "Transcendente", "key_name": "ğŸ—ï¸ Chave Portal 410"}
        ],
        "events": [
            "VocÃª sente o peso do nÃ­vel 410 ao seu redor.", "A realidade aqui Ã© diferente de tudo que vocÃª conhecia.",
            "Criaturas de poder incompreensÃ­vel observam sua passagem.", "Cada passo aqui Ã© uma conquista sem precedentes.",
            "O ar vibra com energia Superior.", "VocÃª estÃ¡ entre os mais fortes jÃ¡ registrados neste plano.",
            "O horizonte aqui nÃ£o existe â€” sÃ³ poder infinito.", "Sua presenÃ§a aqui altera o tecido da realidade.",
            "Nenhum mortal comum sobreviveria neste lugar.", "VocÃª forjou seu prÃ³prio destino chegando atÃ© aqui.",
            "Os GuardiÃµes te testam constantemente.", "Cada batalha aqui redefine seus limites.",
        ],
        "exclusive_drops": {
            "weapons": ["Arma do Plano Superior 410", "LÃ¢mina Dimensional NÃ­vel 410"],
            "armor": ["Armadura Superior 410", "Vestes do Ciclo 4"]
        }
    },
    420: {
        "name": "ğŸŒ€ ğŸŒ€ VÃ³rtice Dimensional Supremo",
        "emoji": "ğŸŒ€",
        "xp_loss_multiplier": 14.5,
        "monsters": {
            "VÃ³rtices Animados Alpha": {"xp": (2130, 2840), "hp": 7100, "atk": 1380, "coins": (84, 140)},
            "VÃ³rtices Animados Supremo": {"xp": (2150, 2865), "hp": 7150, "atk": 1385, "coins": (86, 145)},
            "Elite VÃ³rtices Animados": {"xp": (2170, 2890), "hp": 7200, "atk": 1390, "coins": (88, 150)},
            "VÃ³rtices Animados AnciÃ£o": {"xp": (2190, 2915), "hp": 7250, "atk": 1395, "coins": (90, 155)},
            "VÃ³rtices Animados LendÃ¡rio": {"xp": (2210, 2940), "hp": 7300, "atk": 1400, "coins": (92, 160)},
        },
        "boss": {"name": "VÃ³rtice Supremo Animado", "hp": 2750000, "atk": 21500, "xp": 1280000, "level": 429, "coins": (211000, 379800)},
        "resources": ['EssÃªncia do NÃ­vel 420', 'Fragmento Dimensional 4', 'Cristal do Ciclo 3', 'Runa Absoluta', 'PÃ³ Primordial AvanÃ§ado'],
        "dungeons": [
            {"name": "Masmorra ğŸŒ€ VÃ³rtice Dimensional Supremo I", "level": 43, "boss": "GuardiÃ£o Interno 420"},
            {"name": "Masmorra ğŸŒ€ VÃ³rtice Dimensional Supremo II", "level": 44, "boss": "GuardiÃ£o Sombrio 420"},
            {"name": "SantuÃ¡rio do NÃ­vel 420", "level": 45, "boss": "Senhor do SantuÃ¡rio 420"}
        ],
        "secret_dungeons": [
            {"name": "ğŸ” CÃ¢mara Secreta ğŸŒ€ VÃ³rtice Dimensional Supremo", "level": 43, "boss": "GuardiÃ£o Oculto 420", "secret": True, "special_boss_drop": "Absoluto", "key_name": "ğŸ—ï¸ Chave de ğŸŒ€ VÃ³rtice Dimensional Supremo"},
            {"name": "ğŸŒŒ Portal Dimensional 420", "level": 44, "boss": "Entidade Portal 420", "secret": True, "special_boss_drop": "Transcendente", "key_name": "ğŸ—ï¸ Chave Portal 420"}
        ],
        "events": [
            "VocÃª sente o peso do nÃ­vel 420 ao seu redor.", "A realidade aqui Ã© diferente de tudo que vocÃª conhecia.",
            "Criaturas de poder incompreensÃ­vel observam sua passagem.", "Cada passo aqui Ã© uma conquista sem precedentes.",
            "O ar vibra com energia Superior.", "VocÃª estÃ¡ entre os mais fortes jÃ¡ registrados neste plano.",
            "O horizonte aqui nÃ£o existe â€” sÃ³ poder infinito.", "Sua presenÃ§a aqui altera o tecido da realidade.",
            "Nenhum mortal comum sobreviveria neste lugar.", "VocÃª forjou seu prÃ³prio destino chegando atÃ© aqui.",
            "Os GuardiÃµes te testam constantemente.", "Cada batalha aqui redefine seus limites.",
        ],
        "exclusive_drops": {
            "weapons": ["Arma do Plano Superior 420", "LÃ¢mina Dimensional NÃ­vel 420"],
            "armor": ["Armadura Superior 420", "Vestes do Ciclo 4"]
        }
    },
    430: {
        "name": "ğŸ›ï¸ ğŸ›ï¸ Templo dos Deuses Maiores",
        "emoji": "ğŸ›ï¸",
        "xp_loss_multiplier": 14.5,
        "monsters": {
            "Avatares Divinos Alpha": {"xp": (2220, 2960), "hp": 7400, "atk": 1440, "coins": (86, 143)},
            "Avatares Divinos Supremo": {"xp": (2240, 2985), "hp": 7450, "atk": 1445, "coins": (88, 148)},
            "Elite Avatares Divinos": {"xp": (2260, 3010), "hp": 7500, "atk": 1450, "coins": (90, 153)},
            "Avatares Divinos AnciÃ£o": {"xp": (2280, 3035), "hp": 7550, "atk": 1455, "coins": (92, 158)},
            "Avatares Divinos LendÃ¡rio": {"xp": (2300, 3060), "hp": 7600, "atk": 1460, "coins": (94, 163)},
        },
        "boss": {"name": "Avatar Divino Supremo", "hp": 3150000, "atk": 23400, "xp": 1410000, "level": 439, "coins": (232000, 417600)},
        "resources": ['EssÃªncia do NÃ­vel 430', 'Fragmento Dimensional 4', 'Cristal do Ciclo 3', 'Runa Absoluta', 'PÃ³ Primordial AvanÃ§ado'],
        "dungeons": [
            {"name": "Masmorra ğŸ›ï¸ Templo dos Deuses Maiores I", "level": 44, "boss": "GuardiÃ£o Interno 430"},
            {"name": "Masmorra ğŸ›ï¸ Templo dos Deuses Maiores II", "level": 45, "boss": "GuardiÃ£o Sombrio 430"},
            {"name": "SantuÃ¡rio do NÃ­vel 430", "level": 46, "boss": "Senhor do SantuÃ¡rio 430"}
        ],
        "secret_dungeons": [
            {"name": "ğŸ” CÃ¢mara Secreta ğŸ›ï¸ Templo dos Deuses Maiores", "level": 44, "boss": "GuardiÃ£o Oculto 430", "secret": True, "special_boss_drop": "Absoluto", "key_name": "ğŸ—ï¸ Chave de ğŸ›ï¸ Templo dos Deuses Maiores"},
            {"name": "ğŸŒŒ Portal Dimensional 430", "level": 45, "boss": "Entidade Portal 430", "secret": True, "special_boss_drop": "Transcendente", "key_name": "ğŸ—ï¸ Chave Portal 430"}
        ],
        "events": [
            "VocÃª sente o peso do nÃ­vel 430 ao seu redor.", "A realidade aqui Ã© diferente de tudo que vocÃª conhecia.",
            "Criaturas de poder incompreensÃ­vel observam sua passagem.", "Cada passo aqui Ã© uma conquista sem precedentes.",
            "O ar vibra com energia Superior.", "VocÃª estÃ¡ entre os mais fortes jÃ¡ registrados neste plano.",
            "O horizonte aqui nÃ£o existe â€” sÃ³ poder infinito.", "Sua presenÃ§a aqui altera o tecido da realidade.",
            "Nenhum mortal comum sobreviveria neste lugar.", "VocÃª forjou seu prÃ³prio destino chegando atÃ© aqui.",
            "Os GuardiÃµes te testam constantemente.", "Cada batalha aqui redefine seus limites.",
        ],
        "exclusive_drops": {
            "weapons": ["Arma do Plano Superior 430", "LÃ¢mina Dimensional NÃ­vel 430"],
            "armor": ["Armadura Superior 430", "Vestes do Ciclo 4"]
        }
    },
    440: {
        "name": "â­ â­ Estrela Primordial Viva",
        "emoji": "â­",
        "xp_loss_multiplier": 15.0,
        "monsters": {
            "Elementais Estelares Supremos Alpha": {"xp": (2310, 3080), "hp": 7700, "atk": 1500, "coins": (88, 146)},
            "Elementais Estelares Supremos Supremo": {"xp": (2330, 3105), "hp": 7750, "atk": 1505, "coins": (90, 151)},
            "Elite Elementais Estelares Supremos": {"xp": (2350, 3130), "hp": 7800, "atk": 1510, "coins": (92, 156)},
            "Elementais Estelares Supremos AnciÃ£o": {"xp": (2370, 3155), "hp": 7850, "atk": 1515, "coins": (94, 161)},
            "Elementais Estelares Supremos LendÃ¡rio": {"xp": (2390, 3180), "hp": 7900, "atk": 1520, "coins": (96, 166)},
        },
        "boss": {"name": "Estrela Primordial", "hp": 3600000, "atk": 25400, "xp": 1560000, "level": 449, "coins": (256000, 460800)},
        "resources": ['EssÃªncia do NÃ­vel 440', 'Fragmento Dimensional 4', 'Cristal do Ciclo 3', 'Runa Absoluta', 'PÃ³ Primordial AvanÃ§ado'],
        "dungeons": [
            {"name": "Masmorra â­ Estrela Primordial Viva I", "level": 45, "boss": "GuardiÃ£o Interno 440"},
            {"name": "Masmorra â­ Estrela Primordial Viva II", "level": 46, "boss": "GuardiÃ£o Sombrio 440"},
            {"name": "SantuÃ¡rio do NÃ­vel 440", "level": 47, "boss": "Senhor do SantuÃ¡rio 440"}
        ],
        "secret_dungeons": [
            {"name": "ğŸ” CÃ¢mara Secreta â­ Estrela Primordial Viva", "level": 45, "boss": "GuardiÃ£o Oculto 440", "secret": True, "special_boss_drop": "Absoluto", "key_name": "ğŸ—ï¸ Chave de â­ Estrela Primordial Viva"},
            {"name": "ğŸŒŒ Portal Dimensional 440", "level": 46, "boss": "Entidade Portal 440", "secret": True, "special_boss_drop": "Transcendente", "key_name": "ğŸ—ï¸ Chave Portal 440"}
        ],
        "events": [
            "VocÃª sente o peso do nÃ­vel 440 ao seu redor.", "A realidade aqui Ã© diferente de tudo que vocÃª conhecia.",
            "Criaturas de poder incompreensÃ­vel observam sua passagem.", "Cada passo aqui Ã© uma conquista sem precedentes.",
            "O ar vibra com energia Superior.", "VocÃª estÃ¡ entre os mais fortes jÃ¡ registrados neste plano.",
            "O horizonte aqui nÃ£o existe â€” sÃ³ poder infinito.", "Sua presenÃ§a aqui altera o tecido da realidade.",
            "Nenhum mortal comum sobreviveria neste lugar.", "VocÃª forjou seu prÃ³prio destino chegando atÃ© aqui.",
            "Os GuardiÃµes te testam constantemente.", "Cada batalha aqui redefine seus limites.",
        ],
        "exclusive_drops": {
            "weapons": ["Arma do Plano Superior 440", "LÃ¢mina Dimensional NÃ­vel 440"],
            "armor": ["Armadura Superior 440", "Vestes do Ciclo 4"]
        }
    },
    450: {
        "name": "ğŸŒŒ ğŸŒŒ Abismo CÃ³smico",
        "emoji": "ğŸŒŒ",
        "xp_loss_multiplier": 15.0,
        "monsters": {
            "Predadores do Vazio Alpha": {"xp": (2400, 3200), "hp": 8000, "atk": 1560, "coins": (90, 150)},
            "Predadores do Vazio Supremo": {"xp": (2420, 3225), "hp": 8050, "atk": 1565, "coins": (92, 155)},
            "Elite Predadores do Vazio": {"xp": (2440, 3250), "hp": 8100, "atk": 1570, "coins": (94, 160)},
            "Predadores do Vazio AnciÃ£o": {"xp": (2460, 3275), "hp": 8150, "atk": 1575, "coins": (96, 165)},
            "Predadores do Vazio LendÃ¡rio": {"xp": (2480, 3300), "hp": 8200, "atk": 1580, "coins": (98, 170)},
        },
        "boss": {"name": "Predador do Abismo CÃ³smico", "hp": 4100000, "atk": 27600, "xp": 1720000, "level": 459, "coins": (282000, 507600)},
        "resources": ['EssÃªncia do NÃ­vel 450', 'Fragmento Dimensional 4', 'Cristal do Ciclo 3', 'Runa Absoluta', 'PÃ³ Primordial AvanÃ§ado'],
        "dungeons": [
            {"name": "Masmorra ğŸŒŒ Abismo CÃ³smico I", "level": 46, "boss": "GuardiÃ£o Interno 450"},
            {"name": "Masmorra ğŸŒŒ Abismo CÃ³smico II", "level": 47, "boss": "GuardiÃ£o Sombrio 450"},
            {"name": "SantuÃ¡rio do NÃ­vel 450", "level": 48, "boss": "Senhor do SantuÃ¡rio 450"}
        ],
        "secret_dungeons": [
            {"name": "ğŸ” CÃ¢mara Secreta ğŸŒŒ Abismo CÃ³smico", "level": 46, "boss": "GuardiÃ£o Oculto 450", "secret": True, "special_boss_drop": "Absoluto", "key_name": "ğŸ—ï¸ Chave de ğŸŒŒ Abismo CÃ³smico"},
            {"name": "ğŸŒŒ Portal Dimensional 450", "level": 47, "boss": "Entidade Portal 450", "secret": True, "special_boss_drop": "Transcendente", "key_name": "ğŸ—ï¸ Chave Portal 450"}
        ],
        "events": [
            "VocÃª sente o peso do nÃ­vel 450 ao seu redor.", "A realidade aqui Ã© diferente de tudo que vocÃª conhecia.",
            "Criaturas de poder incompreensÃ­vel observam sua passagem.", "Cada passo aqui Ã© uma conquista sem precedentes.",
            "O ar vibra com energia Superior.", "VocÃª estÃ¡ entre os mais fortes jÃ¡ registrados neste plano.",
            "O horizonte aqui nÃ£o existe â€” sÃ³ poder infinito.", "Sua presenÃ§a aqui altera o tecido da realidade.",
            "Nenhum mortal comum sobreviveria neste lugar.", "VocÃª forjou seu prÃ³prio destino chegando atÃ© aqui.",
            "Os GuardiÃµes te testam constantemente.", "Cada batalha aqui redefine seus limites.",
        ],
        "exclusive_drops": {
            "weapons": ["Arma do Plano Superior 450", "LÃ¢mina Dimensional NÃ­vel 450"],
            "armor": ["Armadura Superior 450", "Vestes do Ciclo 4"]
        }
    },
    460: {
        "name": "âš¡ âš¡ Plasma da CriaÃ§Ã£o",
        "emoji": "âš¡",
        "xp_loss_multiplier": 15.5,
        "monsters": {
            "ManifestaÃ§Ãµes EnergÃ©ticas Alpha": {"xp": (2490, 3320), "hp": 8300, "atk": 1620, "coins": (92, 153)},
            "ManifestaÃ§Ãµes EnergÃ©ticas Supremo": {"xp": (2510, 3345), "hp": 8350, "atk": 1625, "coins": (94, 158)},
            "Elite ManifestaÃ§Ãµes EnergÃ©ticas": {"xp": (2530, 3370), "hp": 8400, "atk": 1630, "coins": (96, 163)},
            "ManifestaÃ§Ãµes EnergÃ©ticas AnciÃ£o": {"xp": (2550, 3395), "hp": 8450, "atk": 1635, "coins": (98, 168)},
            "ManifestaÃ§Ãµes EnergÃ©ticas LendÃ¡rio": {"xp": (2570, 3420), "hp": 8500, "atk": 1640, "coins": (100, 173)},
        },
        "boss": {"name": "ManifestaÃ§Ã£o da CriaÃ§Ã£o", "hp": 4700000, "atk": 30000, "xp": 1900000, "level": 469, "coins": (310000, 558000)},
        "resources": ['EssÃªncia do NÃ­vel 460', 'Fragmento Dimensional 4', 'Cristal do Ciclo 3', 'Runa Absoluta', 'PÃ³ Primordial AvanÃ§ado'],
        "dungeons": [
            {"name": "Masmorra âš¡ Plasma da CriaÃ§Ã£o I", "level": 47, "boss": "GuardiÃ£o Interno 460"},
            {"name": "Masmorra âš¡ Plasma da CriaÃ§Ã£o II", "level": 48, "boss": "GuardiÃ£o Sombrio 460"},
            {"name": "SantuÃ¡rio do NÃ­vel 460", "level": 49, "boss": "Senhor do SantuÃ¡rio 460"}
        ],
        "secret_dungeons": [
            {"name": "ğŸ” CÃ¢mara Secreta âš¡ Plasma da CriaÃ§Ã£o", "level": 47, "boss": "GuardiÃ£o Oculto 460", "secret": True, "special_boss_drop": "Absoluto", "key_name": "ğŸ—ï¸ Chave de âš¡ Plasma da CriaÃ§Ã£o"},
            {"name": "ğŸŒŒ Portal Dimensional 460", "level": 48, "boss": "Entidade Portal 460", "secret": True, "special_boss_drop": "Transcendente", "key_name": "ğŸ—ï¸ Chave Portal 460"}
        ],
        "events": [
            "VocÃª sente o peso do nÃ­vel 460 ao seu redor.", "A realidade aqui Ã© diferente de tudo que vocÃª conhecia.",
            "Criaturas de poder incompreensÃ­vel observam sua passagem.", "Cada passo aqui Ã© uma conquista sem precedentes.",
            "O ar vibra com energia Superior.", "VocÃª estÃ¡ entre os mais fortes jÃ¡ registrados neste plano.",
            "O horizonte aqui nÃ£o existe â€” sÃ³ poder infinito.", "Sua presenÃ§a aqui altera o tecido da realidade.",
            "Nenhum mortal comum sobreviveria neste lugar.", "VocÃª forjou seu prÃ³prio destino chegando atÃ© aqui.",
            "Os GuardiÃµes te testam constantemente.", "Cada batalha aqui redefine seus limites.",
        ],
        "exclusive_drops": {
            "weapons": ["Arma do Plano Superior 460", "LÃ¢mina Dimensional NÃ­vel 460"],
            "armor": ["Armadura Superior 460", "Vestes do Ciclo 4"]
        }
    },
    470: {
        "name": "ğŸ”± ğŸ”± Olimpo Transcendente",
        "emoji": "ğŸ”±",
        "xp_loss_multiplier": 15.5,
        "monsters": {
            "Divindades Transcendentes Alpha": {"xp": (2580, 3440), "hp": 8600, "atk": 1680, "coins": (94, 156)},
            "Divindades Transcendentes Supremo": {"xp": (2600, 3465), "hp": 8650, "atk": 1685, "coins": (96, 161)},
            "Elite Divindades Transcendentes": {"xp": (2620, 3490), "hp": 8700, "atk": 1690, "coins": (98, 166)},
            "Divindades Transcendentes AnciÃ£o": {"xp": (2640, 3515), "hp": 8750, "atk": 1695, "coins": (100, 171)},
            "Divindades Transcendentes LendÃ¡rio": {"xp": (2660, 3540), "hp": 8800, "atk": 1700, "coins": (102, 176)},
        },
        "boss": {"name": "Divindade Transcendente", "hp": 5400000, "atk": 32600, "xp": 2100000, "level": 479, "coins": (341000, 613800)},
        "resources": ['EssÃªncia do NÃ­vel 470', 'Fragmento Dimensional 4', 'Cristal do Ciclo 3', 'Runa Absoluta', 'PÃ³ Primordial AvanÃ§ado'],
        "dungeons": [
            {"name": "Masmorra ğŸ”± Olimpo Transcendente I", "level": 48, "boss": "GuardiÃ£o Interno 470"},
            {"name": "Masmorra ğŸ”± Olimpo Transcendente II", "level": 49, "boss": "GuardiÃ£o Sombrio 470"},
            {"name": "SantuÃ¡rio do NÃ­vel 470", "level": 50, "boss": "Senhor do SantuÃ¡rio 470"}
        ],
        "secret_dungeons": [
            {"name": "ğŸ” CÃ¢mara Secreta ğŸ”± Olimpo Transcendente", "level": 48, "boss": "GuardiÃ£o Oculto 470", "secret": True, "special_boss_drop": "Absoluto", "key_name": "ğŸ—ï¸ Chave de ğŸ”± Olimpo Transcendente"},
            {"name": "ğŸŒŒ Portal Dimensional 470", "level": 49, "boss": "Entidade Portal 470", "secret": True, "special_boss_drop": "Transcendente", "key_name": "ğŸ—ï¸ Chave Portal 470"}
        ],
        "events": [
            "VocÃª sente o peso do nÃ­vel 470 ao seu redor.", "A realidade aqui Ã© diferente de tudo que vocÃª conhecia.",
            "Criaturas de poder incompreensÃ­vel observam sua passagem.", "Cada passo aqui Ã© uma conquista sem precedentes.",
            "O ar vibra com energia Superior.", "VocÃª estÃ¡ entre os mais fortes jÃ¡ registrados neste plano.",
            "O horizonte aqui nÃ£o existe â€” sÃ³ poder infinito.", "Sua presenÃ§a aqui altera o tecido da realidade.",
            "Nenhum mortal comum sobreviveria neste lugar.", "VocÃª forjou seu prÃ³prio destino chegando atÃ© aqui.",
            "Os GuardiÃµes te testam constantemente.", "Cada batalha aqui redefine seus limites.",
        ],
        "exclusive_drops": {
            "weapons": ["Arma do Plano Superior 470", "LÃ¢mina Dimensional NÃ­vel 470"],
            "armor": ["Armadura Superior 470", "Vestes do Ciclo 4"]
        }
    },
    480: {
        "name": "ğŸ’ ğŸ’ Cristal do Universo",
        "emoji": "ğŸ’",
        "xp_loss_multiplier": 16.0,
        "monsters": {
            "GuardiÃµes da Realidade Alpha": {"xp": (2670, 3560), "hp": 8900, "atk": 1740, "coins": (96, 160)},
            "GuardiÃµes da Realidade Supremo": {"xp": (2690, 3585), "hp": 8950, "atk": 1745, "coins": (98, 165)},
            "Elite GuardiÃµes da Realidade": {"xp": (2710, 3610), "hp": 9000, "atk": 1750, "coins": (100, 170)},
            "GuardiÃµes da Realidade AnciÃ£o": {"xp": (2730, 3635), "hp": 9050, "atk": 1755, "coins": (102, 175)},
            "GuardiÃµes da Realidade LendÃ¡rio": {"xp": (2750, 3660), "hp": 9100, "atk": 1760, "coins": (104, 180)},
        },
        "boss": {"name": "GuardiÃ£o da Realidade", "hp": 6200000, "atk": 35500, "xp": 2320000, "level": 489, "coins": (375000, 675000)},
        "resources": ['EssÃªncia do NÃ­vel 480', 'Fragmento Dimensional 4', 'Cristal do Ciclo 3', 'Runa Absoluta', 'PÃ³ Primordial AvanÃ§ado'],
        "dungeons": [
            {"name": "Masmorra ğŸ’ Cristal do Universo I", "level": 49, "boss": "GuardiÃ£o Interno 480"},
            {"name": "Masmorra ğŸ’ Cristal do Universo II", "level": 50, "boss": "GuardiÃ£o Sombrio 480"},
            {"name": "SantuÃ¡rio do NÃ­vel 480", "level": 51, "boss": "Senhor do SantuÃ¡rio 480"}
        ],
        "secret_dungeons": [
            {"name": "ğŸ” CÃ¢mara Secreta ğŸ’ Cristal do Universo", "level": 49, "boss": "GuardiÃ£o Oculto 480", "secret": True, "special_boss_drop": "Absoluto", "key_name": "ğŸ—ï¸ Chave de ğŸ’ Cristal do Universo"},
            {"name": "ğŸŒŒ Portal Dimensional 480", "level": 50, "boss": "Entidade Portal 480", "secret": True, "special_boss_drop": "Transcendente", "key_name": "ğŸ—ï¸ Chave Portal 480"}
        ],
        "events": [
            "VocÃª sente o peso do nÃ­vel 480 ao seu redor.", "A realidade aqui Ã© diferente de tudo que vocÃª conhecia.",
            "Criaturas de poder incompreensÃ­vel observam sua passagem.", "Cada passo aqui Ã© uma conquista sem precedentes.",
            "O ar vibra com energia Superior.", "VocÃª estÃ¡ entre os mais fortes jÃ¡ registrados neste plano.",
            "O horizonte aqui nÃ£o existe â€” sÃ³ poder infinito.", "Sua presenÃ§a aqui altera o tecido da realidade.",
            "Nenhum mortal comum sobreviveria neste lugar.", "VocÃª forjou seu prÃ³prio destino chegando atÃ© aqui.",
            "Os GuardiÃµes te testam constantemente.", "Cada batalha aqui redefine seus limites.",
        ],
        "exclusive_drops": {
            "weapons": ["Arma do Plano Superior 480", "LÃ¢mina Dimensional NÃ­vel 480"],
            "armor": ["Armadura Superior 480", "Vestes do Ciclo 4"]
        }
    },
    490: {
        "name": "ğŸŒ  ğŸŒ  Ãpice das DimensÃµes Superiores",
        "emoji": "ğŸŒ ",
        "xp_loss_multiplier": 16.0,
        "monsters": {
            "Senhores Dimensionais Alpha": {"xp": (2760, 3680), "hp": 9200, "atk": 1800, "coins": (98, 163)},
            "Senhores Dimensionais Supremo": {"xp": (2780, 3705), "hp": 9250, "atk": 1805, "coins": (100, 168)},
            "Elite Senhores Dimensionais": {"xp": (2800, 3730), "hp": 9300, "atk": 1810, "coins": (102, 173)},
            "Senhores Dimensionais AnciÃ£o": {"xp": (2820, 3755), "hp": 9350, "atk": 1815, "coins": (104, 178)},
            "Senhores Dimensionais LendÃ¡rio": {"xp": (2840, 3780), "hp": 9400, "atk": 1820, "coins": (106, 183)},
        },
        "boss": {"name": "Divindade Dimensional", "hp": 7100000, "atk": 38600, "xp": 2560000, "level": 499, "coins": (412000, 741600)},
        "resources": ['EssÃªncia do NÃ­vel 490', 'Fragmento Dimensional 4', 'Cristal do Ciclo 3', 'Runa Absoluta', 'PÃ³ Primordial AvanÃ§ado'],
        "dungeons": [
            {"name": "Masmorra ğŸŒ  Ãpice das DimensÃµes Superiores I", "level": 50, "boss": "GuardiÃ£o Interno 490"},
            {"name": "Masmorra ğŸŒ  Ãpice das DimensÃµes Superiores II", "level": 51, "boss": "GuardiÃ£o Sombrio 490"},
            {"name": "SantuÃ¡rio do NÃ­vel 490", "level": 52, "boss": "Senhor do SantuÃ¡rio 490"}
        ],
        "secret_dungeons": [
            {"name": "ğŸ” CÃ¢mara Secreta ğŸŒ  Ãpice das DimensÃµes Superiores", "level": 50, "boss": "GuardiÃ£o Oculto 490", "secret": True, "special_boss_drop": "Absoluto", "key_name": "ğŸ—ï¸ Chave de ğŸŒ  Ãpice das DimensÃµes Superiores"},
            {"name": "ğŸŒŒ Portal Dimensional 490", "level": 51, "boss": "Entidade Portal 490", "secret": True, "special_boss_drop": "Transcendente", "key_name": "ğŸ—ï¸ Chave Portal 490"}
        ],
        "events": [
            "VocÃª sente o peso do nÃ­vel 490 ao seu redor.", "A realidade aqui Ã© diferente de tudo que vocÃª conhecia.",
            "Criaturas de poder incompreensÃ­vel observam sua passagem.", "Cada passo aqui Ã© uma conquista sem precedentes.",
            "O ar vibra com energia Superior.", "VocÃª estÃ¡ entre os mais fortes jÃ¡ registrados neste plano.",
            "O horizonte aqui nÃ£o existe â€” sÃ³ poder infinito.", "Sua presenÃ§a aqui altera o tecido da realidade.",
            "Nenhum mortal comum sobreviveria neste lugar.", "VocÃª forjou seu prÃ³prio destino chegando atÃ© aqui.",
            "Os GuardiÃµes te testam constantemente.", "Cada batalha aqui redefine seus limites.",
        ],
        "exclusive_drops": {
            "weapons": ["Arma do Plano Superior 490", "LÃ¢mina Dimensional NÃ­vel 490"],
            "armor": ["Armadura Superior 490", "Vestes do Ciclo 4"]
        }
    },
    500: {
        "name": "â™¾ï¸ â™¾ï¸ Planos Absolutos â€” Limiar",
        "emoji": "â™¾ï¸",
        "xp_loss_multiplier": 17.0,
        "monsters": {
            "Sentinelas do Absoluto Alpha": {"xp": (2880, 3840), "hp": 9600, "atk": 1870, "coins": (100, 166)},
            "Sentinelas do Absoluto Supremo": {"xp": (2900, 3865), "hp": 9650, "atk": 1875, "coins": (102, 171)},
            "Elite Sentinelas do Absoluto": {"xp": (2920, 3890), "hp": 9700, "atk": 1880, "coins": (104, 176)},
            "Sentinelas do Absoluto AnciÃ£o": {"xp": (2940, 3915), "hp": 9750, "atk": 1885, "coins": (106, 181)},
            "Sentinelas do Absoluto LendÃ¡rio": {"xp": (2960, 3940), "hp": 9800, "atk": 1890, "coins": (108, 186)},
        },
        "boss": {"name": "Sentinela do Absoluto", "hp": 8200000, "atk": 42000, "xp": 2830000, "level": 509, "coins": (453000, 815400)},
        "resources": ['EssÃªncia do NÃ­vel 500', 'Fragmento Dimensional 5', 'Cristal do Ciclo 3', 'Runa Absoluta', 'PÃ³ Primordial AvanÃ§ado'],
        "dungeons": [
            {"name": "Masmorra â™¾ï¸ Planos Absolutos â€” Limiar I", "level": 51, "boss": "GuardiÃ£o Interno 500"},
            {"name": "Masmorra â™¾ï¸ Planos Absolutos â€” Limiar II", "level": 52, "boss": "GuardiÃ£o Sombrio 500"},
            {"name": "SantuÃ¡rio do NÃ­vel 500", "level": 53, "boss": "Senhor do SantuÃ¡rio 500"}
        ],
        "secret_dungeons": [
            {"name": "ğŸ” CÃ¢mara Secreta â™¾ï¸ Planos Absolutos â€” Limiar", "level": 51, "boss": "GuardiÃ£o Oculto 500", "secret": True, "special_boss_drop": "Absoluto", "key_name": "ğŸ—ï¸ Chave de â™¾ï¸ Planos Absolutos â€” Limiar"},
            {"name": "ğŸŒŒ Portal Dimensional 500", "level": 52, "boss": "Entidade Portal 500", "secret": True, "special_boss_drop": "Transcendente", "key_name": "ğŸ—ï¸ Chave Portal 500"}
        ],
        "events": [
            "VocÃª sente o peso do nÃ­vel 500 ao seu redor.", "A realidade aqui Ã© diferente de tudo que vocÃª conhecia.",
            "Criaturas de poder incompreensÃ­vel observam sua passagem.", "Cada passo aqui Ã© uma conquista sem precedentes.",
            "O ar vibra com energia Absoluto.", "VocÃª estÃ¡ entre os mais fortes jÃ¡ registrados neste plano.",
            "O horizonte aqui nÃ£o existe â€” sÃ³ poder infinito.", "Sua presenÃ§a aqui altera o tecido da realidade.",
            "Nenhum mortal comum sobreviveria neste lugar.", "VocÃª forjou seu prÃ³prio destino chegando atÃ© aqui.",
            "Os GuardiÃµes te testam constantemente.", "Cada batalha aqui redefine seus limites.",
        ],
        "exclusive_drops": {
            "weapons": ["Arma do Plano Absoluto 500", "LÃ¢mina Dimensional NÃ­vel 500"],
            "armor": ["Armadura Absoluto 500", "Vestes do Ciclo 5"]
        }
    },
    510: {
        "name": "ğŸŒ‘ ğŸŒ‘ Trevas Absolutas",
        "emoji": "ğŸŒ‘",
        "xp_loss_multiplier": 17.0,
        "monsters": {
            "Sombras Absolutas Alpha": {"xp": (3000, 4000), "hp": 10000, "atk": 1950, "coins": (102, 170)},
            "Sombras Absolutas Supremo": {"xp": (3020, 4025), "hp": 10050, "atk": 1955, "coins": (104, 175)},
            "Elite Sombras Absolutas": {"xp": (3040, 4050), "hp": 10100, "atk": 1960, "coins": (106, 180)},
            "Sombras Absolutas AnciÃ£o": {"xp": (3060, 4075), "hp": 10150, "atk": 1965, "coins": (108, 185)},
            "Sombras Absolutas LendÃ¡rio": {"xp": (3080, 4100), "hp": 10200, "atk": 1970, "coins": (110, 190)},
        },
        "boss": {"name": "Trevas Absolutas Encarnadas", "hp": 9500000, "atk": 45700, "xp": 3130000, "level": 519, "coins": (498000, 896400)},
        "resources": ['EssÃªncia do NÃ­vel 510', 'Fragmento Dimensional 5', 'Cristal do Ciclo 3', 'Runa Absoluta', 'PÃ³ Primordial AvanÃ§ado'],
        "dungeons": [
            {"name": "Masmorra ğŸŒ‘ Trevas Absolutas I", "level": 52, "boss": "GuardiÃ£o Interno 510"},
            {"name": "Masmorra ğŸŒ‘ Trevas Absolutas II", "level": 53, "boss": "GuardiÃ£o Sombrio 510"},
            {"name": "SantuÃ¡rio do NÃ­vel 510", "level": 54, "boss": "Senhor do SantuÃ¡rio 510"}
        ],
        "secret_dungeons": [
            {"name": "ğŸ” CÃ¢mara Secreta ğŸŒ‘ Trevas Absolutas", "level": 52, "boss": "GuardiÃ£o Oculto 510", "secret": True, "special_boss_drop": "Absoluto", "key_name": "ğŸ—ï¸ Chave de ğŸŒ‘ Trevas Absolutas"},
            {"name": "ğŸŒŒ Portal Dimensional 510", "level": 53, "boss": "Entidade Portal 510", "secret": True, "special_boss_drop": "Transcendente", "key_name": "ğŸ—ï¸ Chave Portal 510"}
        ],
        "events": [
            "VocÃª sente o peso do nÃ­vel 510 ao seu redor.", "A realidade aqui Ã© diferente de tudo que vocÃª conhecia.",
            "Criaturas de poder incompreensÃ­vel observam sua passagem.", "Cada passo aqui Ã© uma conquista sem precedentes.",
            "O ar vibra com energia Absoluto.", "VocÃª estÃ¡ entre os mais fortes jÃ¡ registrados neste plano.",
            "O horizonte aqui nÃ£o existe â€” sÃ³ poder infinito.", "Sua presenÃ§a aqui altera o tecido da realidade.",
            "Nenhum mortal comum sobreviveria neste lugar.", "VocÃª forjou seu prÃ³prio destino chegando atÃ© aqui.",
            "Os GuardiÃµes te testam constantemente.", "Cada batalha aqui redefine seus limites.",
        ],
        "exclusive_drops": {
            "weapons": ["Arma do Plano Absoluto 510", "LÃ¢mina Dimensional NÃ­vel 510"],
            "armor": ["Armadura Absoluto 510", "Vestes do Ciclo 5"]
        }
    },
    520: {
        "name": "ğŸŒŸ ğŸŒŸ Luz Absoluta",
        "emoji": "ğŸŒŸ",
        "xp_loss_multiplier": 17.5,
        "monsters": {
            "Seres de Luz Pura Alpha": {"xp": (3120, 4160), "hp": 10400, "atk": 2040, "coins": (104, 173)},
            "Seres de Luz Pura Supremo": {"xp": (3140, 4185), "hp": 10450, "atk": 2045, "coins": (106, 178)},
            "Elite Seres de Luz Pura": {"xp": (3160, 4210), "hp": 10500, "atk": 2050, "coins": (108, 183)},
            "Seres de Luz Pura AnciÃ£o": {"xp": (3180, 4235), "hp": 10550, "atk": 2055, "coins": (110, 188)},
            "Seres de Luz Pura LendÃ¡rio": {"xp": (3200, 4260), "hp": 10600, "atk": 2060, "coins": (112, 193)},
        },
        "boss": {"name": "Luz Absoluta Encarnada", "hp": 11000000, "atk": 49700, "xp": 3460000, "level": 529, "coins": (547000, 984600)},
        "resources": ['EssÃªncia do NÃ­vel 520', 'Fragmento Dimensional 5', 'Cristal do Ciclo 3', 'Runa Absoluta', 'PÃ³ Primordial AvanÃ§ado'],
        "dungeons": [
            {"name": "Masmorra ğŸŒŸ Luz Absoluta I", "level": 53, "boss": "GuardiÃ£o Interno 520"},
            {"name": "Masmorra ğŸŒŸ Luz Absoluta II", "level": 54, "boss": "GuardiÃ£o Sombrio 520"},
            {"name": "SantuÃ¡rio do NÃ­vel 520", "level": 55, "boss": "Senhor do SantuÃ¡rio 520"}
        ],
        "secret_dungeons": [
            {"name": "ğŸ” CÃ¢mara Secreta ğŸŒŸ Luz Absoluta", "level": 53, "boss": "GuardiÃ£o Oculto 520", "secret": True, "special_boss_drop": "Absoluto", "key_name": "ğŸ—ï¸ Chave de ğŸŒŸ Luz Absoluta"},
            {"name": "ğŸŒŒ Portal Dimensional 520", "level": 54, "boss": "Entidade Portal 520", "secret": True, "special_boss_drop": "Transcendente", "key_name": "ğŸ—ï¸ Chave Portal 520"}
        ],
        "events": [
            "VocÃª sente o peso do nÃ­vel 520 ao seu redor.", "A realidade aqui Ã© diferente de tudo que vocÃª conhecia.",
            "Criaturas de poder incompreensÃ­vel observam sua passagem.", "Cada passo aqui Ã© uma conquista sem precedentes.",
            "O ar vibra com energia Absoluto.", "VocÃª estÃ¡ entre os mais fortes jÃ¡ registrados neste plano.",
            "O horizonte aqui nÃ£o existe â€” sÃ³ poder infinito.", "Sua presenÃ§a aqui altera o tecido da realidade.",
            "Nenhum mortal comum sobreviveria neste lugar.", "VocÃª forjou seu prÃ³prio destino chegando atÃ© aqui.",
            "Os GuardiÃµes te testam constantemente.", "Cada batalha aqui redefine seus limites.",
        ],
        "exclusive_drops": {
            "weapons": ["Arma do Plano Absoluto 520", "LÃ¢mina Dimensional NÃ­vel 520"],
            "armor": ["Armadura Absoluto 520", "Vestes do Ciclo 5"]
        }
    },
    530: {
        "name": "âš–ï¸ âš–ï¸ EquilÃ­brio Primordial",
        "emoji": "âš–ï¸",
        "xp_loss_multiplier": 17.5,
        "monsters": {
            "Ãrbitros do EquilÃ­brio Alpha": {"xp": (3240, 4320), "hp": 10800, "atk": 2140, "coins": (106, 176)},
            "Ãrbitros do EquilÃ­brio Supremo": {"xp": (3260, 4345), "hp": 10850, "atk": 2145, "coins": (108, 181)},
            "Elite Ãrbitros do EquilÃ­brio": {"xp": (3280, 4370), "hp": 10900, "atk": 2150, "coins": (110, 186)},
            "Ãrbitros do EquilÃ­brio AnciÃ£o": {"xp": (3300, 4395), "hp": 10950, "atk": 2155, "coins": (112, 191)},
            "Ãrbitros do EquilÃ­brio LendÃ¡rio": {"xp": (3320, 4420), "hp": 11000, "atk": 2160, "coins": (114, 196)},
        },
        "boss": {"name": "Ãrbitro do EquilÃ­brio", "hp": 12700000, "atk": 54000, "xp": 3820000, "level": 539, "coins": (601000, 1081800)},
        "resources": ['EssÃªncia do NÃ­vel 530', 'Fragmento Dimensional 5', 'Cristal do Ciclo 3', 'Runa Absoluta', 'PÃ³ Primordial AvanÃ§ado'],
        "dungeons": [
            {"name": "Masmorra âš–ï¸ EquilÃ­brio Primordial I", "level": 54, "boss": "GuardiÃ£o Interno 530"},
            {"name": "Masmorra âš–ï¸ EquilÃ­brio Primordial II", "level": 55, "boss": "GuardiÃ£o Sombrio 530"},
            {"name": "SantuÃ¡rio do NÃ­vel 530", "level": 56, "boss": "Senhor do SantuÃ¡rio 530"}
        ],
        "secret_dungeons": [
            {"name": "ğŸ” CÃ¢mara Secreta âš–ï¸ EquilÃ­brio Primordial", "level": 54, "boss": "GuardiÃ£o Oculto 530", "secret": True, "special_boss_drop": "Absoluto", "key_name": "ğŸ—ï¸ Chave de âš–ï¸ EquilÃ­brio Primordial"},
            {"name": "ğŸŒŒ Portal Dimensional 530", "level": 55, "boss": "Entidade Portal 530", "secret": True, "special_boss_drop": "Transcendente", "key_name": "ğŸ—ï¸ Chave Portal 530"}
        ],
        "events": [
            "VocÃª sente o peso do nÃ­vel 530 ao seu redor.", "A realidade aqui Ã© diferente de tudo que vocÃª conhecia.",
            "Criaturas de poder incompreensÃ­vel observam sua passagem.", "Cada passo aqui Ã© uma conquista sem precedentes.",
            "O ar vibra com energia Absoluto.", "VocÃª estÃ¡ entre os mais fortes jÃ¡ registrados neste plano.",
            "O horizonte aqui nÃ£o existe â€” sÃ³ poder infinito.", "Sua presenÃ§a aqui altera o tecido da realidade.",
            "Nenhum mortal comum sobreviveria neste lugar.", "VocÃª forjou seu prÃ³prio destino chegando atÃ© aqui.",
            "Os GuardiÃµes te testam constantemente.", "Cada batalha aqui redefine seus limites.",
        ],
        "exclusive_drops": {
            "weapons": ["Arma do Plano Absoluto 530", "LÃ¢mina Dimensional NÃ­vel 530"],
            "armor": ["Armadura Absoluto 530", "Vestes do Ciclo 5"]
        }
    },
    540: {
        "name": "ğŸ”¥ ğŸ”¥ Chama Eterna",
        "emoji": "ğŸ”¥",
        "xp_loss_multiplier": 18.0,
        "monsters": {
            "GuardiÃµes da Chama Primordial Alpha": {"xp": (3360, 4480), "hp": 11200, "atk": 2250, "coins": (108, 180)},
            "GuardiÃµes da Chama Primordial Supremo": {"xp": (3380, 4505), "hp": 11250, "atk": 2255, "coins": (110, 185)},
            "Elite GuardiÃµes da Chama Primordial": {"xp": (3400, 4530), "hp": 11300, "atk": 2260, "coins": (112, 190)},
            "GuardiÃµes da Chama Primordial AnciÃ£o": {"xp": (3420, 4555), "hp": 11350, "atk": 2265, "coins": (114, 195)},
            "GuardiÃµes da Chama Primordial LendÃ¡rio": {"xp": (3440, 4580), "hp": 11400, "atk": 2270, "coins": (116, 200)},
        },
        "boss": {"name": "GuardiÃ£o da Chama Eterna", "hp": 14700000, "atk": 58700, "xp": 4230000, "level": 549, "coins": (660000, 1188000)},
        "resources": ['EssÃªncia do NÃ­vel 540', 'Fragmento Dimensional 5', 'Cristal do Ciclo 3', 'Runa Absoluta', 'PÃ³ Primordial AvanÃ§ado'],
        "dungeons": [
            {"name": "Masmorra ğŸ”¥ Chama Eterna I", "level": 55, "boss": "GuardiÃ£o Interno 540"},
            {"name": "Masmorra ğŸ”¥ Chama Eterna II", "level": 56, "boss": "GuardiÃ£o Sombrio 540"},
            {"name": "SantuÃ¡rio do NÃ­vel 540", "level": 57, "boss": "Senhor do SantuÃ¡rio 540"}
        ],
        "secret_dungeons": [
            {"name": "ğŸ” CÃ¢mara Secreta ğŸ”¥ Chama Eterna", "level": 55, "boss": "GuardiÃ£o Oculto 540", "secret": True, "special_boss_drop": "Absoluto", "key_name": "ğŸ—ï¸ Chave de ğŸ”¥ Chama Eterna"},
            {"name": "ğŸŒŒ Portal Dimensional 540", "level": 56, "boss": "Entidade Portal 540", "secret": True, "special_boss_drop": "Transcendente", "key_name": "ğŸ—ï¸ Chave Portal 540"}
        ],
        "events": [
            "VocÃª sente o peso do nÃ­vel 540 ao seu redor.", "A realidade aqui Ã© diferente de tudo que vocÃª conhecia.",
            "Criaturas de poder incompreensÃ­vel observam sua passagem.", "Cada passo aqui Ã© uma conquista sem precedentes.",
            "O ar vibra com energia Absoluto.", "VocÃª estÃ¡ entre os mais fortes jÃ¡ registrados neste plano.",
            "O horizonte aqui nÃ£o existe â€” sÃ³ poder infinito.", "Sua presenÃ§a aqui altera o tecido da realidade.",
            "Nenhum mortal comum sobreviveria neste lugar.", "VocÃª forjou seu prÃ³prio destino chegando atÃ© aqui.",
            "Os GuardiÃµes te testam constantemente.", "Cada batalha aqui redefine seus limites.",
        ],
        "exclusive_drops": {
            "weapons": ["Arma do Plano Absoluto 540", "LÃ¢mina Dimensional NÃ­vel 540"],
            "armor": ["Armadura Absoluto 540", "Vestes do Ciclo 5"]
        }
    },
    550: {
        "name": "ğŸŒŠ ğŸŒŠ Oceano Primordial",
        "emoji": "ğŸŒŠ",
        "xp_loss_multiplier": 18.0,
        "monsters": {
            "LeviatÃ£s Primordiais Alpha": {"xp": (3480, 4640), "hp": 11600, "atk": 2370, "coins": (110, 183)},
            "LeviatÃ£s Primordiais Supremo": {"xp": (3500, 4665), "hp": 11650, "atk": 2375, "coins": (112, 188)},
            "Elite LeviatÃ£s Primordiais": {"xp": (3520, 4690), "hp": 11700, "atk": 2380, "coins": (114, 193)},
            "LeviatÃ£s Primordiais AnciÃ£o": {"xp": (3540, 4715), "hp": 11750, "atk": 2385, "coins": (116, 198)},
            "LeviatÃ£s Primordiais LendÃ¡rio": {"xp": (3560, 4740), "hp": 11800, "atk": 2390, "coins": (118, 203)},
        },
        "boss": {"name": "LeviatÃ£ do Oceano Primordial", "hp": 17000000, "atk": 63800, "xp": 4680000, "level": 559, "coins": (725000, 1305000)},
        "resources": ['EssÃªncia do NÃ­vel 550', 'Fragmento Dimensional 5', 'Cristal do Ciclo 3', 'Runa Absoluta', 'PÃ³ Primordial AvanÃ§ado'],
        "dungeons": [
            {"name": "Masmorra ğŸŒŠ Oceano Primordial I", "level": 56, "boss": "GuardiÃ£o Interno 550"},
            {"name": "Masmorra ğŸŒŠ Oceano Primordial II", "level": 57, "boss": "GuardiÃ£o Sombrio 550"},
            {"name": "SantuÃ¡rio do NÃ­vel 550", "level": 58, "boss": "Senhor do SantuÃ¡rio 550"}
        ],
        "secret_dungeons": [
            {"name": "ğŸ” CÃ¢mara Secreta ğŸŒŠ Oceano Primordial", "level": 56, "boss": "GuardiÃ£o Oculto 550", "secret": True, "special_boss_drop": "Absoluto", "key_name": "ğŸ—ï¸ Chave de ğŸŒŠ Oceano Primordial"},
            {"name": "ğŸŒŒ Portal Dimensional 550", "level": 57, "boss": "Entidade Portal 550", "secret": True, "special_boss_drop": "Transcendente", "key_name": "ğŸ—ï¸ Chave Portal 550"}
        ],
        "events": [
            "VocÃª sente o peso do nÃ­vel 550 ao seu redor.", "A realidade aqui Ã© diferente de tudo que vocÃª conhecia.",
            "Criaturas de poder incompreensÃ­vel observam sua passagem.", "Cada passo aqui Ã© uma conquista sem precedentes.",
            "O ar vibra com energia Absoluto.", "VocÃª estÃ¡ entre os mais fortes jÃ¡ registrados neste plano.",
            "O horizonte aqui nÃ£o existe â€” sÃ³ poder infinito.", "Sua presenÃ§a aqui altera o tecido da realidade.",
            "Nenhum mortal comum sobreviveria neste lugar.", "VocÃª forjou seu prÃ³prio destino chegando atÃ© aqui.",
            "Os GuardiÃµes te testam constantemente.", "Cada batalha aqui redefine seus limites.",
        ],
        "exclusive_drops": {
            "weapons": ["Arma do Plano Absoluto 550", "LÃ¢mina Dimensional NÃ­vel 550"],
            "armor": ["Armadura Absoluto 550", "Vestes do Ciclo 5"]
        }
    },
    560: {
        "name": "ğŸ’¨ ğŸ’¨ Vento do Fim dos Tempos",
        "emoji": "ğŸ’¨",
        "xp_loss_multiplier": 18.5,
        "monsters": {
            "Entidades do Apocalipse Alpha": {"xp": (3600, 4800), "hp": 12000, "atk": 2500, "coins": (112, 186)},
            "Entidades do Apocalipse Supremo": {"xp": (3620, 4825), "hp": 12050, "atk": 2505, "coins": (114, 191)},
            "Elite Entidades do Apocalipse": {"xp": (3640, 4850), "hp": 12100, "atk": 2510, "coins": (116, 196)},
            "Entidades do Apocalipse AnciÃ£o": {"xp": (3660, 4875), "hp": 12150, "atk": 2515, "coins": (118, 201)},
            "Entidades do Apocalipse LendÃ¡rio": {"xp": (3680, 4900), "hp": 12200, "atk": 2520, "coins": (120, 206)},
        },
        "boss": {"name": "Entidade do Apocalipse", "hp": 19700000, "atk": 69300, "xp": 5180000, "level": 569, "coins": (797000, 1434600)},
        "resources": ['EssÃªncia do NÃ­vel 560', 'Fragmento Dimensional 5', 'Cristal do Ciclo 3', 'Runa Absoluta', 'PÃ³ Primordial AvanÃ§ado'],
        "dungeons": [
            {"name": "Masmorra ğŸ’¨ Vento do Fim dos Tempos I", "level": 57, "boss": "GuardiÃ£o Interno 560"},
            {"name": "Masmorra ğŸ’¨ Vento do Fim dos Tempos II", "level": 58, "boss": "GuardiÃ£o Sombrio 560"},
            {"name": "SantuÃ¡rio do NÃ­vel 560", "level": 59, "boss": "Senhor do SantuÃ¡rio 560"}
        ],
        "secret_dungeons": [
            {"name": "ğŸ” CÃ¢mara Secreta ğŸ’¨ Vento do Fim dos Tempos", "level": 57, "boss": "GuardiÃ£o Oculto 560", "secret": True, "special_boss_drop": "Absoluto", "key_name": "ğŸ—ï¸ Chave de ğŸ’¨ Vento do Fim dos Tempos"},
            {"name": "ğŸŒŒ Portal Dimensional 560", "level": 58, "boss": "Entidade Portal 560", "secret": True, "special_boss_drop": "Transcendente", "key_name": "ğŸ—ï¸ Chave Portal 560"}
        ],
        "events": [
            "VocÃª sente o peso do nÃ­vel 560 ao seu redor.", "A realidade aqui Ã© diferente de tudo que vocÃª conhecia.",
            "Criaturas de poder incompreensÃ­vel observam sua passagem.", "Cada passo aqui Ã© uma conquista sem precedentes.",
            "O ar vibra com energia Absoluto.", "VocÃª estÃ¡ entre os mais fortes jÃ¡ registrados neste plano.",
            "O horizonte aqui nÃ£o existe â€” sÃ³ poder infinito.", "Sua presenÃ§a aqui altera o tecido da realidade.",
            "Nenhum mortal comum sobreviveria neste lugar.", "VocÃª forjou seu prÃ³prio destino chegando atÃ© aqui.",
            "Os GuardiÃµes te testam constantemente.", "Cada batalha aqui redefine seus limites.",
        ],
        "exclusive_drops": {
            "weapons": ["Arma do Plano Absoluto 560", "LÃ¢mina Dimensional NÃ­vel 560"],
            "armor": ["Armadura Absoluto 560", "Vestes do Ciclo 5"]
        }
    },
    570: {
        "name": "âš¡ âš¡ TrovÃ£o da Origem",
        "emoji": "âš¡",
        "xp_loss_multiplier": 18.5,
        "monsters": {
            "Deuses do TrovÃ£o Primordial Alpha": {"xp": (3720, 4960), "hp": 12400, "atk": 2640, "coins": (114, 190)},
            "Deuses do TrovÃ£o Primordial Supremo": {"xp": (3740, 4985), "hp": 12450, "atk": 2645, "coins": (116, 195)},
            "Elite Deuses do TrovÃ£o Primordial": {"xp": (3760, 5010), "hp": 12500, "atk": 2650, "coins": (118, 200)},
            "Deuses do TrovÃ£o Primordial AnciÃ£o": {"xp": (3780, 5035), "hp": 12550, "atk": 2655, "coins": (120, 205)},
            "Deuses do TrovÃ£o Primordial LendÃ¡rio": {"xp": (3800, 5060), "hp": 12600, "atk": 2660, "coins": (122, 210)},
        },
        "boss": {"name": "Deus do TrovÃ£o Primordial", "hp": 22800000, "atk": 75300, "xp": 5730000, "level": 579, "coins": (876000, 1576800)},
        "resources": ['EssÃªncia do NÃ­vel 570', 'Fragmento Dimensional 5', 'Cristal do Ciclo 3', 'Runa Absoluta', 'PÃ³ Primordial AvanÃ§ado'],
        "dungeons": [
            {"name": "Masmorra âš¡ TrovÃ£o da Origem I", "level": 58, "boss": "GuardiÃ£o Interno 570"},
            {"name": "Masmorra âš¡ TrovÃ£o da Origem II", "level": 59, "boss": "GuardiÃ£o Sombrio 570"},
            {"name": "SantuÃ¡rio do NÃ­vel 570", "level": 60, "boss": "Senhor do SantuÃ¡rio 570"}
        ],
        "secret_dungeons": [
            {"name": "ğŸ” CÃ¢mara Secreta âš¡ TrovÃ£o da Origem", "level": 58, "boss": "GuardiÃ£o Oculto 570", "secret": True, "special_boss_drop": "Absoluto", "key_name": "ğŸ—ï¸ Chave de âš¡ TrovÃ£o da Origem"},
            {"name": "ğŸŒŒ Portal Dimensional 570", "level": 59, "boss": "Entidade Portal 570", "secret": True, "special_boss_drop": "Transcendente", "key_name": "ğŸ—ï¸ Chave Portal 570"}
        ],
        "events": [
            "VocÃª sente o peso do nÃ­vel 570 ao seu redor.", "A realidade aqui Ã© diferente de tudo que vocÃª conhecia.",
            "Criaturas de poder incompreensÃ­vel observam sua passagem.", "Cada passo aqui Ã© uma conquista sem precedentes.",
            "O ar vibra com energia Absoluto.", "VocÃª estÃ¡ entre os mais fortes jÃ¡ registrados neste plano.",
            "O horizonte aqui nÃ£o existe â€” sÃ³ poder infinito.", "Sua presenÃ§a aqui altera o tecido da realidade.",
            "Nenhum mortal comum sobreviveria neste lugar.", "VocÃª forjou seu prÃ³prio destino chegando atÃ© aqui.",
            "Os GuardiÃµes te testam constantemente.", "Cada batalha aqui redefine seus limites.",
        ],
        "exclusive_drops": {
            "weapons": ["Arma do Plano Absoluto 570", "LÃ¢mina Dimensional NÃ­vel 570"],
            "armor": ["Armadura Absoluto 570", "Vestes do Ciclo 5"]
        }
    },
    580: {
        "name": "ğŸŒŒ ğŸŒŒ Vazio AlÃ©m do Vazio",
        "emoji": "ğŸŒŒ",
        "xp_loss_multiplier": 19.0,
        "monsters": {
            "O Nada Consciente Alpha": {"xp": (3840, 5120), "hp": 12800, "atk": 2790, "coins": (116, 193)},
            "O Nada Consciente Supremo": {"xp": (3860, 5145), "hp": 12850, "atk": 2795, "coins": (118, 198)},
            "Elite O Nada Consciente": {"xp": (3880, 5170), "hp": 12900, "atk": 2800, "coins": (120, 203)},
            "O Nada Consciente AnciÃ£o": {"xp": (3900, 5195), "hp": 12950, "atk": 2805, "coins": (122, 208)},
            "O Nada Consciente LendÃ¡rio": {"xp": (3920, 5220), "hp": 13000, "atk": 2810, "coins": (124, 213)},
        },
        "boss": {"name": "O Nada Consciente", "hp": 26400000, "atk": 81800, "xp": 6340000, "level": 589, "coins": (963000, 1733400)},
        "resources": ['EssÃªncia do NÃ­vel 580', 'Fragmento Dimensional 5', 'Cristal do Ciclo 3', 'Runa Absoluta', 'PÃ³ Primordial AvanÃ§ado'],
        "dungeons": [
            {"name": "Masmorra ğŸŒŒ Vazio AlÃ©m do Vazio I", "level": 59, "boss": "GuardiÃ£o Interno 580"},
            {"name": "Masmorra ğŸŒŒ Vazio AlÃ©m do Vazio II", "level": 60, "boss": "GuardiÃ£o Sombrio 580"},
            {"name": "SantuÃ¡rio do NÃ­vel 580", "level": 61, "boss": "Senhor do SantuÃ¡rio 580"}
        ],
        "secret_dungeons": [
            {"name": "ğŸ” CÃ¢mara Secreta ğŸŒŒ Vazio AlÃ©m do Vazio", "level": 59, "boss": "GuardiÃ£o Oculto 580", "secret": True, "special_boss_drop": "Absoluto", "key_name": "ğŸ—ï¸ Chave de ğŸŒŒ Vazio AlÃ©m do Vazio"},
            {"name": "ğŸŒŒ Portal Dimensional 580", "level": 60, "boss": "Entidade Portal 580", "secret": True, "special_boss_drop": "Transcendente", "key_name": "ğŸ—ï¸ Chave Portal 580"}
        ],
        "events": [
            "VocÃª sente o peso do nÃ­vel 580 ao seu redor.", "A realidade aqui Ã© diferente de tudo que vocÃª conhecia.",
            "Criaturas de poder incompreensÃ­vel observam sua passagem.", "Cada passo aqui Ã© uma conquista sem precedentes.",
            "O ar vibra com energia Absoluto.", "VocÃª estÃ¡ entre os mais fortes jÃ¡ registrados neste plano.",
            "O horizonte aqui nÃ£o existe â€” sÃ³ poder infinito.", "Sua presenÃ§a aqui altera o tecido da realidade.",
            "Nenhum mortal comum sobreviveria neste lugar.", "VocÃª forjou seu prÃ³prio destino chegando atÃ© aqui.",
            "Os GuardiÃµes te testam constantemente.", "Cada batalha aqui redefine seus limites.",
        ],
        "exclusive_drops": {
            "weapons": ["Arma do Plano Absoluto 580", "LÃ¢mina Dimensional NÃ­vel 580"],
            "armor": ["Armadura Absoluto 580", "Vestes do Ciclo 5"]
        }
    },
    590: {
        "name": "â™¾ï¸ â™¾ï¸ O Plano Absoluto Final",
        "emoji": "â™¾ï¸",
        "xp_loss_multiplier": 19.0,
        "monsters": {
            "O Absoluto Alpha": {"xp": (3960, 5280), "hp": 13200, "atk": 2950, "coins": (118, 196)},
            "O Absoluto Supremo": {"xp": (3980, 5305), "hp": 13250, "atk": 2955, "coins": (120, 201)},
            "Elite O Absoluto": {"xp": (4000, 5330), "hp": 13300, "atk": 2960, "coins": (122, 206)},
            "O Absoluto AnciÃ£o": {"xp": (4020, 5355), "hp": 13350, "atk": 2965, "coins": (124, 211)},
            "O Absoluto LendÃ¡rio": {"xp": (4040, 5380), "hp": 13400, "atk": 2970, "coins": (126, 216)},
        },
        "boss": {"name": "O Absoluto Final", "hp": 30600000, "atk": 88800, "xp": 7010000, "level": 599, "coins": (1059000, 1906200)},
        "resources": ['EssÃªncia do NÃ­vel 590', 'Fragmento Dimensional 5', 'Cristal do Ciclo 3', 'Runa Absoluta', 'PÃ³ Primordial AvanÃ§ado'],
        "dungeons": [
            {"name": "Masmorra â™¾ï¸ O Plano Absoluto Final I", "level": 60, "boss": "GuardiÃ£o Interno 590"},
            {"name": "Masmorra â™¾ï¸ O Plano Absoluto Final II", "level": 61, "boss": "GuardiÃ£o Sombrio 590"},
            {"name": "SantuÃ¡rio do NÃ­vel 590", "level": 62, "boss": "Senhor do SantuÃ¡rio 590"}
        ],
        "secret_dungeons": [
            {"name": "ğŸ” CÃ¢mara Secreta â™¾ï¸ O Plano Absoluto Final", "level": 60, "boss": "GuardiÃ£o Oculto 590", "secret": True, "special_boss_drop": "Absoluto", "key_name": "ğŸ—ï¸ Chave de â™¾ï¸ O Plano Absoluto Final"},
            {"name": "ğŸŒŒ Portal Dimensional 590", "level": 61, "boss": "Entidade Portal 590", "secret": True, "special_boss_drop": "Transcendente", "key_name": "ğŸ—ï¸ Chave Portal 590"}
        ],
        "events": [
            "VocÃª sente o peso do nÃ­vel 590 ao seu redor.", "A realidade aqui Ã© diferente de tudo que vocÃª conhecia.",
            "Criaturas de poder incompreensÃ­vel observam sua passagem.", "Cada passo aqui Ã© uma conquista sem precedentes.",
            "O ar vibra com energia Absoluto.", "VocÃª estÃ¡ entre os mais fortes jÃ¡ registrados neste plano.",
            "O horizonte aqui nÃ£o existe â€” sÃ³ poder infinito.", "Sua presenÃ§a aqui altera o tecido da realidade.",
            "Nenhum mortal comum sobreviveria neste lugar.", "VocÃª forjou seu prÃ³prio destino chegando atÃ© aqui.",
            "Os GuardiÃµes te testam constantemente.", "Cada batalha aqui redefine seus limites.",
        ],
        "exclusive_drops": {
            "weapons": ["Arma do Plano Absoluto 590", "LÃ¢mina Dimensional NÃ­vel 590"],
            "armor": ["Armadura Absoluto 590", "Vestes do Ciclo 5"]
        }
    },
}

# ================= ITENS EXPANDIDOS (com Divino e Primordial) =================
ITEMS = {
    "weapons": [
        # Comum
        {"name": "Espada Enferrujada", "rarity": "Comum", "atk": 5},
        {"name": "Adaga de Pedra", "rarity": "Comum", "atk": 6},
        {"name": "Cajado de Madeira", "rarity": "Comum", "atk": 5},
        {"name": "Machado Quebrado", "rarity": "Comum", "atk": 6},
        {"name": "LanÃ§a de Bambu", "rarity": "Comum", "atk": 5},
        {"name": "Faca Cega", "rarity": "Comum", "atk": 4},
        {"name": "Porrete de Madeira", "rarity": "Comum", "atk": 5},
        {"name": "Foice Velha", "rarity": "Comum", "atk": 6},
        # Incomum
        {"name": "Espada de Ferro", "rarity": "Incomum", "atk": 12},
        {"name": "Machado de Batalha", "rarity": "Incomum", "atk": 14},
        {"name": "Arco Composto", "rarity": "Incomum", "atk": 13},
        {"name": "Martelo de Guerra", "rarity": "Incomum", "atk": 15},
        {"name": "Katana BÃ¡sica", "rarity": "Incomum", "atk": 13},
        {"name": "Mangual de Ferro", "rarity": "Incomum", "atk": 14},
        {"name": "Espada Larga", "rarity": "Incomum", "atk": 13},
        {"name": "LanÃ§a de Ferro", "rarity": "Incomum", "atk": 12},
        {"name": "Claymore", "rarity": "Incomum", "atk": 15},
        {"name": "Arco Longo", "rarity": "Incomum", "atk": 14},
        {"name": "Alabarda", "rarity": "Incomum", "atk": 14},
        {"name": "Machado Duplo", "rarity": "Incomum", "atk": 15},
        # Raro
        {"name": "Espada de Madeira Negra", "rarity": "Raro", "atk": 25},
        {"name": "LanÃ§a MÃ­stica", "rarity": "Raro", "atk": 27},
        {"name": "Arco Ã‰lfico", "rarity": "Raro", "atk": 26},
        {"name": "Machado RÃºnico", "rarity": "Raro", "atk": 28},
        {"name": "Cimitarra de Prata", "rarity": "Raro", "atk": 26},
        {"name": "Alabarda Encantada", "rarity": "Raro", "atk": 27},
        {"name": "Tridente de AÃ§o", "rarity": "Raro", "atk": 25},
        {"name": "Katana RelÃ¢mpago", "rarity": "Raro", "atk": 28},
        {"name": "Arco das Sombras", "rarity": "Raro", "atk": 27},
        {"name": "Espada Lunar", "rarity": "Raro", "atk": 26},
        {"name": "Martelo RÃºnico", "rarity": "Raro", "atk": 28},
        {"name": "LanÃ§a do CaÃ§ador", "rarity": "Raro", "atk": 27},
        {"name": "Foice Maldita", "rarity": "Raro", "atk": 26},
        {"name": "Adaga Venenosa", "rarity": "Raro", "atk": 25},
        {"name": "Clava TitÃ¢nica", "rarity": "Raro", "atk": 28},
        # Ã‰pico
        {"name": "LÃ¢mina Flamejante", "rarity": "Ã‰pico", "atk": 45},
        {"name": "Cajado Arcano", "rarity": "Ã‰pico", "atk": 48},
        {"name": "Espada do Vento", "rarity": "Ã‰pico", "atk": 46},
        {"name": "Machado TitÃ¢nico", "rarity": "Ã‰pico", "atk": 50},
        {"name": "Arco das Estrelas", "rarity": "Ã‰pico", "atk": 47},
        {"name": "LanÃ§a do DragÃ£o", "rarity": "Ã‰pico", "atk": 49},
        {"name": "Foice Sombria", "rarity": "Ã‰pico", "atk": 48},
        {"name": "Martelo do TrovÃ£o", "rarity": "Ã‰pico", "atk": 51},
        {"name": "Katana DemonÃ­aca", "rarity": "Ã‰pico", "atk": 49},
        {"name": "Espada da Tempestade", "rarity": "Ã‰pico", "atk": 47},
        {"name": "Arco Celestial", "rarity": "Ã‰pico", "atk": 48},
        {"name": "Tridente de Poseidon", "rarity": "Ã‰pico", "atk": 50},
        {"name": "LanÃ§a da FÃªnix", "rarity": "Ã‰pico", "atk": 49},
        {"name": "Machado Infernal", "rarity": "Ã‰pico", "atk": 51},
        {"name": "Adaga da Morte", "rarity": "Ã‰pico", "atk": 46},
        {"name": "Espada do Eclipse", "rarity": "Ã‰pico", "atk": 48},
        {"name": "Cajado do Caos", "rarity": "Ã‰pico", "atk": 50},
        # LendÃ¡rio
        {"name": "Excalibur", "rarity": "LendÃ¡rio", "atk": 100},
        {"name": "Mjolnir", "rarity": "LendÃ¡rio", "atk": 105},
        {"name": "Gungnir", "rarity": "LendÃ¡rio", "atk": 103},
        {"name": "Kusanagi", "rarity": "LendÃ¡rio", "atk": 102},
        {"name": "Durandal", "rarity": "LendÃ¡rio", "atk": 104},
        {"name": "Gram", "rarity": "LendÃ¡rio", "atk": 103},
        {"name": "Tyrfing", "rarity": "LendÃ¡rio", "atk": 102},
        {"name": "Caladbolg", "rarity": "LendÃ¡rio", "atk": 104},
        {"name": "GÃ¡e Bolg", "rarity": "LendÃ¡rio", "atk": 105},
        {"name": "Rhongomyniad", "rarity": "LendÃ¡rio", "atk": 103},
        # MÃ­tico
        {"name": "Espada do Criador", "rarity": "MÃ­tico", "atk": 200},
        {"name": "Cetro da Eternidade", "rarity": "MÃ­tico", "atk": 210},
        {"name": "LÃ¢mina do Destino", "rarity": "MÃ­tico", "atk": 205},
        {"name": "Arco do Apocalipse", "rarity": "MÃ­tico", "atk": 208},
        # Ancestral
        {"name": "Espada dos Antepassados", "rarity": "Ancestral", "atk": 280},
        {"name": "Cajado do Primeiro Mago", "rarity": "Ancestral", "atk": 295},
        {"name": "LanÃ§a da Era Perdida", "rarity": "Ancestral", "atk": 285},
        {"name": "Arco dos Antigos CaÃ§adores", "rarity": "Ancestral", "atk": 290},
        {"name": "Machado da RaÃ§a Extinta", "rarity": "Ancestral", "atk": 288},
        # Divino (NOVO)
        {"name": "Espada da AscensÃ£o", "rarity": "Divino", "atk": 380},
        {"name": "Cajado da CriaÃ§Ã£o Divina", "rarity": "Divino", "atk": 400},
        {"name": "LanÃ§a do JuÃ­zo Final", "rarity": "Divino", "atk": 390},
        {"name": "Arco da ExtinÃ§Ã£o", "rarity": "Divino", "atk": 395},
        {"name": "Foice do Ceifador Divino", "rarity": "Divino", "atk": 385},
        # Primordial (NOVO)
        {"name": "Fragmento da Primeira Arma", "rarity": "Primordial", "atk": 750},
        {"name": "Vontade Feita LÃ¢mina", "rarity": "Primordial", "atk": 800},
        {"name": "O ComeÃ§o e o Fim", "rarity": "Primordial", "atk": 780},
        {"name": "Peso da ExistÃªncia", "rarity": "Primordial", "atk": 760}
    ],
    "armor": [
        # Comum
        {"name": "Armadura de Couro", "rarity": "Comum", "def": 3},
        {"name": "Robes Simples", "rarity": "Comum", "def": 4},
        {"name": "TÃºnica de Linho", "rarity": "Comum", "def": 3},
        {"name": "Peitoral de Bronze", "rarity": "Comum", "def": 4},
        {"name": "Capa Rasgada", "rarity": "Comum", "def": 3},
        {"name": "Colete de Couro", "rarity": "Comum", "def": 4},
        {"name": "Vestes Gastas", "rarity": "Comum", "def": 3},
        {"name": "Armadura Rachada", "rarity": "Comum", "def": 4},
        # Incomum
        {"name": "Armadura de Ferro", "rarity": "Incomum", "def": 8},
        {"name": "Cota de Malha", "rarity": "Incomum", "def": 10},
        {"name": "Armadura de Escamas", "rarity": "Incomum", "def": 9},
        {"name": "Robes ReforÃ§ados", "rarity": "Incomum", "def": 8},
        {"name": "Brigandina", "rarity": "Incomum", "def": 10},
        {"name": "Armadura de Couro Batido", "rarity": "Incomum", "def": 9},
        {"name": "Peitoral de AÃ§o", "rarity": "Incomum", "def": 10},
        {"name": "Armadura de AnÃ©is", "rarity": "Incomum", "def": 9},
        {"name": "Vestes de Batalha", "rarity": "Incomum", "def": 8},
        {"name": "CouraÃ§a Leve", "rarity": "Incomum", "def": 9},
        {"name": "Armadura Laminada", "rarity": "Incomum", "def": 10},
        {"name": "GibÃ£o de Armas", "rarity": "Incomum", "def": 9},
        # Raro
        {"name": "Armadura MÃ­stica", "rarity": "Raro", "def": 18},
        {"name": "Armadura Ã‰lfica", "rarity": "Raro", "def": 20},
        {"name": "Placas de AÃ§o", "rarity": "Raro", "def": 19},
        {"name": "Armadura RÃºnica", "rarity": "Raro", "def": 21},
        {"name": "Cota Encantada", "rarity": "Raro", "def": 19},
        {"name": "Armadura de Mithril", "rarity": "Raro", "def": 20},
        {"name": "Vestes Arcanas", "rarity": "Raro", "def": 18},
        {"name": "Armadura Lunar", "rarity": "Raro", "def": 20},
        {"name": "Placas ReforÃ§adas", "rarity": "Raro", "def": 21},
        {"name": "Armadura Cristalina", "rarity": "Raro", "def": 19},
        {"name": "Vestes do SÃ¡bio", "rarity": "Raro", "def": 18},
        {"name": "Armadura do Cavaleiro", "rarity": "Raro", "def": 21},
        {"name": "CouraÃ§a Ã‰lfica", "rarity": "Raro", "def": 20},
        {"name": "Armadura Sombria", "rarity": "Raro", "def": 19},
        {"name": "Placas de DragÃ£o", "rarity": "Raro", "def": 21},
        # Ã‰pico
        {"name": "Armadura DracÃ´nica", "rarity": "Ã‰pico", "def": 35},
        {"name": "Armadura das Sombras", "rarity": "Ã‰pico", "def": 38},
        {"name": "Placas do TitÃ£", "rarity": "Ã‰pico", "def": 37},
        {"name": "Armadura Flamejante", "rarity": "Ã‰pico", "def": 36},
        {"name": "Vestes Estelares", "rarity": "Ã‰pico", "def": 35},
        {"name": "Armadura do Vazio", "rarity": "Ã‰pico", "def": 39},
        {"name": "CouraÃ§a Angelical", "rarity": "Ã‰pico", "def": 38},
        {"name": "Armadura DemonÃ­aca", "rarity": "Ã‰pico", "def": 40},
        {"name": "Placas do DragÃ£o Negro", "rarity": "Ã‰pico", "def": 39},
        {"name": "Armadura da Tempestade", "rarity": "Ã‰pico", "def": 37},
        {"name": "Vestes do Arcano Maior", "rarity": "Ã‰pico", "def": 36},
        {"name": "Armadura de Obsidiana", "rarity": "Ã‰pico", "def": 38},
        {"name": "Placas Celestiais", "rarity": "Ã‰pico", "def": 40},
        {"name": "Armadura do FÃªnix", "rarity": "Ã‰pico", "def": 37},
        {"name": "CouraÃ§a Infernal", "rarity": "Ã‰pico", "def": 39},
        {"name": "Armadura do Eclipse", "rarity": "Ã‰pico", "def": 38},
        {"name": "Vestes do Caos", "rarity": "Ã‰pico", "def": 36},
        # LendÃ¡rio
        {"name": "Armadura Celestial", "rarity": "LendÃ¡rio", "def": 80},
        {"name": "Ã‰gide Divina", "rarity": "LendÃ¡rio", "def": 85},
        {"name": "Armadura de Odin", "rarity": "LendÃ¡rio", "def": 83},
        {"name": "Placas de Adaman", "rarity": "LendÃ¡rio", "def": 82},
        {"name": "Vestes do Arcano Supremo", "rarity": "LendÃ¡rio", "def": 84},
        {"name": "Armadura de Zeus", "rarity": "LendÃ¡rio", "def": 85},
        {"name": "Placas de Poseidon", "rarity": "LendÃ¡rio", "def": 83},
        {"name": "Armadura de Ares", "rarity": "LendÃ¡rio", "def": 84},
        {"name": "Vestes de Atena", "rarity": "LendÃ¡rio", "def": 82},
        {"name": "CouraÃ§a de Thor", "rarity": "LendÃ¡rio", "def": 85},
        # MÃ­tico
        {"name": "Armadura do Primeiro Deus", "rarity": "MÃ­tico", "def": 180},
        {"name": "Vestes da CriaÃ§Ã£o", "rarity": "MÃ­tico", "def": 190},
        {"name": "Placas da Eternidade", "rarity": "MÃ­tico", "def": 185},
        {"name": "Armadura do Destino", "rarity": "MÃ­tico", "def": 188},
        # Ancestral
        {"name": "Armadura dos GuardiÃµes Ancestrais", "rarity": "Ancestral", "def": 260},
        {"name": "Vestes do Elo Perdido", "rarity": "Ancestral", "def": 275},
        {"name": "Placas da CivilizaÃ§Ã£o Extinta", "rarity": "Ancestral", "def": 268},
        {"name": "Manto do Tempo Esquecido", "rarity": "Ancestral", "def": 272},
        # Divino (NOVO)
        {"name": "Manto da AscensÃ£o", "rarity": "Divino", "def": 350},
        {"name": "Armadura do Serafim", "rarity": "Divino", "def": 370},
        {"name": "Vestes do Julgamento", "rarity": "Divino", "def": 360},
        {"name": "Placas do Arcanjo Supremo", "rarity": "Divino", "def": 365},
        # Primordial (NOVO)
        {"name": "Pele da Primeira Criatura", "rarity": "Primordial", "def": 700},
        {"name": "Armadura do Antes do ComeÃ§o", "rarity": "Primordial", "def": 750},
        {"name": "Vestes do SilÃªncio Eterno", "rarity": "Primordial", "def": 720},
        {"name": "ProteÃ§Ã£o do Vazio Consciente", "rarity": "Primordial", "def": 730}
    ]
}

# ================= NOVOS EQUIPAMENTOS (EXPANSÃƒO â€” DOBRO) =================
ITEMS_EXTRA = {
    "weapons": [
        # Comum
        {"name": "Faca Lascada",          "rarity": "Comum",    "atk": 4},
        {"name": "Vara de Madeira",        "rarity": "Comum",    "atk": 5},
        {"name": "Pedra Afiada",           "rarity": "Comum",    "atk": 4},
        {"name": "Osso Endurecido",        "rarity": "Comum",    "atk": 5},
        {"name": "Garfo de Ferro Velho",   "rarity": "Comum",    "atk": 4},
        {"name": "BordÃ£o Rachado",         "rarity": "Comum",    "atk": 5},
        {"name": "Espeto de CaÃ§ador",      "rarity": "Comum",    "atk": 6},
        {"name": "Clava de Pedra",         "rarity": "Comum",    "atk": 5},
        # Incomum
        {"name": "Espada de Cobre",        "rarity": "Incomum",  "atk": 12},
        {"name": "Arco Curto Ã‰lfico",      "rarity": "Incomum",  "atk": 13},
        {"name": "LanÃ§a de Bronze",        "rarity": "Incomum",  "atk": 12},
        {"name": "BastÃ£o de Ferro",        "rarity": "Incomum",  "atk": 14},
        {"name": "Adaga de Ferro Dupla",   "rarity": "Incomum",  "atk": 13},
        {"name": "Machado Leve",           "rarity": "Incomum",  "atk": 13},
        {"name": "Florete de AÃ§o",         "rarity": "Incomum",  "atk": 14},
        {"name": "Estrela de Arremesso",   "rarity": "Incomum",  "atk": 13},
        {"name": "Espada Curta de Ferro",  "rarity": "Incomum",  "atk": 12},
        {"name": "BastÃ£o de Batalha",      "rarity": "Incomum",  "atk": 14},
        {"name": "Kunai de Ferro",         "rarity": "Incomum",  "atk": 13},
        {"name": "MaÃ§a de Ferro",          "rarity": "Incomum",  "atk": 14},
        # Raro
        {"name": "Katana de Vento",        "rarity": "Raro",     "atk": 26},
        {"name": "Arco de Osso de DragÃ£o", "rarity": "Raro",     "atk": 27},
        {"name": "Espada das MarÃ©s",       "rarity": "Raro",     "atk": 25},
        {"name": "LanÃ§a do Trovejante",    "rarity": "Raro",     "atk": 28},
        {"name": "Machado das Trevas",     "rarity": "Raro",     "atk": 26},
        {"name": "Florete da NÃ©voa",       "rarity": "Raro",     "atk": 27},
        {"name": "Cajado das RaÃ­zes",      "rarity": "Raro",     "atk": 25},
        {"name": "Alabarda do CaÃ§ador",    "rarity": "Raro",     "atk": 28},
        {"name": "Espada de Cristal",      "rarity": "Raro",     "atk": 26},
        {"name": "Tridente Sombrio",       "rarity": "Raro",     "atk": 27},
        {"name": "Adaga do Espectro",      "rarity": "Raro",     "atk": 25},
        {"name": "Mangual RÃºnico",         "rarity": "Raro",     "atk": 28},
        {"name": "LanÃ§a de Coral",         "rarity": "Raro",     "atk": 26},
        {"name": "Cimitarra Lunar",        "rarity": "Raro",     "atk": 27},
        {"name": "Machado da Lua",         "rarity": "Raro",     "atk": 26},
        # Ã‰pico
        {"name": "Espada do Caos Menor",   "rarity": "Ã‰pico",    "atk": 46},
        {"name": "LanÃ§a do DilÃºvio",       "rarity": "Ã‰pico",    "atk": 48},
        {"name": "Arco do CrepÃºsculo",     "rarity": "Ã‰pico",    "atk": 47},
        {"name": "Machado do Abismo",      "rarity": "Ã‰pico",    "atk": 50},
        {"name": "Cajado da Tempestade",   "rarity": "Ã‰pico",    "atk": 49},
        {"name": "Foice do Pesadelo",      "rarity": "Ã‰pico",    "atk": 48},
        {"name": "Florete do Vazio",       "rarity": "Ã‰pico",    "atk": 46},
        {"name": "Tridente Celestial",     "rarity": "Ã‰pico",    "atk": 49},
        {"name": "Espada da Aurora",       "rarity": "Ã‰pico",    "atk": 47},
        {"name": "Alabarda DemonÃ­aca",     "rarity": "Ã‰pico",    "atk": 50},
        {"name": "Katana das Estrelas",    "rarity": "Ã‰pico",    "atk": 48},
        {"name": "LanÃ§a do DragÃ£o Negro",  "rarity": "Ã‰pico",    "atk": 51},
        {"name": "Arco do Destino",        "rarity": "Ã‰pico",    "atk": 47},
        {"name": "Machado do TitÃ£ Sombrio","rarity": "Ã‰pico",    "atk": 50},
        {"name": "Cajado do Necromante",   "rarity": "Ã‰pico",    "atk": 49},
        {"name": "Adaga GÃªmea das Sombras","rarity": "Ã‰pico",    "atk": 48},
        {"name": "Espada do CrepÃºsculo",   "rarity": "Ã‰pico",    "atk": 46},
        # LendÃ¡rio
        {"name": "Fragarach",              "rarity": "LendÃ¡rio", "atk": 101},
        {"name": "Hauteclaire",            "rarity": "LendÃ¡rio", "atk": 103},
        {"name": "Joyeuse",                "rarity": "LendÃ¡rio", "atk": 102},
        {"name": "Skofnung",               "rarity": "LendÃ¡rio", "atk": 104},
        {"name": "Curtana",                "rarity": "LendÃ¡rio", "atk": 101},
        {"name": "Claiomh Solais",         "rarity": "LendÃ¡rio", "atk": 105},
        {"name": "Harpe",                  "rarity": "LendÃ¡rio", "atk": 102},
        {"name": "Shamshir-e Zomorrodnegar","rarity":"LendÃ¡rio", "atk": 103},
        {"name": "DÃ¡insleif",              "rarity": "LendÃ¡rio", "atk": 104},
        {"name": "Chandrahas",             "rarity": "LendÃ¡rio", "atk": 102},
        # MÃ­tico
        {"name": "LÃ¢mina do Caos Absoluto","rarity": "MÃ­tico",   "atk": 205},
        {"name": "Foice da Eternidade",    "rarity": "MÃ­tico",   "atk": 215},
        {"name": "Espada do JuÃ­zo",        "rarity": "MÃ­tico",   "atk": 208},
        {"name": "Martelo dos Deuses",     "rarity": "MÃ­tico",   "atk": 212},
        # Ancestral
        {"name": "LanÃ§a da Aurora Primeva","rarity": "Ancestral","atk": 285},
        {"name": "Espada do Primeiro Rei", "rarity": "Ancestral","atk": 292},
        {"name": "Cajado do Cosmos Antigo","rarity": "Ancestral","atk": 288},
        {"name": "Arco dos Profetas Extintos","rarity":"Ancestral","atk":291},
        {"name": "Machado do TitÃ£ Primordial","rarity":"Ancestral","atk":286},
        # Divino
        {"name": "LanÃ§a da RedenÃ§Ã£o Divina","rarity": "Divino",  "atk": 388},
        {"name": "Espada do Sol Negro",    "rarity": "Divino",   "atk": 395},
        {"name": "Cajado da AniquilaÃ§Ã£o",  "rarity": "Divino",   "atk": 392},
        {"name": "Foice do Arcanjo CaÃ­do", "rarity": "Divino",   "atk": 385},
        {"name": "Tridente do Poseidon Divino","rarity":"Divino","atk": 398},
        # Primordial
        {"name": "SilÃªncio Feito Arma",    "rarity": "Primordial","atk": 755},
        {"name": "A Ãšltima Vontade",       "rarity": "Primordial","atk": 810},
        {"name": "Ecos do NÃ£o-Ser",        "rarity": "Primordial","atk": 775},
        {"name": "Raiz da CriaÃ§Ã£o",        "rarity": "Primordial","atk": 790},
    ],
    "armor": [
        # Comum
        {"name": "Tapa de Couro",          "rarity": "Comum",    "def": 3},
        {"name": "Vestes de Palha",        "rarity": "Comum",    "def": 4},
        {"name": "Escudo de Madeira Leve", "rarity": "Comum",    "def": 3},
        {"name": "Manto Rasgado",          "rarity": "Comum",    "def": 4},
        {"name": "Colete de Osso",         "rarity": "Comum",    "def": 3},
        {"name": "Vestes do AldeÃ£o",       "rarity": "Comum",    "def": 4},
        {"name": "Peitoral de Madeira",    "rarity": "Comum",    "def": 3},
        {"name": "GibÃ£o Velho",            "rarity": "Comum",    "def": 4},
        # Incomum
        {"name": "Armadura de Bronze",     "rarity": "Incomum",  "def": 8},
        {"name": "Vestes de Couro Duplo",  "rarity": "Incomum",  "def": 9},
        {"name": "Peitoral de Madeira ReforÃ§ada","rarity":"Incomum","def":8},
        {"name": "Armadura de Escamas de Peixe","rarity":"Incomum","def":9},
        {"name": "Capa Encantada",         "rarity": "Incomum",  "def": 10},
        {"name": "Vestes do Monge",        "rarity": "Incomum",  "def": 9},
        {"name": "Armadura de Placas Leve","rarity": "Incomum",  "def": 10},
        {"name": "Manto de Viagem",        "rarity": "Incomum",  "def": 8},
        {"name": "Colete ReforÃ§ado",       "rarity": "Incomum",  "def": 9},
        {"name": "Armadura de Tiras",      "rarity": "Incomum",  "def": 10},
        {"name": "Casaco de Ferro",        "rarity": "Incomum",  "def": 9},
        {"name": "Vestes de Batalha Leve", "rarity": "Incomum",  "def": 8},
        # Raro
        {"name": "Armadura de Mithril Leve","rarity":"Raro",     "def": 19},
        {"name": "Placas do Druida",       "rarity": "Raro",     "def": 20},
        {"name": "Vestes do Necromante",   "rarity": "Raro",     "def": 18},
        {"name": "CouraÃ§a das Florestas",  "rarity": "Raro",     "def": 21},
        {"name": "Armadura do MercenÃ¡rio", "rarity": "Raro",     "def": 19},
        {"name": "Manto das Estrelas",     "rarity": "Raro",     "def": 20},
        {"name": "Vestes do Paladino",     "rarity": "Raro",     "def": 18},
        {"name": "Armadura VulcÃ¢nica",     "rarity": "Raro",     "def": 21},
        {"name": "Peitoral do Cavaleiro Negro","rarity":"Raro",  "def": 20},
        {"name": "Cota de Malha RÃºnica",   "rarity": "Raro",     "def": 21},
        {"name": "Vestes do Arauto",       "rarity": "Raro",     "def": 19},
        {"name": "Armadura das MarÃ©s",     "rarity": "Raro",     "def": 20},
        {"name": "Placas do Druida Solar", "rarity": "Raro",     "def": 21},
        {"name": "Manto das RuÃ­nas",       "rarity": "Raro",     "def": 19},
        {"name": "Armadura do CaÃ§ador",    "rarity": "Raro",     "def": 20},
        # Ã‰pico
        {"name": "Armadura do PÃ¢ntano",    "rarity": "Ã‰pico",    "def": 36},
        {"name": "Vestes do Arcanista",    "rarity": "Ã‰pico",    "def": 38},
        {"name": "Placas do Leviathan",    "rarity": "Ã‰pico",    "def": 37},
        {"name": "Armadura do TrovÃ£o",     "rarity": "Ã‰pico",    "def": 39},
        {"name": "Manto da Penumbra",      "rarity": "Ã‰pico",    "def": 35},
        {"name": "CouraÃ§a de Obsidiana Polida","rarity":"Ã‰pico", "def": 38},
        {"name": "Armadura das Profundezas","rarity":"Ã‰pico",    "def": 40},
        {"name": "Vestes do Vazio Menor",  "rarity": "Ã‰pico",    "def": 36},
        {"name": "Placas do Guerreiro Eterno","rarity":"Ã‰pico",  "def": 39},
        {"name": "Armadura do Berserker",  "rarity": "Ã‰pico",    "def": 37},
        {"name": "Manto da AscensÃ£o Menor","rarity": "Ã‰pico",    "def": 38},
        {"name": "CouraÃ§a de DragÃ£o Menor","rarity": "Ã‰pico",    "def": 40},
        {"name": "Armadura do Espectro",   "rarity": "Ã‰pico",    "def": 36},
        {"name": "Placas do Caos",         "rarity": "Ã‰pico",    "def": 37},
        {"name": "Vestes do Feiticeiro",   "rarity": "Ã‰pico",    "def": 35},
        {"name": "Armadura do Inquisidor", "rarity": "Ã‰pico",    "def": 39},
        # LendÃ¡rio
        {"name": "Armadura de Odim",       "rarity": "LendÃ¡rio", "def": 83},
        {"name": "Vestes de HÃ©cate",       "rarity": "LendÃ¡rio", "def": 84},
        {"name": "Placas do GuardiÃ£o Eterno","rarity":"LendÃ¡rio","def": 85},
        {"name": "Ã‰gide do HerÃ³i LendÃ¡rio","rarity": "LendÃ¡rio", "def": 82},
        {"name": "Armadura do Semideus",   "rarity": "LendÃ¡rio", "def": 84},
        {"name": "Vestes do DragÃ£o Sagrado","rarity":"LendÃ¡rio", "def": 85},
        {"name": "CouraÃ§a do Arcanjo",     "rarity": "LendÃ¡rio", "def": 83},
        {"name": "Armadura da Eternidade", "rarity": "LendÃ¡rio", "def": 84},
        {"name": "Placas do CaÃ§ador Divino","rarity":"LendÃ¡rio", "def": 82},
        {"name": "Manto do Profeta",       "rarity": "LendÃ¡rio", "def": 85},
        # MÃ­tico
        {"name": "Armadura do Ser Primevo","rarity": "MÃ­tico",   "def": 185},
        {"name": "Vestes do Cosmos",       "rarity": "MÃ­tico",   "def": 192},
        {"name": "Placas do Abismo Final", "rarity": "MÃ­tico",   "def": 188},
        {"name": "CouraÃ§a da CriaÃ§Ã£o",     "rarity": "MÃ­tico",   "def": 191},
        # Ancestral
        {"name": "Vestes do Tempo Esquecido","rarity":"Ancestral","def":270},
        {"name": "Armadura dos Primeiros HerÃ³is","rarity":"Ancestral","def":278},
        {"name": "Placas da Era das Lendas","rarity":"Ancestral","def":265},
        {"name": "Manto do Arauto Perdido","rarity": "Ancestral","def": 273},
        {"name": "CouraÃ§a dos Antepassados","rarity":"Ancestral","def":268},
        # Divino
        {"name": "Armadura do Serafim CaÃ­do","rarity":"Divino",  "def": 355},
        {"name": "Vestes do Julgamento Final","rarity":"Divino", "def": 368},
        {"name": "Placas da Divindade Menor","rarity":"Divino",  "def": 362},
        {"name": "Manto da CriaÃ§Ã£o Divina","rarity": "Divino",   "def": 358},
        {"name": "CouraÃ§a do Arcanjo Supremo","rarity":"Divino", "def": 372},
        # Primordial
        {"name": "EssÃªncia do Antes do Tempo","rarity":"Primordial","def":710},
        {"name": "Armadura do Ãšltimo Deus","rarity": "Primordial","def":755},
        {"name": "Manto do Vazio Absoluto","rarity": "Primordial","def":730},
        {"name": "Vestes da NÃ£o-ExistÃªncia","rarity":"Primordial","def":740},
    ]
}

# Mescla ITEMS_EXTRA no ITEMS para que todo o sistema use automaticamente
ITEMS["weapons"].extend(ITEMS_EXTRA["weapons"])
ITEMS["armor"].extend(ITEMS_EXTRA["armor"])

# Registra conteÃºdo dos novos reinos (chamado aqui pois ITEMS jÃ¡ estÃ¡ definido)
register_new_world_content()

STRUCTURES = [
    {
        "name": "ğŸ›ï¸ Cidade Mercante",
        "description": "Uma cidade movimentada onde comerciantes de todos os reinos se reÃºnem.",
        "narrator": "As ruas estÃ£o repletas de mercadores gritando seus produtos...",
        "worlds": [1, 10, 20, 30]
    },
    {
        "name": "â›ª Templo Abandonado",
        "description": "Um templo antigo que guarda segredos esquecidos.",
        "narrator": "O ar aqui Ã© pesado... Algo sagrado jÃ¡ habitou este lugar.",
        "worlds": [10, 20, 30, 40]
    },
    {
        "name": "ğŸ° Fortaleza em RuÃ­nas",
        "description": "Restos de uma fortaleza que jÃ¡ foi gloriosa.",
        "narrator": "Ecos de batalhas antigas ainda reverberam entre as pedras...",
        "worlds": [20, 30, 40, 50]
    },
    {
        "name": "ğŸŒ‰ Ponte MÃ­stica",
        "description": "Uma ponte que conecta dimensÃµes.",
        "narrator": "VocÃª sente a realidade se distorcendo ao cruzar...",
        "worlds": [40, 50, 60]
    },
    {
        "name": "ğŸ—¿ Monumento dos HerÃ³is",
        "description": "EstÃ¡tuas de herÃ³is lendÃ¡rios do passado.",
        "narrator": "Seus feitos estÃ£o gravados em pedra eterna...",
        "worlds": [30, 40, 50, 60]
    }
]

# ================= FALAS DO NARRADOR =================
NARRATOR_WARNINGS = [
    "Logo ele enfrentarÃ¡ seu maior pesadelo...",
    "O destino estÃ¡ prestes a testar sua verdadeira forÃ§a...",
    "Algo terrÃ­vel se aproxima nas sombras...",
    "Os dados do destino estÃ£o prestes a rolar...",
    "Uma presenÃ§a maligna observa cada passo seu...",
    "A morte espreita alÃ©m do prÃ³ximo horizonte...",
    "Seu nome serÃ¡ lembrado... ou esquecido para sempre.",
    "As estrelas tremem com o que estÃ¡ por vir...",
    "Nem todos os herÃ³is sobrevivem Ã s suas jornadas...",
    "O fim de uma era se aproxima..."
]

# ================= SISTEMA DE SORTE =================
LUCK_SYSTEM = {
    1: {"emoji": "ğŸ’€", "name": "Azar extremo"},
    2: {"emoji": "â˜ ï¸", "name": "Muito azar"},
    3: {"emoji": "ğŸ˜µ", "name": "Azar"},
    4: {"emoji": "ğŸ˜", "name": "Ruim"},
    5: {"emoji": "ğŸ˜¶", "name": "Neutro"},
    6: {"emoji": "ğŸ™‚", "name": "Bom"},
    7: {"emoji": "ğŸ˜„", "name": "Sorte"},
    8: {"emoji": "ğŸ€", "name": "Muita sorte"},
    9: {"emoji": "âœ¨", "name": "Sorte extrema"},
    10: {"emoji": "ğŸŒŸ", "name": "Lenda"}
}

# ================= BANCO DE DADOS =================

def init_db():
    conn = sqlite3.connect(DB_FILE)
    c = conn.cursor()

    c.execute('''CREATE TABLE IF NOT EXISTS players (
        user_id TEXT PRIMARY KEY,
        level INTEGER DEFAULT 1,
        xp INTEGER DEFAULT 0,
        hp INTEGER DEFAULT 100,
        max_hp INTEGER DEFAULT 100,
        coins INTEGER DEFAULT 0,
        inventory TEXT DEFAULT '[]',
        weapon TEXT DEFAULT NULL,
        armor TEXT DEFAULT NULL,
        worlds TEXT DEFAULT '[1]',
        bosses TEXT DEFAULT '[]',
        class TEXT DEFAULT NULL,
        pet TEXT DEFAULT NULL,
        guild_id INTEGER DEFAULT NULL,
        active_effects TEXT DEFAULT '{}',
        active_quest TEXT DEFAULT NULL,
        completed_quests TEXT DEFAULT '[]',
        mana INTEGER DEFAULT 50,
        max_mana INTEGER DEFAULT 50,
        pvp_battles TEXT DEFAULT '{}',
        alignment_points INTEGER DEFAULT 0,
        pet_farm TEXT DEFAULT '[]',
        discovered_map TEXT DEFAULT '{}'
    )''')

    # MigraÃ§Ã£o segura de colunas novas
    for col_def in [
        "ALTER TABLE players ADD COLUMN mana INTEGER DEFAULT 50",
        "ALTER TABLE players ADD COLUMN max_mana INTEGER DEFAULT 50",
        "ALTER TABLE players ADD COLUMN pvp_battles TEXT DEFAULT '{}'",
        "ALTER TABLE players ADD COLUMN alignment_points INTEGER DEFAULT 0",
        "ALTER TABLE players ADD COLUMN pet_farm TEXT DEFAULT '[]'",
        "ALTER TABLE players ADD COLUMN mana_category TEXT DEFAULT 'none'",
        "ALTER TABLE players ADD COLUMN spell_book_unlocked INTEGER DEFAULT 0",
        "ALTER TABLE players ADD COLUMN afk_farming INTEGER DEFAULT 0",
        "ALTER TABLE players ADD COLUMN afk_start INTEGER DEFAULT 0",
        "ALTER TABLE players ADD COLUMN kingdom_data TEXT DEFAULT 'null'",
        "ALTER TABLE players ADD COLUMN pets_list TEXT DEFAULT '[]'",
        "ALTER TABLE players ADD COLUMN discovered_map TEXT DEFAULT '{}'",
        "ALTER TABLE players ADD COLUMN job TEXT DEFAULT NULL",
        "ALTER TABLE players ADD COLUMN job_since INTEGER DEFAULT 0",
        "ALTER TABLE players ADD COLUMN city_title TEXT DEFAULT NULL",
        "ALTER TABLE players ADD COLUMN knights TEXT DEFAULT '[]'",
        "ALTER TABLE players ADD COLUMN last_work INTEGER DEFAULT 0",
        "ALTER TABLE players ADD COLUMN last_defend INTEGER DEFAULT 0",
        "ALTER TABLE players ADD COLUMN achievements TEXT DEFAULT '[]'",
        "ALTER TABLE players ADD COLUMN training_points INTEGER DEFAULT 0",
        "ALTER TABLE players ADD COLUMN temp_atk_boost INTEGER DEFAULT 0",
        "ALTER TABLE players ADD COLUMN temp_def_boost INTEGER DEFAULT 0",
        "ALTER TABLE players ADD COLUMN temp_hp_boost INTEGER DEFAULT 0",
        "ALTER TABLE players ADD COLUMN level_boss_attempts TEXT DEFAULT '{}'",
        "ALTER TABLE players ADD COLUMN monsters_killed INTEGER DEFAULT 0",
        "ALTER TABLE players ADD COLUMN bosses_defeated INTEGER DEFAULT 0",
        "ALTER TABLE players ADD COLUMN total_coins_earned INTEGER DEFAULT 0",
        "ALTER TABLE players ADD COLUMN total_xp_earned INTEGER DEFAULT 0",
        "ALTER TABLE players ADD COLUMN areas_explored INTEGER DEFAULT 0",
        "ALTER TABLE players ADD COLUMN dungeons_completed INTEGER DEFAULT 0",
        "ALTER TABLE players ADD COLUMN race TEXT DEFAULT NULL",
        "ALTER TABLE players ADD COLUMN specialization TEXT DEFAULT NULL",
        "ALTER TABLE players ADD COLUMN class_tier INTEGER DEFAULT 0",
        "ALTER TABLE players ADD COLUMN supreme_skills TEXT DEFAULT '[]'",
        "ALTER TABLE players ADD COLUMN mount TEXT DEFAULT NULL",
        "ALTER TABLE players ADD COLUMN race_stage INTEGER DEFAULT 0",
        "ALTER TABLE players ADD COLUMN bio TEXT DEFAULT ''",
        "ALTER TABLE players ADD COLUMN last_force_entry INTEGER DEFAULT 0",
        "ALTER TABLE players ADD COLUMN job_works TEXT DEFAULT '{}'",
    ]:
        try:
            c.execute(col_def)
        except: pass

    c.execute('''CREATE TABLE IF NOT EXISTS pvp_battles (
        id INTEGER PRIMARY KEY AUTOINCREMENT,
        challenger_id TEXT,
        target_id TEXT,
        status TEXT DEFAULT 'pending',
        created_at DATETIME DEFAULT CURRENT_TIMESTAMP
    )''')

    c.execute('''CREATE TABLE IF NOT EXISTS coin_exchange_requests (
        id INTEGER PRIMARY KEY AUTOINCREMENT,
        user_id TEXT,
        username TEXT,
        csi_coins INTEGER,
        status TEXT DEFAULT 'pending',
        created_at DATETIME DEFAULT CURRENT_TIMESTAMP
    )''')

    c.execute('''CREATE TABLE IF NOT EXISTS guilds (
        id INTEGER PRIMARY KEY AUTOINCREMENT,
        name TEXT UNIQUE,
        leader_id TEXT,
        members TEXT DEFAULT '[]',
        total_xp INTEGER DEFAULT 0,
        created_at DATETIME DEFAULT CURRENT_TIMESTAMP
    )''')

    c.execute('''CREATE TABLE IF NOT EXISTS trade_requests (
        id INTEGER PRIMARY KEY AUTOINCREMENT,
        from_user TEXT,
        to_user TEXT,
        from_items TEXT,
        to_items TEXT,
        status TEXT DEFAULT 'pending',
        timestamp DATETIME DEFAULT CURRENT_TIMESTAMP
    )''')

    c.execute('''CREATE TABLE IF NOT EXISTS team_quests (
        id INTEGER PRIMARY KEY AUTOINCREMENT,
        quest_id TEXT,
        leader_id TEXT,
        members TEXT DEFAULT '[]',
        status TEXT DEFAULT 'recruiting',
        progress INTEGER DEFAULT 0,
        created_at DATETIME DEFAULT CURRENT_TIMESTAMP
    )''')

    c.execute('''CREATE TABLE IF NOT EXISTS boss_battles (
        id INTEGER PRIMARY KEY AUTOINCREMENT,
        boss_name TEXT,
        leader_id TEXT,
        members TEXT DEFAULT '[]',
        world_level INTEGER,
        status TEXT DEFAULT 'recruiting',
        created_at DATETIME DEFAULT CURRENT_TIMESTAMP
    )''')

    # Tabela para persistir canais de mundo prÃ³prio
    c.execute('''CREATE TABLE IF NOT EXISTS mundo_proprio_channels (
        user_id TEXT PRIMARY KEY,
        channel_id INTEGER NOT NULL
    )''')

    conn.commit()
    conn.close()


def _db_load_mundo_proprio():
    conn = sqlite3.connect(DB_FILE)
    c = conn.cursor()
    try:
        c.execute("SELECT user_id, channel_id FROM mundo_proprio_channels")
        rows = c.fetchall()
    except:
        rows = []
    conn.close()
    return {row[0]: row[1] for row in rows}


def _db_save_mundo_proprio(user_id, channel_id):
    conn = sqlite3.connect(DB_FILE)
    c = conn.cursor()
    try:
        c.execute("INSERT OR REPLACE INTO mundo_proprio_channels (user_id, channel_id) VALUES (?,?)",
                  (str(user_id), channel_id))
        conn.commit()
    except: pass
    conn.close()


def _db_delete_mundo_proprio(user_id):
    conn = sqlite3.connect(DB_FILE)
    c = conn.cursor()
    try:
        c.execute("DELETE FROM mundo_proprio_channels WHERE user_id = ?", (str(user_id),))
        conn.commit()
    except: pass
    conn.close()


def get_player_db(user_id):
    conn = sqlite3.connect(DB_FILE)
    conn.row_factory = sqlite3.Row
    c = conn.cursor()
    c.execute("SELECT * FROM players WHERE user_id = ?", (str(user_id),))
    result = c.fetchone()
    conn.close()

    if result:
        r = dict(result)
        return {
            "level": r.get("level", 1),
            "xp": r.get("xp", 0),
            "hp": r.get("hp", 100),
            "max_hp": r.get("max_hp", 100),
            "coins": r.get("coins", 0),
            "inventory": json.loads(r["inventory"]) if r.get("inventory") else [],
            "weapon": r.get("weapon"),
            "armor": r.get("armor"),
            "worlds": json.loads(r["worlds"]) if r.get("worlds") else [1],
            "bosses": json.loads(r["bosses"]) if r.get("bosses") else [],
            "class": r.get("class"),
            "pet": r.get("pet"),
            "guild_id": r.get("guild_id"),
            "active_effects": json.loads(r["active_effects"]) if r.get("active_effects") else {},
            "active_quest": json.loads(r["active_quest"]) if r.get("active_quest") else None,
            "completed_quests": json.loads(r["completed_quests"]) if r.get("completed_quests") else [],
            "mana": r.get("mana", 50),
            "max_mana": r.get("max_mana", 50),
            "pvp_battles": json.loads(r["pvp_battles"]) if r.get("pvp_battles") else {},
            "alignment_points": r.get("alignment_points", 0),
            "pet_farm": json.loads(r["pet_farm"]) if r.get("pet_farm") else [],
            "discovered_map": json.loads(r["discovered_map"]) if r.get("discovered_map") else {},
            "job": r.get("job"),
            "job_since": r.get("job_since", 0),
            "city_title": r.get("city_title"),
            "knights": json.loads(r["knights"]) if r.get("knights") else [],
            "last_work": r.get("last_work", 0),
            "last_defend": r.get("last_defend", 0),
            "achievements": json.loads(r["achievements"]) if r.get("achievements") else [],
            "training_points": r.get("training_points", 0),
            "temp_atk_boost": r.get("temp_atk_boost", 0),
            "temp_def_boost": r.get("temp_def_boost", 0),
            "temp_hp_boost": r.get("temp_hp_boost", 0),
            "level_boss_attempts": json.loads(r["level_boss_attempts"]) if r.get("level_boss_attempts") else {},
            "monsters_killed": r.get("monsters_killed", 0),
            "bosses_defeated": r.get("bosses_defeated", 0),
            "total_coins_earned": r.get("total_coins_earned", 0),
            "total_xp_earned": r.get("total_xp_earned", 0),
            "areas_explored": r.get("areas_explored", 0),
            "dungeons_completed": r.get("dungeons_completed", 0),
            "mana_category": r.get("mana_category", "none"),
            "spell_book_unlocked": r.get("spell_book_unlocked", 0),
            "afk_farming": r.get("afk_farming", 0),
            "afk_start": r.get("afk_start", 0),
            "kingdom_data": json.loads(r["kingdom_data"]) if r.get("kingdom_data") and r["kingdom_data"] != "null" else None,
            "pets_list": json.loads(r["pets_list"]) if r.get("pets_list") else [],
            "race": r.get("race"),
            "specialization": r.get("specialization"),
            "class_tier": r.get("class_tier", 0),
            "supreme_skills": json.loads(r["supreme_skills"]) if r.get("supreme_skills") else [],
            "race_stage": r.get("race_stage", 0),
            "mount": r.get("mount"),
            "bio": r.get("bio", ""),
            "last_force_entry": r.get("last_force_entry", 0),
            "job_works": json.loads(r["job_works"]) if r.get("job_works") else {},
        }
    return None

def save_player_db(user_id, player):
    conn = sqlite3.connect(DB_FILE)
    c = conn.cursor()

    c.execute('''INSERT OR REPLACE INTO players
                 (user_id, level, xp, hp, max_hp, coins, inventory, weapon, armor,
                  worlds, bosses, class, pet, guild_id, active_effects, active_quest, completed_quests,
                  mana, max_mana, pvp_battles, alignment_points, pet_farm, discovered_map,
                  job, job_since, city_title, knights, last_work, last_defend,
                  achievements, training_points, temp_atk_boost, temp_def_boost, temp_hp_boost,
                  level_boss_attempts, monsters_killed, bosses_defeated, total_coins_earned,
                  total_xp_earned, areas_explored, dungeons_completed, mana_category, spell_book_unlocked,
                  afk_farming, afk_start, kingdom_data, pets_list,
                  race, specialization, class_tier, supreme_skills, race_stage, mount,
                  bio, last_force_entry, job_works)
                 VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?,
                         ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)''',
              (str(user_id), player["level"], player["xp"], player["hp"], player["max_hp"],
               player["coins"], json.dumps(player["inventory"]), player["weapon"], player["armor"],
               json.dumps(player["worlds"]), json.dumps(player["bosses"]), player.get("class"),
               player.get("pet"), player.get("guild_id"),
               json.dumps(player.get("active_effects", {})),
               json.dumps(player.get("active_quest")) if player.get("active_quest") else None,
               json.dumps(player.get("completed_quests", [])),
               player.get("mana", 50), player.get("max_mana", 50),
               json.dumps(player.get("pvp_battles", {})),
               player.get("alignment_points", 0),
               json.dumps(player.get("pet_farm", [])),
               json.dumps(player.get("discovered_map", {})),
               player.get("job"), player.get("job_since", 0),
               player.get("city_title"),
               json.dumps(player.get("knights", [])),
               player.get("last_work", 0), player.get("last_defend", 0),
               json.dumps(player.get("achievements", [])),
               player.get("training_points", 0),
               player.get("temp_atk_boost", 0),
               player.get("temp_def_boost", 0),
               player.get("temp_hp_boost", 0),
               json.dumps(player.get("level_boss_attempts", {})),
               player.get("monsters_killed", 0),
               player.get("bosses_defeated", 0),
               player.get("total_coins_earned", 0),
               player.get("total_xp_earned", 0),
               player.get("areas_explored", 0),
               player.get("dungeons_completed", 0),
               player.get("mana_category", "none"),
               player.get("spell_book_unlocked", 0),
               player.get("afk_farming", 0),
               player.get("afk_start", 0),
               json.dumps(player.get("kingdom_data")) if player.get("kingdom_data") else None,
               json.dumps(player.get("pets_list", [])),
               player.get("race"),
               player.get("specialization"),
               player.get("class_tier", 0),
               json.dumps(player.get("supreme_skills", [])),
               player.get("race_stage", 0),
               player.get("mount"),
               player.get("bio", ""),
               player.get("last_force_entry", 0),
               json.dumps(player.get("job_works", {}))))

    conn.commit()
    conn.close()


# ================= CONQUISTAS =================

async def check_achievements(channel, user_id, trigger_special=None):
    """Verifica e concede conquistas desbloqueadas ao jogador."""
    player = get_player(user_id)
    if not player:
        return
    earned = player.get("achievements", [])
    new_earned = []

    for ach in ACHIEVEMENTS:
        if ach["id"] in earned:
            continue  # JÃ¡ tem
        unlocked = False

        if "stat" in ach:
            val = player.get(ach["stat"], 0)
            if val >= ach["threshold"]:
                unlocked = True

        if "special" in ach and trigger_special == ach["special"]:
            unlocked = True

        if unlocked:
            new_earned.append(ach)
            earned.append(ach["id"])

    if new_earned:
        player["achievements"] = earned
        total_xp = sum(a["xp"] for a in new_earned)
        save_player_db(user_id, player)
        add_xp(user_id, total_xp)

        for ach in new_earned:
            is_secret = ach["cat"] == "ğŸ”® Secreta"
            secret_note = "\nğŸ”® *Uma conquista secreta foi revelada!*" if is_secret else ""
            embed = discord.Embed(
                title="ğŸ† CONQUISTA DESBLOQUEADA!",
                description=f"*'O narrador anuncia com voz trovejante!'*{secret_note}",
                color=discord.Color.gold()
            )
            embed.add_field(name=f"{ach['cat']} â€” {ach['name']}", value=f"_{ach['desc']}_\n\nâ­ **+{ach['xp']:,} XP** de recompensa!", inline=False)
            embed.set_footer(text=f"Conquistas desbloqueadas: {len(earned)}/{len(ACHIEVEMENTS)}")
            await channel.send(embed=embed)


# ================= FUNÃ‡Ã•ES BASE =================

def roll_dice():
    return random.randint(1, 10)

def roll_with_bonus(player):
    """Rola dado com bÃ´nus de raridade de itens e classe"""
    roll = roll_dice()
    item_bonus = get_item_dice_bonus(player)
    if player.get("class") == "Bardo":
        roll = min(10, roll + 1)
    roll = min(10, roll + item_bonus)
    return roll

def get_luck(roll):
    return LUCK_SYSTEM.get(roll, LUCK_SYSTEM[5])

def calc_xp(level):
    return (level ** 2) * 20

def get_world_cycle(level):
    """Retorna o ciclo de mundo do jogador baseado no nÃ­vel."""
    if level <= 199:
        return 1, "âš”ï¸ Reinos Mortais", "NÃ­v. 1â€“199"
    elif level <= 399:
        return 2, "ğŸŒŒ Reinos AvanÃ§ados", "NÃ­v. 200â€“399"
    elif level <= 499:
        return 3, "ğŸ’« DimensÃµes Superiores", "NÃ­v. 400â€“499"
    else:
        return 4, "â™¾ï¸ Planos Absolutos", "NÃ­v. 500â€“600"

def get_world(level, player=None):
    """Retorna o mundo atual do jogador. Respeita current_world se o jogador viajou."""
    if player:
        # Se o jogador viajou para um mundo especÃ­fico, usar esse
        cw = player.get("current_world")
        if cw and cw in WORLDS and cw in player.get("worlds", [1]):
            return WORLDS[cw]
        # Caso contrÃ¡rio, maior mundo desbloqueado
        available = sorted([k for k in WORLDS.keys() if k in player.get("worlds", [1])], reverse=True)
    else:
        levels = sorted([k for k in WORLDS.keys() if k <= level], reverse=True)
        available = levels
    return WORLDS[available[0]] if available else WORLDS[1]

def create_player(user_id):
    player = {
        "level": 1,
        "xp": 0,
        "hp": 100,
        "max_hp": 100,
        "coins": 0,
        "inventory": [],
        "weapon": None,
        "armor": None,
        "worlds": [1],
        "bosses": [],
        "class": None,
        "pet": None,
        "guild_id": None,
        "active_effects": {},
        "active_quest": None,
        "completed_quests": [],
        "mana": 50,
        "max_mana": 50,
        "pvp_battles": {},
        "alignment_points": 0,
        "pet_farm": [],
        "mana_category": "none",
        "spell_book_unlocked": 0,
        "afk_farming": 0,
        "afk_start": 0,
        "kingdom_data": None,
        "pets_list": [],
        "discovered_map": {},
        "job": None,
        "job_since": 0,
        "city_title": None,
        "knights": [],
        "last_work": 0,
        "last_defend": 0,
        "bio": "",
        "last_force_entry": 0,
        "job_works": {},
    }
    save_player_db(user_id, player)
    return player

def get_player(user_id):
    player = get_player_db(user_id)
    if not player:
        player = create_player(user_id)
    return player

def calc_max_mana(player):
    """Calcula mana mÃ¡xima baseada na classe e nÃ­vel"""
    cls = player.get("class")
    if not cls or cls not in CLASS_MANA:
        return 50 + player["level"] * 2
    base = CLASS_MANA[cls]["base_mana"]
    per_level = CLASS_MANA[cls]["mana_per_level"]
    return base + (player["level"] - 1) * per_level

def get_item_dice_bonus(player):
    """Retorna bÃ´nus no dado baseado na raridade dos equipamentos"""
    bonus = 0
    if player.get("weapon"):
        for w in ITEMS["weapons"]:
            if w["name"] == player["weapon"]:
                bonus += RARITY_DICE_BONUS.get(w["rarity"], 0)
                break
    if player.get("armor"):
        for a in ITEMS["armor"]:
            if a["name"] == player["armor"]:
                bonus += RARITY_DICE_BONUS.get(a["rarity"], 0)
                break
    return bonus

def get_item_sell_price(item_name):
    for weapon in ITEMS["weapons"]:
        if weapon["name"] == item_name:
            rarity_prices = {
                "Comum": 2, "Incomum": 8, "Raro": 20,
                "Ã‰pico": 60, "LendÃ¡rio": 200, "MÃ­tico": 600,
                "Divino": 1500, "Primordial": 4000
            }
            return rarity_prices.get(weapon["rarity"], 5)

    for armor in ITEMS["armor"]:
        if armor["name"] == item_name:
            rarity_prices = {
                "Comum": 2, "Incomum": 8, "Raro": 20,
                "Ã‰pico": 60, "LendÃ¡rio": 200, "MÃ­tico": 600,
                "Divino": 1500, "Primordial": 4000
            }
            return rarity_prices.get(armor["rarity"], 5)

    if item_name in POTIONS:
        rarity_prices = {
            "Comum": 3, "Incomum": 10, "Raro": 30,
            "Ã‰pico": 80, "LendÃ¡rio": 250, "MÃ­tico": 800,
            "Divino": 2000
        }
        return rarity_prices.get(POTIONS[item_name]["rarity"], 5)

    return 3  # recursos

def add_xp(user_id, amount, bypass_boss_gate=False):
    player = get_player(user_id)

    # XP aumentado significativamente
    amount = int(amount * 2.5)

    if player.get("class") == "Bardo":
        amount = int(amount * 1.2)

    # Race XP multiplier
    race_name = player.get("race")
    if race_name and race_name in RACES:
        amount = int(amount * RACES[race_name].get("xp_mult", 1.0))

    # Multiplicador de perÃ­odo
    period_data = TIME_PERIODS.get(CURRENT_PERIOD.get("type", "dia"), TIME_PERIODS["dia"])
    amount = int(amount * period_data.get("xp_mult", 1.0))

    # BLOQUEIO DE BOSS: Se o jogador estÃ¡ no nÃ­vel de boss e nÃ£o derrotou ele, XP vai para
    # um "balde" de XP pendente que Ã© liberado ao vencer o boss
    boss_gate_levels = {9, 19, 29, 39, 49, 59, 69, 79, 89, 99, 109, 119, 129, 139, 149, 159, 169, 179, 189, 199, 209, 219, 229, 239, 249, 259, 269, 279, 289, 299, 309, 319, 329, 339, 349, 359, 369, 379, 389, 399, 409, 419, 429, 439, 449, 459, 469, 479, 489, 499, 509, 519, 529, 539, 549, 559, 569, 579, 589, 599}
    if not bypass_boss_gate and player["level"] in boss_gate_levels:
        boss_data = get_level_boss(player["level"])
        if boss_data and boss_data["name"] not in player.get("bosses", []):
            # Acumula XP pendente â€” serÃ¡ liberado ao vencer o boss
            effects = player.get("active_effects", {})
            pending = effects.get("pending_xp", 0) + amount
            effects["pending_xp"] = pending
            player["active_effects"] = effects
            save_player_db(user_id, player)
            return False  # retorna False â€” nÃ­vel nÃ£o mudou

    player["xp"] += amount
    player["total_xp_earned"] = player.get("total_xp_earned", 0) + amount
    leveled = False

    # Bloqueia level-up nos nÃ­veis de boss se o boss nÃ£o foi derrotado
    while player["xp"] >= calc_xp(player["level"]):
        next_level = player["level"] + 1
        # Verifica se o prÃ³ximo nÃ­vel Ã© de boss gate â€” bloqueia progressÃ£o alÃ©m dele
        if player["level"] in boss_gate_levels and not bypass_boss_gate:
            boss_data = get_level_boss(player["level"])
            if boss_data and boss_data["name"] not in player.get("bosses", []):
                # MantÃ©m XP no teto sem ultrapassar
                player["xp"] = calc_xp(player["level"]) - 1
                break
        player["xp"] -= calc_xp(player["level"])
        player["level"] += 1

        class_bonus = 0
        if player.get("class") and player["class"] in CLASSES:
            class_bonus = CLASSES[player["class"]]["hp_bonus"] // 10

        player["max_hp"] += (10 + class_bonus)
        # NÃƒO restaurar HP ao mÃ¡ximo â€” apenas aumenta o cap. Use descansar/poÃ§Ãµes para recuperar!
        player["hp"] = min(player["hp"] + (10 + class_bonus), player["max_hp"])

        # Atualiza mana ao subir de nÃ­vel
        new_max_mana = calc_max_mana(player)
        player["max_mana"] = new_max_mana
        # Mana tambÃ©m nÃ£o recupera totalmente â€” sÃ³ aumenta o cap
        player["mana"] = min(player.get("mana", 0) + 10, new_max_mana)

        # Verificar desbloqueio livro de feitiÃ§os no nÃ­vel 12
        if player["level"] == 12 and not player.get("spell_book_unlocked"):
            player["spell_book_unlocked"] = 1
            effects = player.get("active_effects", {})
            effects["notify_spellbook"] = True
            player["active_effects"] = effects

        leveled = True
        # Mark that evolution should be checked after level-up
        evol_levels = {40, 80, 120, 160}
        if player["level"] in evol_levels and player.get("class"):
            effects = player.get("active_effects", {})
            effects["check_evolution"] = True
            player["active_effects"] = effects

    save_player_db(user_id, player)

    if player.get("guild_id"):
        distribute_guild_xp(player["guild_id"], amount)

    return leveled


def release_pending_xp(user_id):
    """Libera o XP pendente acumulado durante bloqueio de boss. Chame apÃ³s derrotar o boss."""
    player = get_player(user_id)
    effects = player.get("active_effects", {})
    pending = effects.pop("pending_xp", 0)
    player["active_effects"] = effects
    save_player_db(user_id, player)
    if pending > 0:
        # Chama add_xp com bypass para liberar tudo de uma vez
        add_xp(user_id, pending // 3, bypass_boss_gate=True)  # divide por 3 pois add_xp multiplica por 2.5
        return pending
    return 0

def distribute_guild_xp(guild_id, amount):
    """Distribui apenas 5% do XP ganho para os demais membros da guilda (nerf)."""
    shared = max(1, int(amount * 0.05))  # 5% do XP original, mÃ­nimo 1
    conn = sqlite3.connect(DB_FILE)
    c = conn.cursor()
    c.execute("SELECT members FROM guilds WHERE id = ?", (guild_id,))
    result = c.fetchone()

    if result:
        members = json.loads(result[0])
        for member_id in members:
            member = get_player(member_id)
            if member:
                member["xp"] += shared
                while member["xp"] >= calc_xp(member["level"]):
                    member["xp"] -= calc_xp(member["level"])
                    member["level"] += 1
                    class_bonus = 0
                    if member.get("class") and member["class"] in CLASSES:
                        class_bonus = CLASSES[member["class"]]["hp_bonus"] // 10
                    member["max_hp"] += (10 + class_bonus)
                    member["hp"] = member["max_hp"]
                    for wl in WORLDS.keys():
                        if member["level"] >= wl and wl not in member["worlds"]:
                            member["worlds"].append(wl)
                save_player_db(member_id, member)

    conn.close()

def remove_xp(user_id, amount):
    player = get_player(user_id)
    world = get_world(player["level"], player)

    adjusted_loss = int(amount * world.get("xp_loss_multiplier", 1.0))
    player["xp"] -= adjusted_loss

    while player["xp"] < 0 and player["level"] > 1:
        player["level"] -= 1
        player["xp"] += calc_xp(player["level"])

    if player["xp"] < 0:
        player["xp"] = 0

    if player["level"] == 1 and player["xp"] == 0:
        player["inventory"] = []
        player["weapon"] = None
        player["armor"] = None
        player["worlds"] = [1]
        player["bosses"] = []
        player["hp"] = 100
        player["max_hp"] = 100
        player["coins"] = 0
        player["class"] = None
        player["pet"] = None
        player["active_quest"] = None
        save_player_db(user_id, player)
        return "reset", adjusted_loss

    save_player_db(user_id, player)
    return "ok", adjusted_loss

def add_coins(user_id, amount):
    player = get_player(user_id)
    player["coins"] += amount
    if amount > 0:
        player["total_coins_earned"] = player.get("total_coins_earned", 0) + amount
    save_player_db(user_id, player)

def remove_coins(user_id, amount):
    player = get_player(user_id)
    if player["coins"] >= amount:
        player["coins"] -= amount
        save_player_db(user_id, player)
        return True
    return False

def get_level_boss(level):
    """Retorna boss de level correspondente ao nÃ­vel do jogador"""
    boss_levels = {
        9: 1, 19: 10, 29: 20, 39: 30, 49: 40, 59: 50,
        69: 60, 79: 70, 89: 80, 99: 90, 109: 100,
        119: 110, 129: 120, 139: 130, 149: 140, 159: 150,
        169: 160, 179: 170, 189: 180, 199: 190,
        # Ciclo 2 â€” Reinos AvanÃ§ados (200â€“399)
        209: 200, 219: 210, 229: 220, 239: 230, 249: 240,
        259: 250, 269: 260, 279: 270, 289: 280, 299: 290,
        309: 300, 319: 310, 329: 320, 339: 330, 349: 340,
        359: 350, 369: 360, 379: 370, 389: 380, 399: 390,
        # Ciclo 3 â€” DimensÃµes Superiores (400â€“499)
        409: 400, 419: 410, 429: 420, 439: 430, 449: 440,
        459: 450, 469: 460, 479: 470, 489: 480, 499: 490,
        # Ciclo 4 â€” Planos Absolutos (500â€“600)
        509: 500, 519: 510, 529: 520, 539: 530, 549: 540,
        559: 550, 569: 560, 579: 570, 589: 580, 599: 590,
    }
    world_key = boss_levels.get(level)
    if world_key and world_key in WORLDS:
        return WORLDS[world_key]["boss"]
    # Fallback: usar o mundo mais prÃ³ximo disponÃ­vel
    if world_key:
        nearest = max((k for k in WORLDS.keys() if k <= world_key), default=1)
        return WORLDS[nearest]["boss"]
    return None

# ================= VIEWS / BOTÃ•ES =================

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# HELPER: apply race bonuses to player
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
def apply_race_bonuses(player, race_name):
    race = RACES[race_name]
    player["max_hp"]  += race["hp_bonus"]
    player["hp"]       = player["max_hp"]
    player["race"]     = race_name
    return player


# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# HELPER: get current skills for player (tiered system)
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
def get_player_skills(player):
    cls = player.get("class", "Guerreiro") or "Guerreiro"
    lvl = player.get("level", 1)
    tier_data = CLASS_TIERED_SKILLS.get(cls)
    if not tier_data:
        # fallback to old CLASS_SKILLS
        return CLASS_SKILLS.get(cls, CLASS_SKILLS["Guerreiro"])

    skills = list(tier_data["basic"])
    if lvl >= 40:
        skills += tier_data.get("intermediate", [])
    if lvl >= 80:
        skills += tier_data.get("advanced", [])
    # Supreme skill
    supreme = tier_data.get("supreme")
    if supreme and supreme["name"] in player.get("supreme_skills", []):
        skills.append(supreme)
    # Specialization special skill
    spec = player.get("specialization")
    if spec and spec in CLASS_SPECIALIZATIONS:
        spec_skill = CLASS_SPECIALIZATIONS[spec].get("special_skill")
        if spec_skill:
            skills.append(spec_skill)
    return skills


# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# HELPER: check and trigger class evolution prompt
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async def check_class_evolution(channel, user_id):
    player = get_player(user_id)
    if not player or not player.get("class"):
        return
    cls = player["class"]
    lvl = player["level"]
    tree = CLASS_EVOLUTION_TREE.get(cls)
    if not tree:
        return
    current_tier = player.get("class_tier", 0)
    evolution_levels = sorted(tree.keys())
    # Which tiers haven't been taken yet
    for evo_lvl in evolution_levels:
        tier_index = evolution_levels.index(evo_lvl) + 1
        if lvl >= evo_lvl and current_tier < tier_index:
            evo_data = tree[evo_lvl]
            specs = evo_data["spec_options"]
            embed = discord.Embed(
                title=f"ğŸŒŸ EvoluÃ§Ã£o de Classe DisponÃ­vel!",
                description=(
                    f"**{cls}** pode evoluir para **{evo_data['name']}**!\n\n"
                    f"Escolha sua especializaÃ§Ã£o abaixo.\n"
                    f"*A escolha altera suas habilidades, passivas e estilo de combate.*"
                ),
                color=discord.Color.gold()
            )
            for s in specs:
                spec_data = CLASS_SPECIALIZATIONS.get(s)
                if spec_data:
                    embed.add_field(
                        name=f"{spec_data['emoji']} {s}",
                        value=f"{spec_data['desc']}\n**Passiva:** {spec_data['passive']}",
                        inline=False
                    )
            view = ClassEvolutionView(user_id, cls, evo_data["name"], specs, tier_index)
            await channel.send(embed=embed, view=view)
            return  # show one at a time


# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# VIEW: Race selection (page 1 of 4)
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
class RaceSelectView(discord.ui.View):
    def __init__(self, user_id, page=0, timeout=180):
        super().__init__(timeout=timeout)
        self.user_id = user_id
        self.page = page
        self.answered = False
        all_races = list(RACES.keys())
        # 5 per page
        chunk = all_races[page*5:(page+1)*5]
        colors = [
            discord.ButtonStyle.primary, discord.ButtonStyle.success,
            discord.ButtonStyle.danger, discord.ButtonStyle.secondary,
            discord.ButtonStyle.primary
        ]
        for i, race_name in enumerate(chunk):
            race_data = RACES[race_name]
            btn = discord.ui.Button(
                label=race_name,
                style=colors[i % len(colors)],
                emoji=race_data["emoji"],
                row=0
            )
            btn.callback = self.make_cb(race_name)
            self.add_item(btn)
        # Nav buttons
        total_pages = (len(all_races) + 4) // 5
        if page > 0:
            prev_btn = discord.ui.Button(label="â—€ Anterior", style=discord.ButtonStyle.secondary, row=1)
            prev_btn.callback = self.make_nav(page - 1)
            self.add_item(prev_btn)
        if page < total_pages - 1:
            next_btn = discord.ui.Button(label="PrÃ³xima â–¶", style=discord.ButtonStyle.secondary, row=1)
            next_btn.callback = self.make_nav(page + 1)
            self.add_item(next_btn)

    def make_cb(self, race_name):
        async def callback(interaction: discord.Interaction):
            if str(interaction.user.id) != str(self.user_id):
                return await interaction.response.send_message("âŒ Esta escolha nÃ£o Ã© sua!", ephemeral=True)
            if self.answered:
                return
            self.answered = True
            player = get_player(self.user_id)
            if player.get("race"):
                return await interaction.response.send_message(f"âŒ VocÃª jÃ¡ Ã© um(a) **{player['race']}**!", ephemeral=True)
            apply_race_bonuses(player, race_name)
            save_player_db(self.user_id, player)
            race_data = RACES[race_name]
            embed = discord.Embed(
                title=f"{race_data['emoji']} RaÃ§a Escolhida: {race_name}!",
                description=f"*{race_data['lore']}*\n\n{race_data['description']}",
                color=discord.Color.purple()
            )
            embed.add_field(name="â¤ï¸ BÃ´nus HP",  value=f"+{race_data['hp_bonus']}",  inline=True)
            embed.add_field(name="âš”ï¸ BÃ´nus ATK", value=f"+{race_data['atk_bonus']}", inline=True)
            embed.add_field(name="ğŸ›¡ï¸ BÃ´nus DEF", value=f"+{race_data['def_bonus']}", inline=True)
            embed.add_field(name="âœ¨ Passiva",    value=race_data["passive"],          inline=False)
            embed.set_footer(text="Agora use 'escolher classe' para completar seu personagem!")
            await interaction.response.edit_message(embed=embed, view=None)
        return callback

    def make_nav(self, new_page):
        async def callback(interaction: discord.Interaction):
            if str(interaction.user.id) != str(self.user_id):
                return await interaction.response.send_message("âŒ Esta nÃ£o Ã© sua seleÃ§Ã£o!", ephemeral=True)
            all_races = list(RACES.keys())
            chunk = all_races[new_page*5:(new_page+1)*5]
            embed = discord.Embed(
                title=f"ğŸ§¬ Escolha sua RaÃ§a (PÃ¡gina {new_page+1})",
                description="Sua raÃ§a define bÃ´nus permanentes e passivas Ãºnicas.",
                color=discord.Color.purple()
            )
            for rn in chunk:
                rd = RACES[rn]
                embed.add_field(
                    name=f"{rd['emoji']} {rn}",
                    value=f"{rd['description']}\n**Passiva:** {rd['passive']}\n**HP:** +{rd['hp_bonus']} | **ATK:** +{rd['atk_bonus']} | **DEF:** +{rd['def_bonus']}",
                    inline=False
                )
            new_view = RaceSelectView(self.user_id, page=new_page)
            await interaction.response.edit_message(embed=embed, view=new_view)
        return callback


# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# VIEW: Class selection (paginated, 5 per page across 6 pages)
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
class ClassSelectView(discord.ui.View):
    def __init__(self, user_id, page=0, timeout=180):
        super().__init__(timeout=timeout)
        self.user_id = user_id
        self.page = page
        self.answered = False
        all_classes = list(CLASSES.keys())
        chunk = all_classes[page*5:(page+1)*5]
        colors = [
            discord.ButtonStyle.primary, discord.ButtonStyle.success,
            discord.ButtonStyle.danger, discord.ButtonStyle.secondary,
            discord.ButtonStyle.primary
        ]
        for i, class_name in enumerate(chunk):
            class_data = CLASSES[class_name]
            btn = discord.ui.Button(
                label=class_name[:25],
                style=colors[i % len(colors)],
                emoji=class_data["emoji"],
                row=0
            )
            btn.callback = self.make_cb(class_name)
            self.add_item(btn)
        total_pages = (len(all_classes) + 4) // 5
        if page > 0:
            prev_btn = discord.ui.Button(label="â—€ Anterior", style=discord.ButtonStyle.secondary, row=1)
            prev_btn.callback = self.make_nav(page - 1)
            self.add_item(prev_btn)
        if page < total_pages - 1:
            next_btn = discord.ui.Button(label="PrÃ³xima â–¶", style=discord.ButtonStyle.secondary, row=1)
            next_btn.callback = self.make_nav(page + 1)
            self.add_item(next_btn)

    def make_cb(self, class_name):
        async def callback(interaction: discord.Interaction):
            if str(interaction.user.id) != str(self.user_id):
                return await interaction.response.send_message("âŒ Esta escolha nÃ£o Ã© sua!", ephemeral=True)
            if self.answered:
                return
            self.answered = True
            player = get_player(self.user_id)
            if player.get("class"):
                return await interaction.response.send_message(f"âŒ VocÃª jÃ¡ Ã© um(a) **{player['class']}**!", ephemeral=True)
            player["class"] = class_name
            class_data = CLASSES[class_name]
            player["max_hp"] += class_data["hp_bonus"]
            player["hp"] = player["max_hp"]
            # Apply race affinity bonus if player has a race
            race = player.get("race")
            affinity_bonus = ""
            if race and race in class_data.get("race_affinity", []):
                player["max_hp"] += 15
                player["hp"] = player["max_hp"]
                affinity_bonus = f"\n\nğŸŒŸ **BÃ´nus de Afinidade!** Sua raÃ§a **{race}** tem afinidade com esta classe!\n+15 HP bÃ´nus adicional."
            save_player_db(self.user_id, player)
            embed = discord.Embed(
                title=f"{class_data['emoji']} Classe Escolhida: {class_name}!",
                description=f"{class_data['description']}{affinity_bonus}",
                color=discord.Color.gold()
            )
            embed.add_field(name="ğŸ’ª BÃ´nus ATK", value=f"+{class_data['atk_bonus']}", inline=True)
            embed.add_field(name="ğŸ›¡ï¸ BÃ´nus DEF", value=f"+{class_data['def_bonus']}", inline=True)
            embed.add_field(name="â¤ï¸ BÃ´nus HP",  value=f"+{class_data['hp_bonus']}", inline=True)
            tree = CLASS_EVOLUTION_TREE.get(class_name)
            if tree:
                evo_levels = sorted(tree.keys())
                evo_text = " â†’ ".join([f"Nv.{lvl} ({tree[lvl]['name']})" for lvl in evo_levels])
                embed.add_field(name="ğŸŒŸ Ãrvore de EvoluÃ§Ã£o", value=evo_text, inline=False)
            embed.set_footer(text="Use 'habilidades' para ver suas skills. Evolua nos nÃ­veis 40, 80, 120 e 160!")
            await interaction.response.edit_message(embed=embed, view=None)
        return callback

    def make_nav(self, new_page):
        async def callback(interaction: discord.Interaction):
            if str(interaction.user.id) != str(self.user_id):
                return await interaction.response.send_message("âŒ Esta nÃ£o Ã© sua seleÃ§Ã£o!", ephemeral=True)
            all_classes = list(CLASSES.keys())
            chunk = all_classes[new_page*5:(new_page+1)*5]
            total_pages = (len(all_classes) + 4) // 5
            embed = discord.Embed(
                title=f"ğŸ­ Escolha sua Classe (PÃ¡gina {new_page+1}/{total_pages})",
                description="Cada classe tem Ã¡rvore de evoluÃ§Ã£o e especializaÃ§Ãµes Ãºnicas.",
                color=discord.Color.blue()
            )
            for cn in chunk:
                cd = CLASSES[cn]
                tree = CLASS_EVOLUTION_TREE.get(cn)
                evo_hint = ""
                if tree:
                    evo_hint = f"\nğŸŒŸ Evolui nos nÃ­veis: {', '.join(str(k) for k in sorted(tree.keys()))}"
                embed.add_field(
                    name=f"{cd['emoji']} {cn}",
                    value=f"{cd['description']}\n**ATK:** +{cd['atk_bonus']} | **DEF:** +{cd['def_bonus']} | **HP:** +{cd['hp_bonus']}{evo_hint}",
                    inline=False
                )
            new_view = ClassSelectView(self.user_id, page=new_page)
            await interaction.response.edit_message(embed=embed, view=new_view)
        return callback


# Keep old aliases for backward compat
ClassSelectButton  = ClassSelectView
ClassSelectButton2 = ClassSelectView


# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# VIEW: Class Evolution / Specialization choice
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
class ClassEvolutionView(discord.ui.View):
    def __init__(self, user_id, base_class, evolved_name, spec_options, new_tier, timeout=180):
        super().__init__(timeout=timeout)
        self.user_id = user_id
        self.base_class = base_class
        self.evolved_name = evolved_name
        self.answered = False
        colors = [discord.ButtonStyle.success, discord.ButtonStyle.danger]
        for i, spec in enumerate(spec_options):
            spec_data = CLASS_SPECIALIZATIONS.get(spec, {})
            btn = discord.ui.Button(
                label=spec[:25],
                style=colors[i % len(colors)],
                emoji=spec_data.get("emoji", "â­"),
                row=0
            )
            btn.callback = self.make_cb(spec, new_tier)
            self.add_item(btn)

    def make_cb(self, spec_name, new_tier):
        async def callback(interaction: discord.Interaction):
            if str(interaction.user.id) != str(self.user_id):
                return await interaction.response.send_message("âŒ Esta evoluÃ§Ã£o nÃ£o Ã© sua!", ephemeral=True)
            if self.answered:
                return
            self.answered = True
            player = get_player(self.user_id)
            spec_data = CLASS_SPECIALIZATIONS.get(spec_name, {})
            player["class"] = self.base_class
            player["specialization"] = spec_name
            player["class_tier"] = new_tier

            # â”€â”€ Status escalonados por tier â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
            # Tier 1 (nÃ­vel 40):  1Ã— base
            # Tier 2 (nÃ­vel 80):  2.5Ã— base + bÃ´nus extra
            # Tier 3 (nÃ­vel 120): 5Ã— base + bÃ´nus extra grande
            # Tier 4 (nÃ­vel 160): 10Ã— base + bÃ´nus mÃ¡ximo (poder divino)
            BASE_HP  = spec_data.get("bonus_hp",  0)
            BASE_ATK = spec_data.get("bonus_atk", 0)
            BASE_DEF = spec_data.get("bonus_def", 0)

            TIER_MULTIPLIERS = {
                1: {"hp": 1.0,  "atk": 1.0,  "def": 1.0,  "extra_hp":   0, "extra_atk":  0, "extra_def":  0},
                2: {"hp": 2.5,  "atk": 2.5,  "def": 2.5,  "extra_hp":  50, "extra_atk": 20, "extra_def": 15},
                3: {"hp": 5.0,  "atk": 5.0,  "def": 5.0,  "extra_hp": 150, "extra_atk": 60, "extra_def": 45},
                4: {"hp": 10.0, "atk": 10.0, "def": 10.0, "extra_hp": 400, "extra_atk":150, "extra_def":120},
            }
            mult = TIER_MULTIPLIERS.get(new_tier, TIER_MULTIPLIERS[1])

            bonus_hp  = int(BASE_HP  * mult["hp"])  + mult["extra_hp"]
            bonus_atk = int(BASE_ATK * mult["atk"]) + mult["extra_atk"]
            bonus_def = int(BASE_DEF * mult["def"]) + mult["extra_def"]

            # Garantir mÃ­nimos por tier (mesmo specs sem bÃ´nus base ganham algo)
            MIN_HP  = {1: 10, 2: 80,  3: 200, 4: 500}
            MIN_ATK = {1:  5, 2: 30,  3:  80, 4: 200}
            MIN_DEF = {1:  0, 2: 20,  3:  55, 4: 130}
            bonus_hp  = max(bonus_hp,  MIN_HP[new_tier])
            bonus_atk = max(bonus_atk, MIN_ATK[new_tier])
            bonus_def = max(bonus_def, MIN_DEF[new_tier])

            # Aplicar bÃ´nus ao jogador
            player["max_hp"] += bonus_hp
            player["hp"] = min(player["hp"] + bonus_hp, player["max_hp"])
            save_player_db(self.user_id, player)

            # Nomes dos tiers para exibiÃ§Ã£o
            TIER_NAMES = {1: "Tier I â€” Elite", 2: "Tier II â€” Mestre", 3: "Tier III â€” LendÃ¡rio", 4: "Tier IV â€” Divino"}
            TIER_COLORS = {1: discord.Color.blue(), 2: discord.Color.gold(), 3: discord.Color.from_rgb(255, 60, 0), 4: discord.Color.from_rgb(200, 0, 255)}
            TIER_EMOJIS = {1: "ğŸ”µ", 2: "ğŸŒŸ", 3: "ğŸ”¥", 4: "ğŸ‘‘"}

            embed = discord.Embed(
                title=f"{TIER_EMOJIS[new_tier]} EVOLUÃ‡ÃƒO {TIER_NAMES[new_tier].upper()}!",
                description=(
                    f"VocÃª evoluiu para **{self.evolved_name}**!\n"
                    f"EspecializaÃ§Ã£o: **{spec_name}** {spec_data.get('emoji','')}\n\n"
                    f"*{spec_data.get('desc', '')}*\n\n"
                    f"**Passiva:** {spec_data.get('passive', '')}"
                ),
                color=TIER_COLORS[new_tier]
            )
            if spec_data.get("special_skill"):
                sk = spec_data["special_skill"]
                embed.add_field(name="âš¡ Habilidade Especial", value=f"{sk['name']} â€” {sk['desc']}", inline=False)
            embed.add_field(name="â¤ï¸ HP Ganho",  value=f"**+{bonus_hp}**",  inline=True)
            embed.add_field(name="âš”ï¸ ATK Ganho", value=f"**+{bonus_atk}**", inline=True)
            embed.add_field(name="ğŸ›¡ï¸ DEF Ganho", value=f"**+{bonus_def}**", inline=True)
            if new_tier >= 2:
                embed.add_field(
                    name=f"ğŸ“ˆ Por que tÃ£o forte?",
                    value=(
                        f"*Cada tier de evoluÃ§Ã£o multiplica os bÃ´nus da especializaÃ§Ã£o.*\n"
                        f"Tier I: Ã—1 | Tier II: Ã—2.5 | Tier III: Ã—5 | Tier IV: Ã—10"
                    ),
                    inline=False
                )
            embed.set_footer(text=f"Tier {new_tier}/4 â€” Use 'habilidades' para ver suas skills!")
            await interaction.response.edit_message(embed=embed, view=None)
        return callback


class PetTameButton(discord.ui.View):
    def __init__(self, user_id, pet, timeout=60):
        super().__init__(timeout=timeout)
        self.user_id = user_id
        self.pet = pet
        self.answered = False

    @discord.ui.button(label="Tentar Domesticar", style=discord.ButtonStyle.green, emoji="ğŸ¤")
    async def tame(self, interaction: discord.Interaction, button: discord.ui.Button):
        if str(interaction.user.id) != str(self.user_id):
            return await interaction.response.send_message("âŒ Este pet nÃ£o Ã© para vocÃª!", ephemeral=True)
        if self.answered:
            return
        self.answered = True

        roll = roll_dice()
        luck = get_luck(roll)
        embed = discord.Embed(title="ğŸ² Tentativa de DomesticaÃ§Ã£o", color=discord.Color.blue())
        embed.add_field(name="ğŸ² Dado", value=f"`{roll}` {luck['emoji']} **{luck['name']}**", inline=False)

        if roll <= 3:
            player = get_player(self.user_id)
            dmg = random.randint(20, 40)
            player["hp"] -= dmg
            if player["hp"] <= 0:
                player["hp"] = 1
            save_player_db(self.user_id, player)
            embed.add_field(name="ğŸ’¥ O Pet Ataca!", value=f"*'{self.pet['name']} se assusta e ataca vocÃª!'*\n\nğŸ’” **âˆ’{dmg} HP**", inline=False)
            embed.color = discord.Color.red()
        elif roll <= 6:
            embed.add_field(name="ğŸƒ Fuga!", value=f"*'{self.pet['name']} nÃ£o confia em vocÃª e foge...'*", inline=False)
            embed.color = discord.Color.orange()
        else:
            player = get_player(self.user_id)
            pet_entry = {**self.pet, "evo_stage": 1, "pet_xp": 0}
            if not player.get("pet"):
                # Sem pet ativo â†’ torna-se pet ativo
                player["pet"] = self.pet["name"]
                save_player_db(self.user_id, player)
                embed.add_field(
                    name="âœ¨ Domesticado! (Pet Ativo)",
                    value=f"*'{self.pet['emoji']} **{self.pet['name']}** agora Ã© seu companheiro ativo!'*\n\n"
                          f"ğŸ’ª **+{self.pet['bonus_atk']} ATK** | â¤ï¸ **+{self.pet['bonus_hp']} HP**\n"
                          f"*Use `ver fazenda` para ver todos seus pets.*",
                    inline=False
                )
            else:
                # JÃ¡ tem pet ativo â†’ vai pra fazenda automaticamente
                pets_list = player.get("pets_list", [])
                if len(pets_list) >= 15:
                    embed.add_field(name="âŒ Fazenda Cheia!", value="Sua fazenda jÃ¡ tem 15 pets! Use `ver fazenda` para gerenciar.", inline=False)
                    embed.color = discord.Color.red()
                else:
                    pets_list.append(pet_entry)
                    player["pets_list"] = pets_list
                    save_player_db(self.user_id, player)
                    embed.add_field(
                        name=f"ğŸ¾ Domesticado! â†’ Fazenda",
                        value=f"*'{self.pet['emoji']} **{self.pet['name']}** foi para sua fazenda!'*\n\n"
                              f"ğŸ’ª **+{self.pet['bonus_atk']} ATK** | â¤ï¸ **+{self.pet['bonus_hp']} HP**\n"
                              f"Pet ativo atual: **{player['pet']}**\n"
                              f"*Use `trocar pet [nome]` para definir como ativo, ou `ver fazenda`.*",
                        inline=False
                    )
            embed.color = discord.Color.gold()

        await interaction.response.edit_message(embed=embed, view=None)

    @discord.ui.button(label="Deixar Ir", style=discord.ButtonStyle.gray, emoji="ğŸ‘‹")
    async def leave(self, interaction: discord.Interaction, button: discord.ui.Button):
        if str(interaction.user.id) != str(self.user_id):
            return await interaction.response.send_message("âŒ Esta escolha nÃ£o Ã© sua!", ephemeral=True)
        if self.answered:
            return
        self.answered = True
        await interaction.response.edit_message(
            content=f"*'VocÃª decide nÃ£o arriscar e deixa {self.pet['name']} em paz...'*", view=None
        )


class EquipButton(discord.ui.View):
    def __init__(self, user_id, item_name, item_type, timeout=60):
        super().__init__(timeout=timeout)
        self.user_id = user_id
        self.item_name = item_name
        self.item_type = item_type
        self.answered = False

    @discord.ui.button(label="Equipar", style=discord.ButtonStyle.green, emoji="âš”ï¸")
    async def equip(self, interaction: discord.Interaction, button: discord.ui.Button):
        if str(interaction.user.id) != str(self.user_id):
            return await interaction.response.send_message("âŒ Esse item nÃ£o Ã© seu!", ephemeral=True)
        if self.answered:
            return
        self.answered = True
        player = get_player(self.user_id)
        old_item = player[self.item_type]
        player[self.item_type] = self.item_name
        save_player_db(self.user_id, player)

        if old_item:
            response = f"âœ… **Equipado!**\n\nğŸ”„ VocÃª substituiu **{old_item}** por **{self.item_name}**!\n\n*'Seu poder aumenta...'*"
        else:
            response = f"âœ… **Equipado!**\n\nâš”ï¸ VocÃª equipou **{self.item_name}**!\n\n*'VocÃª estÃ¡ mais forte agora.'*"

        await interaction.response.edit_message(content=response, view=None)

    @discord.ui.button(label="Guardar", style=discord.ButtonStyle.gray, emoji="ğŸ’")
    async def keep(self, interaction: discord.Interaction, button: discord.ui.Button):
        if str(interaction.user.id) != str(self.user_id):
            return await interaction.response.send_message("âŒ Esse item nÃ£o Ã© seu!", ephemeral=True)
        if self.answered:
            return
        self.answered = True
        player = get_player(self.user_id)
        player["inventory"].append(self.item_name)
        save_player_db(self.user_id, player)
        await interaction.response.edit_message(
            content=f"ğŸ’ **Guardado!**\n\nVocÃª guarda **{self.item_name}** no inventÃ¡rio.\n\n*'Pode ser Ãºtil depois...'*",
            view=None
        )


class BossButton(discord.ui.View):
    def __init__(self, user_id, boss_name, timeout=120):
        super().__init__(timeout=timeout)
        self.user_id = user_id
        self.boss_name = boss_name
        self.answered = False

    @discord.ui.button(label="Enfrentar", style=discord.ButtonStyle.red, emoji="âš”ï¸")
    async def fight(self, interaction: discord.Interaction, button: discord.ui.Button):
        if str(interaction.user.id) != str(self.user_id):
            return await interaction.response.send_message("âŒ Esse nÃ£o Ã© seu boss!", ephemeral=True)
        if self.answered:
            return
        self.answered = True

        # AUTO-CONVOCAR membros da mesma guilda como aliados
        player = get_player(self.user_id)
        guild_allies = []
        guild_ally_names = []
        if player and player.get("guild_id"):
            try:
                _conn = sqlite3.connect(DB_FILE)
                _c = _conn.cursor()
                _c.execute("SELECT members FROM guilds WHERE id = ?", (player["guild_id"],))
                _row = _c.fetchone()
                _conn.close()
                if _row:
                    _members = json.loads(_row[0])
                    for _mid in _members:
                        if str(_mid) == str(self.user_id):
                            continue
                        _ap = get_player(str(_mid))
                        if _ap and _ap.get("hp", 0) > 0:
                            guild_allies.append(str(_mid))
                            guild_ally_names.append(_ap.get("name", str(_mid)))
            except Exception:
                pass

        # Buscar nomes reais dos aliados via Discord
        guild_ally_names = []
        for _aid in guild_allies:
            try:
                _au = await bot.fetch_user(int(_aid))
                guild_ally_names.append(_au.display_name)
            except:
                guild_ally_names.append(str(_aid))

        _ally_text = ""
        if guild_ally_names:
            _ally_text = f"\n\nğŸ›¡ï¸ **Aliados da guilda convocados automaticamente:** {', '.join(guild_ally_names[:5])}"

        # Edita a mensagem UMA SÃ“ VEZ e pega o canal antes de deferir
        channel = interaction.channel
        await interaction.response.edit_message(
            content=f"âš”ï¸ **VocÃª avanÃ§a em direÃ§Ã£o ao {self.boss_name}!**{_ally_text}\n\n*A batalha Ã©pica comeÃ§a...*",
            view=None
        )
        await asyncio.sleep(2)
        await fight_boss(channel, self.user_id, allies=guild_allies if guild_allies else None)


    @discord.ui.button(label="Chamar Aliados", style=discord.ButtonStyle.blurple, emoji="ğŸ‘¥")
    async def call_allies(self, interaction: discord.Interaction, button: discord.ui.Button):
        if str(interaction.user.id) != str(self.user_id):
            return await interaction.response.send_message("âŒ Esse nÃ£o Ã© seu boss!", ephemeral=True)
        if self.answered:
            return
        self.answered = True
        await interaction.response.edit_message(
            content=f"ğŸ“£ **{interaction.user.mention} estÃ¡ convocando aliados para enfrentar o {self.boss_name}!**\n\nUse `juntar boss` para participar desta batalha! (atÃ© 5 jogadores)\n\nO lÃ­der deverÃ¡ usar `iniciar batalha boss` quando estiver pronto.",
            view=None
        )
        # Registra na DB
        conn = sqlite3.connect(DB_FILE)
        c = conn.cursor()
        player = get_player(self.user_id)
        world_level = max([k for k in WORLDS.keys() if k <= player["level"]])
        c.execute("INSERT INTO boss_battles (boss_name, leader_id, members, world_level) VALUES (?, ?, ?, ?)",
                  (self.boss_name, str(self.user_id), json.dumps([str(self.user_id)]), world_level))
        conn.commit()
        conn.close()

    @discord.ui.button(label="Recuar", style=discord.ButtonStyle.gray, emoji="ğŸƒ")
    async def flee(self, interaction: discord.Interaction, button: discord.ui.Button):
        if str(interaction.user.id) != str(self.user_id):
            return await interaction.response.send_message("âŒ Esse nÃ£o Ã© seu boss!", ephemeral=True)
        if self.answered:
            return
        self.answered = True
        await interaction.response.edit_message(
            content=f"ğŸƒ **VocÃª recua estrategicamente.**\n\n*'A prudÃªncia tambÃ©m Ã© sabedoria.'*", view=None
        )


class RevengeTrainingView(discord.ui.View):
    """Mostrado ao jogador apÃ³s derrota em boss de level â€” opÃ§Ãµes de VinganÃ§a ou Treinamento"""
    def __init__(self, user_id, boss_data, timeout=180):
        super().__init__(timeout=timeout)
        self.user_id = user_id
        self.boss_data = boss_data
        self.answered = False

    @discord.ui.button(label="âš”ï¸ VinganÃ§a!", style=discord.ButtonStyle.red, emoji="ğŸ”¥")
    async def revenge(self, interaction: discord.Interaction, button: discord.ui.Button):
        if str(interaction.user.id) != str(self.user_id):
            return await interaction.response.send_message("âŒ Essa escolha nÃ£o Ã© sua!", ephemeral=True)
        if self.answered:
            return
        self.answered = True
        # Store revenge flag and boss for the next fight
        player = get_player(self.user_id)
        effects = player.get("active_effects", {})
        effects["pending_boss"] = self.boss_data
        effects["used_revenge"] = True
        player["active_effects"] = effects
        save_player_db(self.user_id, player)

        # AUTO-CONVOCAR membros da guilda na revanche
        _r_allies = []
        _r_names = []
        if player.get("guild_id"):
            try:
                _rc = sqlite3.connect(DB_FILE)
                _rcc = _rc.cursor()
                _rcc.execute("SELECT members FROM guilds WHERE id = ?", (player["guild_id"],))
                _rrow = _rcc.fetchone()
                _rc.close()
                if _rrow:
                    for _rm in json.loads(_rrow[0]):
                        if str(_rm) != str(self.user_id):
                            _rap = get_player(str(_rm))
                            if _rap and _rap.get("hp", 0) > 0:
                                _r_allies.append(str(_rm))
                                _r_names.append(_rap.get("name", str(_rm)))
            except Exception:
                pass

        # Buscar nomes reais dos aliados via Discord
        _r_names = []
        for _rid in _r_allies:
            try:
                _rau = await bot.fetch_user(int(_rid))
                _r_names.append(_rau.display_name)
            except:
                _r_names.append(str(_rid))

        _r_ally_text = ""
        if _r_names:
            _r_ally_text = f"\n\nğŸ›¡ï¸ **Aliados convocados:** {', '.join(_r_names[:5])}"

        channel = interaction.channel
        await interaction.response.edit_message(
            content=f"ğŸ”¥ **A raiva te toma! VocÃª avanÃ§a novamente contra {self.boss_data['name']}!**{_r_ally_text}\n\n*'O Ã³dio pode ser a maior das forÃ§as!'*",
            view=None
        )
        await asyncio.sleep(2)
        await fight_boss(channel, self.user_id, allies=_r_allies if _r_allies else None)

    @discord.ui.button(label="ğŸ‹ï¸ Treinamento", style=discord.ButtonStyle.green, emoji="ğŸ’ª")
    async def training(self, interaction: discord.Interaction, button: discord.ui.Button):
        if str(interaction.user.id) != str(self.user_id):
            return await interaction.response.send_message("âŒ Essa escolha nÃ£o Ã© sua!", ephemeral=True)
        if self.answered:
            return
        self.answered = True
        player = get_player(self.user_id)
        effects = player.get("active_effects", {})
        effects["pending_boss"] = self.boss_data
        player["active_effects"] = effects
        save_player_db(self.user_id, player)
        embed = discord.Embed(
            title="ğŸ‹ï¸ CENTRO DE TREINAMENTO",
            description=f"*'Um sÃ¡bio anciÃ£o te guia: Seu corpo precisa de mais forÃ§a para enfrentar {self.boss_data['name']}...'*\n\nEscolha o tipo de treino abaixo. ApÃ³s treinar, use `desafiar boss` para renfrentar o boss!",
            color=discord.Color.green()
        )
        for name, data in TRAINING_OPTIONS.items():
            boosts = []
            if data.get("atk_boost"):
                boosts.append(f"+{data['atk_boost']} ATK")
            if data.get("def_boost"):
                boosts.append(f"+{data['def_boost']} DEF")
            if data.get("hp_boost"):
                boosts.append(f"+{data['hp_boost']} HP Max")
            embed.add_field(
                name=f"{data['emoji']} Treino de {name.capitalize()}",
                value=f"**{data['desc']}**\nğŸ’° Custo: `{data['cost']:,}` CSI\nğŸ“ˆ BÃ´nus: {', '.join(boosts)}",
                inline=True
            )
        embed.set_footer(text="Use: treinar forÃ§a | treinar defesa | treinar vitalidade | treinar intensivo")
        view = TrainingView(self.user_id, self.boss_data)
        await interaction.response.edit_message(content=None, embed=embed, view=view)

    @discord.ui.button(label="ğŸƒ Recuar", style=discord.ButtonStyle.gray)
    async def flee(self, interaction: discord.Interaction, button: discord.ui.Button):
        if str(interaction.user.id) != str(self.user_id):
            return await interaction.response.send_message("âŒ Essa escolha nÃ£o Ã© sua!", ephemeral=True)
        if self.answered:
            return
        self.answered = True
        await interaction.response.edit_message(
            content="ğŸƒ *VocÃª recua para recuperar suas forÃ§as. Ã€s vezes, a prudÃªncia Ã© a maior virtude.*",
            view=None
        )


class TrainingView(discord.ui.View):
    """BotÃµes de treinamento apÃ³s derrota em boss"""
    def __init__(self, user_id, boss_data=None, timeout=180):
        super().__init__(timeout=timeout)
        self.user_id = user_id
        self.boss_data = boss_data
        self.answered = False
        for key, data in TRAINING_OPTIONS.items():
            label = f"{data['emoji']} {key.capitalize()} ({data['cost']} CSI)"
            btn = discord.ui.Button(label=label, style=discord.ButtonStyle.primary)
            btn.callback = self._make_callback(key)
            self.add_item(btn)

    def _make_callback(self, training_key):
        async def callback(interaction: discord.Interaction):
            if str(interaction.user.id) != str(self.user_id):
                return await interaction.response.send_message("âŒ Essa escolha nÃ£o Ã© sua!", ephemeral=True)
            if self.answered:
                return
            self.answered = True
            player = get_player(self.user_id)
            opt = TRAINING_OPTIONS[training_key]
            cost = opt["cost"]
            if player["coins"] < cost:
                self.answered = False
                return await interaction.response.send_message(
                    f"âŒ VocÃª nÃ£o tem CSI suficiente! Precisa de `{cost:,}` mas tem `{player['coins']:,}`.", ephemeral=True
                )
            player["coins"] -= cost
            boosts = []
            if opt.get("atk_boost"):
                player["temp_atk_boost"] = player.get("temp_atk_boost", 0) + opt["atk_boost"]
                boosts.append(f"+{opt['atk_boost']} ATK")
            if opt.get("def_boost"):
                player["temp_def_boost"] = player.get("temp_def_boost", 0) + opt["def_boost"]
                boosts.append(f"+{opt['def_boost']} DEF")
            if opt.get("hp_boost"):
                player["temp_hp_boost"] = player.get("temp_hp_boost", 0) + opt["hp_boost"]
                player["max_hp"] = player.get("max_hp", 100) + opt["hp_boost"]
                player["hp"] = min(player["hp"] + opt["hp_boost"], player["max_hp"])
                boosts.append(f"+{opt['hp_boost']} HP Max")

            # Training counter for achievement
            training_count = player.get("training_points", 0) + 1
            player["training_points"] = training_count
            save_player_db(self.user_id, player)

            embed = discord.Embed(
                title=f"ğŸ’ª Treino Completo!",
                description=f"*'O anciÃ£o sorri: VocÃª ficou mais forte!'*\n\n{opt['emoji']} **Treino de {training_key.capitalize()}** concluÃ­do!\n\nğŸ“ˆ **Melhorias:** {', '.join(boosts)}\nğŸ’° **Custo:** âˆ’{cost:,} CSI",
                color=discord.Color.green()
            )
            if self.boss_data:
                embed.set_footer(text=f"Use 'desafiar boss' para enfrentar {self.boss_data['name']} novamente!")

            await interaction.response.edit_message(embed=embed, view=None)
            await check_achievements(interaction.channel, self.user_id, "training_10" if training_count >= 10 else None)
            if training_count >= 10:
                await check_achievements(interaction.channel, self.user_id, "training_10")
        return callback


class TradeButton(discord.ui.View):
    def __init__(self, from_user, to_user, from_items, to_items, timeout=300):
        super().__init__(timeout=timeout)
        self.from_user = from_user
        self.to_user = to_user
        self.from_items = from_items
        self.to_items = to_items
        self.answered = False

    @discord.ui.button(label="Aceitar Troca", style=discord.ButtonStyle.green, emoji="âœ…")
    async def accept(self, interaction: discord.Interaction, button: discord.ui.Button):
        if str(interaction.user.id) != str(self.to_user):
            return await interaction.response.send_message("âŒ Esta troca nÃ£o Ã© para vocÃª!", ephemeral=True)
        if self.answered:
            return
        self.answered = True

        from_player = get_player(self.from_user)
        to_player = get_player(self.to_user)

        def _is_weapon(item_name):
            return any(w["name"].lower() == item_name.lower() for w in ITEMS["weapons"])

        def _is_armor(item_name):
            return any(a["name"].lower() == item_name.lower() for a in ITEMS["armor"])

        def _get_item_name_exact(item_name):
            """Retorna o nome exato do item (case-insensitive) ou None"""
            for w in ITEMS["weapons"]:
                if w["name"].lower() == item_name.strip().lower():
                    return w["name"]
            for a in ITEMS["armor"]:
                if a["name"].lower() == item_name.strip().lower():
                    return a["name"]
            return item_name.strip()

        # Remove itens do from_player (inventÃ¡rio ou slot equipado)
        for item in self.from_items:
            exact = _get_item_name_exact(item)
            if exact in from_player["inventory"]:
                from_player["inventory"].remove(exact)
            elif from_player.get("weapon") and from_player["weapon"].lower() == item.strip().lower():
                from_player["weapon"] = None
            elif from_player.get("armor") and from_player["armor"].lower() == item.strip().lower():
                from_player["armor"] = None

        # Remove itens do to_player (inventÃ¡rio ou slot equipado)
        for item in self.to_items:
            exact = _get_item_name_exact(item)
            if exact in to_player["inventory"]:
                to_player["inventory"].remove(exact)
            elif to_player.get("weapon") and to_player["weapon"].lower() == item.strip().lower():
                to_player["weapon"] = None
            elif to_player.get("armor") and to_player["armor"].lower() == item.strip().lower():
                to_player["armor"] = None

        # Adiciona itens de to_player para from_player (garantindo nome exato)
        for item in self.to_items:
            exact = _get_item_name_exact(item)
            from_player["inventory"].append(exact)

        # Adiciona itens de from_player para to_player (garantindo nome exato)
        for item in self.from_items:
            exact = _get_item_name_exact(item)
            to_player["inventory"].append(exact)

        save_player_db(self.from_user, from_player)
        save_player_db(self.to_user, to_player)

        # Monta resumo da troca com tipo correto
        def _item_type_label(item_name):
            if _is_weapon(item_name): return "âš”ï¸ Arma"
            if _is_armor(item_name): return "ğŸ›¡ï¸ Armadura"
            return "ğŸ’ Item"

        from_labels = ", ".join(f"{_item_type_label(i)} **{_get_item_name_exact(i)}**" for i in self.from_items)
        to_labels = ", ".join(f"{_item_type_label(i)} **{_get_item_name_exact(i)}**" for i in self.to_items)

        await interaction.response.edit_message(
            content=(
                f"âœ… **Troca Realizada!**\n\n"
                f"*'Os itens mudam de mÃ£os...'*\n\n"
                f"ğŸ“¤ VocÃª recebeu: {to_labels}\n"
                f"ğŸ“¥ Outro jogador recebeu: {from_labels}\n\n"
                f"ğŸ’¡ Use `equipar [nome do item]` para equipar armas ou armaduras recebidas!"
            ),
            view=None
        )

    @discord.ui.button(label="Recusar", style=discord.ButtonStyle.red, emoji="âŒ")
    async def decline(self, interaction: discord.Interaction, button: discord.ui.Button):
        if str(interaction.user.id) != str(self.to_user):
            return await interaction.response.send_message("âŒ Esta troca nÃ£o Ã© para vocÃª!", ephemeral=True)
        if self.answered:
            return
        self.answered = True
        await interaction.response.edit_message(content=f"âŒ **Troca Recusada**\n\n*'Talvez em outra ocasiÃ£o...'*", view=None)


# ================= VIEW: NAVEGAÃ‡ÃƒO DOS CAPÃTULOS DO PRÃ“LOGO (< >) =================

# Dados completos de cada capÃ­tulo para o prÃ³logo interativo
PROLOGUE_CHAPTERS = {
    1: {
        "title": "ğŸ“— CapÃ­tulo I â€” Terras Iniciais",
        "color": 0x2ecc40,
        "desc": "*\"Todo herÃ³i comeÃ§a aqui. O guerreiro mais poderoso comeÃ§ou matando um slime.\"*\nâ€” Historiador Pell",
        "chave": "ğŸ—ï¸ Chave Antiga",
        "nivel": "NÃ­vel 1 â€“ 100  â€¢  Reinos 1â€“10",
        "reinos": [
            ("ğŸŒ±", "Campos Iniciais", "nÃ­vel 1â€“9", "PlanÃ­cies abertas. O Slime Rei guarda os primeiros segredos."),
            ("ğŸŒ²", "Floresta Sombria", "nÃ­vel 10â€“19", "A floresta respira e lembra. O Ent AnciÃ£o aguarda."),
            ("ğŸœï¸", "Deserto das Almas", "nÃ­vel 20â€“29", "Calor que consome almas. Uma pirÃ¢mide esconde o FaraÃ³ das Sombras."),
            ("â„ï¸", "Montanhas Geladas", "nÃ­vel 30â€“39", "O frio nÃ£o Ã© inimigo, Ã© teste. O Yeti Colossal ronda os picos."),
            ("ğŸŒ‹", "Reino VulcÃ¢nico", "nÃ­vel 40â€“49", "O fogo transforma. O DragÃ£o de Magma dorme no nÃºcleo."),
            ("ğŸŒŒ", "Abismo Arcano", "nÃ­vel 50â€“59", "Onde toda magia nasce e morre. O Olho do Abismo tudo vÃª."),
            ("ğŸ‘‘", "Trono Celestial", "nÃ­vel 60â€“69", "Quem chegar nÃ£o serÃ¡ mais mortal. O Querubim Corrompido guarda."),
            ("ğŸŒ¿", "PÃ¢ntano das Almas Perdidas", "nÃ­vel 70â€“79", "Almas presas na lama. Templo afundado de Morthak."),
            ("ğŸ’", "Floresta Cristalina", "nÃ­vel 80â€“89", "Cristais que refletem versÃµes suas que nÃ£o sobreviveram."),
            ("ğŸŒ‘", "Sombras Eternas", "nÃ­vel 90â€“99", "EscuridÃ£o que sabe seu nome. O Rei das Sombras espera."),
        ]
    },
    2: {
        "title": "ğŸ“˜ CapÃ­tulo II â€” NaÃ§Ãµes IntermediÃ¡rias",
        "color": 0x2980B9,
        "desc": "*\"As naÃ§Ãµes crescem, os inimigos ficam mais astutos. O mundo revela seus segredos.\"*",
        "chave": "ğŸ”‘ Chave Arcana",
        "nivel": "NÃ­vel 101 â€“ 200  â€¢  Reinos 11â€“20",
        "reinos": [
            ("âš¡", "PlanÃ­cies do TrovÃ£o", "nÃ­vel 100â€“109", "RelÃ¢mpagos que sÃ£o criaturas vivas. Zeus Menor troveja."),
            ("ğŸ—¿", "Terra dos Gigantes", "nÃ­vel 110â€“119", "Montanhas que sÃ£o costas de gigantes dormindo."),
            ("ğŸŒŠ", "Mar das Almas", "nÃ­vel 120â€“129", "Um oceano onde o tempo nÃ£o flui normalmente."),
            ("ğŸŒ€", "Reino do Caos", "nÃ­vel 130â€“139", "A realidade como inimigo. O Caos em Pessoa reina."),
            ("ğŸŒ¸", "Jardim dos Deuses", "nÃ­vel 140â€“149", "Um paraÃ­so onde cada flor Ã© uma armadilha divina."),
            ("ğŸ§Š", "Reino do Gelo Eterno", "nÃ­vel 150â€“159", "Frio que antecede o prÃ³prio universo."),
            ("ğŸ›ï¸", "RuÃ­nas da CivilizaÃ§Ã£o Perdida", "nÃ­vel 160â€“169", "AutÃ´matos de uma civilizaÃ§Ã£o que precedeu os deuses."),
            ("âœ¨", "Plano Astral", "nÃ­vel 170â€“179", "O cosmos consciente. A linguagem nÃ£o alcanÃ§a tudo."),
            ("ğŸŒŒ", "AlÃ©m da ExistÃªncia", "nÃ­vel 180â€“189", "Onde o conceito de existir se torna opcional."),
            ("â­", "O Trono Primordial", "nÃ­vel 190â€“199", "O Criador Primordial espera aqui desde sempre."),
        ]
    },
    3: {
        "title": "ğŸ“™ CapÃ­tulo III â€” ImpÃ©rios AvanÃ§ados",
        "color": 0x8E44AD,
        "desc": "*\"O mortal deixa de ser mortal. ImpÃ©rios que dobram a realidade ao redor.\"*",
        "chave": "ğŸ—¡ï¸ Chave Sombria",
        "nivel": "NÃ­vel 201 â€“ 300  â€¢  Reinos 21â€“30",
        "reinos": [
            ("ğŸ”±", "Reinos Mortais â€” Ãpice", "nÃ­vel 200â€“209", "O topo da mortalidade. Um Ãºltimo boss antes do transcendente."),
            ("âš¡", "Reinos AvanÃ§ados â€” Despertar", "nÃ­vel 210â€“219", "O despertar alÃ©m do plano mortal."),
            ("ğŸŒ€", "VÃ³rtice dos Reinos", "nÃ­vel 220â€“229", "DimensÃµes se entrelaÃ§am. FÃ­sica Ã© diferente aqui."),
            ("ğŸ”ï¸", "Montanhas do AlÃ©m", "nÃ­vel 230â€“239", "Picos que tocam outras dimensÃµes."),
            ("ğŸŒŠ", "Oceano Dimensional", "nÃ­vel 240â€“249", "Um mar que conecta planos de existÃªncia."),
            ("ğŸ”¥", "Forjas do Caos", "nÃ­vel 250â€“259", "Onde os melhores itens do mundo sÃ£o criados â€” e destruÃ­dos."),
            ("â„ï¸", "Tundra Absoluta", "nÃ­vel 260â€“269", "Frio absoluto onde nem a magia funciona normalmente."),
            ("âš—ï¸", "Alquimia das Eras", "nÃ­vel 270â€“279", "O conhecimento de mil civilizaÃ§Ãµes condensado aqui."),
            ("ğŸŒŒ", "GalÃ¡xia Interior", "nÃ­vel 280â€“289", "Uma galÃ¡xia inteira dentro de um Ãºnico plano."),
            ("âš–ï¸", "Tribunal do Cosmo", "nÃ­vel 290â€“299", "Onde almas sÃ£o julgadas antes de avanÃ§ar."),
        ]
    },
    4: {
        "title": "ğŸ“• CapÃ­tulo IV â€” Terras Corrompidas",
        "color": 0x922B21,
        "desc": "*\"A corrupÃ§Ã£o nÃ£o Ã© inimiga â€” Ã© apenas outra forma de poder.\"*\nâš ï¸ Efeito ambiental: **dano contÃ­nuo e debuffs** em todas as Ã¡reas.",
        "chave": "ğŸ—¡ï¸ Chave Sombria",
        "nivel": "NÃ­vel 301 â€“ 350  â€¢  Reinos 31â€“35",
        "reinos": [
            ("ğŸ—¡ï¸", "Arena dos Deuses Menores", "nÃ­vel 300â€“309", "Deuses menores se combatem eternamente. VocÃª entra no meio."),
            ("ğŸ‘ï¸", "O Olho do Multiverso", "nÃ­vel 310â€“319", "Uma entidade que observa todas as realidades simultaneamente."),
            ("ğŸ”®", "Plano Astral Inferior", "nÃ­vel 320â€“329", "A versÃ£o corrompida do Plano Astral. Mais perigosa."),
            ("ğŸ’", "Fortaleza de Cristal", "nÃ­vel 330â€“339", "Cristais corrompidos que amplificam e distorcem poderes."),
            ("ğŸŒ‘", "Lua Negra", "nÃ­vel 340â€“349", "A lua que existia antes do sol. CorrupÃ§Ã£o pura cristalizada."),
        ]
    },
    5: {
        "title": "ğŸ“’ CapÃ­tulo V â€” Reinos Dimensionais",
        "color": 0x6C3483,
        "desc": "*\"O portal se abre. O que hÃ¡ alÃ©m nÃ£o Ã© um reino â€” Ã© uma realidade inteira.\"*\nğŸ’¥ Bosses Dimensionais liberam **passivas globais** e **slots extras** de pet/equip!",
        "chave": "âœ¨ Chave Celestial",
        "nivel": "NÃ­vel 351 â€“ 400  â€¢  Reinos 36â€“40",
        "reinos": [
            ("â˜„ï¸", "CemitÃ©rio de Estrelas", "nÃ­vel 350â€“359", "Estrelas mortas que ainda guardam poder imenso."),
            ("ğŸŒ", "CoraÃ§Ã£o Solar", "nÃ­vel 360â€“369", "O nÃºcleo de uma estrela viva â€” calor alÃ©m da compreensÃ£o."),
            ("ğŸ•³ï¸", "Buraco Negro Vivo", "nÃ­vel 370â€“379", "Um buraco negro consciente que devora tudo ao redor."),
            ("ğŸŒ", "Nexo das DimensÃµes", "nÃ­vel 380â€“389", "O ponto onde todas as dimensÃµes se encontram."),
            ("âš¡", "Tempestade Interdimensional", "nÃ­vel 390â€“399", "Uma tempestade que existe entre dimensÃµes ao mesmo tempo."),
        ]
    },
    6: {
        "title": "ğŸŒŒ CapÃ­tulo VI â€” As Cinco DimensÃµes",
        "color": 0xF39C12,
        "desc": "*\"O mapa se rasga. O que hÃ¡ alÃ©m nÃ£o Ã© um reino â€” Ã© uma realidade inteira...\"*\n*\"Transcendeste tudo. Agora as DimensÃµes Verdadeiras te aguardam.\"*",
        "chave": "âœ¨ Chave Celestial  (Celestial)  â€¢  ğŸŒ‘ Chave Abissal  (demais)",
        "nivel": "NÃ­vel 401 â€“ 500  â€¢  AlÃ©m dos reinos",
        "reinos": [
            ("ğŸ•Šï¸", "DimensÃ£o Celestial", "nÃ­vel 400â€“419",
             "Efeito: **buff sagrado** â€” +15% a todos os stats.\n"
             "O CÃ©u feito de cristal eterno. NPCs Transcendentais concedem bÃªnÃ§Ã£os divinas.\n"
             "Dungeons sagradas e o Boss Celestial guardam segredos da CriaÃ§Ã£o."),
            ("ğŸ”¥", "DimensÃ£o Infernal", "nÃ­vel 420â€“439",
             "Efeito: **dano de fogo contÃ­nuo** â€” âˆ’5 HP por turno.\n"
             "O Inferno como nunca foi descrito. Criaturas do abismo que existem antes da morte.\n"
             "Drops mÃ­ticos abundam â€” se vocÃª sobreviver."),
            ("ğŸŒªï¸", "DimensÃ£o das Badlands", "nÃ­vel 440â€“459",
             "Efeito: **caos puro** â€” eventos aleatÃ³rios a cada exploraÃ§Ã£o.\n"
             "Terra devastada onde as leis da fÃ­sica sÃ£o sugestÃµes. Nada Ã© como parece.\n"
             "Dungeons secretas que aparecem e desaparecem."),
            ("ğŸŒ‘", "DimensÃ£o Abissal", "nÃ­vel 460â€“479",
             "Efeito: **debuff de sanidade** â€” habilidades tÃªm chance de falhar.\n"
             "Horrores primordiais que existem antes da linguagem. O Abissal nÃ£o tem forma.\n"
             "NPCs Transcendentais que falam em riddles e concedem poderes proibidos."),
            ("ğŸŒ€", "DimensÃ£o do Vazio", "nÃ­vel 480â€“499",
             "Efeito: **distorÃ§Ã£o da realidade** â€” stats alterados aleatoriamente.\n"
             "O nada que tem consciÃªncia. O Senhor do Vazio Ã© a Ãºltima entidade antes do Absoluto.\n"
             "A dungeon secreta mais lendÃ¡ria do jogo estÃ¡ aqui â€” trancada pela **Chave Abissal**."),
        ]
    },
    7: {
        "title": "â™¾ï¸ CapÃ­tulo VII â€” Planos Absolutos",
        "color": 0xE74C3C,
        "desc": "*\"AlÃ©m daqui nÃ£o hÃ¡ mais nomes. HÃ¡ apenas... o Absoluto.\"*\nRaridades exclusivas: ğŸ’ Divino â€¢ ğŸŒˆ Primordial â€¢ âœ´ï¸ Absoluto",
        "chave": "ğŸŒ‘ Chave Abissal",
        "nivel": "NÃ­vel 501 â€“ 600  â€¢  O fim da jornada",
        "reinos": [
            ("ğŸ”±", "Trono dos Reinos AvanÃ§ados", "nÃ­vel 390â€“399", "O Ãºltimo trono antes das dimensÃµes."),
            ("ğŸŒ ", "DimensÃµes Superiores â€” Entrada", "nÃ­vel 400â€“409", "O portal de entrada para o alÃ©m absoluto."),
            ("ğŸ’«", "Nebulosa da ConsciÃªncia", "nÃ­vel 410â€“419", "Uma nebulosa que pensa e sente."),
            ("ğŸŒ€", "VÃ³rtice Dimensional Supremo", "nÃ­vel 420â€“429", "O vÃ³rtice que gerou todas as dimensÃµes."),
            ("ğŸ›ï¸", "Templo dos Deuses Maiores", "nÃ­vel 430â€“439", "Onde os deuses maiores residem â€” e morrem."),
            ("â­", "Estrela Primordial Viva", "nÃ­vel 440â€“449", "A primeira estrela que existiu. Ainda viva."),
            ("ğŸŒŒ", "Abismo CÃ³smico", "nÃ­vel 450â€“459", "O abismo que circunda toda a criaÃ§Ã£o."),
            ("âš¡", "Plasma da CriaÃ§Ã£o", "nÃ­vel 460â€“469", "A energia pura usada para criar o universo."),
            ("ğŸ”±", "Olimpo Transcendente", "nÃ­vel 470â€“479", "O Olimpo real, nÃ£o a cÃ³pia mortal."),
            ("ğŸ’", "Cristal do Universo", "nÃ­vel 480â€“489", "O cristal que sustenta toda a realidade."),
            ("ğŸŒ ", "Ãpice das DimensÃµes Superiores", "nÃ­vel 490â€“499", "O topo de tudo que existe alÃ©m do mortal."),
            ("â™¾ï¸", "Planos Absolutos â€” Limiar", "nÃ­vel 500â€“509", "A fronteira entre o transcendente e o absoluto."),
            ("ğŸŒ‘", "Trevas Absolutas", "nÃ­vel 510â€“519", "EscuridÃ£o que devora atÃ© a luz absoluta."),
            ("ğŸŒŸ", "Luz Absoluta", "nÃ­vel 520â€“529", "Brilho que cega eternamente â€” atÃ© os deuses."),
            ("âš–ï¸", "EquilÃ­brio Primordial", "nÃ­vel 530â€“539", "A balanÃ§a que mantÃ©m tudo existindo."),
            ("ğŸ”¥", "Chama Eterna", "nÃ­vel 540â€“549", "A chama que criou o universo ainda arde."),
            ("ğŸŒŠ", "Oceano Primordial", "nÃ­vel 550â€“559", "O oceano que precedeu toda a criaÃ§Ã£o."),
            ("ğŸ’¨", "Vento do Fim dos Tempos", "nÃ­vel 560â€“569", "O sopro que encerrarÃ¡ tudo, um dia."),
            ("âš¡", "TrovÃ£o da Origem", "nÃ­vel 570â€“579", "O primeiro trovÃ£o que ecoou no vazio."),
            ("ğŸŒŒ", "Vazio AlÃ©m do Vazio", "nÃ­vel 580â€“589", "O nada alÃ©m do nada. Sem palavras suficientes."),
            ("â™¾ï¸", "O Plano Absoluto Final", "nÃ­vel 590â€“599", "O fim e o comeÃ§o de tudo. NÃ­vel 600 aguarda."),
        ]
    },
}


def build_prologue_chapter_embed(chapter: int) -> tuple:
    """ConstrÃ³i embed + view para um capÃ­tulo do prÃ³logo."""
    data = PROLOGUE_CHAPTERS.get(chapter)
    if not data:
        return None, None

    total = len(PROLOGUE_CHAPTERS)
    embed = discord.Embed(
        title=data["title"],
        description=f"*{data['nivel']}*\n\n{data['desc']}",
        color=data["color"]
    )

    # Para cap VI (dimensÃµes) cada reino tem descriÃ§Ã£o longa â†’ mostra um por field
    # Para demais capÃ­tulos â†’ lista compacta
    if chapter == 6:
        for emoji, nome, nivel, desc in data["reinos"]:
            embed.add_field(
                name=f"{emoji} {nome}  Â·  {nivel}",
                value=desc,
                inline=False
            )
    else:
        lines = []
        for emoji, nome, nivel, desc in data["reinos"]:
            lines.append(f"{emoji} **{nome}** Â· *{nivel}*\n{desc}")
        # Split into 2 fields to avoid hitting 1024 char limit
        mid = len(lines) // 2
        if lines[:mid]:
            embed.add_field(name="âš”ï¸ Reinos", value="\n\n".join(lines[:mid]), inline=False)
        if lines[mid:]:
            embed.add_field(name="â€‹", value="\n\n".join(lines[mid:]), inline=False)

    embed.add_field(name="ğŸ—ï¸ Chave das Dungeons Secretas", value=data["chave"], inline=False)
    embed.set_footer(text=f"CapÃ­tulo {chapter}/{total}  â€¢  Use os botÃµes â—€ â–¶ para navegar entre capÃ­tulos")

    view = PrologueChapterView(chapter, total)
    return embed, view


class PrologueChapterView(discord.ui.View):
    def __init__(self, chapter: int, total: int = 7):
        super().__init__(timeout=300)
        self.chapter = chapter
        self.total = total

        prev_btn = discord.ui.Button(
            label="â—€",
            style=discord.ButtonStyle.secondary,
            disabled=(chapter <= 1),
            custom_id="prologue_prev"
        )
        prev_btn.callback = self._prev
        self.add_item(prev_btn)

        page_btn = discord.ui.Button(
            label=f"Cap. {chapter} / {total}",
            style=discord.ButtonStyle.primary,
            disabled=True,
            custom_id="prologue_page"
        )
        self.add_item(page_btn)

        next_btn = discord.ui.Button(
            label="â–¶",
            style=discord.ButtonStyle.secondary,
            disabled=(chapter >= total),
            custom_id="prologue_next"
        )
        next_btn.callback = self._next
        self.add_item(next_btn)

    async def _prev(self, interaction: discord.Interaction):
        embed, view = build_prologue_chapter_embed(self.chapter - 1)
        if embed:
            await interaction.response.edit_message(embed=embed, view=view)

    async def _next(self, interaction: discord.Interaction):
        embed, view = build_prologue_chapter_embed(self.chapter + 1)
        if embed:
            await interaction.response.edit_message(embed=embed, view=view)


# ================= VIEW: NAVEGAÃ‡ÃƒO DO MAPA (< >) =================
class MapNavView(discord.ui.View):
    def __init__(self, user_id, page: int, total_pages: int = 6):
        super().__init__(timeout=120)
        self.user_id = user_id
        self.page = page
        self.total_pages = total_pages

        # BotÃ£o anterior
        prev_btn = discord.ui.Button(
            label="â—€",
            style=discord.ButtonStyle.secondary,
            disabled=(page <= 1),
            custom_id="map_prev"
        )
        prev_btn.callback = self._prev
        self.add_item(prev_btn)

        # Indicador de pÃ¡gina (botÃ£o desativado sÃ³ para mostrar)
        page_btn = discord.ui.Button(
            label=f"CapÃ­tulo {page}/{total_pages}",
            style=discord.ButtonStyle.primary,
            disabled=True,
            custom_id="map_page"
        )
        self.add_item(page_btn)

        # BotÃ£o prÃ³ximo
        next_btn = discord.ui.Button(
            label="â–¶",
            style=discord.ButtonStyle.secondary,
            disabled=(page >= total_pages),
            custom_id="map_next"
        )
        next_btn.callback = self._next
        self.add_item(next_btn)

    async def _prev(self, interaction: discord.Interaction):
        if str(interaction.user.id) != str(self.user_id):
            return await interaction.response.send_message("âŒ Este mapa nÃ£o Ã© seu!", ephemeral=True)
        player = get_player(str(interaction.user.id))
        if not player:
            return await interaction.response.send_message("âŒ Personagem nÃ£o encontrado.", ephemeral=True)
        new_page = self.page - 1
        embed, view = build_map_embed(player, new_page)
        await interaction.response.edit_message(embed=embed, view=view)

    async def _next(self, interaction: discord.Interaction):
        if str(interaction.user.id) != str(self.user_id):
            return await interaction.response.send_message("âŒ Este mapa nÃ£o Ã© seu!", ephemeral=True)
        player = get_player(str(interaction.user.id))
        if not player:
            return await interaction.response.send_message("âŒ Personagem nÃ£o encontrado.", ephemeral=True)
        new_page = self.page + 1
        embed, view = build_map_embed(player, new_page)
        await interaction.response.edit_message(embed=embed, view=view)


# Dados dos capÃ­tulos do mapa â€” nomes e emojis de cada reino/dimensÃ£o por capÃ­tulo
MAP_CHAPTER_KINGDOMS = {
    1: {
        "title": "ğŸ“– CapÃ­tulo I â€” Terras Iniciais",
        "subtitle": "NÃ­vel 1â€“100  â€¢  Reinos 1â€“10",
        "color": 0x3498DB,
        "chave": "ğŸ—ï¸ Chave Antiga",
        "reinos": [
            (1,   "ğŸŒ±", "Campos Iniciais"),
            (10,  "ğŸŒ²", "Floresta Sombria"),
            (20,  "ğŸœï¸", "Deserto das Almas"),
            (30,  "â„ï¸", "Montanhas Geladas"),
            (40,  "ğŸŒ‹", "Reino VulcÃ¢nico"),
            (50,  "ğŸŒŒ", "Abismo Arcano"),
            (60,  "ğŸ‘‘", "Trono Celestial"),
            (62,  "ğŸŒ¿", "PÃ¢ntano das Almas Perdidas"),
            (70,  "ğŸ’", "Floresta Cristalina"),
            (80,  "ğŸŒ‘", "Sombras Eternas"),
        ]
    },
    2: {
        "title": "ğŸ“– CapÃ­tulo II â€” NaÃ§Ãµes IntermediÃ¡rias",
        "subtitle": "NÃ­vel 101â€“200  â€¢  Reinos 11â€“20",
        "color": 0x2980B9,
        "chave": "ğŸ”‘ Chave Arcana",
        "reinos": [
            (90,  "âš¡", "PlanÃ­cies do TrovÃ£o"),
            (100, "ğŸ—¿", "Terra dos Gigantes"),
            (110, "ğŸŒŠ", "Mar das Almas"),
            (120, "ğŸŒ€", "Reino do Caos"),
            (130, "ğŸŒ¸", "Jardim dos Deuses"),
            (140, "ğŸ§Š", "Reino do Gelo Eterno"),
            (150, "ğŸ›ï¸", "RuÃ­nas da CivilizaÃ§Ã£o Perdida"),
            (160, "âœ¨", "Plano Astral"),
            (170, "ğŸŒŒ", "AlÃ©m da ExistÃªncia"),
            (180, "â­", "O Trono Primordial"),
        ]
    },
    3: {
        "title": "ğŸ“– CapÃ­tulo III â€” ImpÃ©rios AvanÃ§ados",
        "subtitle": "NÃ­vel 201â€“300  â€¢  Reinos 21â€“30",
        "color": 0x8E44AD,
        "chave": "ğŸ—¡ï¸ Chave Sombria",
        "reinos": [
            (190, "ğŸ”±", "Reinos Mortais â€” Ãpice"),
            (200, "âš¡", "Reinos AvanÃ§ados â€” Despertar"),
            (210, "ğŸŒ€", "VÃ³rtice dos Reinos"),
            (220, "ğŸ”ï¸", "Montanhas do AlÃ©m"),
            (230, "ğŸŒŠ", "Oceano Dimensional"),
            (240, "ğŸ”¥", "Forjas do Caos"),
            (250, "â„ï¸", "Tundra Absoluta"),
            (260, "âš—ï¸", "Alquimia das Eras"),
            (270, "ğŸŒŒ", "GalÃ¡xia Interior"),
            (280, "âš–ï¸", "Tribunal do Cosmo"),
        ]
    },
    4: {
        "title": "ğŸ“– CapÃ­tulos IV & V â€” Corrompidos e Dimensionais",
        "subtitle": "NÃ­vel 301â€“400  â€¢  Reinos 31â€“40",
        "color": 0x6C3483,
        "chave": "ğŸ—¡ï¸ Chave Sombria / âœ¨ Chave Celestial",
        "reinos": [
            (290, "ğŸ—¡ï¸", "Arena dos Deuses Menores"),
            (300, "ğŸ‘ï¸", "O Olho do Multiverso"),
            (310, "ğŸ”®", "Plano Astral Inferior"),
            (320, "ğŸ’", "Fortaleza de Cristal"),
            (330, "ğŸŒ‘", "Lua Negra"),
            (None, "â”€â”€â”€â”€â”€", "â”€â”€ Reinos Dimensionais â”€â”€"),
            (340, "â˜„ï¸", "CemitÃ©rio de Estrelas"),
            (350, "ğŸŒ", "CoraÃ§Ã£o Solar"),
            (360, "ğŸ•³ï¸", "Buraco Negro Vivo"),
            (370, "ğŸŒ", "Nexo das DimensÃµes"),
            (380, "âš¡", "Tempestade Interdimensional"),
        ],
        "extra": "ğŸ’¥ Bosses Dimensionais liberam passivas globais e slots extras!"
    },
    5: {
        "title": "ğŸ“– CapÃ­tulo VI â€” As Cinco DimensÃµes",
        "subtitle": "NÃ­vel 401â€“500  â€¢  AlÃ©m dos reinos",
        "color": 0xF39C12,
        "chave": "ğŸŒ‘ Chave Abissal",
        "reinos": [
            (None, "ğŸ•Šï¸", "DimensÃ£o Celestial  â€¢  buff sagrado passivo"),
            (None, "ğŸ”¥", "DimensÃ£o Infernal  â€¢  dano contÃ­nuo"),
            (None, "ğŸŒªï¸", "DimensÃ£o das Badlands  â€¢  caos aleatÃ³rio"),
            (None, "ğŸŒ‘", "DimensÃ£o Abissal  â€¢  debuff de sanidade"),
            (None, "ğŸŒ€", "DimensÃ£o do Vazio  â€¢  distorÃ§Ã£o da realidade"),
        ]
    },
    6: {
        "title": "ğŸ“– CapÃ­tulo VII â€” Planos Absolutos",
        "subtitle": "NÃ­vel 501â€“600  â€¢  O fim e o comeÃ§o",
        "color": 0xE74C3C,
        "chave": "ğŸŒ‘ Chave Abissal",
        "reinos": [
            (390, "ğŸ”±", "Trono dos Reinos AvanÃ§ados"),
            (400, "ğŸŒ ", "DimensÃµes Superiores â€” Entrada"),
            (410, "ğŸ’«", "Nebulosa da ConsciÃªncia"),
            (420, "ğŸŒ€", "VÃ³rtice Dimensional Supremo"),
            (430, "ğŸ›ï¸", "Templo dos Deuses Maiores"),
            (440, "â­", "Estrela Primordial Viva"),
            (450, "ğŸŒŒ", "Abismo CÃ³smico"),
            (460, "âš¡", "Plasma da CriaÃ§Ã£o"),
            (470, "ğŸ”±", "Olimpo Transcendente"),
            (480, "ğŸ’", "Cristal do Universo"),
            (490, "ğŸŒ ", "Ãpice das DimensÃµes Superiores"),
            (500, "â™¾ï¸", "Planos Absolutos â€” Limiar"),
            (510, "ğŸŒ‘", "Trevas Absolutas"),
            (520, "ğŸŒŸ", "Luz Absoluta"),
            (530, "âš–ï¸", "EquilÃ­brio Primordial"),
            (540, "ğŸ”¥", "Chama Eterna"),
            (550, "ğŸŒŠ", "Oceano Primordial"),
            (560, "ğŸ’¨", "Vento do Fim dos Tempos"),
            (570, "âš¡", "TrovÃ£o da Origem"),
            (580, "ğŸŒŒ", "Vazio AlÃ©m do Vazio"),
            (590, "â™¾ï¸", "O Plano Absoluto Final"),
        ]
    },
}


def build_map_embed(player, page: int):
    """ConstrÃ³i o embed do mapa para uma pÃ¡gina/capÃ­tulo especÃ­fico."""
    chap = MAP_CHAPTER_KINGDOMS.get(page)
    page_data = MAP_PAGES.get(page)
    if not chap or not page_data:
        return None, None

    unlocked_worlds = set(player.get("worlds", [1]))
    current_world = max(unlocked_worlds)
    rng_min, rng_max = page_data["range"]

    # Verifica se o capÃ­tulo estÃ¡ desbloqueado
    chapter_unlocked = any(
        (w_id is not None and w_id >= rng_min and w_id <= rng_max)
        for w_id, _, _ in chap["reinos"]
        if w_id in unlocked_worlds
    ) or (page == 1)  # capÃ­tulo 1 sempre visÃ­vel

    color = chap["color"]
    embed = discord.Embed(
        title=chap["title"],
        description=f"*{chap['subtitle']}*",
        color=color
    )

    if not chapter_unlocked and page > 1:
        lock_msg = MAP_CYCLE_LOCK_MSG.get(page, "ğŸ”’ SeÃ§Ã£o bloqueada.")
        embed.add_field(name="ğŸ”’ Bloqueado", value=lock_msg, inline=False)
    else:
        lines = []
        for entry in chap["reinos"]:
            w_id, emoji, name = entry
            if w_id is None:
                # Separador ou dimensÃ£o (sem mundo associado)
                lines.append(f"â•Œâ•Œ *{name}* â•Œâ•Œ" if "â”€â”€" in name else f"{emoji} **{name}**")
                continue
            if w_id in unlocked_worlds:
                marker = " **â† aqui**" if w_id == current_world else ""
                lines.append(f"{emoji} **{name}**{marker}")
            elif w_id <= current_world + 20:
                lines.append(f"ğŸ”’ ~~{name}~~")
            # reinos muito distantes nÃ£o aparecem

        if lines:
            embed.add_field(
                name="ğŸ—ºï¸ Reinos",
                value="\n".join(lines),
                inline=False
            )

        # Chave da dungeon secreta
        embed.add_field(name="ğŸ—ï¸ Chave", value=chap["chave"], inline=True)

        # Extra (ex: bosses dimensionais)
        if chap.get("extra"):
            embed.add_field(name="âš¡ Destaque", value=chap["extra"], inline=False)

    embed.set_footer(text=f"Use â—€ â–¶ para navegar â€¢ `viajar <nome>` para se deslocar â€¢ CapÃ­tulo {page}/6")
    view = MapNavView(str(player.get("user_id", "0")), page)
    return embed, view


class ShopButton(discord.ui.View):
    def __init__(self, user_id, items, timeout=120):
        super().__init__(timeout=timeout)
        self.user_id = user_id
        self.items = items

    @discord.ui.button(label="Comprar Item 1", style=discord.ButtonStyle.green, emoji="ğŸ’°")
    async def buy1(self, interaction: discord.Interaction, button: discord.ui.Button):
        await self.buy_item(interaction, 0)

    @discord.ui.button(label="Comprar Item 2", style=discord.ButtonStyle.green, emoji="ğŸ’°")
    async def buy2(self, interaction: discord.Interaction, button: discord.ui.Button):
        await self.buy_item(interaction, 1)

    @discord.ui.button(label="Comprar Item 3", style=discord.ButtonStyle.green, emoji="ğŸ’°")
    async def buy3(self, interaction: discord.Interaction, button: discord.ui.Button):
        await self.buy_item(interaction, 2)

    @discord.ui.button(label="Sair", style=discord.ButtonStyle.gray, emoji="ğŸšª")
    async def leave(self, interaction: discord.Interaction, button: discord.ui.Button):
        await interaction.response.edit_message(content="ğŸšª **VocÃª sai da loja.**\n\n*'AtÃ© a prÃ³xima, viajante...'*", view=None)

    async def buy_item(self, interaction, index):
        if index >= len(self.items):
            return await interaction.response.send_message("âŒ Item invÃ¡lido!", ephemeral=True)
        item = self.items[index]
        player = get_player(interaction.user.id)

        if player["coins"] < item["price"]:
            return await interaction.response.send_message(
                f"âŒ **Moedas insuficientes!**\n\nVocÃª precisa de **{item['price']} CSI** mas tem apenas **{player['coins']} CSI**.",
                ephemeral=True
            )

        remove_coins(interaction.user.id, item["price"])
        if item["type"] in ["weapon", "armor"]:
            player = get_player(interaction.user.id)
            player["inventory"].append(item["name"])
            save_player_db(interaction.user.id, player)
        elif item["type"] == "potion":
            player = get_player(interaction.user.id)
            player["inventory"].append(item["name"])
            save_player_db(interaction.user.id, player)

        await interaction.response.send_message(
            f"âœ… **Compra realizada!**\n\nVocÃª comprou **{item['name']}** por **{item['price']} CSI**!\n\n*'Uma boa escolha!'*",
            ephemeral=True
        )


class DungeonSelectButton(discord.ui.View):
    def __init__(self, user_id, dungeons, world, timeout=120):
        super().__init__(timeout=timeout)
        self.user_id = user_id
        self.dungeons = dungeons
        self.world = world
        self.answered = False

        for i, dungeon in enumerate(dungeons[:3]):
            button = discord.ui.Button(
                label=dungeon["name"], style=discord.ButtonStyle.primary,
                emoji="ğŸ›ï¸", custom_id=f"dungeon_{i}"
            )
            button.callback = self.create_callback(i)
            self.add_item(button)

    def create_callback(self, index):
        async def callback(interaction: discord.Interaction):
            if str(interaction.user.id) != str(self.user_id):
                return await interaction.response.send_message("âŒ Esta dungeon nÃ£o Ã© para vocÃª!", ephemeral=True)
            if self.answered:
                return
            dungeon = self.dungeons[index]
            is_secret = dungeon.get("secret", False)
            is_locked = dungeon.get("locked", False)

            # â”€â”€â”€ VerificaÃ§Ã£o de chave para dungeon secreta â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
            if is_secret and is_locked:
                key_name = dungeon.get("key_name", "")
                return await interaction.response.send_message(
                    f"ğŸ”’ **Dungeon Bloqueada!**\n\n"
                    f"VocÃª descobriu **{dungeon['name']}** mas nÃ£o possui a chave.\n"
                    f"NecessÃ¡rio: **{key_name}**\n"
                    f"*Explore dungeons comuns desta regiÃ£o para encontrar a chave em baÃºs!*",
                    ephemeral=True
                )
            if is_secret and not is_locked:
                key_name = dungeon.get("key_name", "")
                if key_name:
                    player = get_player(self.user_id)
                    if not player_has_key(player, key_name):
                        return await interaction.response.send_message(
                            f"ğŸ”’ **Dungeon Secreta Bloqueada!**\n\nNecessÃ¡rio: **{key_name}**\n"
                            f"*Explore dungeons comuns desta regiÃ£o para encontrar a chave em baÃºs!*",
                            ephemeral=True
                        )
                    # Consome a chave ao entrar
                    consume_key(player, key_name)
                    save_player_db(self.user_id, player)

            self.answered = True
            if is_secret:
                await interaction.response.edit_message(
                    content=f"ğŸ”® **ENTRANDO NA DUNGEON SECRETA: {dungeon['name']}!**\n\n*'A chave brilha e a porta se abre... Que os deuses te protejam!'*",
                    view=None
                )
            else:
                await interaction.response.edit_message(
                    content=f"ğŸ›ï¸ **VocÃª entra na {dungeon['name']}!**\n\n*'Que a sorte esteja com vocÃª...'*",
                    view=None
                )
            await asyncio.sleep(2)
            await explore_dungeon(interaction.channel, self.user_id, dungeon, self.world)
        return callback


class QuestAcceptButton(discord.ui.View):
    def __init__(self, user_id, quest, timeout=120):
        super().__init__(timeout=timeout)
        self.user_id = user_id
        self.quest = quest
        self.answered = False

    @discord.ui.button(label="Aceitar Quest", style=discord.ButtonStyle.green, emoji="âœ…")
    async def accept(self, interaction: discord.Interaction, button: discord.ui.Button):
        if str(interaction.user.id) != str(self.user_id):
            return await interaction.response.send_message("âŒ Esta quest nÃ£o Ã© para vocÃª!", ephemeral=True)
        if self.answered:
            return
        self.answered = True
        player = get_player(self.user_id)

        if player.get("active_quest"):
            return await interaction.response.edit_message(
                content="âŒ VocÃª jÃ¡ tem uma quest ativa! Abandone-a primeiro com `abandonar quest`.", view=None
            )
        if self.quest["id"] in player.get("completed_quests", []):
            return await interaction.response.edit_message(
                content="âŒ VocÃª jÃ¡ completou esta quest!", view=None
            )

        quest_data = dict(self.quest)
        quest_data["progress"] = 0
        quest_data["started_at"] = datetime.now().isoformat()
        player["active_quest"] = quest_data
        save_player_db(self.user_id, player)

        embed = discord.Embed(
            title=f"ğŸ“œ Quest Aceita: {self.quest['name']}",
            description=f"*{self.quest['npc']} sorri e diz:*\n\n*'{self.quest['lore']}'*",
            color=discord.Color.gold()
        )
        embed.add_field(name="ğŸ¯ Objetivo", value=self.quest["description"], inline=False)
        embed.add_field(name="â­ Recompensa XP", value=str(self.quest["reward_xp"]), inline=True)
        embed.add_field(name="ğŸ’° Recompensa Coins", value=str(self.quest["reward_coins"]), inline=True)
        if self.quest.get("reward_item"):
            embed.add_field(name="ğŸ Item Recompensa", value=self.quest["reward_item"], inline=True)

        await interaction.response.edit_message(embed=embed, view=None)

    @discord.ui.button(label="Recusar", style=discord.ButtonStyle.gray, emoji="âŒ")
    async def decline(self, interaction: discord.Interaction, button: discord.ui.Button):
        if str(interaction.user.id) != str(self.user_id):
            return await interaction.response.send_message("âŒ NÃ£o Ã© para vocÃª!", ephemeral=True)
        if self.answered:
            return
        self.answered = True
        await interaction.response.edit_message(content="*VocÃª declina a quest e segue em frente.*", view=None)


class PvPChallengeButton(discord.ui.View):
    def __init__(self, challenger_id, target_id, challenger_name, target_name, timeout=120):
        super().__init__(timeout=timeout)
        self.challenger_id = challenger_id
        self.target_id = target_id
        self.challenger_name = challenger_name
        self.target_name = target_name
        self.answered = False

    @discord.ui.button(label="âš”ï¸ Aceitar Duelo!", style=discord.ButtonStyle.red, emoji="âš”ï¸")
    async def accept(self, interaction: discord.Interaction, button: discord.ui.Button):
        if str(interaction.user.id) != str(self.target_id):
            return await interaction.response.send_message("âŒ Esse desafio nÃ£o Ã© para vocÃª!", ephemeral=True)
        if self.answered:
            return
        self.answered = True
        await interaction.response.edit_message(
            content=f"âš”ï¸ **{self.target_name}** aceita o desafio! A batalha comeÃ§a!",
            view=None
        )
        await asyncio.sleep(1)
        await fight_pvp(interaction.channel, self.challenger_id, self.target_id)

    @discord.ui.button(label="ğŸƒ Recusar", style=discord.ButtonStyle.gray)
    async def decline(self, interaction: discord.Interaction, button: discord.ui.Button):
        if str(interaction.user.id) != str(self.target_id):
            return await interaction.response.send_message("âŒ Esse desafio nÃ£o Ã© para vocÃª!", ephemeral=True)
        if self.answered:
            return
        self.answered = True
        await interaction.response.edit_message(
            content=f"ğŸƒ **{self.target_name}** recusou o desafio de **{self.challenger_name}**...\n\n*'A coragem Ã© necessÃ¡ria para um duelo.'*",
            view=None
        )


async def fight_pvp(channel, challenger_id, target_id):
    """âš”ï¸ Sistema de Duelo PvP CinematogrÃ¡fico â€” Batalha Ã©pica turno a turno"""
    challenger = get_player(challenger_id)
    target = get_player(target_id)

    try:
        challenger_user = await bot.fetch_user(int(challenger_id))
        target_user = await bot.fetch_user(int(target_id))
        ch_name = challenger_user.display_name
        tg_name = target_user.display_name
    except:
        ch_name = "Desafiante"
        tg_name = "Alvo"

    ch_cls = challenger.get("class", "Guerreiro")
    tg_cls = target.get("class", "Guerreiro")
    ch_skills = get_player_skills(challenger)
    tg_skills = get_player_skills(target)
    ch_race = challenger.get("race", "Humano")
    tg_race = target.get("race", "Humano")

    # â”€â”€ Stats de batalha â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    ch_hp = challenger["max_hp"] + challenger.get("temp_hp_boost", 0)
    tg_hp = target["max_hp"] + target.get("temp_hp_boost", 0)
    ch_mana = calc_max_mana(challenger)
    tg_mana = calc_max_mana(target)

    ch_atk_base = CLASSES[ch_cls]["atk_bonus"] + challenger["level"] * 2 + challenger.get("temp_atk_boost", 0)
    tg_atk_base = CLASSES[tg_cls]["atk_bonus"] + target["level"] * 2 + target.get("temp_atk_boost", 0)
    ch_def = CLASSES[ch_cls]["def_bonus"] + challenger["level"] + challenger.get("temp_def_boost", 0)
    tg_def = CLASSES[tg_cls]["def_bonus"] + target["level"] + target.get("temp_def_boost", 0)

    # BÃ´nus de equipamento
    def get_weapon_atk(pl):
        bonus = 0
        wname = pl.get("weapon")
        if wname:
            for lst in [ITEMS["weapons"], ITEMS_EXTRA.get("weapons", [])]:
                for w in lst:
                    if w["name"] == wname:
                        bonus += w.get("atk", 0) // 4
                        break
        return bonus

    def get_armor_def(pl):
        bonus = 0
        aname = pl.get("armor")
        if aname:
            for lst in [ITEMS["armor"], ITEMS_EXTRA.get("armor", [])]:
                for a in lst:
                    if a["name"] == aname:
                        bonus += a.get("def", 0) // 4
                        break
        return bonus

    ch_atk_base += get_weapon_atk(challenger)
    tg_atk_base += get_weapon_atk(target)
    ch_def += get_armor_def(challenger)
    tg_def += get_armor_def(target)

    # NÃ­vel decide quem age primeiro
    ch_goes_first = challenger["level"] >= target["level"]

    ch_cur_hp   = ch_hp
    tg_cur_hp   = tg_hp
    ch_cur_mana = ch_mana
    tg_cur_mana = tg_mana

    ch_icon = CLASSES.get(ch_cls, {}).get("emoji", "âš”ï¸")
    tg_icon = CLASSES.get(tg_cls, {}).get("emoji", "âš”ï¸")
    ch_race_icon = RACES.get(ch_race, {}).get("emoji", "ğŸ‘¤")
    tg_race_icon = RACES.get(tg_race, {}).get("emoji", "ğŸ‘¤")

    # â”€â”€ Frases de duelo por classe â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    DUEL_TAUNTS = {
        "Guerreiro": [
            "âš”ï¸ *Â«Eu nasci para o combate. VocÃª vai aprender isso da pior forma.Â»*",
            "ğŸ—¡ï¸ *Â«Minha lÃ¢mina jÃ¡ cortou criaturas que te fariam fugir. Prepare-se.Â»*",
            "ğŸ’ª *Â«ResistÃªncia Ã© tudo. Vamos ver quanto vocÃª aguentarÃ¡.Â»*",
        ],
        "Mago": [
            "ğŸ”® *Â«Os arcanos obedecem Ã  minha voz. VocÃª Ã© apenas mais um obstÃ¡culo.Â»*",
            "âœ¨ *Â«Cada feitiÃ§o que conjuro carrega sÃ©culos de estudo. VocÃª nÃ£o terÃ¡ chance.Â»*",
            "âš¡ *Â«O poder arcano nÃ£o conhece misericÃ³rdia. Nem eu.Â»*",
        ],
        "Arqueiro": [
            "ğŸ¹ *Â«JÃ¡ mirei em alvos maiores que vocÃª. E nenhum escapou.Â»*",
            "ğŸ¯ *Â«Do topo daquele morro, vocÃª nem me veria. Pena que estamos aqui.Â»*",
            "ğŸ’¨ *Â«Minhas flechas voam mais rÃ¡pido que seus reflexos. Conta regressiva iniciada.Â»*",
        ],
        "Paladino": [
            "ğŸ›¡ï¸ *Â«Combato em nome do sagrado. Que os deuses testemunhem sua derrota.Â»*",
            "â˜€ï¸ *Â«A luz que carrego nÃ£o ilumina covardes. Mostre do que Ã© feito!Â»*",
            "âœ¨ *Â«Eu nÃ£o luto por glÃ³ria. Luto por dever. E esse dever Ã© te derrotar.Â»*",
        ],
        "Assassino": [
            "ğŸ—¡ï¸ *Â«VocÃª nem me verÃ¡ chegar. Quando perceber, jÃ¡ terÃ¡ caÃ­do.Â»*",
            "ğŸŒ‘ *Â«As sombras sÃ£o meu lar. VocÃª estÃ¡ prestes a entrar nelas.Â»*",
            "ğŸ’€ *Â«Contratantes pagam muito por uma cabeÃ§a como a sua. Hoje faÃ§o de graÃ§a.Â»*",
        ],
        "Necromante": [
            "ğŸ’€ *Â«A morte nÃ£o Ã© fim para mim. Ã‰ comeÃ§o. Para vocÃª, Ã© diferente.Â»*",
            "ğŸ¦´ *Â«Meus aliados mais leais jÃ¡ morreram uma vez. Logo vocÃª se juntarÃ¡ a eles.Â»*",
            "ğŸŒ‘ *Â«Cada inimigo que derrotei agora me serve. Prepare seu espÃ­rito.Â»*",
        ],
        "Berserker": [
            "ğŸª“ *Â«AAAARGH! VENHA! EU QUERO VER SANGUE!Â»*",
            "ğŸ’¢ *Â«Dor? Ela me alimenta. Quanto mais vocÃª me machucar, mais forte fico!Â»*",
            "ğŸ”¥ *Â«Minha fÃºria nÃ£o tem limites. Prepare-se para o caos puro!Â»*",
        ],
        "Druida": [
            "ğŸŒ¿ *Â«A natureza jÃ¡ escolheu o vencedor. OuÃ§a o vento â€” ele fala meu nome.Â»*",
            "ğŸº *Â«Cada criatura viva ao meu redor Ã© minha aliada. VocÃª estÃ¡ sozinho.Â»*",
            "âš¡ *Â«A terra treme quando eu luto. Sinta isso nos seus pÃ©s.Â»*",
        ],
        "Monge": [
            "ğŸ‘Š *Â«Cem anos de disciplina concentrados neste momento. Defenda-se.Â»*",
            "ğŸ§˜ *Â«Ki, mente, corpo â€” tudo em harmonia. Nada pode me deter.Â»*",
            "ğŸŒ€ *Â«Velocidade nÃ£o Ã© tudo. Mas ajuda quando vocÃª a tem toda.Â»*",
        ],
        "Bardo": [
            "ğŸµ *Â«Escrevi a mÃºsica da sua derrota antes mesmo de vocÃª chegar.Â»*",
            "ğŸ¸ *Â«Esta batalha? Vai virar uma balada Ã©pica. Com vocÃª como o derrotado.Â»*",
            "ğŸº *Â«Minha melodia vai ecoar nos seus pesadelos por anos.Â»*",
        ],
    }

    # Frases de vitÃ³ria por classe
    VICTORY_LINES = {
        "Guerreiro": ["*Â«Foi uma boa luta. Da prÃ³xima vez, treine mais.Â»*", "*Â«A forÃ§a sempre prevalece.Â»*", "*Â«Isso Ã© o que anos de batalha fazem.Â»*"],
        "Mago":      ["*Â«O poder arcano nunca falha.Â»*", "*Â«VocÃª lutou contra a magia. A magia sempre vence.Â»*", "*Â«Cada feitiÃ§o tinha seu propÃ³sito.Â»*"],
        "Arqueiro":  ["*Â«Nenhum alvo escapa de mim.Â»*", "*Â«PrecisÃ£o supera forÃ§a bruta.Â»*", "*Â«JÃ¡ sabia o resultado quando mirei pela primeira vez.Â»*"],
        "Paladino":  ["*Â«Que os deuses guiem sua recuperaÃ§Ã£o.Â»*", "*Â«A luz sempre triunfa.Â»*", "*Â«Foi uma honra combater alguÃ©m com tal coragem.Â»*"],
        "Assassino": ["*Â«VocÃª nunca teve chance desde o inÃ­cio.Â»*", "*Â«As sombras me acompanharam bem hoje.Â»*", "*Â«EficiÃªncia perfeita.Â»*"],
        "Necromante":["*Â«Agora vocÃª entende a verdade da morte.Â»*", "*Â«Bem-vindo ao lado que sempre vence.Â»*", "*Â«A escuridÃ£o consome tudo.Â»*"],
        "Berserker": ["*Â«ISSO Ã‰ O QUE CHAMO DE BATALHA!Â»*", "*Â«HAHAHA! MAIS! QUERO MAIS!Â»*", "*Â«A fÃºria... sempre prevalece...Â»*"],
        "Druida":    ["*Â«A natureza escolheu sabiamente.Â»*", "*Â«O equilÃ­brio foi restaurado.Â»*", "*Â«As raÃ­zes da terra me apoiaram atÃ© o fim.Â»*"],
        "Monge":     ["*Â«O ki nunca mente.Â»*", "*Â«Disciplina e paciÃªncia sempre vencem.Â»*", "*Â«Uma batalha de mente, nÃ£o apenas de corpo.Â»*"],
        "Bardo":     ["*Â«E assim termina o primeiro ato!Â»*", "*Â«Que balada Ã©pica foi essa!Â»*", "*Â«JÃ¡ estou compondo sua derrota em versos.Â»*"],
    }

    # ComentÃ¡rios estratÃ©gicos do narrador por situaÃ§Ã£o
    NARRATOR_PHASE = {
        "opening":  ["âš¡ *O primeiro encontro define o ritmo da batalha!*", "ğŸ”¥ *Os guerreiros se avaliam mutuamente...*", "âš”ï¸ *A tensÃ£o Ã© palpÃ¡vel no ar!*"],
        "midgame":  ["ğŸŒ€ *A batalha esquenta! Ambos exploram seus limites!*", "ğŸ’¥ *Golpes cada vez mais poderosos se sucedem!*", "ğŸ­ *Este Ã© o momento que define campeÃµes!*"],
        "critical": ["â— *Sangue no chÃ£o! Quem suportarÃ¡ mais um golpe?!*", "ğŸ”´ *SITUAÃ‡ÃƒO CRÃTICA! A derrota estÃ¡ a um passo!*", "ğŸ’€ *As bordas da escuridÃ£o comeÃ§am a fechar!*"],
        "comeback": ["ğŸŒŸ *INCRÃVEL! Uma reviravolta espetacular!*", "âœ¨ *Das cinzas, um guerreiro ressurge!*", "ğŸ† *Isso Ã© o que separa herÃ³is de mortais!*"],
        "stun":     ["âš¡ *PARALISADO! O adversÃ¡rio aproveita a abertura!*", "ğŸŒ€ *Corpo e mente congelados por um instante fatal!*"],
        "crit":     ["ğŸ’¥ *GOLPE CRÃTICO! O impacto ecoa pela arena!*", "ğŸ”¥ *DEVASTADOR! Um ataque que dobra a realidade!*", "âš¡ *CRÃTICO PERFEITO! A defesa foi completamente ignorada!*"],
        "poison":   ["â˜ ï¸ *O veneno se espalha pelas veias, corroendo por dentro...*", "ğŸŸ¢ *Toxina mortal! Cada segundo conta agora!*"],
        "low_hp":   ["â¤ï¸â€ğŸ”¥ *{name} estÃ¡ na beira do colapso... mas ainda de pÃ©!*", "ğŸ©¸ *{name} cuspe sangue mas se recusa a cair!*", "âš ï¸ *ForÃ§a pura de vontade mantÃ©m {name} em pÃ©!*"],
    }

    # â”€â”€ ProgressÃ£o de fases de batalha â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    def get_phase_color(ch_pct, tg_pct):
        min_pct = min(ch_pct, tg_pct)
        if min_pct > 70:
            return discord.Color.from_rgb(50, 150, 255)   # Azul â€” Abertura
        elif min_pct > 40:
            return discord.Color.from_rgb(255, 140, 0)     # Laranja â€” Meio
        elif min_pct > 20:
            return discord.Color.from_rgb(220, 50, 50)     # Vermelho â€” CrÃ­tico
        else:
            return discord.Color.from_rgb(80, 0, 0)        # Vermelho escuro â€” Final

    def hp_bar(cur, mx, length=8):
        cur = max(0, cur)
        filled = int((cur / max(1, mx)) * length)
        pct = int((cur / max(1, mx)) * 100)
        if pct > 60:
            bar = "ğŸŸ©" * filled + "â¬›" * (length - filled)
        elif pct > 30:
            bar = "ğŸŸ¨" * filled + "â¬›" * (length - filled)
        else:
            bar = "ğŸŸ¥" * filled + "â¬›" * (length - filled)
        return f"{bar} `{cur}/{mx}` ({pct}%)"

    def mana_bar(cur, mx, length=5):
        filled = int((cur / max(1, mx)) * length)
        return "ğŸ’™" * filled + "ğŸ”²" * (length - filled)

    # â”€â”€ CENA DE ABERTURA â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    taunt_ch = random.choice(DUEL_TAUNTS.get(ch_cls, [f"*Â«Vamos terminar isso!Â»*"]))
    taunt_tg = random.choice(DUEL_TAUNTS.get(tg_cls, [f"*Â«VocÃª vai se arrepender!Â»*"]))

    intro = discord.Embed(
        title="âš”ï¸ â”â”â”â”â” DUELO Ã‰PICO â”â”â”â”â” âš”ï¸",
        description=(
            f"*O ambiente ao redor silencia. O chÃ£o treme ligeiramente.*\n"
            f"*Dois guerreiros se encaram â€” o ar entre eles parece vibrar de tensÃ£o.*\n\n"
            f"**{ch_icon} {ch_name}** {ch_race_icon} avanÃ§a e declara:\n{taunt_ch}\n\n"
            f"**{tg_icon} {tg_name}** {tg_race_icon} responde:\n{taunt_tg}\n\n"
            f"*âš¡ {'**'+ch_name+'** age primeiro por ter mais experiÃªncia!' if ch_goes_first else '**'+tg_name+'** age primeiro por ter mais experiÃªncia!'}*"
        ),
        color=discord.Color.from_rgb(180, 30, 30)
    )
    intro.add_field(
        name=f"â”â”â” {ch_icon} {ch_name} | {ch_cls} â”â”â”",
        value=(
            f"â¤ï¸ HP: {hp_bar(ch_cur_hp, ch_hp)}\n"
            f"ğŸ’™ Mana: {mana_bar(ch_cur_mana, ch_mana)} `{ch_cur_mana}`\n"
            f"âš”ï¸ ATK: `{ch_atk_base}` | ğŸ›¡ï¸ DEF: `{ch_def}`\n"
            f"ğŸ—¡ï¸ Arma: **{challenger.get('weapon') or 'Punhos'}**\n"
            f"ğŸ›¡ï¸ Armadura: **{challenger.get('armor') or 'Nenhuma'}**"
        ),
        inline=True
    )
    intro.add_field(
        name=f"â”â”â” {tg_icon} {tg_name} | {tg_cls} â”â”â”",
        value=(
            f"â¤ï¸ HP: {hp_bar(tg_cur_hp, tg_hp)}\n"
            f"ğŸ’™ Mana: {mana_bar(tg_cur_mana, tg_mana)} `{tg_cur_mana}`\n"
            f"âš”ï¸ ATK: `{tg_atk_base}` | ğŸ›¡ï¸ DEF: `{tg_def}`\n"
            f"ğŸ—¡ï¸ Arma: **{target.get('weapon') or 'Punhos'}**\n"
            f"ğŸ›¡ï¸ Armadura: **{target.get('armor') or 'Nenhuma'}**"
        ),
        inline=True
    )
    intro.set_footer(text="âš”ï¸ A batalha comeÃ§a agora! Que o mais digno prevaleÃ§a!")
    await channel.send(embed=intro)
    await asyncio.sleep(3)

    # â”€â”€ SISTEMA DE BATALHA â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    turn = 1
    MAX_TURNS = 10

    # Estados de batalha
    ch_poison        = 0   # turnos restantes de veneno
    tg_poison        = 0
    ch_weakened      = 0   # turnos de fraqueza
    tg_weakened      = 0
    ch_stunned       = False
    tg_stunned       = False
    ch_shielded      = False  # escudo paladino
    tg_shielded      = False
    ch_rage_stacks   = 0   # berserker: stacks de fÃºria
    tg_rage_stacks   = 0
    ch_ki_charge     = 0   # monge: carga de ki
    tg_ki_charge     = 0

    prev_ch_pct = 100
    prev_tg_pct = 100
    battle_events = []  # histÃ³rico de eventos marcantes

    while ch_cur_hp > 0 and tg_cur_hp > 0 and turn <= MAX_TURNS:
        ch_pct = max(0, int(ch_cur_hp / ch_hp * 100))
        tg_pct = max(0, int(tg_cur_hp / tg_hp * 100))
        turn_color = get_phase_color(ch_pct, tg_pct)

        # Fase narrativa
        if turn == 1:
            phase_comment = random.choice(NARRATOR_PHASE["opening"])
        elif ch_pct < 25 or tg_pct < 25:
            phase_comment = random.choice(NARRATOR_PHASE["critical"])
        elif (ch_pct > prev_ch_pct + 15) or (tg_pct > prev_tg_pct + 15):
            phase_comment = random.choice(NARRATOR_PHASE["comeback"])
        else:
            phase_comment = random.choice(NARRATOR_PHASE["midgame"])

        prev_ch_pct = ch_pct
        prev_tg_pct = tg_pct

        # TÃ­tulo dramÃ¡tico do turno por fase
        if ch_pct < 20 or tg_pct < 20:
            turn_title = f"ğŸ’€ â•â•â• TURNO FINAL {turn} â•â•â• ğŸ’€"
        elif ch_pct < 50 or tg_pct < 50:
            turn_title = f"ğŸ”¥ â•â•â• TURNO {turn} â€” CLÃMAX â•â•â• ğŸ”¥"
        else:
            turn_title = f"âš”ï¸ â•â•â• TURNO {turn} â•â•â• âš”ï¸"

        turn_embed = discord.Embed(
            title=turn_title,
            description=phase_comment,
            color=turn_color
        )

        # â”€â”€ Auxiliar: calcular aÃ§Ã£o de um combatente â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        def resolve_action(attacker_name, defender_name, a_icon, d_icon,
                           a_skills, a_mana, a_atk, d_def, d_hp, d_max_hp,
                           a_hp, a_max_hp, a_weakened, d_weakened,
                           a_stunned, a_cls, a_rage, a_ki,
                           a_shielded, d_shielded, d_poison, a_poison):
            """Resolve uma aÃ§Ã£o de combate e retorna (a_mana_new, d_hp_new, a_hp_new,
               d_poison_new, a_weakened_new, d_weakened_new, d_stunned, a_rage_new,
               a_ki_new, d_shielded_new, a_shielded_new, log_text, event_tag)"""
            event_tag = None

            # IA estratÃ©gica: escolher melhor skill
            available = [s for s in a_skills if s["mana_cost"] <= a_mana]
            if not available:
                available = [a_skills[0]]

            # EstratÃ©gia: HP baixo â†’ usar heal, senÃ£o ataque mais forte disponÃ­vel
            hp_ratio = a_hp / max(1, a_max_hp)
            heal_skills = [s for s in available if s.get("self_heal", 0) > 0]
            high_dmg    = [s for s in available if s["dmg_mult"] >= 2.0]
            stun_skills = [s for s in available if s.get("stun_chance", 0) > 0.15]
            poison_sk   = [s for s in available if s.get("poison")]

            # Prioridade estratÃ©gica
            if hp_ratio < 0.30 and heal_skills:
                skill = random.choice(heal_skills)  # se HP crÃ­tico, curar
            elif d_hp / max(1, d_max_hp) < 0.35 and high_dmg:
                skill = random.choice(high_dmg)     # inimigo fraco â†’ finalizar
            elif a_rage > 2 and high_dmg:
                skill = random.choice(high_dmg)     # com fÃºria â†’ atacar forte
            elif d_weakened <= 0 and stun_skills and random.random() < 0.4:
                skill = random.choice(stun_skills)  # tentar atordoar
            elif len(poison_sk) > 0 and d_poison <= 0 and random.random() < 0.35:
                skill = random.choice(poison_sk)    # envenenar se nÃ£o envenenado
            else:
                skill = random.choice(available)    # aÃ§Ã£o aleatÃ³ria balanceada

            a_mana = max(0, a_mana - skill["mana_cost"])

            # Calcula dano base
            dmg_raw = int(a_atk * skill["dmg_mult"])

            # Berserker: bÃ´nus de fÃºria e dano prÃ³prio
            if a_cls == "Berserker":
                hp_bonus_mult = 1.0 + (1.0 - hp_ratio) * 0.6  # atÃ© +60% quando HP baixo
                dmg_raw = int(dmg_raw * hp_bonus_mult)
                a_rage = min(a_rage + 1, 5)
                if skill.get("self_dmg"):
                    a_hp = max(1, a_hp - skill["self_dmg"])
            elif a_cls == "Monge":
                a_ki = min(a_ki + 1, 3)
                if a_ki >= 3:
                    dmg_raw = int(dmg_raw * 1.4)  # Ki cheio: bÃ´nus
                    a_ki = 0

            # Fraqueza
            if a_weakened > 0:
                dmg_raw = int(dmg_raw * 0.65)
                a_weakened -= 1

            # CrÃ­tico
            is_crit = random.random() < skill.get("crit_chance", 0.12)
            if is_crit:
                dmg_raw = int(dmg_raw * 2.0)
                event_tag = "crit"

            # Escudo reduz dano em 35%
            if d_shielded:
                dmg_raw = int(dmg_raw * 0.65)
                d_shielded = False

            # Defesa
            if skill.get("ignore_def"):
                final_dmg = max(1, dmg_raw)
            else:
                final_dmg = max(1, dmg_raw - d_def)

            d_hp -= final_dmg

            # Cura prÃ³pria
            if skill.get("self_heal"):
                heal_amt = skill["self_heal"]
                a_hp = min(a_max_hp, a_hp + heal_amt)

            # Escudo paladino
            if a_cls == "Paladino" and skill.get("def_bonus", 0) >= 15:
                a_shielded = True

            # Efeitos no alvo
            d_stunned_new = random.random() < skill.get("stun_chance", 0)
            if skill.get("poison") and d_poison <= 0:
                d_poison = 3   # 3 turnos de veneno
                event_tag = event_tag or "poison"
            if skill.get("weaken"):
                d_weakened = max(d_weakened, 2)

            # â”€â”€ Montar texto da aÃ§Ã£o â”€â”€
            if is_crit:
                skill_display = f"ğŸ’¥ **CRÃTICO!** {skill['name']}"
            else:
                skill_display = skill['name']

            dmg_pct = int((final_dmg / max(1, d_max_hp)) * 100)
            if dmg_pct >= 30:
                impact_txt = "ğŸ’£ **IMPACTO DEMOLIDOR!**"
            elif dmg_pct >= 15:
                impact_txt = "âš¡ Golpe pesado!"
            else:
                impact_txt = "ğŸ—¡ï¸ Acerto sÃ³lido."

            log = (
                f"{a_icon} **{attacker_name}** usa **{skill_display}**!\n"
                f"_{skill['desc']}_\n"
                f"â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n"
                f"{impact_txt}\n"
                f"ğŸ’¢ **`âˆ’{final_dmg} HP`** em {d_icon} **{defender_name}**"
            )
            if is_crit:
                log += f"\nğŸŒŸ *{random.choice(NARRATOR_PHASE['crit'])}*"
            if skill.get("self_heal"):
                log += f"\nğŸ’š **{attacker_name}** se cura em `+{skill['self_heal']} HP`!"
            if d_stunned_new:
                log += f"\nâš¡ **{defender_name} foi PARALISADO!** {random.choice(NARRATOR_PHASE['stun'])}"
                event_tag = "stun"
            if skill.get("poison") and d_poison > 0:
                log += f"\nâ˜ ï¸ **{defender_name} foi ENVENENADO!** `{d_poison} turnos`"
            if skill.get("weaken"):
                log += f"\nğŸ”» **{defender_name}** estÃ¡ **ENFRAQUECIDO** por 2 turnos!"
            if a_shielded:
                log += f"\nğŸ›¡ï¸ **{attacker_name}** ergue um **Escudo Divino**!"
            if a_cls == "Berserker" and skill.get("self_dmg"):
                log += f"\nğŸ©¸ **{attacker_name}** sacrifica `{skill['self_dmg']} HP` por mais poder!"
            if a_cls == "Monge" and a_ki == 0 and dmg_raw > 0:
                log += f"\nğŸŒ€ **Ki liberado!** BÃ´nus de ki ativado neste golpe!"
            if a_cls == "Berserker":
                rage_bar = "ğŸ”´" * a_rage + "âš«" * (5 - a_rage)
                log += f"\nğŸª“ FÃºria: {rage_bar}"

            return (a_mana, d_hp, a_hp, d_poison, a_weakened, d_weakened,
                    d_stunned_new, a_rage, a_ki, d_shielded, a_shielded, log, event_tag)

        # â”€â”€ Resolver turno: quem age primeiro â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        actors = [(True, "ch"), (False, "tg")] if ch_goes_first else [(True, "tg"), (False, "ch")]
        # Alternar quem age primeiro a cada turno para dinamismo
        if turn % 2 == 0:
            actors = list(reversed(actors))

        turn_log_parts = []
        for is_first, actor in actors:
            if actor == "ch":
                if ch_stunned:
                    turn_log_parts.append(
                        f"{ch_icon} **{ch_name}** estÃ¡ **PARALISADO** e perde o turno!\n"
                        f"*Â«{tg_name} aproveita a abertura!Â»*"
                    )
                    ch_stunned = False
                    continue
                (ch_cur_mana, tg_cur_hp, ch_cur_hp,
                 tg_poison, ch_weakened, tg_weakened,
                 tg_stunned_new, ch_rage_stacks, ch_ki_charge,
                 tg_shielded, ch_shielded, log_txt, evt) = resolve_action(
                    ch_name, tg_name, ch_icon, tg_icon,
                    ch_skills, ch_cur_mana, ch_atk_base, tg_def,
                    tg_cur_hp, tg_hp, ch_cur_hp, ch_hp,
                    ch_weakened, tg_weakened,
                    ch_stunned, ch_cls, ch_rage_stacks, ch_ki_charge,
                    ch_shielded, tg_shielded, tg_poison, ch_poison
                )
                tg_stunned = tg_stunned or tg_stunned_new
                if evt:
                    battle_events.append(evt)
                turn_log_parts.append(log_txt)
                if tg_cur_hp <= 0:
                    break
            else:
                if tg_stunned:
                    turn_log_parts.append(
                        f"{tg_icon} **{tg_name}** estÃ¡ **PARALISADO** e perde o turno!\n"
                        f"*Â«{ch_name} aproveita a abertura!Â»*"
                    )
                    tg_stunned = False
                    continue
                (tg_cur_mana, ch_cur_hp, tg_cur_hp,
                 ch_poison, tg_weakened, ch_weakened,
                 ch_stunned_new, tg_rage_stacks, tg_ki_charge,
                 ch_shielded, tg_shielded, log_txt, evt) = resolve_action(
                    tg_name, ch_name, tg_icon, ch_icon,
                    tg_skills, tg_cur_mana, tg_atk_base, ch_def,
                    ch_cur_hp, ch_hp, tg_cur_hp, tg_hp,
                    tg_weakened, ch_weakened,
                    tg_stunned, tg_cls, tg_rage_stacks, tg_ki_charge,
                    tg_shielded, ch_shielded, ch_poison, tg_poison
                )
                ch_stunned = ch_stunned or ch_stunned_new
                if evt:
                    battle_events.append(evt)
                turn_log_parts.append(log_txt)
                if ch_cur_hp <= 0:
                    break

        # Efeitos de veneno no final do turno
        poison_log = ""
        if tg_poison > 0 and tg_cur_hp > 0:
            p_dmg = max(8, int(tg_hp * 0.06))
            tg_cur_hp -= p_dmg
            tg_poison -= 1
            poison_log += f"\nâ˜ ï¸ **Veneno** corrÃ³i **{tg_name}**: `âˆ’{p_dmg} HP` | {tg_poison} turnos restantes"
        if ch_poison > 0 and ch_cur_hp > 0:
            p_dmg = max(8, int(ch_hp * 0.06))
            ch_cur_hp -= p_dmg
            ch_poison -= 1
            poison_log += f"\nâ˜ ï¸ **Veneno** corrÃ³i **{ch_name}**: `âˆ’{p_dmg} HP` | {ch_poison} turnos restantes"

        # Montar embed do turno
        for i, part in enumerate(turn_log_parts):
            color_name = "ğŸ”´" if i == 0 else "ğŸ”µ"
            turn_embed.add_field(
                name=f"{color_name} {'1Âª AÃ§Ã£o' if i == 0 else '2Âª AÃ§Ã£o'}",
                value=part,
                inline=False
            )
        if poison_log:
            turn_embed.add_field(name="â˜ ï¸ Efeitos Persistentes", value=poison_log, inline=False)

        # ComentÃ¡rio de HP baixo
        ch_pct_new = max(0, int(ch_cur_hp / ch_hp * 100))
        tg_pct_new = max(0, int(tg_cur_hp / tg_hp * 100))
        low_hp_comment = ""
        if ch_pct_new < 25 and ch_cur_hp > 0:
            low_hp_comment += "\n" + random.choice(NARRATOR_PHASE["low_hp"]).replace("{name}", ch_name)
        if tg_pct_new < 25 and tg_cur_hp > 0:
            low_hp_comment += "\n" + random.choice(NARRATOR_PHASE["low_hp"]).replace("{name}", tg_name)

        # Painel de status completo
        status_val = (
            f"{ch_icon} **{ch_name}**\n"
            f"â¤ï¸ {hp_bar(ch_cur_hp, ch_hp)}\n"
            f"ğŸ’™ {mana_bar(ch_cur_mana, ch_mana)} `{ch_cur_mana}`"
            + (" ğŸ›¡ï¸*escudo*" if ch_shielded else "")
            + (" ğŸ”»*fraco*" if ch_weakened > 0 else "")
            + (" âš¡*paralisado*" if ch_stunned else "")
            + (" â˜ ï¸*veneno*" if ch_poison > 0 else "")
            + f"\n\n{tg_icon} **{tg_name}**\n"
            f"â¤ï¸ {hp_bar(tg_cur_hp, tg_hp)}\n"
            f"ğŸ’™ {mana_bar(tg_cur_mana, tg_mana)} `{tg_cur_mana}`"
            + (" ğŸ›¡ï¸*escudo*" if tg_shielded else "")
            + (" ğŸ”»*fraco*" if tg_weakened > 0 else "")
            + (" âš¡*paralisado*" if tg_stunned else "")
            + (" â˜ ï¸*veneno*" if tg_poison > 0 else "")
            + (low_hp_comment if low_hp_comment else "")
        )
        turn_embed.add_field(name="ğŸ“Š â•â•â• STATUS â•â•â•", value=status_val, inline=False)
        turn_embed.set_footer(text=f"Turno {turn}/{MAX_TURNS} | Eventos: {', '.join(set(battle_events[-5:])) if battle_events else 'Normal'}")

        await channel.send(embed=turn_embed)
        await asyncio.sleep(2.5)

        if ch_cur_hp <= 0 or tg_cur_hp <= 0:
            break
        turn += 1

    # â”€â”€ CENA FINAL: RESULTADO â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    await asyncio.sleep(1.5)

    # Determina vencedor, XP, coins e drama
    ch_final_pct = max(0, int(ch_cur_hp / ch_hp * 100))
    tg_final_pct = max(0, int(tg_cur_hp / tg_hp * 100))

    # XP proporcional ao nÃ­vel e performance
    def calc_pvp_xp(winner, loser, victory_style):
        base = 200 + winner["level"] * 8
        level_diff_bonus = max(0, (loser["level"] - winner["level"]) * 15)
        style_bonus = {"knockout": 80, "timeout": 30, "draw": 50}.get(victory_style, 0)
        return base + level_diff_bonus + style_bonus

    def calc_pvp_coins(winner, loser):
        return 50 + (winner["level"] + loser["level"]) * 3

    if ch_cur_hp <= 0 and tg_cur_hp <= 0:
        # Empate Ã©pico
        victory_line = random.choice([
            "âš¡ *Â«Dois titÃ£s caem ao mesmo tempo! O mundo testemunha um empate lendÃ¡rio!Â»*",
            "ğŸŒ€ *Â«Golpes simultÃ¢neos! Ambos dÃ£o tudo e recebem tudo! Empate Ã‰PICO!Â»*",
            "ğŸ’¥ *Â«ImpossÃ­vel! Os dois guerreiros colapsam juntos! Isso nunca tinha acontecido!Â»*",
        ])
        result_embed = discord.Embed(
            title="âš¡ â•â• EMPATE LENDÃRIO! â•â• âš¡",
            description=f"{victory_line}\n\n"
                        f"*Â«{ch_name} e {tg_name} se encaram pelo chÃ£o, sem forÃ§as para continuar, mas com respeito mÃºtuo gravado nas almas.Â»*",
            color=discord.Color.from_rgb(255, 215, 0)
        )
        coins_draw = 30
        add_coins(challenger_id, coins_draw)
        add_coins(target_id, coins_draw)
        xp_draw = 100
        add_xp(challenger_id, xp_draw)
        add_xp(target_id, xp_draw)
        result_embed.add_field(name=f"{ch_icon} {ch_name}", value=f"+{xp_draw} XP | +{coins_draw} CSI", inline=True)
        result_embed.add_field(name=f"{tg_icon} {tg_name}", value=f"+{xp_draw} XP | +{coins_draw} CSI", inline=True)
        winner_id = None

    elif tg_cur_hp <= 0 or (ch_cur_hp > tg_cur_hp and turn > MAX_TURNS):
        # Challenger vence
        winner_id   = challenger_id
        loser_id    = target_id
        winner_name = ch_name
        loser_name  = tg_name
        winner_cls  = ch_cls
        winner_icon = ch_icon
        loser_icon  = tg_icon
        hp_left     = max(0, ch_cur_hp)

        victory_type = "knockout" if tg_cur_hp <= 0 else "timeout"
        xp_win   = calc_pvp_xp(challenger, target, victory_type)
        coins_win = calc_pvp_coins(challenger, target)
        victory_line = random.choice(VICTORY_LINES.get(winner_cls, ["*Â«VitÃ³ria!Â»*"]))

        ko_desc = (
            f"*{tg_icon} {tg_name} cai de joelhos... a espada escorrega da mÃ£o... silÃªncio.*\n\n"
            if tg_cur_hp <= 0 else
            f"*O tempo esgota! {ch_icon} {ch_name} permanece de pÃ© com mais HP restante!*\n\n"
        )
        result_embed = discord.Embed(
            title=f"ğŸ† â•â• {ch_name.upper()} VENCE! â•â• ğŸ†",
            description=(
                ko_desc +
                f"{winner_icon} **{winner_name}** levanta a arma e proclama:\n{victory_line}\n\n"
                f"*O povo ao redor explode em aplausos!*"
            ),
            color=discord.Color.from_rgb(255, 215, 0)
        )
        result_embed.add_field(name=f"ğŸ† {winner_name} â€” VENCEDOR", value=f"+{xp_win} XP | +{coins_win} CSI | HP restante: `{hp_left}`", inline=True)
        result_embed.add_field(name=f"ğŸ’€ {loser_name} â€” Derrotado", value=f"+50 XP por bravura | *'Derrota honrosa.'*", inline=True)
        add_xp(challenger_id, xp_win)
        add_xp(target_id, 50)
        add_coins(challenger_id, coins_win)
        # Atualizar contagem PvP
        ch_data = get_player(challenger_id)
        pvp = ch_data.get("pvp_battles", {})
        pvp["wins"] = pvp.get("wins", 0) + 1
        ch_data["pvp_battles"] = pvp
        save_player_db(challenger_id, ch_data)

    else:
        # Target vence
        winner_id   = target_id
        loser_id    = challenger_id
        winner_name = tg_name
        loser_name  = ch_name
        winner_cls  = tg_cls
        winner_icon = tg_icon
        loser_icon  = ch_icon
        hp_left     = max(0, tg_cur_hp)

        victory_type = "knockout" if ch_cur_hp <= 0 else "timeout"
        xp_win    = calc_pvp_xp(target, challenger, victory_type)
        coins_win  = calc_pvp_coins(target, challenger)
        victory_line = random.choice(VICTORY_LINES.get(winner_cls, ["*Â«VitÃ³ria!Â»*"]))

        ko_desc = (
            f"*{ch_icon} {ch_name} cai de joelhos... a espada escorrega da mÃ£o... silÃªncio.*\n\n"
            if ch_cur_hp <= 0 else
            f"*O tempo esgota! {tg_icon} {tg_name} permanece de pÃ© com mais HP restante!*\n\n"
        )
        result_embed = discord.Embed(
            title=f"ğŸ† â•â• {tg_name.upper()} VENCE! â•â• ğŸ†",
            description=(
                ko_desc +
                f"{winner_icon} **{winner_name}** levanta a arma e proclama:\n{victory_line}\n\n"
                f"*O povo ao redor explode em aplausos!*"
            ),
            color=discord.Color.from_rgb(255, 215, 0)
        )
        result_embed.add_field(name=f"ğŸ† {winner_name} â€” VENCEDOR", value=f"+{xp_win} XP | +{coins_win} CSI | HP restante: `{hp_left}`", inline=True)
        result_embed.add_field(name=f"ğŸ’€ {loser_name} â€” Derrotado", value=f"+50 XP por bravura | *'Derrota honrosa.'*", inline=True)
        add_xp(target_id, xp_win)
        add_xp(challenger_id, 50)
        add_coins(target_id, coins_win)
        tg_data = get_player(target_id)
        pvp = tg_data.get("pvp_battles", {})
        pvp["wins"] = pvp.get("wins", 0) + 1
        tg_data["pvp_battles"] = pvp
        save_player_db(target_id, tg_data)

    # Resumo da batalha
    event_summary = []
    for e in set(battle_events):
        if e == "crit":    event_summary.append("ğŸ’¥ Golpes CrÃ­ticos")
        if e == "stun":    event_summary.append("âš¡ ParalisaÃ§Ãµes")
        if e == "poison":  event_summary.append("â˜ ï¸ Envenenamentos")
        if e == "comeback":event_summary.append("ğŸŒŸ Reviravolta")
    result_embed.add_field(
        name="ğŸ“œ â•â•â• CRÃ”NICA DA BATALHA â•â•â•",
        value=(
            f"â±ï¸ DuraÃ§Ã£o: **{turn} turnos**\n"
            f"ğŸ­ Eventos: {', '.join(event_summary) if event_summary else 'Batalha limpa'}\n\n"
            + random.choice([
                "*'Uma batalha que serÃ¡ contada por geraÃ§Ãµes!'*",
                "*'Os deuses pararam para assistir a este duelo!'*",
                "*'Lendas nascem de combates como este!'*",
                "*'Quem viu isso nunca esquecerÃ¡.'*",
                "*'O bardo mais prÃ³ximo jÃ¡ estÃ¡ escrevendo sobre isto.'*",
            ])
        ),
        inline=False
    )
    result_embed.set_footer(text="âš”ï¸ Use 'desafiar @jogador' para um novo duelo!")
    await channel.send(embed=result_embed)
    await check_achievements(channel, challenger_id, "pvp_win_1")
    await check_achievements(channel, target_id)


# ================= FUNÃ‡Ã•ES DE BATALHA E EXPLORAÃ‡ÃƒO =================

async def fight_boss(channel, user_id, is_dungeon=False, dungeon_boss=None, allies=None):
    """Batalha de boss estilo PokÃ©mon â€” turno a turno usando habilidades de classe"""
    player = get_player(user_id)

    if is_dungeon and dungeon_boss:
        boss_data = dungeon_boss
    else:
        effects = player.get("active_effects", {})
        pending_boss = effects.pop("pending_boss", None)
        player["active_effects"] = effects
        save_player_db(user_id, player)

        boss_gate_levels = {9, 19, 29, 39, 49, 59, 69, 79, 89, 99, 109, 119, 129, 139, 149, 159, 169, 179, 189, 199, 209, 219, 229, 239, 249, 259, 269, 279, 289, 299, 309, 319, 329, 339, 349, 359, 369, 379, 389, 399, 409, 419, 429, 439, 449, 459, 469, 479, 489, 499, 509, 519, 529, 539, 549, 559, 569, 579, 589, 599}

        # LÃ“GICA DE BOSS:
        # 1. Se tem pending_boss explÃ­cito (jogador escolheu via "confrontar/desafiar boss do level X"), usar ele
        # 2. Se estÃ¡ em boss gate e NÃƒO derrotou o boss do level atual, forÃ§ar o boss correto
        # 3. Caso contrÃ¡rio, boss do mundo atual
        if pending_boss:
            boss_data = pending_boss
        elif player["level"] in boss_gate_levels:
            correct_boss = get_level_boss(player["level"])
            if correct_boss and correct_boss["name"] not in player.get("bosses", []):
                boss_data = correct_boss
            else:
                world_level = max([k for k in WORLDS.keys() if k <= player["level"]])
                boss_pool = WORLD_BOSSES_VARIANTS.get(world_level, [])
                boss_data = random.choice(boss_pool) if boss_pool else WORLDS[world_level]["boss"]
        else:
            world_level = max([k for k in WORLDS.keys() if k <= player["level"]])
            boss_pool = WORLD_BOSSES_VARIANTS.get(world_level, [])
            boss_data = random.choice(boss_pool) if boss_pool else WORLDS[world_level]["boss"]

    # ---- Player stats ----
    p_cls = player.get("class", "Guerreiro")
    p_skills = get_player_skills(player)
    p_icon = CLASSES.get(p_cls, {}).get("emoji", "âš”ï¸")

    p_max_hp = player["max_hp"] + player.get("temp_hp_boost", 0)
    p_hp = min(player["hp"], p_max_hp)
    p_mana = calc_max_mana(player)
    p_cur_mana = p_mana

    p_atk = CLASSES.get(p_cls, {}).get("atk_bonus", 5) + player["level"] * 2 + player.get("temp_atk_boost", 0)
    p_def = CLASSES.get(p_cls, {}).get("def_bonus", 3) + player["level"] + player.get("temp_def_boost", 0)

    # Item bonuses
    if player.get("weapon"):
        for w in ITEMS["weapons"]:
            if w["name"] == player["weapon"]:
                p_atk += w.get("atk", 0) // 4
                break
    if player.get("armor"):
        for a in ITEMS["armor"]:
            if a["name"] == player["armor"]:
                p_def += a.get("def", 0) // 4
                break
    if player.get("pet"):
        try:
            pet_name = player["pet"] if isinstance(player["pet"], str) else player["pet"].get("name", "")
            # Find pet in PETS and PETS_EXTRA data
            all_pet_worlds = list(PETS.values()) + list(PETS_EXTRA.values())
            for world_pets in all_pet_worlds:
                for p in world_pets:
                    if p["name"] == pet_name:
                        p_atk += p.get("bonus_atk", 0)
                        break
        except:
            pass
    # Also add small bonus from farm pets (max 3 farm pets contribute)
    pets_list = player.get("pets_list", [])
    farm_bonus = sum(p.get("bonus_atk", 0) // 3 for p in pets_list[:3])
    p_atk += farm_bonus

    # Ally bonus
    ally_bonus_atk = 0
    ally_names = []
    if allies:
        num_allies = len([a for a in allies if str(a) != str(user_id)])
        for ally_id in allies:
            if str(ally_id) != str(user_id):
                ally_p = get_player(ally_id)
                if ally_p:
                    ally_bonus_atk += ally_p["level"]
                    try:
                        au = await bot.fetch_user(int(ally_id))
                        ally_names.append(au.display_name)
                    except:
                        pass
        # Boss escala com o nÃºmero de aliados (cada aliado adiciona 20% ao HP e ATK do boss)
        if num_allies > 0:
            scale_factor = 1.0 + (num_allies * 0.20)
            boss_data = dict(boss_data)  # cÃ³pia para nÃ£o modificar o original
            boss_data["hp"] = int(boss_data["hp"] * scale_factor)
            boss_data["atk"] = int(boss_data["atk"] * scale_factor)
    p_atk += ally_bonus_atk // 2

    # ---- ExÃ©rcito do reino participa automaticamente do boss ----
    army_bonus_atk = 0
    army_bonus_desc = None
    kingdom_data = player.get("kingdom_data")
    if kingdom_data:
        army_level = kingdom_data.get("army", "Neutra")
        army_buffs = {
            "Ruim":     {"bonus": 5,   "desc": "âš”ï¸ Recrutas mal-treinados ajudam como podem (+5 ATK)"},
            "Neutra":   {"bonus": 15,  "desc": "âš”ï¸ Soldados do seu reino entram na batalha! (+15 ATK)"},
            "Boa":      {"bonus": 35,  "desc": "âš”ï¸ Tropas de elite marcham ao seu lado! (+35 ATK)"},
            "Excelente":{"bonus": 70,  "desc": "âš”ï¸ ExÃ©rcito lendÃ¡rio ataca com fÃºria devastadora! (+70 ATK)"},
        }
        buff = army_buffs.get(army_level)
        if buff:
            army_bonus_atk = buff["bonus"]
            army_bonus_desc = buff["desc"]
            p_atk += army_bonus_atk
    # ---- Pet combat bonus (pet entra automaticamente junto) ----
    pet_combat_name = None
    pet_combat_emoji = "ğŸ¾"
    pet_combat_hp = 0
    pet_combat_atk = 0
    if player.get("pet"):
        try:
            pet_name = player["pet"] if isinstance(player["pet"], str) else player["pet"].get("name", "")
            all_pet_worlds = list(PETS.values()) + list(PETS_EXTRA.values())
            for world_pets in all_pet_worlds:
                for p in world_pets:
                    if p["name"] == pet_name:
                        pet_combat_name = pet_name
                        pet_combat_emoji = p.get("emoji", "ğŸ¾")
                        pet_combat_hp = p.get("bonus_hp", 10)
                        pet_combat_atk = p.get("bonus_atk", 3)
                        break
        except:
            pass

    # ---- Montaria bonus (se tiver montaria ativa, adiciona DEF) ----
    mount_bonus_def = 0
    mount_name = player.get("mount")
    if mount_name:
        mount_data = get_pet_mount_data(mount_name)
        if mount_data:
            mount_bonus_def = mount_data.get("mount_bonus_def", 0)
            p_def += mount_bonus_def
    boss_hp = boss_data["hp"]
    boss_atk = boss_data["atk"]

    # Bosses de level sÃ£o MUITO mais difÃ­ceis
    # Todos os bosses de level (nÃ­veis 9, 19, 29... 199)
    level_boss_names = set()
    boss_level_map = {9:1, 19:10, 29:20, 39:30, 49:40, 59:50, 69:60, 79:70, 89:80, 99:90,
                      109:100, 119:110, 129:120, 139:130, 149:140, 159:150, 169:160, 179:170, 189:180, 199:190,
                      209:200, 219:210, 229:220, 239:230, 249:240, 259:250, 269:260, 279:270, 289:280, 299:290,
                      309:300, 319:310, 329:320, 339:330, 349:340, 359:350, 369:360, 379:370, 389:380, 399:390,
                      409:400, 419:410, 429:420, 439:430, 449:440, 459:450, 469:460, 479:470, 489:480, 499:490,
                      509:500, 519:510, 529:520, 539:530, 549:540, 559:550, 569:560, 579:570, 589:580, 599:590}
    for wk in boss_level_map.values():
        if wk in WORLDS:
            level_boss_names.add(WORLDS[wk]["boss"]["name"])
        else:
            nearest = max((k for k in WORLDS.keys() if k <= wk), default=1)
            level_boss_names.add(WORLDS[nearest]["boss"]["name"])
    is_level_boss = boss_data["name"] in level_boss_names
    if is_level_boss:
        pass  # stats ja ajustados diretamente nos dados do boss

    boss_skills = BOSS_SKILLS.get(boss_data["name"], BOSS_SKILLS["default"])
    boss_cur_hp = boss_hp
    boss_poison = False
    boss_weakened = False

    try:
        player_user = await bot.fetch_user(int(user_id))
        p_name = player_user.display_name
    except:
        p_name = "HerÃ³i"

    # ---- INTRO CINEMATOGRÃFICA ----
    boss_intro_pool = BOSS_INTROS.get(boss_data["name"], BOSS_INTROS["default"])
    boss_intro_text = random.choice(boss_intro_pool)

    if is_level_boss:
        intro_title = f"ğŸš¨ BOSS DE NÃVEL {boss_data.get('level', player['level'])} â€” CONFRONTO Ã‰PICO!"
        intro_color = discord.Color.from_rgb(200, 0, 50)
    elif is_dungeon:
        intro_title = f"ğŸ’€ GUARDIÃƒO DA MASMORRA â€” {boss_data['name']}!"
        intro_color = discord.Color.dark_purple()
    else:
        intro_title = f"ğŸ‘¹ BATALHA COMEÃ‡OU â€” {p_name} vs {boss_data['name']}!"
        intro_color = discord.Color.dark_red()

    intro = discord.Embed(
        title=intro_title,
        description=boss_intro_text,
        color=intro_color
    )

    if is_level_boss:
        intro.add_field(
            name="ğŸš¨ BOSS GUARDIÃƒO DA PASSAGEM",
            value="*Este boss bloqueia sua evoluÃ§Ã£o. Derrote-o para avanÃ§ar ao prÃ³ximo reino!*",
            inline=False
        )

    if ally_names:
        ally_display = " | ".join([f"âš”ï¸ {n}" for n in ally_names])
        intro.add_field(name="ğŸ‘¥ ALIADOS NA BATALHA", value=ally_display, inline=False)

    if army_bonus_desc:
        intro.add_field(name="ğŸ° ExÃ©rcito do Reino", value=army_bonus_desc, inline=False)

    intro.add_field(
        name=f"{p_icon} {p_name} ({p_cls})",
        value=f"â¤ï¸ `{p_hp}/{p_max_hp}` | ğŸ’™ `{p_cur_mana}` mana\nâš”ï¸ ATK `{p_atk}` | ğŸ›¡ï¸ DEF `{p_def}`",
        inline=True
    )
    if pet_combat_name:
        intro.add_field(
            name=f"{pet_combat_emoji} {pet_combat_name} (Pet)",
            value=f"â¤ï¸ `{pet_combat_hp}` | âš”ï¸ ATK `{pet_combat_atk}`\n*Seu companheiro leal entra na batalha!*",
            inline=True
        )
    if mount_name and mount_bonus_def > 0:
        intro.add_field(
            name=f"ğŸ {mount_name}",
            value=f"ğŸ›¡ï¸ DEF +`{mount_bonus_def}`\n*Sua montaria te protege!*",
            inline=True
        )
    intro.add_field(
        name=f"ğŸ‘¹ {boss_data['name']}",
        value=f"â¤ï¸ `{boss_cur_hp:,}/{boss_hp:,}` | âš”ï¸ ATK `{boss_atk}`\n_{boss_data.get('desc','...')[:70]}_",
        inline=True
    )
    intro.set_footer(text="âš”ï¸ A batalha Ã©pica comeÃ§a! Que os mais fortes sobrevivam...")
    await channel.send(embed=intro)
    await asyncio.sleep(2)

    # ---- Turn-based combat ----
    p_cur_hp = p_hp
    p_poison = False
    p_weakened = False
    p_stunned = False
    crits_done = 0
    poisons_done = 0
    stuns_done = 0
    skills_used = set()
    was_poisoned = False
    was_stunned = False
    pet_cur_hp = pet_combat_hp

    # Fases do boss
    boss_phase = 1  # 1=normal, 2=50%HP, 3=25%HP, 4=enrage(<10%)
    phase_triggered = {2: False, 3: False, 4: False}

    # PrÃ©-calcular dados dos aliados para aÃ§Ãµes ativas
    ally_full_data = []
    if allies:
        for ally_id in allies:
            if str(ally_id) != str(user_id):
                ap = get_player(ally_id)
                if ap:
                    try:
                        au = await bot.fetch_user(int(ally_id))
                        ally_full_data.append({
                            "id": ally_id,
                            "name": au.display_name,
                            "class": ap.get("class", "Guerreiro"),
                            "level": ap.get("level", 1),
                            "atk": CLASSES.get(ap.get("class","Guerreiro"),{}).get("atk_bonus",5) + ap.get("level",1)*2,
                        })
                    except:
                        pass

    # NarraÃ§Ã£o dinÃ¢mica por turno
    TURN_NARRATIONS = [
        "âš”ï¸ **TURNO {t}** â€” *Os combatentes se encaram com determinaÃ§Ã£o!*",
        "ğŸŒ€ **TURNO {t}** â€” *A tensÃ£o no ar Ã© cortante como uma lÃ¢mina!*",
        "ğŸ’¥ **TURNO {t}** â€” *O solo treme com cada golpe desferido!*",
        "ğŸ”¥ **TURNO {t}** â€” *O calor da batalha se intensifica!*",
        "âš¡ **TURNO {t}** â€” *Os movimentos ficam mais rÃ¡pidos e mais letais!*",
        "ğŸ’€ **TURNO {t}** â€” *Quem sai daqui com vida?*",
        "ğŸŒ‘ **TURNO {t}** â€” *O momento decisivo se aproxima!*",
        "ğŸ¯ **TURNO {t}** â€” *Cada golpe pode ser o Ãºltimo!*",
    ]

    for turn in range(1, 10):
        if p_cur_hp <= 0 or boss_cur_hp <= 0:
            break

        # === VERIFICAR FASE DO BOSS ===
        boss_hp_pct = boss_cur_hp / boss_hp
        phase_taunts = BOSS_PHASE_TAUNTS.get(boss_data["name"], BOSS_PHASE_TAUNTS["default"])

        if boss_hp_pct <= 0.50 and not phase_triggered[2]:
            phase_triggered[2] = True
            boss_phase = 2
            phase_embed = discord.Embed(
                title="âš ï¸ FASE 2 â€” O BOSS ESTÃ ENRAIVECIDO!",
                description=phase_taunts["phase2"],
                color=discord.Color.orange()
            )
            phase_embed.add_field(name="ğŸ’¢ MudanÃ§a de Fase!", value="*O boss libera uma nova camada de poder! Seus ataques ficam mais perigosos!*", inline=False)
            await channel.send(embed=phase_embed)
            await asyncio.sleep(1.5)
            # Buff do boss na fase 2
            boss_atk = int(boss_atk * 1.15)

        if boss_hp_pct <= 0.25 and not phase_triggered[3]:
            phase_triggered[3] = True
            boss_phase = 3
            phase_embed = discord.Embed(
                title="ğŸ”¥ FASE 3 â€” MODO FRENESI ATIVADO!",
                description=phase_taunts["phase3"],
                color=discord.Color.red()
            )
            phase_embed.add_field(name="ğŸ’€ SituaÃ§Ã£o CrÃ­tica!", value="*O boss estÃ¡ Ã  beira da morte... mas isso o torna ainda mais PERIGOSO!*", inline=False)
            await channel.send(embed=phase_embed)
            await asyncio.sleep(1.5)
            # Buff do boss na fase 3
            boss_atk = int(boss_atk * 1.20)

        if boss_hp_pct <= 0.10 and not phase_triggered[4]:
            phase_triggered[4] = True
            boss_phase = 4
            phase_embed = discord.Embed(
                title="â˜ ï¸ MODO ENRAGE â€” TUDO OU NADA!",
                description=phase_taunts["enrage"],
                color=discord.Color.from_rgb(180, 0, 0)
            )
            phase_embed.add_field(name="ğŸŒ‘ PERIGO MÃXIMO!", value="*O boss estÃ¡ morrendo e nÃ£o tem nada a perder. ATENÃ‡ÃƒO MÃXIMA!*", inline=False)
            await channel.send(embed=phase_embed)
            await asyncio.sleep(1.5)
            boss_atk = int(boss_atk * 1.25)

        # TÃ­tulo do turno com narraÃ§Ã£o dinÃ¢mica
        narr = random.choice(TURN_NARRATIONS).format(t=turn)
        turn_embed = discord.Embed(title=narr, color=discord.Color.red())

        # === AÃ‡ÃƒO DO JOGADOR PRINCIPAL ===
        available = [s for s in p_skills if s["mana_cost"] <= p_cur_mana]
        if not available:
            available = [p_skills[0]]
        p_skill = random.choice(available)
        p_cur_mana = max(0, p_cur_mana - p_skill["mana_cost"])
        skills_used.add(p_skill["name"])

        dmg_raw = int(p_atk * p_skill["dmg_mult"])
        if p_weakened:
            dmg_raw = int(dmg_raw * 0.7)

        is_crit = random.random() < p_skill.get("crit_chance", 0.1)
        if is_crit:
            dmg_raw = int(dmg_raw * 1.8)
            crits_done += 1
            skill_display = f"ğŸ’¥ CRÃTICO! {p_skill['name']}"
        else:
            skill_display = p_skill["name"]

        if p_skill.get("ignore_def"):
            p_dmg = max(1, dmg_raw)
        else:
            boss_def = max(0, boss_atk // 4)
            p_dmg = max(1, dmg_raw - boss_def)

        boss_cur_hp -= p_dmg

        if p_skill.get("self_heal"):
            p_cur_hp = min(p_max_hp, p_cur_hp + p_skill["self_heal"])

        boss_stun = random.random() < p_skill.get("stun_chance", 0)
        if p_skill.get("poison"):
            boss_poison = True
            poisons_done += 1
        if p_skill.get("weaken"):
            boss_weakened = True

        # NarraÃ§Ã£o do ataque do jogador com variaÃ§Ã£o
        atk_intros = [
            f"{p_icon} **{p_name}** usa **{skill_display}**!",
            f"âš¡ **{p_name}** lanÃ§a **{skill_display}** com precisÃ£o mortal!",
            f"ğŸ”¥ Com determinaÃ§Ã£o feroz, **{p_name}** executa **{skill_display}**!",
            f"ğŸ’¢ **{p_name}** grita e ativa **{skill_display}**!",
        ]
        p_action = f"{random.choice(atk_intros)}\n> ğŸ’¥ `âˆ’{p_dmg:,} HP` causado a **{boss_data['name']}**\n> _{p_skill['desc']}_"
        if boss_stun:
            p_action += "\n> âš¡ **O boss foi PARALISADO pelo ataque!**"
            stuns_done += 1
        if p_skill.get("self_heal"):
            p_action += f"\n> ğŸ’š **{p_name} recuperou `{p_skill['self_heal']}` HP!**"
        if is_crit:
            p_action += f"\n> ğŸ¯ *A batalha tremeu com a forÃ§a desse golpe!*"
        turn_embed.add_field(name=f"ğŸ”´ Ataque de {p_name}!", value=p_action, inline=False)

        # === AÃ‡Ã•ES DOS ALIADOS (cada aliado age ativamente!) ===
        total_ally_dmg = 0
        for ally_data in ally_full_data:
            ally_cls = ally_data["class"]
            ally_actions = ALLY_CLASS_ACTIONS.get(ally_cls, ALLY_CLASS_ACTIONS["default"])
            ally_action_text, ally_mult = random.choice(ally_actions)
            ally_battle_cry = random.choice(ALLY_BATTLE_CRIES.get(ally_cls, ALLY_BATTLE_CRIES["default"]))

            # Dano do aliado baseado no nÃ­vel e classe
            # atk = atk_bonus_classe + level*2, multiplicado pela habilidade usada
            ally_base_atk = ally_data["atk"]
            ally_level = ally_data["level"]
            ally_is_crit = random.random() < 0.20
            ally_dmg_raw = int(ally_base_atk * ally_mult)
            if ally_is_crit:
                ally_dmg_raw = int(ally_dmg_raw * 1.7)
            # Defesa do boss reduzida para aliados (nÃ£o penalizar muito aliados de level menor)
            ally_boss_def = max(0, boss_atk // 8)
            ally_dmg = max(ally_level * 2, ally_dmg_raw - ally_boss_def)

            boss_cur_hp -= ally_dmg
            total_ally_dmg += ally_dmg

            ally_txt = ally_action_text.format(name=ally_data["name"])
            ally_display = f"{ally_txt}\n> {ally_battle_cry}\n> ğŸ’¥ `âˆ’{ally_dmg:,} HP` para **{boss_data['name']}**"
            if ally_is_crit:
                ally_display += "\n> ğŸ’¥ **CRÃTICO DO ALIADO!** *A arena vibra!*"

            cls_emoji = CLASSES.get(ally_cls, {}).get("emoji", "âš”ï¸")
            turn_embed.add_field(name=f"{cls_emoji} {ally_data['name']} ataca!", value=ally_display, inline=False)

        # === ATAQUE DO PET ===
        if pet_combat_name and pet_cur_hp > 0:
            pet_dmg = max(1, pet_combat_atk + random.randint(0, pet_combat_atk // 2))
            boss_cur_hp -= pet_dmg
            pet_heal = 0
            if "Fada" in pet_combat_name or "Coelho" in pet_combat_name:
                pet_heal = random.randint(5, 20)
                p_cur_hp = min(p_max_hp, p_cur_hp + pet_heal)

            pet_actions = [
                f"{pet_combat_emoji} **{pet_combat_name}** salta sobre o boss com suas garras afiadas!",
                f"{pet_combat_emoji} **{pet_combat_name}** rosna e ataca ferozmente!",
                f"{pet_combat_emoji} **{pet_combat_name}** protege seu dono e contra-ataca!",
                f"{pet_combat_emoji} **{pet_combat_name}** usa seu instinto animal para golpear o ponto fraco!",
            ]
            pet_msg = f"{random.choice(pet_actions)}\n> ğŸ’¥ `âˆ’{pet_dmg}` HP para o boss"
            if pet_heal:
                pet_msg += f"\n> ğŸ’š Cura `+{pet_heal}` HP para vocÃª!"
                pet_msg += f"\n> *'Seu companheiro cuida de vocÃª mesmo em batalha!'*"
            turn_embed.add_field(name="ğŸ¾ Companheiro de batalha!", value=pet_msg, inline=False)

        # === VERIFICAR MORTE DO BOSS ===
        if boss_cur_hp <= 0:
            death_line = BOSS_DEATH_LINES.get(boss_data["name"], BOSS_DEATH_LINES["default"])
            turn_embed.add_field(
                name="ğŸ’¥ O BOSS FOI DERROTADO!",
                value=f"*{death_line}*\n\nğŸ† **{boss_data['name']} caiu!**",
                inline=False
            )
            await channel.send(embed=turn_embed)
            break

        # === VENENO NO BOSS ===
        if boss_poison:
            boss_poison_dmg = max(10, int(boss_hp * 0.04))
            boss_cur_hp -= boss_poison_dmg
            turn_embed.add_field(
                name="â˜ ï¸ Efeito de Veneno!",
                value=f"*O veneno corrÃ³i as entranhas de **{boss_data['name']}**!*\n> ğŸ©¸ `âˆ’{boss_poison_dmg}` dano de veneno",
                inline=False
            )
            if boss_cur_hp <= 0:
                death_line = BOSS_DEATH_LINES.get(boss_data["name"], BOSS_DEATH_LINES["default"])
                turn_embed.add_field(
                    name="â˜ ï¸ O VENENO FINALIZOU O BOSS!",
                    value=f"*{death_line}*\nğŸ† **{boss_data['name']} caiu!**",
                    inline=False
                )
                await channel.send(embed=turn_embed)
                break

        # === AÃ‡ÃƒO DO BOSS (se nÃ£o estiver paralisado) ===
        if not boss_stun:
            # Na fase de enrage, boss pode usar habilidade especial
            if boss_phase >= 3 and random.random() < 0.3:
                # Habilidade especial de fase final
                b_skill = max(boss_skills, key=lambda x: x.get("dmg_mult", 0))
            else:
                b_skill = random.choice(boss_skills)

            b_dmg_raw = int(boss_atk * b_skill["dmg_mult"])
            if boss_weakened:
                b_dmg_raw = int(b_dmg_raw * 0.6)

            boss_crit = random.random() < (0.15 if boss_phase >= 2 else 0.1)
            if boss_crit:
                b_dmg_raw = int(b_dmg_raw * 1.6)
                b_skill_name = f"ğŸ’¥ CRÃTICO! {b_skill['name']}"
            else:
                b_skill_name = b_skill["name"]

            b_dmg = max(1, b_dmg_raw - p_def)
            p_cur_hp -= b_dmg

            if b_skill.get("poison"):
                p_poison = True
                was_poisoned = True
            if b_skill.get("weaken"):
                p_weakened = True
            b_stun = random.random() < b_skill.get("stun_chance", 0)
            if b_stun:
                p_stunned = True
                was_stunned = True

            # ReaÃ§Ã£o dramÃ¡tica baseado no HP do boss
            if boss_hp_pct <= 0.10:
                boss_reaction = "***(Em frenesi total, o boss ataca sem pensar!)***"
            elif boss_hp_pct <= 0.25:
                boss_reaction = "***(Ferido e desesperado, o golpe carrega Ã³dio puro!)***"
            elif boss_hp_pct <= 0.50:
                boss_reaction = "***(O boss estÃ¡ com raiva agora!)***"
            else:
                boss_reaction = f"*{b_skill['desc']}*"

            b_action = f"ğŸ‘¹ **{boss_data['name']}** usa **{b_skill_name}**!\n> ğŸ’¥ `âˆ’{b_dmg}` de dano em **{p_name}**!\n> {boss_reaction}"
            if b_stun:
                b_action += f"\n> âš¡ **{p_name} foi PARALISADO! Perde o prÃ³ximo turno!**"
            if b_skill.get("poison"):
                b_action += f"\n> â˜ ï¸ **{p_name} foi envenenado!**"
            if b_skill.get("weaken"):
                b_action += f"\n> ğŸ’” **{p_name} foi enfraquecido! ATK reduzido!**"
            if boss_crit:
                b_action += f"\n> ğŸ’¢ *O golpe crÃ­tico ricocheteou pela arena inteira!*"

            turn_embed.add_field(name=f"ğŸ”µ {boss_data['name']} contra-ataca!", value=b_action, inline=False)
        else:
            stun_msgs = [
                f"âš¡ **{boss_data['name']}** estÃ¡ PARALISADO! O boss perdeu o turno!",
                f"ğŸ˜µ **{boss_data['name']}** tonteia e nÃ£o consegue agir! *(Turno perdido!)*",
                f"ğŸŒ€ A paralisia impede **{boss_data['name']}** de atacar! *Aproveite a abertura!*",
            ]
            turn_embed.add_field(name="âš¡ Boss Paralisado!", value=random.choice(stun_msgs), inline=False)

        # === VENENO NO JOGADOR ===
        if p_poison:
            p_poison_dmg = max(5, int(p_max_hp * 0.04))
            p_cur_hp -= p_poison_dmg
            turn_embed.add_field(
                name="â˜ ï¸ Veneno em vocÃª!",
                value=f"*O veneno do boss queima por dentro...*\n> ğŸ©¸ `âˆ’{p_poison_dmg}` dano contÃ­nuo",
                inline=False
            )

        # === BARRAS DE HP ESTILO Ã‰PICO ===
        p_pct = max(0, int(p_cur_hp / p_max_hp * 100))
        b_pct = max(0, int(boss_cur_hp / boss_hp * 100))

        # Barras com emojis variados por porcentagem
        def make_hp_bar(pct, filled_emoji, empty_emoji="â¬›"):
            filled = max(0, min(10, pct // 10))
            return filled_emoji * filled + empty_emoji * (10 - filled)

        if p_pct > 60:
            p_bar = make_hp_bar(p_pct, "ğŸŸ©")
        elif p_pct > 30:
            p_bar = make_hp_bar(p_pct, "ğŸŸ¨")
        else:
            p_bar = make_hp_bar(p_pct, "ğŸŸ¥")

        if b_pct > 60:
            b_bar = make_hp_bar(b_pct, "ğŸŸ¦")
        elif b_pct > 30:
            b_bar = make_hp_bar(b_pct, "ğŸŸ§")
        else:
            b_bar = make_hp_bar(b_pct, "ğŸŸ¥")

        # Indicador de fase do boss
        phase_indicators = {1: "ğŸ˜", 2: "ğŸ˜¡ FASE 2", 3: "ğŸ¤¬ FASE 3", 4: "â˜ ï¸ ENRAGE"}
        boss_status_line = f"ğŸ‘¹ **{boss_data['name']}** {phase_indicators.get(boss_phase,'')}: {b_bar} `{max(0,boss_cur_hp):,}/{boss_hp:,}` â¤ï¸"

        status_text = (
            f"{p_icon} **{p_name}**: {p_bar} `{max(0,p_cur_hp)}/{p_max_hp}` â¤ï¸ | ğŸ’™ `{p_cur_mana}` mana\n"
            f"{boss_status_line}"
        )
        if ally_full_data and total_ally_dmg > 0:
            status_text += f"\nâš”ï¸ *Aliados causaram `{total_ally_dmg:,}` de dano adicional neste turno!*"

        # Mensagem de alerta de HP baixo
        if p_pct <= 20:
            status_text += f"\n\nâš ï¸ ***ATENÃ‡ÃƒO: {p_name} estÃ¡ em situaÃ§Ã£o crÃ­tica!***"
        elif p_pct <= 40:
            status_text += f"\n\nğŸ’” *{p_name} estÃ¡ se segurando por um fio...*"

        turn_embed.add_field(name="ğŸ“Š SituaÃ§Ã£o da Batalha", value=status_text, inline=False)
        await channel.send(embed=turn_embed)
        await asyncio.sleep(2)

    # ---- Battle result ----
    await asyncio.sleep(1)

    if p_cur_hp <= 0 or (boss_cur_hp > 0 and p_cur_hp <= 0):
        # === DERROTA ===
        result, xp_loss = remove_xp(user_id, random.randint(80, 150))
        boss_taunt = BOSS_VICTORY_TAUNTS.get(boss_data["name"], BOSS_VICTORY_TAUNTS["default"])
        defeat_descs = [
            f"*As forÃ§as te abandonam. O chÃ£o parece frio e distante enquanto vocÃª cai...*\n\n{boss_taunt}",
            f"*Seus joelhos cedem. A Ãºltima coisa que vocÃª vÃª sÃ£o os olhos do boss te encarando...*\n\n{boss_taunt}",
            f"*A escuridÃ£o chega. VocÃª foi derrotado com honra â€” mas derrotado ainda assim...*\n\n{boss_taunt}",
        ]
        defeat_embed = discord.Embed(
            title="ğŸ’€ DERROTA... A BATALHA SE PERDEU",
            description=random.choice(defeat_descs) + f"\n\nâŒ **âˆ’{xp_loss} XP perdido**",
            color=discord.Color.dark_red()
        )
        if ally_full_data:
            defeat_embed.add_field(
                name="ğŸ˜” Seus aliados ficam ao seu lado...",
                value="\n".join([f"> *'{n['name']} te carrega para longe do campo de batalha...'*" for n in ally_full_data[:3]]),
                inline=False
            )
        defeat_embed.add_field(
            name="ğŸ’¡ O que fazer agora?",
            value="âš”ï¸ **VinganÃ§a** â€” Enfrente o boss novamente imediatamente\nğŸ“š **Treinar** â€” FortaleÃ§a seus stats antes da revanche\nğŸƒ **Recuar** â€” Recolha suas forÃ§as e volte mais forte",
            inline=False
        )
        await channel.send(embed=defeat_embed)
        # Show revenge/training buttons for level bosses
        boss_levels_set = {"Slime Rei", "Ent AnciÃ£o", "FaraÃ³ AmaldiÃ§oado", "Yeti Colossal", "DragÃ£o de Magma", "Senhor das Sombras"}
        if boss_data["name"] in boss_levels_set or player.get("level") in [9,19,29,39,49,59]:
            view = RevengeTrainingView(user_id, boss_data)
            await channel.send("**O que vocÃª deseja fazer?**", view=view)
        return

    # === VITÃ“RIA ===
    xp = boss_data["xp"] + (player["level"] * 10)
    coins = random.randint(boss_data["coins"][0], boss_data["coins"][1])

    player2 = get_player(user_id)
    if boss_data["name"] not in player2["bosses"]:
        player2["bosses"].append(boss_data["name"])
    player2["bosses_defeated"] = player2.get("bosses_defeated", 0) + 1
    player2["total_coins_earned"] = player2.get("total_coins_earned", 0) + coins
    player2["total_xp_earned"] = player2.get("total_xp_earned", 0) + xp
    # Check for revenge achievement
    effects2 = player2.get("active_effects", {})
    was_revenge = effects2.pop("used_revenge", False)
    player2["active_effects"] = effects2
    save_player_db(user_id, player2)

    leveled = add_xp(user_id, xp, bypass_boss_gate=True)

    # Libera XP acumulado durante o bloqueio do boss
    pending_released = release_pending_xp(user_id)

    # === RECOMPENSA PARA ALIADOS (boss de nÃ­vel) ===
    if is_level_boss and allies:
        boss_to_world_ally = {}
        boss_level_map_ally = {9:1, 19:10, 29:20, 39:30, 49:40, 59:50, 69:60, 79:70, 89:80, 99:90,
                               109:100, 119:110, 129:120, 139:130, 149:140, 159:150, 169:160, 179:170, 189:180, 199:190,
                               209:200, 219:210, 229:220, 239:230, 249:240, 259:250, 269:260, 279:270, 289:280, 299:290,
                               309:300, 319:310, 329:320, 339:330, 349:340, 359:350, 369:360, 379:370, 389:380, 399:390,
                               409:400, 419:410, 429:420, 439:430, 449:440, 459:450, 469:460, 479:470, 489:480, 499:490,
                               509:500, 519:510, 529:520, 539:530, 549:540, 559:550, 569:560, 579:570, 589:580, 599:590}
        for gate_lvl, wk in boss_level_map_ally.items():
            nearest = wk if wk in WORLDS else max((k for k in WORLDS.keys() if k <= wk), default=1)
            boss_to_world_ally[WORLDS[nearest]["boss"]["name"]] = nearest
        next_world_ally = boss_to_world_ally.get(boss_data["name"])
        ally_xp = boss_data["xp"] // 2  # aliados recebem metade do XP
        ally_coins = coins // 2

        for ally_id in allies:
            if str(ally_id) == str(user_id):
                continue
            ap = get_player(ally_id)
            if not ap:
                continue

            # Registra o boss como derrotado para o aliado
            if boss_data["name"] not in ap.get("bosses", []):
                ap["bosses"].append(boss_data["name"])
            ap["bosses_defeated"] = ap.get("bosses_defeated", 0) + 1
            ap["total_coins_earned"] = ap.get("total_coins_earned", 0) + ally_coins
            ap["total_xp_earned"] = ap.get("total_xp_earned", 0) + ally_xp

            # Desbloqueia o prÃ³ximo mundo para o aliado
            if next_world_ally and next_world_ally in WORLDS:
                if next_world_ally not in ap.get("worlds", [1]):
                    ap["worlds"].append(next_world_ally)
                    ap["worlds"] = sorted(list(set(ap["worlds"])))

            save_player_db(ally_id, ap)

            # Libera XP bloqueado do aliado e dÃ¡ XP + coins da batalha
            add_xp(ally_id, ally_xp, bypass_boss_gate=True)
            release_pending_xp(ally_id)
            add_coins(ally_id, ally_coins)

            # Drop prÃ³prio para cada aliado
            ally_drop_rand = random.random()
            ally_drop_rarity = None
            if ally_drop_rand < 0.002:
                ally_drop_rarity = random.choice(["Divino", "Primordial"])
            elif ally_drop_rand < 0.015:
                ally_drop_rarity = "MÃ­tico"
            elif ally_drop_rand < 0.05:
                ally_drop_rarity = "LendÃ¡rio"
            elif ally_drop_rand < 0.14:
                ally_drop_rarity = "Ã‰pico"
            elif ally_drop_rand < 0.28:
                ally_drop_rarity = "Raro"

            # Notifica o aliado
            try:
                ally_user = await bot.fetch_user(int(ally_id))
                ally_after = get_player(ally_id)
                ally_embed = discord.Embed(
                    title="ğŸ¤ ALIADO â€” BOSS DERROTADO! BATALHA Ã‰PICA VENCIDA!",
                    description=f"VocÃª lutou ao lado de **{p_name}** e juntos derrubaram **{boss_data['name']}**!\n*'A forÃ§a dos aliados provou ser invencÃ­vel!'*",
                    color=discord.Color.gold()
                )
                ally_embed.add_field(name="â­ XP Ganho", value=f"`+{ally_xp:,}`", inline=True)
                ally_embed.add_field(name="ğŸ’° Coins Ganhos", value=f"`+{ally_coins:,}`", inline=True)
                if next_world_ally and next_world_ally in WORLDS:
                    nw = WORLDS[next_world_ally]
                    ally_embed.add_field(
                        name=f"ğŸŒ Reino Desbloqueado!",
                        value=f"{nw['emoji']} **{nw['name']}** agora estÃ¡ acessÃ­vel!\nUse `abrir mapa` para viajar.",
                        inline=False
                    )
                if ally_drop_rarity:
                    item_type_ally = random.choice(["weapon", "armor"])
                    item_list_ally = "weapons" if item_type_ally == "weapon" else "armor"
                    items_of_rarity_ally = [i for i in ITEMS[item_list_ally] if i["rarity"] == ally_drop_rarity]
                    if items_of_rarity_ally:
                        item_ally = random.choice(items_of_rarity_ally)
                        ap2 = get_player(ally_id)
                        ap2["inventory"].append(item_ally["name"])
                        save_player_db(ally_id, ap2)
                        ally_embed.add_field(
                            name=f"âœ¨ Drop Especial para vocÃª!",
                            value=f"{RARITIES[ally_drop_rarity]['emoji']} **{item_ally['name']}** ({ally_drop_rarity})",
                            inline=False
                        )
                ally_embed.set_footer(text=f"Aliado de {p_name} na batalha contra {boss_data['name']}")
                await channel.send(f"{ally_user.mention}", embed=ally_embed)
            except:
                pass

    add_coins(user_id, coins)

    victory_descs = [
        f"*A lenda de **{p_name}** ecoa pelos reinos! **{boss_data['name']}** cai para nunca mais se erguer!*",
        f"*Guerreiros cantarÃ£o esta vitÃ³ria por geraÃ§Ãµes! O nome de **{p_name}** ficarÃ¡ gravado na histÃ³ria!*",
        f"*Com o Ãºltimo golpe, o silÃªncio cai sobre o campo de batalha. **{p_name}** permanece de pÃ©. O boss, nÃ£o.*",
        f"*'ImpossÃ­vel...'* *â€” as Ãºltimas palavras do boss enquanto o poder de **{p_name}** provava ser superior.*",
    ]
    victory_embed = discord.Embed(
        title="ğŸ† VITÃ“RIA GLORIOSA! A BATALHA Ã‰PICA TERMINOU!",
        description=random.choice(victory_descs) + f"\n\nâ­ **+{xp:,} XP** | ğŸ’° **+{coins:,} CSI**",
        color=discord.Color.gold()
    )
    if ally_full_data:
        ally_celebration = []
        for ad in ally_full_data:
            cries = ALLY_BATTLE_CRIES.get(ad["class"], ALLY_BATTLE_CRIES["default"])
            ally_celebration.append(f"> ğŸ‰ **{ad['name']}**: *'Conseguimos! IncrÃ­vel!'*")
        victory_embed.add_field(
            name="ğŸ¤ Aliados Comemoram!",
            value="\n".join(ally_celebration[:4]),
            inline=False
        )
    if pending_released > 0:
        victory_embed.add_field(
            name="ğŸ”“ XP Bloqueado Liberado!",
            value=f"*O XP acumulado durante o bloqueio foi liberado!*\nâ­ **+{pending_released:,} XP bÃ´nus**",
            inline=False
        )

    if leveled:
        p_after = get_player(user_id)
        victory_embed.add_field(name="ğŸ†™ Level Up!", value=f"*VocÃª chegou ao **NÃ­vel {p_after['level']}**!*", inline=False)

    # Unlock next world for level bosses + AUTO-TRAVEL
    boss_to_world = {}
    _boss_level_map = {9:1, 19:10, 29:20, 39:30, 49:40, 59:50, 69:60, 79:70, 89:80, 99:90,
                       109:100, 119:110, 129:120, 139:130, 149:140, 159:150, 169:160, 179:170, 189:180, 199:190,
                       209:200, 219:210, 229:220, 239:230, 249:240, 259:250, 269:260, 279:270, 289:280, 299:290,
                       309:300, 319:310, 329:320, 339:330, 349:340, 359:350, 369:360, 379:370, 389:380, 399:390,
                       409:400, 419:410, 429:420, 439:430, 449:440, 459:450, 469:460, 479:470, 489:480, 499:490,
                       509:500, 519:510, 529:520, 539:530, 549:540, 559:550, 569:560, 579:570, 589:580, 599:590}
    for _gate_lvl, _wk in _boss_level_map.items():
        _nearest = _wk if _wk in WORLDS else max((k for k in WORLDS.keys() if k <= _wk), default=1)
        _boss_name = WORLDS[_nearest]["boss"]["name"]
        # Map this boss to the NEXT world (one tier up)
        _all_world_keys = sorted(WORLDS.keys())
        _idx = _all_world_keys.index(_nearest) if _nearest in _all_world_keys else -1
        if _idx >= 0 and _idx + 1 < len(_all_world_keys):
            boss_to_world[_boss_name] = _all_world_keys[_idx + 1]
    next_world = boss_to_world.get(boss_data["name"])
    # SeguranÃ§a: se boss_data tinha nome errado, checar pelos bosses derrotados
    if not next_world:
        p_check = get_player(user_id)
        for b_name, w_key in boss_to_world.items():
            if b_name in p_check.get("bosses", []) and w_key not in p_check.get("worlds", [1]) and w_key in WORLDS:
                next_world = w_key
                break
    if next_world and next_world in WORLDS:
        p3 = get_player(user_id)
        if next_world not in p3["worlds"]:
            p3["worlds"].append(next_world)
            # AUTO-TRAVEL: move player to new world (muda mundo atual)
            # Garante que o novo mundo estÃ¡ na lista e marca como mundo atual
            p3["worlds"] = sorted(list(set(p3["worlds"])))
            p3["current_world"] = next_world  # avanÃ§a o mundo atual automaticamente
            save_player_db(user_id, p3)
            new_world_data = WORLDS[next_world]
            # Check if entering a new cycle
            cycle_transitions = {
                200: (2, "ğŸŒŒ Reinos AvanÃ§ados", "200â€“399", "As barreiras mortais se dissolvem! VocÃª adentra os Reinos AvanÃ§ados!"),
                400: (3, "ğŸ’« DimensÃµes Superiores", "400â€“499", "A realidade se fragmenta! VocÃª transcendeu os limites dimensionais!"),
                500: (4, "â™¾ï¸ Planos Absolutos", "500â€“600", "O cosmos tremeu com sua chegada! VocÃª entrou nos Planos Absolutos â€” o fim e o comeÃ§o de tudo!"),
            }
            if next_world in cycle_transitions:
                cycle_num, cycle_name, cycle_range, cycle_msg = cycle_transitions[next_world]
                cycle_embed = discord.Embed(
                    title=f"ğŸ”„ NOVO CICLO DESBLOQUEADO â€” CICLO {cycle_num}!",
                    description=f"**{cycle_name}** *(NÃ­v. {cycle_range})*\n\n*'{cycle_msg}'*\n\n"
                                f"âœ¦ **Novas dimensÃµes acessÃ­veis!**\n"
                                f"âœ¦ **Raridade de itens drasticamente aumentada!**\n"
                                f"âœ¦ **MecÃ¢nicas e habilidades superiores desbloqueadas!**\n"
                                f"âœ¦ **EvoluÃ§Ã£o de classes e pets do ciclo anterior liberada!**",
                    color=discord.Color.from_rgb(255, 215, 0)
                )
                cycle_embed.set_footer(text=f"Ciclo {cycle_num} | Use 'evoluÃ§Ã£o classe' para ver novas evoluÃ§Ãµes disponÃ­veis")
                await channel.send(embed=cycle_embed)
                await asyncio.sleep(1)
            victory_embed.add_field(
                name=f"ğŸŒ REINO DESBLOQUEADO & VIAGEM AUTOMÃTICA!",
                value=f"{new_world_data['emoji']} **{new_world_data['name']}** agora estÃ¡ acessÃ­vel!\n\n"
                      f"*'As correntes se rompem! As nÃ©voas se dissipam!'*\n"
                      f"**VocÃª foi automaticamente transportado para o novo reino!**\n"
                      f"*Para voltar, use `abrir mapa` e viaje manualmente.*",
                inline=False
            )
            await channel.send(embed=victory_embed)
            await asyncio.sleep(2)
            # Enviar embed de chegada ao novo mundo
            arrival_embed = discord.Embed(
                title=f"{new_world_data['emoji']} BEM-VINDO: {new_world_data['name']}!",
                description=f"*'{random.choice(new_world_data.get('events', ['VocÃª chega a um novo reino...']))}'*\n\n"
                            f"Um novo horizonte se abre diante de vocÃª! Este reino trarÃ¡ novos desafios, criaturas e segredos.\n\n"
                            f"Use `explorar` para comeÃ§ar sua aventura aqui.\nUse `abrir mapa` para voltar ao reino anterior.",
                color=discord.Color.gold()
            )
            arrival_embed.set_footer(text=f"Reino: {new_world_data['name']} | Use 'abrir mapa' para navegar entre reinos")
            await channel.send(embed=arrival_embed)
            # Drop + achievements after this return
            return

    # Item drop â€” boss Ã© a ÃšNICA fonte de MÃ­tico+
    # Bosses de level tÃªm chance maior de drops raros
    drop_rarity = None
    # Boss especial de dungeon secreta GARANTE drop da raridade definida
    if boss_data.get("is_secret_boss") and boss_data.get("special_drop_rarity"):
        _min_rarity = boss_data["special_drop_rarity"]
        _rarity_order = ["MÃ­tico", "Ancestral", "Divino", "Primordial"]
        _min_idx = _rarity_order.index(_min_rarity) if _min_rarity in _rarity_order else 0
        _rarity_pool = _rarity_order[_min_idx:]
        _weights = [50, 30, 20, 10][:len(_rarity_pool)]
        drop_rarity = random.choices(_rarity_pool, weights=_weights)[0]
    else:
        rand = random.random()
        if is_level_boss:
            # Boss de level: chances maiores
            if rand < 0.002:    # 0.2% Divino/Primordial
                drop_rarity = random.choice(["Divino", "Primordial"])
            elif rand < 0.015:  # 1.5% MÃ­tico
                drop_rarity = "MÃ­tico"
            elif rand < 0.05:   # 5% LendÃ¡rio
                drop_rarity = "LendÃ¡rio"
            elif rand < 0.14:   # 9% Ã‰pico
                drop_rarity = "Ã‰pico"
            elif rand < 0.28:   # 14% Raro
                drop_rarity = "Raro"
        else:
            # Boss comum: chances menores em MÃ­tico+
            if rand < 0.0003:   # 0.03% Divino/Primordial
                drop_rarity = random.choice(["Divino", "Primordial"])
            elif rand < 0.002:  # 0.2% MÃ­tico
                drop_rarity = "MÃ­tico"
            elif rand < 0.015:  # 1.5% LendÃ¡rio
                drop_rarity = "LendÃ¡rio"
            elif rand < 0.05:   # 5% Ã‰pico
                drop_rarity = "Ã‰pico"
            elif rand < 0.11:   # 6% Raro
                drop_rarity = "Raro"

    if drop_rarity:
        item_type = random.choice(["weapon", "armor"])
        item_list = "weapons" if item_type == "weapon" else "armor"
        items_of_rarity = [i for i in ITEMS[item_list] if i["rarity"] == drop_rarity]
        if items_of_rarity:
            item = random.choice(items_of_rarity)
            victory_embed.add_field(
                name=f"{'ğŸŒŸ' if drop_rarity in ['Divino','Primordial'] else 'âœ¨'} Drop Especial!",
                value=f"{RARITIES[drop_rarity]['emoji']} **{item['name']}** ({drop_rarity}) caiu do boss!\n*'Os deuses sorriem para vocÃª!'*",
                inline=False
            )
            await channel.send(embed=victory_embed)
            view = EquipButton(user_id, item["name"], item_type)
            await channel.send(f"âš”ï¸ **{item['name']}** brilha em suas mÃ£os! Deseja equipar?", view=view)

            # Achievements for drops
            if drop_rarity in ["Divino", "Primordial"]:
                await check_achievements(channel, user_id, "divine_drop")
            elif drop_rarity == "LendÃ¡rio":
                await check_achievements(channel, user_id, "legendary_drop")

            p4 = get_player(user_id)
            p4["inventory"].append(item["name"])
            save_player_db(user_id, p4)
        else:
            await channel.send(embed=victory_embed)
    else:
        # Potion drop
        if random.random() < 0.15:
            pot_rarities = ["Raro", "Ã‰pico"]
            pot_weights = [70, 30]
            chosen_rarity = random.choices(pot_rarities, weights=pot_weights)[0]
            pots = [name for name, data in POTIONS.items() if data["rarity"] == chosen_rarity]
            if pots:
                dropped_pot = random.choice(pots)
                p4 = get_player(user_id)
                p4["inventory"].append(dropped_pot)
                save_player_db(user_id, p4)
                victory_embed.add_field(name="ğŸ§ª PoÃ§Ã£o Encontrada!", value=f"{RARITIES[chosen_rarity]['emoji']} **{dropped_pot}** adicionado ao inventÃ¡rio!", inline=False)
        await channel.send(embed=victory_embed)

    # Check achievements
    await check_achievements(channel, user_id)
    if was_revenge:
        await check_achievements(channel, user_id, "comeback_win")
    if p_cur_hp >= int(p_max_hp * 0.8):
        await check_achievements(channel, user_id, "boss_no_damage")
    if not was_poisoned and not was_stunned:
        await check_achievements(channel, user_id, "perfect_boss_fight")
    if boss_data["name"] == "Slime Rei":
        await check_achievements(channel, user_id, "boss_slime_rei")
    if boss_data["name"] == "DragÃ£o de Magma":
        await check_achievements(channel, user_id, "boss_dragao")
    if boss_data["name"] == "Senhor das Sombras":
        await check_achievements(channel, user_id, "boss_sombras")
    # Check level boss
    p_bosses_beaten = player2.get("bosses", [])
    if len(p_bosses_beaten) >= 1:
        await check_achievements(channel, user_id, "level_boss_1")
    level_bosses_names = {"Slime Rei", "Ent AnciÃ£o", "FaraÃ³ AmaldiÃ§oado", "Yeti Colossal", "DragÃ£o de Magma", "Senhor das Sombras"}
    p3_final = get_player(user_id)
    if all(b in p3_final.get("bosses", []) for b in level_bosses_names):
        await check_achievements(channel, user_id, "all_level_bosses")
    # World unlocks
    worlds_count = len(p3_final.get("worlds", [1]))
    if worlds_count >= 2:
        await check_achievements(channel, user_id, "world_2")
    if worlds_count >= 3:
        await check_achievements(channel, user_id, "world_3")
    if worlds_count >= 4:
        await check_achievements(channel, user_id, "world_4")
    if worlds_count >= 5:
        await check_achievements(channel, user_id, "world_5")
    if len(WORLDS) <= worlds_count:
        await check_achievements(channel, user_id, "all_worlds")

    # â”€â”€ Check class evolution after boss fight (levels 40/80/120/160/200/400/500) â”€â”€
    p_evo = get_player(user_id)
    effects_evo = p_evo.get("active_effects", {})
    if effects_evo.pop("check_evolution", False):
        p_evo["active_effects"] = effects_evo
        save_player_db(user_id, p_evo)
        await check_class_evolution(channel, user_id)

    # â”€â”€ Check supreme skill unlock (boss-specific) â”€â”€
    cls = p_evo.get("class")
    if cls and cls in CLASS_TIERED_SKILLS:
        supreme = CLASS_TIERED_SKILLS[cls].get("supreme")
        if supreme:
            unlock_boss = supreme.get("unlock_boss", "")
            if boss_data["name"] == unlock_boss:
                supreme_skills = p_evo.get("supreme_skills", [])
                if supreme["name"] not in supreme_skills:
                    supreme_skills.append(supreme["name"])
                    p_evo["supreme_skills"] = supreme_skills
                    save_player_db(user_id, p_evo)
                    unlock_embed = discord.Embed(
                        title="ğŸ‘‘ HABILIDADE SUPREMA DESBLOQUEADA!",
                        description=(
                            f"**{supreme['name']}**\n\n"
                            f"*{supreme['desc']}*\n\n"
                            f"Derrotou **{unlock_boss}** e dominou o poder supremo da sua classe!"
                        ),
                        color=discord.Color.from_rgb(255, 215, 0)
                    )
                    unlock_embed.add_field(name="ğŸ’¥ Dano", value=f"{supreme['dmg_mult']}x", inline=True)
                    unlock_embed.add_field(name="ğŸ”µ Mana", value=f"{supreme['mana_cost']}", inline=True)
                    await channel.send(embed=unlock_embed)


async def explore_dungeon(channel, user_id, dungeon, world):
    player = get_player(user_id)
    roll = roll_with_bonus(player)
    luck = get_luck(roll)
    is_secret = dungeon.get("secret", False)
    level_mult = get_dungeon_difficulty_multiplier(player)  # mais difÃ­cil por nÃ­vel

    SECRET_EVENTS = [
        "ğŸŒ‘ *As paredes sangram sÃ­mbolos antigos...*",
        "ğŸ‘ï¸ *Mil olhos te observam das trevas...*",
        "ğŸŒ€ *A realidade distorce ao seu redor...*",
        "âš¡ *Energia arcana pulsa sob seus pÃ©s...*",
        "ğŸ”® *Vozes sussurram segredos proibidos...*",
    ]

    flavor = random.choice(SECRET_EVENTS) if is_secret else "*A dungeon Ã© escura e Ãºmida... VocÃª sente perigo em cada sombra.*"

    embed = discord.Embed(
        title=f"{'ğŸ”® MASMORRA SECRETA:' if is_secret else 'ğŸ›ï¸'} {dungeon['name']}",
        description=flavor,
        color=discord.Color.dark_purple()
    )
    embed.add_field(name="ğŸ² Dado da ExploraÃ§Ã£o", value=f"`{roll}` {luck['emoji']} **{luck['name']}**", inline=False)

    if is_secret:
        embed.set_footer(text=f"âš”ï¸ Masmorra Secreta â€” Dificuldade Ã—{level_mult:.1f} | Recompensas Ã—{level_mult:.1f}")

    if roll == 1:
        dmg = int(random.randint(40, 70) * (level_mult if is_secret else 1))
        player["hp"] -= dmg
        if player["hp"] <= 0:
            player["hp"] = player["max_hp"] // 3
        save_player_db(user_id, player)
        xp_loss_base = random.randint(150, 250) if is_secret else random.randint(100, 150)
        xp_loss_total = int(xp_loss_base * level_mult)
        result, xp_loss = remove_xp(user_id, xp_loss_total)

        trap_msgs = [
            "Uma armadilha de cristal explode ao seu toque! Fragmentos cortam por todo lado!",
            "Garras gigantes surgem do chÃ£o! VocÃª Ã© lanÃ§ado contra a parede!",
            "O teto desaba em blocos de pedra mÃ¡gica! Esmagamento inevitÃ¡vel!",
            "Um campo arcano eletrifica tudo ao redor! VocÃª convulsiona de dor!",
        ] if is_secret else ["Uma armadilha antiga Ã© ativada! LÃ¢minas surgem de todas as direÃ§Ãµes!"]

        embed.add_field(
            name="ğŸ’€ ARMADILHA MORTAL!",
            value=f"*'{random.choice(trap_msgs)}'*\n\nâŒ **âˆ’{xp_loss} XP**\nğŸ’” **âˆ’{dmg} HP**",
            inline=False
        )
        embed.color = discord.Color.dark_red()

    elif roll <= 3:
        xp_loss_base = random.randint(80, 120) if is_secret else random.randint(50, 80)
        xp_loss_total = int(xp_loss_base * (level_mult if is_secret else 1))
        result, xp_loss = remove_xp(user_id, xp_loss_total)
        if is_secret:
            msgs = [
                "Entidades do vazio bloqueiam seu caminho e drenam sua energia!",
                "Um labirinto dimensional te faz andar em cÃ­rculos por horas!",
                "A masmorra te estuda. VocÃª sai mais fraco do que entrou.",
            ]
            embed.add_field(
                name="â˜ ï¸ Pesadelo Dimensional",
                value=f"*'{random.choice(msgs)}'*\n\nâŒ **âˆ’{xp_loss} XP**",
                inline=False
            )
        else:
            embed.add_field(
                name="â˜ ï¸ ExploraÃ§Ã£o Perigosa",
                value=f"*'VocÃª se perde nos corredores sombrios...'*\n\nâŒ **âˆ’{xp_loss} XP**",
                inline=False
            )
        embed.color = discord.Color.red()

    elif roll <= 5:
        resources = random.sample(world["resources"], min(3 if is_secret else 2, len(world["resources"])))
        for r in resources:
            player["inventory"].append(r)
        save_player_db(user_id, player)
        items_text = "\n".join([f"â€¢ **{r}**" for r in resources])
        xp_bonus = int(random.randint(100, 200) * (level_mult if is_secret else 1))
        add_xp(user_id, xp_bonus)
        embed.add_field(
            name="ğŸ“¦ CÃ¢mara de Recursos",
            value=f"*'Uma cÃ¢mara intocada hÃ¡ sÃ©culos...'*\n\n{items_text}\nâ­ **+{xp_bonus} XP**", inline=False
        )
        embed.color = discord.Color.blue()

    elif roll <= 7:
        xp_base = random.randint(500, 900) if is_secret else random.randint(80, 150)
        coins_base = random.randint(20, 50) if is_secret else random.randint(10, 25)
        xp = int(xp_base * level_mult)
        coins = int(coins_base * level_mult)
        leveled = add_xp(user_id, xp)
        add_coins(user_id, coins)

        key_dropped = None
        potion_dropped = None

        if random.random() < (0.50 if is_secret else 0.25):
            potion_list = list(POTIONS.keys())
            potion_dropped = random.choice(potion_list[-5:] if is_secret else potion_list)
            player = get_player(user_id)
            player["inventory"].append(potion_dropped)
            save_player_db(user_id, player)

        # â”€â”€â”€ DROP DE CHAVE EM DUNGEON COMUM (garantido a cada 5 dungeons ou 8% de sorte) â”€â”€
        if not is_secret:
            player_for_key = get_player(user_id)
            dungeons_done = player_for_key.get("dungeons_completed", 0) + 1
            player_for_key["dungeons_completed"] = dungeons_done
            save_player_db(user_id, player_for_key)

            key_by_count = (dungeons_done % 5 == 0)
            key_by_luck  = random.random() < DUNGEON_KEY_DROP_CHANCE

            if key_by_count or key_by_luck:
                # Coleta TODAS as chaves com key_name definido em qualquer mundo
                all_valid_keys = []
                for w_data in WORLDS.values():
                    for sd in w_data.get("secret_dungeons", []):
                        kn = sd.get("key_name", "").strip()
                        if kn:
                            all_valid_keys.append(kn)

                # Prefere chaves do mundo atual
                current_world_keys = [
                    sd.get("key_name", "").strip()
                    for sd in world.get("secret_dungeons", [])
                    if sd.get("key_name", "").strip()
                ]
                pool = current_world_keys if current_world_keys else all_valid_keys

                if pool:
                    chosen_key = random.choice(pool)
                    player = get_player(user_id)
                    player["inventory"].append(chosen_key)
                    save_player_db(user_id, player)
                    key_dropped = chosen_key

        chest_bonus = ""
        if potion_dropped:
            chest_bonus += f"\nğŸ§ª **{potion_dropped}** dropada!"
        if key_dropped:
            chest_bonus += f"\nğŸ—ï¸ **{key_dropped}** encontrada no baÃº! *(Use para entrar na dungeon secreta!)*"
            # Mensagem dramÃ¡tica de chave
            key_msgs = [
                f"*'Um brilho estranho emana do corpo caÃ­do do boss... Uma chave cai ao chÃ£o com um tinido!'*",
                f"*'Nas entranhas do monstro, algo metÃ¡lico brilha. Uma chave... mas para onde ela abre?'*",
                f"*'O boss se dissolve em sombras, deixando para trÃ¡s uma chave enferrujada de origem desconhecida...'*",
                f"*'Uau, achou uma chave! Sla pra que serve isso... mas parece importante. Muito importante.'*",
                f"*'Uma chave surge do nada entre os escombros. AlguÃ©m claramente nÃ£o queria que vocÃª a encontrasse.'*",
            ]
            await asyncio.sleep(1)
            key_embed = discord.Embed(
                title="ğŸ—ï¸ CHAVE ENCONTRADA!",
                description=random.choice(key_msgs) + f"\n\nğŸ”‘ VocÃª obteve: **{key_dropped}**\n\n*Esta chave abre uma dungeon secreta! Use `usar chave [nome da dungeon]` para entrar diretamente, ou `ver chaves` para saber qual dungeon ela abre.*",
                color=discord.Color.from_rgb(255, 200, 0)
            )
            key_embed.set_footer(text="Use 'dungeon' e encontre a dungeon secreta para usar esta chave!")
            await channel.send(embed=key_embed)

        embed.add_field(
            name="ğŸ’ CÃ¢mara do Tesouro!",
            value=f"*'{'Um tesouro ancestral brilha com luz prÃ³pria!' if is_secret else 'VocÃª encontra um baÃº antigo cheio de riquezas!'}'*\n\nâ­ **+{xp} XP**\nğŸ’° **+{coins} CSI**{chest_bonus}",
            inline=False
        )
        if leveled:
            player = get_player(user_id)
            embed.add_field(name="ğŸ†™ Level Up!", value=f"**NÃ­vel {player['level']}**", inline=False)
        embed.color = discord.Color.green()

    elif roll <= 9:
        item_type = random.choice(["weapon", "armor"])
        item_list = "weapons" if item_type == "weapon" else "armor"
        if is_secret:
            # Usa raridade mÃ­nima definida na dungeon, ou MÃ­tico por padrÃ£o
            min_rarity = dungeon.get("special_boss_drop", "MÃ­tico")
            rarity_order = ["MÃ­tico", "Ancestral", "Divino", "Primordial"]
            min_idx = rarity_order.index(min_rarity) if min_rarity in rarity_order else 0
            rarity_pool = rarity_order[min_idx:]
            # Pesos decrescentes
            all_weights = [50, 30, 25, 15]
            weights = all_weights[min_idx:min_idx + len(rarity_pool)]
            if not weights:
                rarity_pool = ["MÃ­tico", "Ancestral", "Divino", "Primordial"]
                weights = [50, 30, 25, 15]
        else:
            rarity_pool = ["Raro", "Ã‰pico", "LendÃ¡rio"]
            weights = [40, 40, 20]
        rarity = random.choices(rarity_pool, weights=weights)[0]
        items_filtered = [i for i in ITEMS[item_list] if i["rarity"] == rarity]
        item = random.choice(items_filtered) if items_filtered else random.choice(ITEMS[item_list])

        xp_base = random.randint(800, 1500) if is_secret else random.randint(120, 200)
        coins_base = random.randint(30, 80) if is_secret else random.randint(15, 35)
        xp = int(xp_base * level_mult)
        coins = int(coins_base * level_mult)
        leveled = add_xp(user_id, xp)
        add_coins(user_id, coins)

        rarity_info = RARITIES[item["rarity"]]
        embed.add_field(
            name=f"{'ğŸŒŸ ITEM LENDÃRIO DA MASMORRA!' if is_secret else 'âœ¨ Equipamento Raro!'}",
            value=f"*'{'Um artefato que nÃ£o deveria existir...' if is_secret else 'Em uma sala secreta, vocÃª encontra um equipamento magnÃ­fico!'}'*\n\n{rarity_info['emoji']} **{item['name']}**\nâ­ **+{xp} XP**\nğŸ’° **+{coins} CSI**",
            inline=False
        )
        if leveled:
            player = get_player(user_id)
            embed.add_field(name="ğŸ†™ Level Up!", value=f"**NÃ­vel {player['level']}**", inline=False)
        embed.color = rarity_info["color"]

        await channel.send(embed=embed)
        await asyncio.sleep(1)
        view = EquipButton(user_id, item["name"], item_type)
        await channel.send(f"âœ¨ **{item['name']}** aguarda por vocÃª!\n\n*'Deseja equipar?'*", view=view)
        return

    else:  # roll == 10
        # Boss sÃ³ aparece em 35% dos roll==10 (reduz frequÃªncia excessiva)
        if not is_secret and random.random() > 0.35:
            # Sem boss â€” dÃ¡ item bom em vez disso
            item_type = random.choice(["weapon", "armor"])
            item_list = "weapons" if item_type == "weapon" else "armor"
            epic_pool = [i for i in ITEMS[item_list] if i["rarity"] in ["Ã‰pico", "LendÃ¡rio"]]
            item = random.choice(epic_pool) if epic_pool else random.choice(ITEMS[item_list])
            xp_base = random.randint(150, 280)
            coins_base = random.randint(20, 50)
            xp = int(xp_base * level_mult)
            coins = int(coins_base * level_mult)
            leveled = add_xp(user_id, xp)
            add_coins(user_id, coins)
            rarity_info = RARITIES.get(item["rarity"], RARITIES["Ã‰pico"])
            embed.add_field(
                name="ğŸ’ CÃ¢mara do Tesouro Oculta!",
                value=f"*'No fundo da dungeon, vocÃª encontra uma cÃ¢mara escondida...'*\n\n{rarity_info['emoji']} **{item['name']}**\nâ­ **+{xp} XP** | ğŸ’° **+{coins} CSI**",
                inline=False
            )
            player = get_player(user_id)
            player["inventory"].append(item["name"])
            save_player_db(user_id, player)
            embed.color = rarity_info["color"]
            await channel.send(embed=embed)
            return
        if is_secret:
            boss_power_msgs = [
                "ğŸ‘ï¸ *Uma entidade primordial abre os olhos. Ela existia antes do tempo. E agora... te enxerga.*",
                "ğŸŒ‘ *O guardiÃ£o final desperta. VocÃª sentiu isso vindo desde o inÃ­cio da masmorra.*",
                "ğŸ’€ *A morte personificada bloqueia a cÃ¢mara central. NÃ£o hÃ¡ fuga. SÃ³ hÃ¡ batalha.*",
                "ğŸŒ€ *A realidade se distorce ao redor de um ser que nÃ£o deveria existir. E ele estÃ¡ com raiva.*",
            ]
            embed.add_field(
                name="ğŸ‘¹ GUARDIÃƒO FINAL DA MASMORRA SECRETA!",
                value=f"{random.choice(boss_power_msgs)}\n\n**{dungeon['boss']}** se ergue das sombras com poder incompreensÃ­vel!\n\n*Esta batalha ficarÃ¡ gravada na sua memÃ³ria para sempre...*",
                inline=False
            )
        else:
            boss_appear_msgs = [
                f"*'VocÃª chega Ã  cÃ¢mara final... e o ar pesado te diz que nÃ£o estÃ¡ sozinho.'*",
                f"*'Um rugido ecoa pelas paredes. O boss acordou â€” e parece estar esperando por vocÃª.'*",
                f"*'Passos pesados. Sombra crescente. **{dungeon['boss']}** bloqueia sua saÃ­da!'*",
            ]
            embed.add_field(
                name="ğŸ‘¹ O BOSS DA DUNGEON APARECE!",
                value=f"{random.choice(boss_appear_msgs)}\n\n**{dungeon['boss']}** surge com fÃºria das sombras!",
                inline=False
            )
        embed.color = discord.Color.dark_red()
        await channel.send(embed=embed)
        await asyncio.sleep(2)

        # Boss de dungeon secreta Ã© MUITO mais forte
        player_level = player.get("level", 1)
        if is_secret:
            special_drop_rarity = dungeon.get("special_boss_drop", "MÃ­tico")
            # Escala fortemente pelo nÃ­vel do jogador
            boss_data = {
                "name": dungeon["boss"],
                "hp":   int((player_level * 180 + dungeon["level"] * 300) * level_mult),
                "atk":  int((player_level * 8  + dungeon["level"] * 20)  * level_mult),
                "xp":   int((2000 + dungeon["level"] * 300 + player_level * 50) * level_mult),
                "coins": (
                    int((60 + dungeon["level"] * 10 + player_level * 3) * level_mult),
                    int((150 + dungeon["level"] * 20 + player_level * 6) * level_mult)
                ),
                "special_drop_rarity": special_drop_rarity,
                "is_secret_boss": True
            }
        else:
            # Boss comum de dungeon â€” agora escala pelo nÃ­vel do jogador tambÃ©m
            boss_data = {
                "name": dungeon["boss"],
                "hp":   player_level * 120 + dungeon["level"] * 80,
                "atk":  player_level * 5  + dungeon["level"] * 8,
                "xp":   250 + dungeon["level"] * 60 + player_level * 15,
                "coins": (
                    20 + dungeon["level"] * 5  + player_level * 2,
                    60 + dungeon["level"] * 10 + player_level * 4
                )
            }
        await fight_boss(channel, user_id, is_dungeon=True, dungeon_boss=boss_data)
        return

    await channel.send(embed=embed)

# ================= TAREFAS PERIÃ“DICAS =================

@tasks.loop(minutes=20)
async def random_world_events():
    for guild in bot.guilds:
        channel = discord.utils.get(guild.text_channels, name=CANAL_BETA)
        if not channel:
            continue

        event_type = random.choice(["structure", "narrator", "merchant", "pet", "book"])

        if event_type == "structure":
            structure = random.choice(STRUCTURES)
            embed = discord.Embed(
                title=f"{structure['name']} Avistada!",
                description=f"*'{structure['narrator']}'*",
                color=discord.Color.purple()
            )
            embed.add_field(name="ğŸ“ DescriÃ§Ã£o", value=structure["description"], inline=False)
            await channel.send(embed=embed)

        elif event_type == "narrator":
            warning = random.choice(NARRATOR_WARNINGS)
            try:
                members = [m for m in guild.members if not m.bot]
                if members:
                    random_member = random.choice(members)
                    embed = discord.Embed(
                        title="ğŸ“– O Narrador Fala",
                        description=f"*Uma voz ecoa direcionada a {random_member.mention}...*\n\n**\"{warning}\"**",
                        color=discord.Color.dark_gold()
                    )
                    await channel.send(embed=embed)
            except:
                pass

        elif event_type == "merchant":
            items_for_sale = []
            weapon = random.choice([i for i in ITEMS["weapons"] if i["rarity"] in ["Incomum", "Raro", "Ã‰pico"]])
            weapon_price = {"Incomum": 300, "Raro": 900, "Ã‰pico": 2000}[weapon["rarity"]]
            items_for_sale.append({"name": weapon["name"], "type": "weapon", "price": weapon_price})

            armor = random.choice([i for i in ITEMS["armor"] if i["rarity"] in ["Incomum", "Raro", "Ã‰pico"]])
            armor_price = {"Incomum": 300, "Raro": 900, "Ã‰pico": 2000}[armor["rarity"]]
            items_for_sale.append({"name": armor["name"], "type": "armor", "price": armor_price})

            items_for_sale.append({"name": "PoÃ§Ã£o de Vida", "type": "potion", "price": 150})

            embed = discord.Embed(
                title="ğŸª Mercador Errante Apareceu!",
                description="*'Um mercador misterioso surge do nada oferecendo seus produtos...'*",
                color=discord.Color.gold()
            )
            for i, item in enumerate(items_for_sale, 1):
                embed.add_field(name=f"Item {i}: {item['name']}", value=f"ğŸ’° **PreÃ§o: {item['price']} CSI**", inline=False)

            await channel.send(embed=embed, view=ShopButton(None, items_for_sale))

        elif event_type == "pet":
            world_levels = list(PETS.keys())
            chosen_world = random.choice(world_levels)
            pet = random.choice(PETS[chosen_world])
            embed = discord.Embed(
                title=f"{pet['emoji']} Criatura Selvagem Apareceu!",
                description=f"*'Um **{pet['name']}** selvagem aparece no horizonte!'*",
                color=RARITIES[pet["rarity"]]["color"]
            )
            embed.add_field(name="âœ¨ Raridade", value=f"{RARITIES[pet['rarity']]['emoji']} {pet['rarity']}", inline=True)
            embed.add_field(name="ğŸ’ª BÃ´nus ATK", value=f"+{pet['bonus_atk']}", inline=True)
            embed.add_field(name="â¤ï¸ BÃ´nus HP", value=f"+{pet['bonus_hp']}", inline=True)
            embed.set_footer(text="Use 'domesticar' para tentar capturÃ¡-lo!")
            await channel.send(embed=embed)

        elif event_type == "book":
            # Livro de lore aleatÃ³rio aparece
            world_key = random.choice(list(LORE_BOOKS.keys()))
            book = random.choice(LORE_BOOKS[world_key])
            embed = discord.Embed(
                title=f"ğŸ“š Um Livro Antigo Foi Encontrado!",
                description=f"*'As pÃ¡ginas se abrem sozinhas...'*",
                color=discord.Color.dark_gold()
            )
            embed.add_field(name=book["title"], value=book["content"][:1024], inline=False)
            await channel.send(embed=embed)


# ================= PRÃ“LOGO =================
async def send_prologue(guild):
    channel = discord.utils.get(guild.text_channels, name=CANAL_BETA)
    if not channel:
        return

    await asyncio.sleep(1)

    # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    # EMBED 1 â€” Abertura Ã©pica do narrador
    # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    embed1 = discord.Embed(
        title="ğŸ“–  W O R L D   C S I  ğŸ“–",
        description=(
            "```\n"
            "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—\n"
            "â•‘   O Narrador Desperta...                 â•‘\n"
            "â•‘   A Maior Saga de Todos os Ciclos ComeÃ§a â•‘\n"
            "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n"
            "```\n"
            "*Uma voz grave ecoa por todo o servidor...*\n\n"
            "**\"No princÃ­pio, havia apenas o Vazio â€” um silÃªncio perfeito e eterno.**\n"
            "EntÃ£o, a Primeira Chama surgiu do nada, e com ela nasceu o Mundo.\n\n"
            "Quarenta reinos se formaram das cinzas da criaÃ§Ã£o.\n"
            "Cinco DimensÃµes aguardam alÃ©m deles, cada uma um mundo em si mesma.\n"
            "Seis ciclos de existÃªncia dividem o que os mortais chamam de realidade.\n"
            "Cada ciclo transcende o anterior de formas que a mente mortal mal pode conceber.\n\n"
            "**VocÃª... Ã© o prÃ³ximo herÃ³i desta histÃ³ria.**\n"
            "Ou talvez o prÃ³ximo Absoluto. O destino Ã© seu para escrever.\"\n\n"
            "*â€” O Narrador, antes que a histÃ³ria comece*"
        ),
        color=0x2C2F33
    )
    embed1.set_footer(text="ğŸ­ O Narrador observa cada passo seu... atÃ© o Plano Absoluto.")
    await channel.send(embed=embed1)
    await asyncio.sleep(2)

    # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    # EMBED 2 â€” CapÃ­tulos do Mundo (lista de reinos)
    # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    embed2 = discord.Embed(
        title="ğŸ“– Os 7 CapÃ­tulos do Mundo",
        description=(
            "*O Narrador abre o grande livro do destino...*\n\n"
            "Use `abrir mapa` para navegar pelos capÃ­tulos com os botÃµes **â—€ â–¶**.\n"
            "Cada capÃ­tulo mostra os reinos desbloqueados, locais e dungeons secretas."
        ),
        color=0x1a0033
    )
    embed2.add_field(
        name="ğŸ“– Cap. I â€” Terras Iniciais  â€¢  NÃ­vel 1â€“100",
        value="ğŸŒ±ğŸŒ²ğŸœï¸â„ï¸ğŸŒ‹ğŸŒŒğŸ‘‘ğŸŒ¿ğŸ’ğŸŒ‘  â€¢  ğŸ—ï¸ Chave Antiga",
        inline=False
    )
    embed2.add_field(
        name="ğŸ“– Cap. II â€” NaÃ§Ãµes IntermediÃ¡rias  â€¢  NÃ­vel 101â€“200",
        value="âš¡ğŸ—¿ğŸŒŠğŸŒ€ğŸŒ¸ğŸ§ŠğŸ›ï¸âœ¨ğŸŒŒâ­  â€¢  ğŸ”‘ Chave Arcana",
        inline=False
    )
    embed2.add_field(
        name="ğŸ“– Cap. III â€” ImpÃ©rios AvanÃ§ados  â€¢  NÃ­vel 201â€“300",
        value="ğŸ”±âš¡ğŸŒ€ğŸ”ï¸ğŸŒŠğŸ”¥â„ï¸âš—ï¸ğŸŒŒâš–ï¸  â€¢  ğŸ—¡ï¸ Chave Sombria",
        inline=False
    )
    embed2.add_field(
        name="ğŸ“– Cap. IV â€” Terras Corrompidas  â€¢  NÃ­vel 301â€“350",
        value="ğŸ—¡ï¸ğŸ‘ï¸ğŸ”®ğŸ’ğŸŒ‘  â€¢  ğŸ—¡ï¸ Chave Sombria",
        inline=False
    )
    embed2.add_field(
        name="ğŸ“– Cap. V â€” Reinos Dimensionais  â€¢  NÃ­vel 351â€“400",
        value="â˜„ï¸ğŸŒğŸ•³ï¸ğŸŒâš¡  â€¢  âœ¨ Chave Celestial  â€¢  ğŸ’¥ Bosses liberam passivas!",
        inline=False
    )
    embed2.add_field(
        name="ğŸ“– Cap. VI â€” As 5 DimensÃµes  â€¢  NÃ­vel 401â€“500",
        value="ğŸ•Šï¸ Celestial  â€¢  ğŸ”¥ Infernal  â€¢  ğŸŒªï¸ Badlands  â€¢  ğŸŒ‘ Abissal  â€¢  ğŸŒ€ Vazio  â€¢  ğŸŒ‘ Chave Abissal",
        inline=False
    )
    embed2.add_field(
        name="ğŸ“– Cap. VII â€” Planos Absolutos  â€¢  NÃ­vel 501â€“600",
        value="ğŸ”±ğŸŒ ğŸ’«ğŸŒ€ğŸ›ï¸â­ğŸŒŒâš¡ğŸ”±ğŸ’ğŸŒ â™¾ï¸ğŸŒ‘ğŸŒŸâš–ï¸ğŸ”¥ğŸŒŠğŸ’¨âš¡ğŸŒŒâ™¾ï¸  â€¢  ğŸŒ‘ Chave Abissal",
        inline=False
    )
    embed2.set_footer(text="ğŸ—ºï¸ Use `abrir mapa` para explorar com os botÃµes â—€ â–¶ â€¢ 40 reinos â€¢ 5 dimensÃµes â€¢ 7 capÃ­tulos")
    await channel.send(embed=embed2)
    await asyncio.sleep(2)

    # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    # EMBED 3 â€” CapÃ­tulos interativos (â—€ â–¶)
    # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    chap_embed, chap_view = build_prologue_chapter_embed(1)
    await channel.send(embed=chap_embed, view=chap_view)
    await asyncio.sleep(2)

    # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    # EMBED 5 â€” Lore: A Guerra Primordial
    # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    embed5 = discord.Embed(
        title="ğŸ“œ CrÃ´nicas da Guerra Primordial",
        description=(
            "*Um livro antigo se abre sozinho nas pÃ¡ginas proibidas...*\n\n"
            "**'O Que Existia Antes dos Ciclos'**\n\n"
            "Antes que qualquer ciclo existisse, houve uma guerra sem nome.\n\n"
            "De um lado: a **Luz Primordial**, que queria existÃªncia, forma, vida.\n"
            "Do outro: o **Vazio Eterno**, que queria silÃªncio, paz, nada.\n\n"
            "Eles lutaram por uma eternidade que nÃ£o tinha nome ainda.\n"
            "A batalha terminou sem vencedor â€” ambos exaustos, fizeram um acordo:\n"
            "criariam algo novo. Algo que contivesse os dois.\n\n"
            "Chamaram isso de ***Universo***. E o dividiram em quatro ciclos crescentes.\n"
            "Cada ciclo mais prÃ³ximo da verdade absoluta â€” e mais distante do mortal.\n\n"
            "**A guerra nÃ£o terminou. Apenas mudou de palco.**\n"
            "E agora ela acontece dentro de vocÃª.\n\n"
            "*â€” Fragmento encontrado no 'Plano Absoluto Final', autor: O Absoluto*"
        ),
        color=0x1a0033
    )
    embed5.set_footer(text="ğŸ“š Explore os mundos para encontrar mais fragmentos de lore.")
    await channel.send(embed=embed5)
    await asyncio.sleep(2)

    # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    # EMBED 6 â€” Sistema de Alinhamento
    # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    embed6 = discord.Embed(
        title="âš–ï¸ O Peso das Escolhas",
        description=(
            "*O Narrador observa vocÃª com olhos que viram mil histÃ³rias e quatro ciclos...*\n\n"
            "**Neste mundo, suas aÃ§Ãµes tÃªm consequÃªncias morais que atravessam todos os ciclos.**\n\n"
            "Salvar uma dimensÃ£o ou consumi-la.\n"
            "Proteger os planos ou destruÃ­-los.\n"
            "Cada escolha ressoa atÃ© o Plano Absoluto:"
        ),
        color=0x9B59B6
    )
    embed6.add_field(
        name="âœ¨ HerÃ³i (+30 pontos ou mais)",
        value="*'Sua luz guia atÃ© os que habitam alÃ©m das dimensÃµes.'*\nAcesso a missÃµes de proteÃ§Ã£o, recompensas divinas e respeito universal.",
        inline=False
    )
    embed6.add_field(
        name="âš–ï¸ Anti-HerÃ³i (-5 a -29 pontos)",
        value="*'VocÃª faz o bem pelos motivos errados... ou o errado pelos motivos certos.'*\nMissÃµes de moral cinza com recompensas Ãºnicas em todos os ciclos.",
        inline=False
    )
    embed6.add_field(
        name="ğŸ’€ VilÃ£o (-30 pontos ou menos)",
        value="*'O poder nÃ£o se pede. Se toma. E com ele, os planos tremem.'*\nMissÃµes de conquista e destruiÃ§Ã£o com XP massivo â€” e consequÃªncias absolutas.",
        inline=False
    )
    embed6.add_field(
        name="ğŸ­ Como funciona",
        value="Use `cenÃ¡rio` para enfrentar dilemas morais!\nUse `alinhamento` para ver seu estado atual.\nUse `missÃ£o moral` para quests de alinhamento.",
        inline=False
    )
    await channel.send(embed=embed6)
    await asyncio.sleep(2)

    # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    # EMBED 7 â€” Empregos e TÃ­tulos
    # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    embed7 = discord.Embed(
        title="ğŸ’¼ Empregos & TÃ­tulos do Reino",
        description=(
            "*O taberneiro pregou uma lista de oportunidades na parede...*\n\n"
            "**A partir do nÃ­vel 5**, vocÃª pode trabalhar e ganhar salÃ¡rio!\n"
            "Empregos funcionam em todos os ciclos â€” quanto maior seu nÃ­vel, maior o salÃ¡rio."
        ),
        color=0xE67E22
    )
    embed7.add_field(name="âš’ï¸ Ferreiro (Nv.5)", value="Forja armas Ãºnicas, fusÃ£o de itens, 20% desc. em lojas", inline=True)
    embed7.add_field(name="ğŸ”® Arcano (Nv.5)", value="+15 mana mÃ¡x, acesso a grimÃ³rios arcanos", inline=True)
    embed7.add_field(name="ğŸ’š Curandeiro (Nv.5)", value="Cura aliados, poÃ§Ãµes 30% mais baratas", inline=True)
    embed7.add_field(name="ğŸ’° Mercador (Nv.5)", value="Vende 25% a mais, acesso ao mercado negro", inline=True)
    embed7.add_field(name="ğŸ“œ Escriba (Nv.5)", value="Descobre locais 2Ã— mais rÃ¡pido, lore extra", inline=True)
    embed7.add_field(name="âš”ï¸ Cavaleiro (Nv.10)", value="+20 HP, defende cidades de invasÃµes", inline=True)
    embed7.add_field(name="ğŸ›¡ï¸ Guarda Real (Nv.15)", value="+35 HP, comanda a guarda do reino", inline=True)
    embed7.add_field(name="ğŸ‘‘ Rei (Nv.30)", value="Governa, nomeia cavaleiros, recebe tributo real", inline=True)
    embed7.add_field(
        name="ğŸ“£ Como comeÃ§ar",
        value="`procurar emprego` â†’ escolha sua profissÃ£o â†’ `trabalhar` a cada 30 min!",
        inline=False
    )
    await channel.send(embed=embed7)
    await asyncio.sleep(2)

    # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    # EMBED 8 â€” Guia Completo de Comandos
    # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    embed8 = discord.Embed(
        title="âš”ï¸ Guia Completo de Comandos â€” World CSI",
        description="*Tudo que vocÃª precisa para conquistar os quatro ciclos:*",
        color=0x3498DB
    )
    embed8.add_field(
        name="ğŸŒ ExploraÃ§Ã£o & CaÃ§a",
        value="`explorar` | `caÃ§ar` | `coletar` | `minerar` | `dungeon` | `procurar dungeon`",
        inline=False
    )
    embed8.add_field(
        name="ğŸ‘¹ Boss & Combate",
        value=(
            "`encontrar boss` â€” boss do reino atual\n"
            "`desafiar boss` â€” enfrente o boss (**boss de nÃ­vel** nos nÃ­veis 9/19/29/.../599)\n"
            "`juntar boss` | `iniciar batalha boss` | `desafiar @jogador`"
        ),
        inline=False
    )
    embed8.add_field(
        name="ğŸš¨ Boss de NÃ­vel â€” Sistema de Bloqueio",
        value=(
            "Nos **60 nÃ­veis terminados em 9** (9, 19, 29... 599) o XP Ã© **bloqueado**!\n"
            "O XP acumula e Ã© liberado quando vocÃª **vencer o boss de nÃ­vel**.\n"
            "Somente o Boss de NÃ­vel desbloqueia o prÃ³ximo reino e novas habilidades."
        ),
        inline=False
    )
    embed8.add_field(
        name="ğŸ’ª Treinamento (apÃ³s derrota em boss)",
        value="`treinar forÃ§a` â€” +ATK\n`treinar defesa` â€” +DEF\n`treinar vitalidade` â€” +HP MÃ¡x\n`treinar intensivo` â€” +ATK+DEF+HP",
        inline=False
    )
    embed8.add_field(
        name="ğŸ‘¤ Personagem & EvoluÃ§Ã£o",
        value="`ver perfil` | `inventÃ¡rio` | `escolher raÃ§a` | `evoluir raÃ§a` | `escolher classe` | `habilidades` | `evoluÃ§Ã£o classe` | `ver mana`",
        inline=False
    )
    embed8.add_field(
        name="ğŸŒŸ Ciclos & EvoluÃ§Ãµes de Classe",
        value=(
            "**7 tiers** de evoluÃ§Ã£o por classe:\n"
            "NÃ­v. **40** Tier I â†’ **80** Tier II â†’ **120** Tier III â†’ **160** Tier IV\n"
            "â†’ **200** Tier V (Transcendental) â†’ **400** Tier VI (Dimensional) â†’ **500** Tier VII (Absoluto)"
        ),
        inline=False
    )
    embed8.add_field(
        name="ğŸ¾ Pets & Fazenda",
        value="`fazenda` | `trocar pet` | `guardar pet` | `procurar pet` | `domesticar` | `evoluir pet` | `stats pet`",
        inline=False
    )
    embed8.add_field(
        name="ğŸ’¼ Empregos, Quests & Moral",
        value="`procurar emprego` | `trabalhar` | `ver quests` | `realizar quest` | `cenÃ¡rio` | `missÃ£o moral` | `alinhamento`",
        inline=False
    )
    embed8.add_field(
        name="ğŸ—ºï¸ Mapa, Guilda & Social",
        value="`abrir mapa` | `viajar <local>` | `criar guilda` | `entrar guilda` | `ver guilda` | `trocar [item] com @user`",
        inline=False
    )
    embed8.add_field(
        name="ğŸ›’ Itens, Economia & AFK",
        value="`equipar [item]` | `vender [item]` | `usar [poÃ§Ã£o]` | `trocar coins` | `farm afk` | `clima` | `perÃ­odo` | `descansar`",
        inline=False
    )
    embed8.add_field(
        name="ğŸ“š Info, Lore & Especiais",
        value="`comandos` â€” lista completa | `atualizaÃ§Ã£o` â€” novidades | `falar npc especial` | `dialogar com npc [nome]` | `abrir livro` | `ver conquistas`",
        inline=False
    )
    embed8.set_footer(text="ğŸŒŸ Use 'comandos' para esta lista a qualquer momento | 'atualizaÃ§Ã£o' para novidades | 'ver perfil' para seu estado")
    await channel.send(embed=embed8)
    await asyncio.sleep(1)

    # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    # EMBED 9 â€” Nota de AtualizaÃ§Ã£o (Patch Notes)
    # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    embed9 = discord.Embed(
        title="ğŸ“‹ ATUALIZAÃ‡ÃƒO â€” ExpansÃ£o: 40 Reinos & 5 DimensÃµes",
        description=(
            "*O Narrador desdobra um pergaminho oficial com o selo dos Seis Ciclos...*\n\n"
            "**\"Uma nova era de poder comeÃ§a. O mundo cresceu alÃ©m de tudo que qualquer mortal imaginou.\"**\n"
            "**VersÃ£o:** Reinos & DimensÃµes â€” Fevereiro 2026"
        ),
        color=0x2ECC71
    )
    embed9.add_field(
        name="ğŸ° 40 Reinos + 5 DimensÃµes",
        value=(
            "O mundo agora tem **40 reinos** organizados em 4 grupos geogrÃ¡ficos/narrativos:\n"
            "ğŸŒ± Reinos 1â€“10: **Terras Iniciais** | âš”ï¸ Reinos 11â€“20: **NaÃ§Ãµes IntermediÃ¡rias**\n"
            "ğŸ›ï¸ Reinos 21â€“30: **ImpÃ©rios AvanÃ§ados** | ğŸ©¸ Reinos 31â€“35: **Terras Corrompidas**\n"
            "ğŸŒ€ Reinos 36â€“40: **Reinos Dimensionais**\n\n"
            "A partir do nÃ­vel 400: **5 DimensÃµes** (Celestial, Infernal, Badlands, Abissal, Vazio)"
        ),
        inline=False
    )
    embed9.add_field(
        name="ğŸ”„ 6 Ciclos de Mundo",
        value=(
            "ğŸŒ± **Ciclo 1** â€” Terras Iniciais (1â€“100) | âš”ï¸ **Ciclo 2** â€” NaÃ§Ãµes IntermediÃ¡rias (101â€“200)\n"
            "ğŸ›ï¸ **Ciclo 3** â€” ImpÃ©rios AvanÃ§ados (201â€“300) | ğŸ©¸ **Ciclo 4** â€” Corrompidas+Dimensionais (301â€“400)\n"
            "ğŸŒŒ **Ciclo 5** â€” As 5 DimensÃµes (401â€“500) | â™¾ï¸ **Ciclo 6** â€” Planos Absolutos (501â€“600)"
        ),
        inline=False
    )
    embed9.add_field(
        name="ğŸ—ï¸ 5 Tipos de Chave para Dungeons Secretas",
        value=(
            "Cada ciclo tem seu tipo de chave especÃ­fico:\n"
            "ğŸ—ï¸ **Chave Antiga** â€” Terras Iniciais (reinos 1â€“10)\n"
            "ğŸ”‘ **Chave Arcana** â€” NaÃ§Ãµes IntermediÃ¡rias (reinos 11â€“20)\n"
            "ğŸ—¡ï¸ **Chave Sombria** â€” ImpÃ©rios AvanÃ§ados + Terras Corrompidas (reinos 21â€“35)\n"
            "âœ¨ **Chave Celestial** â€” Reinos Dimensionais + DimensÃ£o Celestial (reinos 36â€“40)\n"
            "ğŸŒ‘ **Chave Abissal** â€” DimensÃµes Infernal, Badlands, Abissal e Vazio"
        ),
        inline=False
    )
    embed9.add_field(
        name="ğŸ’¥ Bosses Dimensionais â€” Sistemas Novos",
        value=(
            "Os Bosses Dimensionais (reinos 36â€“40 e Ciclo 5) liberam sistemas exclusivos:\n"
            "â€¢ ğŸ”® **Habilidades Passivas Globais** â€” ativas para sempre apÃ³s o boss\n"
            "â€¢ ğŸ¾ **Slot Extra de Pet** â€” capacidade de pet expandida\n"
            "â€¢ âš”ï¸ **Slot Extra de Equipamento** â€” novo slot de item disponÃ­vel\n"
            "â€¢ Efeitos Ambientais: dano contÃ­nuo, debuff de sanidade, buff sagrado e mais!"
        ),
        inline=False
    )
    embed9.add_field(
        name="ğŸ° Cada Reino Agora Tem",
        value=(
            "â€¢ ğŸ™ï¸ Cidade principal | â€¢ 4â€“6 Ã¡reas explorÃ¡veis\n"
            "â€¢ 1 Dungeon comum | â€¢ 1 Dungeon avanÃ§ada\n"
            "â€¢ 1 Dungeon secreta (ativada por chave)\n"
            "â€¢ 1 Boss de Level | â€¢ 1â€“2 Bosses opcionais | â€¢ 1 World Event raro"
        ),
        inline=False
    )
    embed9.add_field(
        name="ğŸ“Š Hierarquia de Raridades (inalterada)",
        value=(
            "âšª Comum â†’ ğŸŸ¢ Incomum â†’ ğŸ”µ Raro â†’ ğŸŸ£ Ã‰pico â†’ ğŸŸ¡ LendÃ¡rio\n"
            "ğŸ”´ MÃ­tico â†’ ğŸŸ  Ancestral â†’ ğŸ’ Divino â†’ ğŸŒˆ Primordial\n"
            "*Raridades superiores surgem com mais frequÃªncia nos ciclos 5 e 6.*"
        ),
        inline=False
    )
    embed9.set_footer(text="ğŸ“… ExpansÃ£o Reinos & DimensÃµes | Use 'atualizaÃ§Ã£o' para rever este changelog a qualquer hora!")
    await channel.send(embed=embed9)
    await asyncio.sleep(2)

    # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    # EMBED 10 â€” Mensagem Final
    # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    embed10 = discord.Embed(
        title="ğŸŒŸ Sua Jornada AtravÃ©s dos Ciclos ComeÃ§a Agora",
        description=(
            "*O Narrador fecha o livro e te olha diretamente...*\n\n"
            "**\"VocÃª estÃ¡ pronto? Ou acha que estÃ¡?\"**\n\n"
            "Os Campos Iniciais aguardam seus primeiros passos.\n"
            "Um Slime estÃ¡ por aÃ­, inocente demais para saber o que vem depois.\n\n"
            "**Primeiro passo:**\n"
            "Use `explorar` para comeÃ§ar.\n"
            "Use `ver perfil` para ver seu estado.\n"
            "Use `escolher classe` quando chegar ao nÃ­vel 2.\n\n"
            "**Lembre-se:** Em cada nÃ­vel terminado em **9**, o boss de nÃ­vel aparece.\n"
            "Derrote-o para avanÃ§ar. Perca... e o XP fica bloqueado atÃ© a revanche.\n\n"
            "*Toda lenda comeÃ§a com um Ãºnico passo. A sua vai atravessar seis ciclos e cinco dimensÃµes.*\n\n"
            "**Boa sorte, aventureiro. VocÃª vai precisar.** ğŸ­"
        ),
        color=0xF1C40F
    )
    embed10.set_footer(text="âš ï¸ Boss de nÃ­vel: nÃ­veis 9, 19, 29... 599 â€¢ 40 reinos â€¢ 5 dimensÃµes â€¢ 6 ciclos â€¢ Level mÃ¡ximo 600 â€¢ Use 'comandos' para ajuda")
    await channel.send(embed=embed10)


# ================= EVENTOS DO BOT =================

@bot.event
async def on_ready():
    init_db()
    print(f"ğŸ® {bot.user} estÃ¡ online!")
    print(f"ğŸ“Š Servidores: {len(bot.guilds)}")

    # Restaurar canais de mundo prÃ³prio do banco
    MUNDO_PROPRIO_CHANNELS.update(_db_load_mundo_proprio())
    print(f"ğŸŒ {len(MUNDO_PROPRIO_CHANNELS)} canais de mundo prÃ³prio restaurados.")

    if not random_world_events.is_running():
        random_world_events.start()
    if not weather_change_loop.is_running():
        weather_change_loop.start()

    for guild in bot.guilds:
        await send_prologue(guild)


@bot.event
async def on_message(message):
    if message.author.bot:
        return
    if message.channel.name != CANAL_BETA and message.channel.id not in MUNDO_PROPRIO_CHANNELS.values():
        return

    content = message.content.lower().strip()
    user_id = message.author.id

    # ======================================================
    # ================= USAR POÃ‡ÃƒO (novo formato) ==========
    # ======================================================
    # Formato: "poÃ§Ã£o de vida, usar" ou "elixir de xp, usar" etc.
    if ", usar" in content or ",usar" in content:
        clean = content.replace(",usar", ", usar")
        item_part = clean.split(", usar")[0].strip()

        player = get_player(user_id)

        # Tenta encontrar a poÃ§Ã£o
        found_potion = None
        for potion_name in POTIONS.keys():
            if item_part in potion_name.lower():
                found_potion = potion_name
                break

        # Tenta encontrar equipamento a equipar
        if not found_potion:
            found_weapon = None
            found_armor = None
            for w in ITEMS["weapons"]:
                if item_part in w["name"].lower() and w["name"] in player["inventory"]:
                    found_weapon = w
                    break
            for a in ITEMS["armor"]:
                if item_part in a["name"].lower() and a["name"] in player["inventory"]:
                    found_armor = a
                    break

            if found_weapon:
                player["weapon"] = found_weapon["name"]
                save_player_db(user_id, player)
                await message.channel.send(f"âš”ï¸ **{found_weapon['name']}** equipado!")
                return
            elif found_armor:
                player["armor"] = found_armor["name"]
                save_player_db(user_id, player)
                await message.channel.send(f"ğŸ›¡ï¸ **{found_armor['name']}** equipado!")
                return
            else:
                await message.channel.send(f"âŒ Item **{item_part}** nÃ£o encontrado no inventÃ¡rio!")
                return

        if found_potion not in player["inventory"]:
            await message.channel.send(f"âŒ VocÃª nÃ£o tem **{found_potion}**!")
            return

        potion = POTIONS[found_potion]
        player["inventory"].remove(found_potion)

        embed = discord.Embed(
            title=f"{potion['emoji']} PoÃ§Ã£o Consumida!",
            description=f"*'VocÃª bebe **{found_potion}**...'*",
            color=RARITIES.get(potion["rarity"], {"color": 0xFFFFFF})["color"]
        )

        if "hp_restore" in potion:
            old_hp = player["hp"]
            player["hp"] = min(player["hp"] + potion["hp_restore"], player["max_hp"])
            healed = player["hp"] - old_hp
            embed.add_field(name="ğŸ’š HP Restaurado", value=f"+{healed} HP", inline=False)

        if "xp_gain" in potion:
            add_xp(user_id, potion["xp_gain"])
            embed.add_field(name="â­ XP Ganho", value=f"+{potion['xp_gain']} XP", inline=False)

        if "revive" in potion and potion["revive"]:
            player["hp"] = player["max_hp"]
            embed.add_field(name="ğŸ’€ RessurreiÃ§Ã£o", value="HP completamente restaurado!", inline=False)

        save_player_db(user_id, player)
        await message.channel.send(embed=embed)
        return

    # ======================================================
    # ================= EQUIPAR ITEM =======================
    # ======================================================
    if content.startswith("equipar "):
        item_name_search = content[8:].strip()
        player = get_player(user_id)

        found_item = None
        item_type = None
        for w in ITEMS["weapons"]:
            if item_name_search in w["name"].lower() and w["name"] in player["inventory"]:
                found_item = w["name"]
                item_type = "weapon"
                break
        if not found_item:
            for a in ITEMS["armor"]:
                if item_name_search in a["name"].lower() and a["name"] in player["inventory"]:
                    found_item = a["name"]
                    item_type = "armor"
                    break

        if not found_item:
            await message.channel.send(f"âŒ Item nÃ£o encontrado no inventÃ¡rio. Verifique com `inventÃ¡rio`.")
            return

        view = EquipButton(user_id, found_item, item_type)
        await message.channel.send(f"âš”ï¸ **{found_item}** encontrado!\n\n*Deseja equipar?*", view=view)
        return

    # ======================================================
    # ================= ESCOLHER CLASSE ====================
    # ======================================================
    if any(word in content for word in ["escolher classe", "ver classes", "classes"]):
        player = get_player(user_id)

        if player.get("class"):
            await message.channel.send(f"âŒ VocÃª jÃ¡ Ã© um **{player['class']}**! Use `evoluÃ§Ã£o classe` para ver sua Ã¡rvore de evoluÃ§Ã£o.")
            return
        if player["level"] < 2:
            await message.channel.send("âŒ VocÃª precisa ser **nÃ­vel 2** para escolher uma classe!")
            return

        all_classes = list(CLASSES.keys())
        total_pages = (len(all_classes) + 4) // 5
        page = 0
        chunk = all_classes[:5]

        embed = discord.Embed(
            title=f"ğŸ­ Escolha sua Classe (PÃ¡gina 1/{total_pages})",
            description="*'Qual caminho vocÃª deseja seguir?'*\nCada classe tem Ã¡rvore de evoluÃ§Ã£o Ãºnica com especializaÃ§Ãµes nos nÃ­veis 40, 80, 120 e 160!",
            color=discord.Color.blue()
        )
        for cn in chunk:
            cd = CLASSES[cn]
            tree = CLASS_EVOLUTION_TREE.get(cn)
            evo_hint = f"\nğŸŒŸ Evolui: {', '.join(str(k) for k in sorted(tree.keys()))}" if tree else ""
            embed.add_field(
                name=f"{cd['emoji']} {cn}",
                value=f"{cd['description']}\n**ATK:** +{cd['atk_bonus']} | **DEF:** +{cd['def_bonus']} | **HP:** +{cd['hp_bonus']}{evo_hint}",
                inline=False
            )
        view = ClassSelectView(user_id, page=0)
        await message.channel.send(embed=embed, view=view)
        return

    # ======================================================
    # ================= ESCOLHER RAÃ‡A ======================
    # ======================================================
    elif any(word in content for word in ["evoluir raÃ§a", "evoluir raca", "evoluÃ§Ã£o raÃ§a", "evolucao raca", "evo raÃ§a", "evo raca", "ver evoluÃ§Ã£o raÃ§a", "evoluÃ§Ãµes de raÃ§a"]):
        player = get_player(user_id)
        if not player:
            await message.channel.send("âŒ Crie seu personagem primeiro!")
            return

        race_name = player.get("race")
        if not race_name:
            await message.channel.send("âŒ VocÃª ainda nÃ£o escolheu uma raÃ§a! Use `escolher raÃ§a` primeiro.")
            return

        player_level = player.get("level", 1)
        evos = RACE_EVOLUTION_TREE.get(race_name, [])
        current_stage = player.get("race_stage", 0)

        if not evos:
            await message.channel.send(f"âŒ A raÃ§a **{race_name}** nÃ£o possui evoluÃ§Ãµes registradas.")
            return

        base_race = RACES.get(race_name, {})

        # Montar embed de status de evoluÃ§Ã£o
        embed = discord.Embed(
            title=f"ğŸ§¬ EvoluÃ§Ã£o de RaÃ§a â€” {base_race.get('emoji','')} {race_name}",
            description=(
                f"*'Cada ciclo de vida forja um ser mais poderoso. Sua linhagem estÃ¡ evoluindo...'*\n\n"
                f"**EstÃ¡gio atual:** `{current_stage}/3`\n"
                f"**NÃ­vel:** `{player_level}`"
            ),
            color=discord.Color.from_rgb(100, 0, 200)
        )

        # Mostrar todos os 3 estÃ¡gios
        stage_emojis = ["1ï¸âƒ£", "2ï¸âƒ£", "3ï¸âƒ£"]
        for i, evo in enumerate(evos):
            stage_num = i + 1
            unlocked = current_stage >= stage_num
            available = player_level >= evo["level"] and current_stage == stage_num - 1
            if unlocked:
                status = "âœ… **DESBLOQUEADO**"
            elif available:
                status = "ğŸ”“ **DISPONÃVEL â€” Use `evoluir raÃ§a` para evoluir!**"
            else:
                status = f"ğŸ”’ Requer NÃ­vel **{evo['level']}**"
            embed.add_field(
                name=f"{stage_emojis[i]} {evo['emoji']} {evo['name']}",
                value=(
                    f"{status}\n"
                    f"*{evo['lore']}*\n"
                    f"â¤ï¸ HP: **+{evo['hp_bonus']}** | âš”ï¸ ATK: **+{evo['atk_bonus']}** | ğŸ›¡ï¸ DEF: **+{evo['def_bonus']}**"
                ),
                inline=False
            )

        # Verificar se pode evoluir agora
        next_stage = current_stage + 1
        if next_stage > 3:
            embed.set_footer(text="ğŸ† VocÃª atingiu a evoluÃ§Ã£o mÃ¡xima da sua raÃ§a!")
            await message.channel.send(embed=embed)
            return

        next_evo = evos[next_stage - 1]
        if player_level < next_evo["level"]:
            embed.set_footer(text=f"PrÃ³xima evoluÃ§Ã£o disponÃ­vel no NÃ­vel {next_evo['level']}")
            await message.channel.send(embed=embed)
            return

        # Pode evoluir! Aplicar evoluÃ§Ã£o
        old_hp  = player.get("max_hp",  100)
        old_atk = player.get("atk",     10)
        old_def = player.get("def",     5)

        player["max_hp"] = old_hp  + next_evo["hp_bonus"]
        player["hp"]     = player["max_hp"]
        player["atk"]    = old_atk + next_evo["atk_bonus"]
        player["def"]    = old_def + next_evo["def_bonus"]
        player["race_stage"] = next_stage
        save_player_db(user_id, player)

        evo_embed = discord.Embed(
            title=f"ğŸŒŸ EVOLUÃ‡ÃƒO DE RAÃ‡A â€” ESTÃGIO {next_stage}!",
            description=(
                f"*'{next_evo['lore']}'*\n\n"
                f"{base_race.get('emoji','')} **{race_name}** â†’ {next_evo['emoji']} **{next_evo['name']}**\n\n"
                f"âœ¨ *Seu poder racial atingiu um novo patamar!*"
            ),
            color=discord.Color.gold()
        )
        evo_embed.add_field(name="â¤ï¸ HP Ganho",  value=f"+{next_evo['hp_bonus']}  â†’ `{player['max_hp']}`", inline=True)
        evo_embed.add_field(name="âš”ï¸ ATK Ganho", value=f"+{next_evo['atk_bonus']} â†’ `{player['atk']}`",    inline=True)
        evo_embed.add_field(name="ğŸ›¡ï¸ DEF Ganho", value=f"+{next_evo['def_bonus']} â†’ `{player['def']}`",    inline=True)
        if next_stage == 3:
            evo_embed.add_field(
                name="ğŸ‘‘ EVOLUÃ‡ÃƒO MÃXIMA ATINGIDA!",
                value="*VocÃª chegou ao Ã¡pice da sua linhagem racial. Nenhum ser da sua raÃ§a Ã© mais poderoso.*",
                inline=False
            )
        evo_embed.set_footer(text=f"EstÃ¡gio {next_stage}/3 | Use 'ver perfil' para ver seus atributos atualizados")
        await message.channel.send(embed=evo_embed)
        return

    elif any(word in content for word in ["escolher raÃ§a", "escolher raca", "ver raÃ§as", "ver racas", "raÃ§as", "racas"]):
        player = get_player(user_id)

        if player.get("race"):
            race_data = RACES[player["race"]]
            await message.channel.send(
                f"âŒ VocÃª jÃ¡ Ã© um(a) **{race_data['emoji']} {player['race']}**!\n"
                f"**Passiva:** {race_data['passive']}"
            )
            return
        if player["level"] < 1:
            await message.channel.send("âŒ VocÃª precisa estar registrado para escolher uma raÃ§a!")
            return

        all_races = list(RACES.keys())
        total_pages = (len(all_races) + 4) // 5
        chunk = all_races[:5]

        embed = discord.Embed(
            title=f"ğŸ§¬ Escolha sua RaÃ§a (PÃ¡gina 1/{total_pages})",
            description="*'De onde vocÃª vem? Sua origem define seu destino.'*\nSua raÃ§a concede bÃ´nus permanentes e uma passiva Ãºnica!",
            color=discord.Color.purple()
        )
        for rn in chunk:
            rd = RACES[rn]
            embed.add_field(
                name=f"{rd['emoji']} {rn}",
                value=f"{rd['description']}\n**Passiva:** {rd['passive']}\n**HP:** +{rd['hp_bonus']} | **ATK:** +{rd['atk_bonus']} | **DEF:** +{rd['def_bonus']}",
                inline=False
            )
        view = RaceSelectView(user_id, page=0)
        await message.channel.send(embed=embed, view=view)
        return

    # ======================================================
    # ================= HABILIDADES ========================
    # ======================================================
    elif any(word in content for word in ["habilidades", "ver habilidades", "skills", "magias"]):
        player = get_player(user_id)
        cls = player.get("class")
        if not cls:
            await message.channel.send("âš ï¸ Escolha uma classe primeiro! Use: `escolher classe`")
            return

        skills = get_player_skills(player)
        tier_data = CLASS_TIERED_SKILLS.get(cls)

        embed = discord.Embed(
            title=f"âš”ï¸ Habilidades de {message.author.display_name}",
            description=f"**Classe:** {CLASSES[cls]['emoji']} {cls}{(' â€¢ **Spec:** ' + player['specialization']) if player.get('specialization') else ''}",
            color=discord.Color.red()
        )

        lvl = player["level"]
        tiers_shown = {"ğŸŸ¢ BÃ¡sicas": [], "ğŸ”µ IntermediÃ¡rias": [], "ğŸŸ£ AvanÃ§adas": [], "â­ Especial": [], "ğŸ‘‘ Suprema": []}

        if tier_data:
            for sk in tier_data["basic"]:
                tiers_shown["ğŸŸ¢ BÃ¡sicas"].append(sk)
            if lvl >= 40:
                for sk in tier_data.get("intermediate", []):
                    tiers_shown["ğŸ”µ IntermediÃ¡rias"].append(sk)
            else:
                embed.add_field(name="ğŸ”µ IntermediÃ¡rias", value=f"*Desbloqueiam no nÃ­vel 40*", inline=False)
            if lvl >= 80:
                for sk in tier_data.get("advanced", []):
                    tiers_shown["ğŸŸ£ AvanÃ§adas"].append(sk)
            else:
                embed.add_field(name="ğŸŸ£ AvanÃ§adas", value=f"*Desbloqueiam no nÃ­vel 80*", inline=False)
            supreme = tier_data.get("supreme")
            if supreme:
                if supreme["name"] in player.get("supreme_skills", []):
                    tiers_shown["ğŸ‘‘ Suprema"].append(supreme)
                else:
                    embed.add_field(name="ğŸ‘‘ Suprema", value=f"*Desbloqueie derrotando: **{supreme['unlock_boss']}***", inline=False)
        else:
            for sk in CLASS_SKILLS.get(cls, []):
                tiers_shown["ğŸŸ¢ BÃ¡sicas"].append(sk)

        spec = player.get("specialization")
        if spec and spec in CLASS_SPECIALIZATIONS:
            sk = CLASS_SPECIALIZATIONS[spec].get("special_skill")
            if sk:
                tiers_shown["â­ Especial"].append(sk)

        for tier_label, sk_list in tiers_shown.items():
            if sk_list:
                val = "\n".join([f"**{sk['name']}** â€” {sk['mana_cost']} mana | {sk['desc']}" for sk in sk_list])
                embed.add_field(name=tier_label, value=val, inline=False)

        # Show evolution tree
        tree = CLASS_EVOLUTION_TREE.get(cls)
        if tree:
            current_tier = player.get("class_tier", 0)
            evo_lines = []
            for evo_lvl in sorted(tree.keys()):
                tier_idx = sorted(tree.keys()).index(evo_lvl) + 1
                status = "âœ…" if current_tier >= tier_idx else ("ğŸ”“" if lvl >= evo_lvl else "ğŸ”’")
                evo_lines.append(f"{status} **Nv.{evo_lvl}** â†’ {tree[evo_lvl]['name']}")
            embed.add_field(name="ğŸŒ³ Ãrvore de EvoluÃ§Ã£o", value="\n".join(evo_lines), inline=False)

        await message.channel.send(embed=embed)
        return

    # ======================================================
    # ================= EVOLUÃ‡ÃƒO CLASSE ====================
    # ======================================================
    elif any(word in content for word in ["evoluÃ§Ã£o classe", "evoluir classe", "evolucao classe", "evoluir minha classe"]):
        player = get_player(user_id)
        cls = player.get("class")
        if not cls:
            await message.channel.send("âš ï¸ Escolha uma classe primeiro!")
            return
        await check_class_evolution(message.channel, user_id)
        return

    # ======================================================
    # ================= PROCURAR PET =======================
    # ======================================================
    elif any(word in content for word in ["procurar pet", "procurar criatura", "buscar pet"]):
        player = get_player(user_id)
        # Permite procurar novos pets mesmo com pet ativo â€” extras vÃ£o pra fazenda

        world = get_world(player["level"], player)
        roll = roll_dice()
        luck = get_luck(roll)

        embed = discord.Embed(
            title="ğŸ” Procurando Criaturas...",
            description="*'VocÃª vasculha o ambiente em busca de criaturas selvagens...'*",
            color=discord.Color.blue()
        )
        embed.add_field(name="ğŸ² Dado da Busca", value=f"`{roll}` {luck['emoji']} **{luck['name']}**", inline=False)

        if roll <= 2:
            # Encontra inimigo em vez de pet
            monster_name = random.choice(list(world["monsters"].keys()))
            monster = world["monsters"][monster_name]
            dmg = random.randint(15, 35)
            player["hp"] -= dmg
            if player["hp"] <= 0:
                player["hp"] = 1
            save_player_db(user_id, player)
            result, xp_loss = remove_xp(user_id, random.randint(20, 40))

            embed.add_field(
                name="âš ï¸ Emboscada!",
                value=f"*'Em vez de um pet, vocÃª encontra um **{monster_name}** furioso que te ataca!'*\n\nğŸ’” **âˆ’{dmg} HP**\nâŒ **âˆ’{xp_loss} XP**",
                inline=False
            )
            embed.color = discord.Color.red()
            await message.channel.send(embed=embed)
            return

        elif roll <= 4:
            embed.add_field(
                name="ğŸ˜” Nada Encontrado",
                value="*'VocÃª vasculha por horas, mas sÃ³ encontra rastros. As criaturas parecem evitar vocÃª.'*",
                inline=False
            )
            embed.color = discord.Color.light_grey()
            await message.channel.send(embed=embed)
            return

        elif roll <= 6:
            # Pet comum do mundo
            world_level = max([k for k in PETS.keys() if k <= player["level"]])
            available = PETS[world_level]
            pet = random.choice([p for p in available if p["rarity"] in ["Comum", "Incomum"]] or available)

            embed.add_field(
                name=f"{pet['emoji']} Criatura Avistada!",
                value=f"*'VocÃª encontra um **{pet['name']}** ({pet['rarity']}) nas proximidades!'*",
                inline=False
            )
            embed.color = RARITIES[pet["rarity"]]["color"]
            await message.channel.send(embed=embed)
            await asyncio.sleep(1)
            view = PetTameButton(user_id, pet)
            await message.channel.send(f"{pet['emoji']} **{pet['name']}** estÃ¡ prÃ³ximo!", view=view)

        else:  # 7-10: maior chance de pet raro
            world_level = max([k for k in PETS.keys() if k <= player["level"]])
            available = PETS[world_level]
            if roll >= 9:
                pets_filtered = [p for p in available if p["rarity"] in ["Raro", "Ã‰pico", "LendÃ¡rio", "MÃ­tico", "Divino", "Primordial"]]
            else:
                pets_filtered = [p for p in available if p["rarity"] in ["Incomum", "Raro", "Ã‰pico"]]
            pet = random.choice(pets_filtered or available)

            embed.add_field(
                name=f"{pet['emoji']} Criatura Rara Avistada!",
                value=f"*'IncrÃ­vel! VocÃª detecta um **{pet['name']}** ({RARITIES[pet['rarity']]['emoji']} {pet['rarity']}) escondido!'*",
                inline=False
            )
            embed.color = RARITIES[pet["rarity"]]["color"]
            await message.channel.send(embed=embed)
            await asyncio.sleep(1)
            view = PetTameButton(user_id, pet)
            await message.channel.send(f"{pet['emoji']} **{pet['name']}** apareceu!", view=view)
        return

    # ======================================================
    # ================= DOMESTICAR PET =====================
    # ======================================================
    elif any(word in content for word in ["domesticar", "tentar domesticar", "domar"]):
        player = get_player(user_id)
        # Permite mÃºltiplos pets â€” o ativo fica em player["pet"], os outros na fazenda
        # NÃ£o bloqueia mais domesticaÃ§Ã£o!

        world_level = player["level"] - (player["level"] % 10)
        if world_level == 0:
            world_level = 1
        if world_level not in PETS:
            world_level = max([w for w in PETS.keys() if w <= player["level"]])

        available_pets = PETS[world_level]
        pet = random.choice(available_pets)

        embed = discord.Embed(
            title=f"{pet['emoji']} {pet['name']} Apareceu!",
            description=f"*'Um **{pet['name']}** selvagem aparece diante de vocÃª!'*",
            color=RARITIES[pet["rarity"]]["color"]
        )
        embed.add_field(name="âœ¨ Raridade", value=f"{RARITIES[pet['rarity']]['emoji']} {pet['rarity']}", inline=True)
        embed.add_field(name="ğŸ’ª BÃ´nus ATK", value=f"+{pet['bonus_atk']}", inline=True)
        embed.add_field(name="â¤ï¸ BÃ´nus HP", value=f"+{pet['bonus_hp']}", inline=True)

        view = PetTameButton(user_id, pet)
        await message.channel.send(embed=embed, view=view)
        return

    # ======================================================
    # ================= DESAFIAR / IR ATRÃS DO BOSS ========
    # ======================================================
    elif any(word in content for word in ["desafiar boss", "ir atrÃ¡s do boss", "ir atras do boss", "chamar boss", "invocar boss", "enfrentar boss"]):
        player = get_player(user_id)

        # â”€â”€ REDIRECIONAR: desafiar boss do level X â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        import re as _re
        _m = _re.match(r"desafiar boss (?:do )?level (\d+)", content)
        if _m:
            target_level = int(_m.group(1))
            boss_gate_levels = [9, 19, 29, 39, 49, 59, 69, 79, 89, 99, 109, 119, 129, 139, 149, 159, 169, 179, 189, 199, 209, 219, 229, 239, 249, 259, 269, 279, 289, 299, 309, 319, 329, 339, 349, 359, 369, 379, 389, 399, 409, 419, 429, 439, 449, 459, 469, 479, 489, 499, 509, 519, 529, 539, 549, 559, 569, 579, 589, 599]
            if target_level not in boss_gate_levels:
                niveis_str = ", ".join(str(x) for x in boss_gate_levels[:10]) + "..."
                await message.channel.send(
                    f"âŒ **Level {target_level}** nÃ£o tem boss de nÃ­vel!\n\n"
                    f"Bosses de nÃ­vel existem apenas nos nÃ­veis: **{niveis_str}**\n"
                    f"Exemplo: `desafiar boss do level 9`, `desafiar boss do level 19`"
                )
                return
            player_level = player.get("level", 1)
            if player_level < target_level:
                await message.channel.send(
                    f"ğŸ”’ **Boss do Level {target_level}** bloqueado!\n\n"
                    f"VocÃª estÃ¡ no nÃ­vel **{player_level}**. Alcance o nÃ­vel **{target_level}** para desafiar este boss.\n"
                    f"*\'O guardiÃ£o desta passagem nÃ£o reconhece sua presenÃ§a... ainda.\'*"
                )
                return
            boss_data_lv = get_level_boss(target_level)
            if not boss_data_lv:
                await message.channel.send(f"âŒ NÃ£o foi possÃ­vel encontrar o boss do level {target_level}.")
                return
            already_defeated = boss_data_lv["name"] in player.get("bosses", [])
            effects = player.get("active_effects", {})
            effects["pending_boss"] = boss_data_lv
            player["active_effects"] = effects
            save_player_db(user_id, player)
            if already_defeated:
                boss_level_to_world = {9:1, 19:10, 29:20, 39:30, 49:40, 59:50, 69:60, 79:70, 89:80, 99:90,
                                       109:100, 119:110, 129:120, 139:130, 149:140, 159:150, 169:160, 179:170, 189:180, 199:190,
                                       209:200, 219:210, 229:220, 239:230, 249:240, 259:250, 269:260, 279:270, 289:280, 299:290,
                                       309:300, 319:310, 329:320, 339:330, 349:340, 359:350, 369:360, 379:370, 389:380, 399:390,
                                       409:400, 419:410, 429:420, 439:430, 449:440, 459:450, 469:460, 479:470, 489:480, 499:490,
                                       509:500, 519:510, 529:520, 539:530, 549:540, 559:550, 569:560, 579:570, 589:580, 599:590}
                world_key = boss_level_to_world.get(target_level, 1)
                world_data_lv = WORLDS.get(world_key, {})
                world_name_lv = world_data_lv.get("name", "Reino " + str(target_level))
                world_emoji_lv = world_data_lv.get("emoji", "ğŸŒ")
                boss_nm = boss_data_lv["name"]
                embed_lv = discord.Embed(
                    title=f"âš”ï¸ REVANCHE â€” BOSS DO LEVEL {target_level}!",
                    description=(
                        f"*\'As nÃ©voas do tempo se desfazem... O guardiÃ£o ressurge das sombras para um novo duelo!\'*\n\n"
                        f"ğŸ‘¹ **{boss_nm}** retorna para uma batalha Ã©pica!\n\n"
                        f"{world_emoji_lv} **{world_name_lv}** â€” Este foi o guardiÃ£o que desbloqueou este reino para vocÃª.\n\n"
                        f"*A lenda diz que reviver grandes batalhas fortalece a alma do guerreiro...*"
                    ),
                    color=discord.Color.from_rgb(150, 0, 200)
                )
            else:
                boss_nm = boss_data_lv["name"]
                embed_lv = discord.Embed(
                    title=f"ğŸš¨ BOSS DE NÃVEL {target_level} â€” PASSAGEM BLOQUEADA!",
                    description=(
                        f"*\'O ar fica pesado... Uma sombra colossal bloqueia seu caminho!\'*\n\n"
                        f"ğŸ‘¹ **{boss_nm}** surge diante de vocÃª!\n\n"
                        f"âš ï¸ **Derrote-o para desbloquear o prÃ³ximo reino e desbloquear o XP!**"
                    ),
                    color=discord.Color.dark_red()
                )
            embed_lv.add_field(name="â¤ï¸ HP", value=f"`{boss_data_lv['hp']:,}`", inline=True)
            embed_lv.add_field(name="âš”ï¸ ATK", value=f"`{boss_data_lv['atk']}`", inline=True)
            embed_lv.add_field(name="â­ XP", value=f"`{boss_data_lv['xp']:,}`", inline=True)
            embed_lv.add_field(name="ğŸ¯ Level do Boss", value=f"`{target_level}`", inline=True)
            if already_defeated:
                embed_lv.add_field(name="ğŸ† Status", value="*Revanche â€” Boss jÃ¡ derrotado anteriormente*", inline=False)
            embed_lv.add_field(name="ğŸ’¡ Dica", value="Use os botÃµes abaixo para lutar ou chamar aliados!", inline=False)
            view_lv = BossButton(user_id, boss_data_lv["name"])
            await message.channel.send(embed=embed_lv, view=view_lv)
            return
        # â”€â”€ FIM REDIRECT DESAFIAR BOSS DO LEVEL â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

        if player["level"] >= 2 and not player.get("class"):
            await message.channel.send("âš ï¸ Escolha uma classe primeiro! Use: `escolher classe`")
            return

        # PRIORIDADE: Boss de level (se nÃ­vel 9/19/29/39/49/59 e ainda nÃ£o derrotou)
        boss_gate_levels = {9, 19, 29, 39, 49, 59, 69, 79, 89, 99, 109, 119, 129, 139, 149, 159, 169, 179, 189, 199, 209, 219, 229, 239, 249, 259, 269, 279, 289, 299, 309, 319, 329, 339, 349, 359, 369, 379, 389, 399, 409, 419, 429, 439, 449, 459, 469, 479, 489, 499, 509, 519, 529, 539, 549, 559, 569, 579, 589, 599}
        boss_data = None
        is_level_boss = False

        if player["level"] in boss_gate_levels:
            boss_data = get_level_boss(player["level"])
            if boss_data and boss_data["name"] not in player.get("bosses", []):
                is_level_boss = True
            else:
                boss_data = None  # JÃ¡ derrotou, vai pegar boss do mundo

        if not boss_data:
            # Verifica se tem boss pendente (de encontrar boss)
            effects = player.get("active_effects", {})
            pending = effects.get("pending_boss")
            if pending:
                boss_data = pending
            else:
                # Boss do mundo atual
                world_level = max([k for k in WORLDS.keys() if k <= player["level"]])
                boss_pool = WORLD_BOSSES_VARIANTS.get(world_level, [])
                boss_data = random.choice(boss_pool) if boss_pool else WORLDS[world_level]["boss"]

        # *** CORREÃ‡ÃƒO: Salva SEMPRE o boss correto como pending_boss antes dos botÃµes ***
        effects = player.get("active_effects", {})
        effects["pending_boss"] = boss_data
        player["active_effects"] = effects
        save_player_db(user_id, player)

        color = discord.Color.dark_red() if is_level_boss else discord.Color.red()
        title = f"ğŸš¨ BOSS DE NÃVEL {boss_data.get('level', '?')} â€” PASSAGEM BLOQUEADA!" if is_level_boss else "âš”ï¸ BOSS ENCONTRADO!"
        desc_extra = "\n\nâš ï¸ **Derrote-o para desbloquear o prÃ³ximo reino e desbloquear o XP!**" if is_level_boss else ""

        embed = discord.Embed(
            title=title,
            description=f"*'O ar fica pesado... Uma sombra colossal se ergue!'*\n\nğŸ‘¹ **{boss_data['name']}** surge!{desc_extra}",
            color=color
        )
        embed.add_field(name="â¤ï¸ HP", value=f"`{boss_data['hp']:,}`", inline=True)
        embed.add_field(name="âš”ï¸ ATK", value=f"`{boss_data['atk']}`", inline=True)
        embed.add_field(name="â­ XP", value=f"`{boss_data['xp']:,}`", inline=True)
        if is_level_boss:
            embed.add_field(name="ğŸš« XP Bloqueado", value="Ganhe XP novamente derrotando este boss!", inline=False)
        embed.add_field(name="ğŸ’¡ Dica", value="Use os botÃµes abaixo para lutar ou chamar aliados!", inline=False)

        view = BossButton(user_id, boss_data["name"])
        await message.channel.send(embed=embed, view=view)
        return

    # ======================================================
    # ======= DESAFIAR BOSS DO LEVEL X (revanche) ==========
    # ======================================================
    elif content.startswith("desafiar boss do level ") or content.startswith("desafiar boss level "):
        player = get_player(user_id)
        if not player:
            await message.channel.send("âŒ Crie seu personagem primeiro!")
            return

        # Extrair o nÃºmero do level do comando
        try:
            parts = content.split()
            target_level = int(parts[-1])
        except (ValueError, IndexError):
            await message.channel.send("âŒ Use: `desafiar boss do level 9` (ou 19, 29, 39...)")
            return

        # Bosses disponÃ­veis nos nÃ­veis: 9, 19, 29, 39...
        boss_gate_levels = [9, 19, 29, 39, 49, 59, 69, 79, 89, 99, 109, 119, 129, 139, 149, 159, 169, 179, 189, 199, 209, 219, 229, 239, 249, 259, 269, 279, 289, 299, 309, 319, 329, 339, 349, 359, 369, 379, 389, 399, 409, 419, 429, 439, 449, 459, 469, 479, 489, 499, 509, 519, 529, 539, 549, 559, 569, 579, 589, 599]
        if target_level not in boss_gate_levels:
            niveis_str = ", ".join(str(x) for x in boss_gate_levels[:10]) + "..."
            await message.channel.send(
                f"âŒ **Level {target_level}** nÃ£o tem boss de nÃ­vel!\n\n"
                f"Os bosses de nÃ­vel existem apenas nos nÃ­veis: **{niveis_str}**\n\n"
                f"Use: `desafiar boss do level 9`, `desafiar boss do level 19`, etc."
            )
            return

        # Verificar se o jogador jÃ¡ passou desse level (desbloqueou o boss)
        player_level = player.get("level", 1)
        if player_level < target_level:
            await message.channel.send(
                f"ğŸ”’ **Boss do Level {target_level}** ainda estÃ¡ bloqueado!\n\n"
                f"VocÃª estÃ¡ no nÃ­vel **{player_level}**. Alcance o nÃ­vel **{target_level}** para desafiar este boss.\n\n"
                f"*\'O guardiÃ£o desta passagem nÃ£o reconhece sua presenÃ§a... ainda.\'*"
            )
            return

        # Pegar dados do boss
        boss_data = get_level_boss(target_level)
        if not boss_data:
            await message.channel.send(f"âŒ NÃ£o foi possÃ­vel encontrar o boss do level {target_level}.")
            return

        already_defeated = boss_data["name"] in player.get("bosses", [])

        # Salvar como pending boss
        effects = player.get("active_effects", {})
        effects["pending_boss"] = boss_data
        player["active_effects"] = effects
        save_player_db(user_id, player)

        if already_defeated:
            # Revanche â€” mesma vibe de desbloqueio de reino
            boss_level_to_world = {9:1, 19:10, 29:20, 39:30, 49:40, 59:50, 69:60, 79:70, 89:80, 99:90,
                                   109:100, 119:110, 129:120, 139:130, 149:140, 159:150, 169:160, 179:170, 189:180, 199:190,
                                   209:200, 219:210, 229:220, 239:230, 249:240, 259:250, 269:260, 279:270, 289:280, 299:290,
                                   309:300, 319:310, 329:320, 339:330, 349:340, 359:350, 369:360, 379:370, 389:380, 399:390,
                                   409:400, 419:410, 429:420, 439:430, 449:440, 459:450, 469:460, 479:470, 489:480, 499:490,
                                   509:500, 519:510, 529:520, 539:530, 549:540, 559:550, 569:560, 579:570, 589:580, 599:590}
            world_key = boss_level_to_world.get(target_level, 1)
            world_data = WORLDS.get(world_key, {})
            world_name = world_data.get("name", "Reino " + str(target_level))
            world_emoji = world_data.get("emoji", "ğŸŒ")
            boss_name_val = boss_data["name"]
            embed = discord.Embed(
                title=f"âš”ï¸ REVANCHE â€” BOSS DO LEVEL {target_level}!",
                description=(
                    f"*'As nÃ©voas do tempo se desfazem... O guardiÃ£o ressurge das sombras para um novo duelo!'*\n\n"
                    f"ğŸ‘¹ **{boss_name_val}** retorna para uma batalha Ã©pica!\n\n"
                    f"{world_emoji} **{world_name}** â€” Este foi o guardiÃ£o que desbloqueou este reino para vocÃª.\n\n"
                    f"*A lenda diz que reviver grandes batalhas fortalece a alma do guerreiro...*"
                ),
                color=discord.Color.from_rgb(150, 0, 200)
            )
        else:
            boss_name_val = boss_data["name"]
            embed = discord.Embed(
                title=f"ğŸš¨ BOSS DE NÃVEL {target_level} â€” PASSAGEM BLOQUEADA!",
                description=(
                    f"*'O ar fica pesado... Uma sombra colossal bloqueia seu caminho!'*\n\n"
                    f"ğŸ‘¹ **{boss_name_val}** surge diante de vocÃª!\n\n"
                    f"âš ï¸ **Derrote-o para desbloquear o prÃ³ximo reino e desbloquear o XP!**"
                ),
                color=discord.Color.dark_red()
            )

        embed.add_field(name="â¤ï¸ HP", value=f"`{boss_data['hp']:,}`", inline=True)
        embed.add_field(name="âš”ï¸ ATK", value=f"`{boss_data['atk']}`", inline=True)
        embed.add_field(name="â­ XP", value=f"`{boss_data['xp']:,}`", inline=True)
        embed.add_field(name="ğŸ¯ Level do Boss", value=f"`{target_level}`", inline=True)
        if already_defeated:
            embed.add_field(name="ğŸ† Status", value="*Revanche â€” Boss jÃ¡ derrotado anteriormente*", inline=False)
        embed.add_field(name="ğŸ’¡ Dica", value="Use os botÃµes abaixo para lutar ou chamar aliados!", inline=False)

        view = BossButton(user_id, boss_data["name"])
        await message.channel.send(embed=embed, view=view)
        return

    # ======================================================
    # ================= JUNTAR BOSS (co-op) ================
    # ======================================================
    elif any(word in content for word in ["juntar boss", "ajudar boss", "participar boss"]):
        player = get_player(user_id)

        conn = sqlite3.connect(DB_FILE)
        c = conn.cursor()
        c.execute("SELECT id, boss_name, leader_id, members FROM boss_battles WHERE status = 'recruiting' ORDER BY created_at DESC LIMIT 1")
        result = c.fetchone()
        conn.close()

        if not result:
            await message.channel.send("âŒ NÃ£o hÃ¡ batalhas de boss abertas no momento!")
            return

        battle_id, boss_name, leader_id, members_json = result
        members = json.loads(members_json)

        if str(user_id) in members:
            await message.channel.send("âŒ VocÃª jÃ¡ estÃ¡ nesta batalha!")
            return

        if len(members) >= 5:
            await message.channel.send("âŒ Esta batalha jÃ¡ estÃ¡ cheia (mÃ¡ximo 5 jogadores)!")
            return

        members.append(str(user_id))
        conn = sqlite3.connect(DB_FILE)
        c = conn.cursor()
        c.execute("UPDATE boss_battles SET members = ? WHERE id = ?", (json.dumps(members), battle_id))
        conn.commit()
        conn.close()

        await message.channel.send(
            f"âœ… **{message.author.mention}** entrou na batalha contra **{boss_name}**!\n\nğŸ‘¥ Jogadores: {len(members)}/5\n\nO lÃ­der pode usar `iniciar batalha boss` quando estiver pronto!"
        )
        return

    # ======================================================
    # ================= INICIAR BATALHA BOSS (co-op) =======
    # ======================================================
    elif any(word in content for word in ["iniciar batalha boss", "comeÃ§ar batalha boss", "start boss"]):
        conn = sqlite3.connect(DB_FILE)
        c = conn.cursor()
        c.execute("SELECT id, boss_name, leader_id, members, world_level FROM boss_battles WHERE leader_id = ? AND status = 'recruiting'", (str(user_id),))
        result = c.fetchone()

        if not result:
            await message.channel.send("âŒ VocÃª nÃ£o tem uma batalha de boss ativa. Use `desafiar boss` e escolha 'Chamar Aliados'.")
            conn.close()
            return

        battle_id, boss_name, leader_id, members_json, world_level = result
        members = json.loads(members_json)

        c.execute("UPDATE boss_battles SET status = 'active' WHERE id = ?", (battle_id,))
        conn.commit()
        conn.close()

        boss_data = WORLDS.get(world_level, WORLDS[1])["boss"]

        member_names = []
        for mid in members:
            try:
                u = await bot.fetch_user(int(mid))
                member_names.append(u.mention)
            except:
                pass

        embed = discord.Embed(
            title=f"âš”ï¸ BATALHA Ã‰PICA INICIADA!",
            description=f"**{'  |  '.join(member_names)}** vs **{boss_name}**!\n\n*'Que os deuses guiem suas espadas!'*",
            color=discord.Color.dark_red()
        )
        await message.channel.send(embed=embed)
        await asyncio.sleep(2)
        await fight_boss(message.channel, user_id, allies=members)
        return


    # ======================================================
    # ================= CRIAR GUILDA =======================
    # ======================================================
    elif "criar guilda" in content or "criar guild" in content:
        player = get_player(user_id)
        if player.get("guild_id"):
            await message.channel.send("âŒ VocÃª jÃ¡ estÃ¡ em uma guilda!")
            return

        guild_name = content.replace("criar guilda", "").replace("criar guild", "").strip()
        if not guild_name:
            await message.channel.send("âŒ Use: `criar guilda [nome]`")
            return

        conn = sqlite3.connect(DB_FILE)
        c = conn.cursor()
        try:
            c.execute("INSERT INTO guilds (name, leader_id, members) VALUES (?, ?, ?)",
                      (guild_name, str(user_id), json.dumps([str(user_id)])))
            guild_id = c.lastrowid
            conn.commit()
            player["guild_id"] = guild_id
            save_player_db(user_id, player)

            embed = discord.Embed(
                title="ğŸ° Guilda Criada!",
                description=f"*'A guilda **{guild_name}** foi fundada!'*",
                color=discord.Color.gold()
            )
            embed.add_field(name="ğŸ‘‘ LÃ­der", value=message.author.mention, inline=True)
            embed.set_footer(text="Outros podem usar 'entrar guilda' para se juntar!")
            await message.channel.send(embed=embed)
        except sqlite3.IntegrityError:
            await message.channel.send("âŒ JÃ¡ existe uma guilda com esse nome!")
        finally:
            conn.close()
        return

    # ======================================================
    # ================= ENTRAR GUILDA ======================
    # ======================================================
    elif "entrar guilda" in content or "entrar na guilda" in content:
        player = get_player(user_id)
        if player.get("guild_id"):
            await message.channel.send("âŒ VocÃª jÃ¡ estÃ¡ em uma guilda!")
            return

        conn = sqlite3.connect(DB_FILE)
        c = conn.cursor()
        c.execute("SELECT id, name, leader_id, members FROM guilds")
        guilds = c.fetchall()
        conn.close()

        if not guilds:
            await message.channel.send("âŒ NÃ£o hÃ¡ guildas! Crie uma com `criar guilda [nome]`")
            return

        embed = discord.Embed(title="ğŸ° Guildas DisponÃ­veis", color=discord.Color.blue())
        for guild_row in guilds:
            guild_id, name, leader_id, members_json = guild_row
            members = json.loads(members_json)
            embed.add_field(name=f"{guild_id}. {name}", value=f"ğŸ‘¥ Membros: {len(members)}", inline=False)
        await message.channel.send(embed=embed)

        def check(m):
            return m.author.id == user_id and m.content.isdigit()

        try:
            response = await bot.wait_for('message', check=check, timeout=30.0)
            guild_id_choice = int(response.content)
            conn = sqlite3.connect(DB_FILE)
            c = conn.cursor()
            c.execute("SELECT name, members FROM guilds WHERE id = ?", (guild_id_choice,))
            result = c.fetchone()
            if not result:
                await message.channel.send("âŒ Guilda nÃ£o encontrada!")
                conn.close()
                return
            guild_name, members_json = result
            members = json.loads(members_json)
            members.append(str(user_id))
            c.execute("UPDATE guilds SET members = ? WHERE id = ?", (json.dumps(members), guild_id_choice))
            conn.commit()
            conn.close()
            player["guild_id"] = guild_id_choice
            save_player_db(user_id, player)
            await message.channel.send(f"âœ… **VocÃª entrou na guilda {guild_name}!**")
        except asyncio.TimeoutError:
            await message.channel.send("â° Tempo esgotado!")
        return

    # ======================================================
    # ================= VER GUILDA =========================
    # ======================================================
    elif any(word in content for word in ["ver guilda", "minha guilda"]):
        player = get_player(user_id)
        if not player.get("guild_id"):
            await message.channel.send("âŒ VocÃª nÃ£o estÃ¡ em nenhuma guilda!")
            return

        conn = sqlite3.connect(DB_FILE)
        c = conn.cursor()
        c.execute("SELECT name, leader_id, members, total_xp FROM guilds WHERE id = ?", (player["guild_id"],))
        result = c.fetchone()
        conn.close()

        if not result:
            await message.channel.send("âŒ Guilda nÃ£o encontrada!")
            return

        guild_name, leader_id, members_json, total_xp = result
        members = json.loads(members_json)
        embed = discord.Embed(title=f"ğŸ° {guild_name}", color=discord.Color.gold())
        embed.add_field(name="ğŸ‘¥ Membros", value=len(members), inline=True)
        embed.add_field(name="â­ XP Total", value=total_xp, inline=True)
        await message.channel.send(embed=embed)
        return

    # ======================================================
    # ================= BEBER POÃ‡ÃƒO (formato antigo) =======
    # ======================================================
    elif any(word in content for word in ["beber", "usar poÃ§Ã£o", "tomar"]):
        player = get_player(user_id)
        potion_name = None
        for potion in POTIONS.keys():
            if potion.lower() in content:
                potion_name = potion
                break

        if not potion_name:
            await message.channel.send("âŒ Especifique qual poÃ§Ã£o! Formato: `[nome da poÃ§Ã£o], usar`")
            return

        if potion_name not in player["inventory"]:
            await message.channel.send(f"âŒ VocÃª nÃ£o tem **{potion_name}**!")
            return

        potion = POTIONS[potion_name]
        player["inventory"].remove(potion_name)
        embed = discord.Embed(
            title=f"{potion['emoji']} PoÃ§Ã£o Consumida!",
            description=f"*'VocÃª bebe **{potion_name}**...'*",
            color=RARITIES.get(potion["rarity"], {"color": 0xFFFFFF})["color"]
        )
        if "hp_restore" in potion:
            old_hp = player["hp"]
            player["hp"] = min(player["hp"] + potion["hp_restore"], player["max_hp"])
            embed.add_field(name="ğŸ’š HP Restaurado", value=f"+{player['hp'] - old_hp} HP", inline=False)
        if "xp_gain" in potion:
            add_xp(user_id, potion["xp_gain"])
            embed.add_field(name="â­ XP Ganho", value=f"+{potion['xp_gain']} XP", inline=False)
        if "revive" in potion and potion["revive"]:
            player["hp"] = player["max_hp"]
            embed.add_field(name="ğŸ’€ RessurreiÃ§Ã£o", value="HP completamente restaurado!", inline=False)
        save_player_db(user_id, player)
        await message.channel.send(embed=embed)
        return

    # ======================================================
    # ================= VENDER ITEM ========================
    # ======================================================
    elif content.startswith("vender"):
        player = get_player(user_id)
        item_name = content.replace("vender", "").strip()
        if not item_name:
            await message.channel.send("âŒ Use: `vender [nome do item]`")
            return

        found_item = None
        for item in player["inventory"]:
            if item_name in item.lower():
                found_item = item
                break

        if not found_item:
            await message.channel.send(f"âŒ VocÃª nÃ£o tem **{item_name}** no inventÃ¡rio!")
            return

        price = get_item_sell_price(found_item)
        player["inventory"].remove(found_item)
        player["coins"] += price
        save_player_db(user_id, player)

        embed = discord.Embed(
            title="ğŸ’° Item Vendido!",
            description=f"*'VocÃª vendeu **{found_item}** por **{price} CSI**!'*",
            color=discord.Color.gold()
        )
        embed.add_field(name="ğŸ’° Moedas Atuais", value=f"{player['coins']} CSI", inline=False)
        await message.channel.send(embed=embed)
        return

    # ======================================================
    # ================= TROCAR ITEMS =======================
    # ======================================================
    if "trocar" in content and "@" in message.content and "csi" not in content:
        parts = message.content.split("com")
        if len(parts) < 2:
            return

        from_items_text = parts[0].replace("trocar", "").strip()
        mentions = message.mentions
        if not mentions:
            await message.channel.send("âŒ Mencione um usuÃ¡rio vÃ¡lido!")
            return

        to_user = mentions[0]
        to_user_id = to_user.id

        if to_user_id == user_id:
            await message.channel.send("âŒ VocÃª nÃ£o pode trocar com vocÃª mesmo!")
            return

        await message.channel.send(f"{to_user.mention}, que item vocÃª oferece em troca de **{from_items_text}**?\n\nResponda com: `ofereÃ§o [nome do item]`")

        def check(m):
            return m.author.id == to_user_id and "ofereÃ§o" in m.content.lower()

        try:
            response = await bot.wait_for('message', check=check, timeout=60.0)
            to_items_text = response.content.replace("ofereÃ§o", "").strip()

            embed = discord.Embed(title="ğŸ”„ Proposta de Troca", color=discord.Color.blue())
            embed.add_field(name=f"ğŸ“¤ {message.author.name} oferece", value=f"**{from_items_text}**", inline=True)
            embed.add_field(name=f"ğŸ“¥ {to_user.name} oferece", value=f"**{to_items_text}**", inline=True)

            view = TradeButton(user_id, to_user_id, [from_items_text], [to_items_text])
            await message.channel.send(embed=embed, view=view)
        except asyncio.TimeoutError:
            await message.channel.send("â° Tempo esgotado! Proposta expirou.")
        return

    # ======================================================
    # ================= TROCAR COINS CSI ===================
    # ======================================================
    elif "trocar" in content and "csi" in content:
        player = get_player(user_id)
        embed = discord.Embed(
            title="ğŸ’± SolicitaÃ§Ã£o de ConversÃ£o",
            description=f"{message.author.mention} deseja converter moedas CSI.",
            color=discord.Color.gold()
        )
        embed.add_field(name="ğŸ’° Moedas CSI", value=f"`{player['coins']}` CSI", inline=False)
        await message.channel.send(embed=embed)
        try:
            admin = await bot.fetch_user(int(BOT_OWNER_ID))
            dm_embed = discord.Embed(title="ğŸ”” SolicitaÃ§Ã£o de ConversÃ£o", color=discord.Color.gold())
            dm_embed.add_field(name="Jogador", value=f"{message.author.name} ({message.author.id})", inline=False)
            dm_embed.add_field(name="ğŸ’° Moedas CSI", value=f"`{player['coins']}` CSI", inline=False)
            await admin.send(embed=dm_embed)
        except:
            pass
        return

    # ======================================================
    # ================= EXPLORAR ===========================
    # ======================================================
    if content in ["comandos", "ver comandos", "lista de comandos", "ajuda", "help", "/comandos"]:
        # â”€â”€ PÃ¡gina 1: Personagem, InÃ­cio, Ciclos â”€â”€
        e1 = discord.Embed(
            title="ğŸ“‹ COMANDOS â€” World CSI  [1/5]",
            description="*Guia completo â€” 40 reinos, 5 dimensÃµes, 6 ciclos!*\n`comandos 2` `comandos 3` `comandos 4` `comandos 5` para mais pÃ¡ginas",
            color=0x3498DB
        )
        e1.add_field(
            name="ğŸ‘¤ Personagem",
            value=(
                "`ver perfil` | `inventÃ¡rio` | `escolher raÃ§a` | `evoluir raÃ§a`\n"
                "`escolher classe` | `habilidades` | `evoluÃ§Ã£o classe` | `ver mana`"
            ),
            inline=False
        )
        e1.add_field(
            name="ğŸ’ª Treinamento & Conquistas",
            value=(
                "`treinar forÃ§a` | `treinar defesa` | `treinar vitalidade` | `treinar intensivo`\n"
                "`ver conquistas` | `alinhamento` | `ver tÃ­tulos`"
            ),
            inline=False
        )
        e1.add_field(
            name="ğŸŒŸ 7 Tiers de EvoluÃ§Ã£o de Classe",
            value=(
                "Desbloqueados nos nÃ­veis: **40 / 80 / 120 / 160 / 200 / 400 / 500**\n"
                "Tier I Ã—1 â†’ II Ã—2.5 â†’ III Ã—5 â†’ IV Ã—10 â†’ V Ã—20 â†’ VI Ã—50 â†’ VII Ã—100\n"
                "Tier V (Transcendental) | Tier VI (Dimensional) | Tier VII (Absoluto)"
            ),
            inline=False
        )
        e1.add_field(
            name="ğŸ”„ Os 4 Ciclos de Mundo",
            value=(
                "âš”ï¸ **Ciclo 1** â€” Reinos Mortais (1â€“199)\n"
                "ğŸŒŒ **Ciclo 2** â€” Reinos AvanÃ§ados (200â€“399)\n"
                "ğŸ’« **Ciclo 3** â€” DimensÃµes Superiores (400â€“499)\n"
                "â™¾ï¸ **Ciclo 4** â€” Planos Absolutos (500â€“600)\n"
                "`ver perfil` mostra seu ciclo atual"
            ),
            inline=False
        )
        e1.set_footer(text="PÃ¡gina 1/5 â€” Use 'comandos 2' para ExploraÃ§Ã£o & Combate")

        # â”€â”€ PÃ¡gina 2: ExploraÃ§Ã£o, Boss, Combate â”€â”€
        e2 = discord.Embed(
            title="ğŸ“‹ COMANDOS â€” World CSI  [2/5]",
            description="*ExploraÃ§Ã£o, boss, dungeons e combate*",
            color=0x2ECC71
        )
        e2.add_field(
            name="ğŸŒ ExploraÃ§Ã£o & Coleta",
            value="`explorar` | `caÃ§ar` | `coletar` | `minerar` | `dungeon` | `procurar dungeon`",
            inline=False
        )
        e2.add_field(
            name="ğŸ‘¹ Boss & Combate",
            value=(
                "`encontrar boss` â€” boss do reino atual\n"
                "`desafiar boss` â€” boss de nÃ­vel nos nÃ­veis 9/19/29/.../599\n"
                "`juntar boss` | `iniciar batalha boss` | `desafiar @jogador`"
            ),
            inline=False
        )
        e2.add_field(
            name="ğŸš¨ Sistema de Boss de NÃ­vel â€” 60 Bosses",
            value=(
                "Nos **nÃ­veis terminados em 9** (9, 19... 599), o XP Ã© **bloqueado**!\n"
                "O XP acumula e Ã© liberado apenas ao **vencer o boss de nÃ­vel**.\n"
                "Somente o boss de nÃ­vel desbloqueia o prÃ³ximo reino e novas habilidades.\n"
                "Se perder, o XP continua bloqueado atÃ© a revanche."
            ),
            inline=False
        )
        e2.add_field(
            name="ğŸ’ª Treinamento (apÃ³s derrota em boss)",
            value="`treinar forÃ§a` â€” +ATK | `treinar defesa` â€” +DEF | `treinar vitalidade` â€” +HP | `treinar intensivo`",
            inline=False
        )
        e2.add_field(
            name="ğŸ—ºï¸ Mapa & Viagem â€” 60 Reinos",
            value="`abrir mapa` | `viajar <local>` | `procurar cidade`",
            inline=False
        )
        e2.set_footer(text="PÃ¡gina 2/5 â€” Use 'comandos 3' para Pets, Empregos & Quests")

        # â”€â”€ PÃ¡gina 3: Pets, Empregos, Quests â”€â”€
        e3 = discord.Embed(
            title="ğŸ“‹ COMANDOS â€” World CSI  [3/5]",
            description="*Pets, empregos, quests e moral*",
            color=0xF39C12
        )
        e3.add_field(
            name="ğŸ¾ Pets",
            value=(
                "`procurar pet` | `domesticar` | `evoluir pet` | `fazenda` | `ver fazenda`\n"
                "`trocar pet` | `guardar pet` | `stats pet`\n"
                "*Pets participam automaticamente de batalhas de boss!*"
            ),
            inline=False
        )
        e3.add_field(
            name="ğŸ¾ Formas Especiais",
            value=(
                "`quarta forma pet` â€” Pets Comuns, nÃ­vel 3+\n"
                "`forma bestial pet` â€” Pets LendÃ¡rio+, nÃ­vel 80+\n"
                "Use `ajuda formas pet` para detalhes"
            ),
            inline=False
        )
        e3.add_field(
            name="ğŸ’¼ Empregos & Ferreiro",
            value=(
                "`procurar emprego` | `ver emprego` | `trabalhar` | `largar emprego`\n"
                "`forjar armas` | `fundir [raridade]` â€” Ferreiro nÃ­vel 5+\n"
                "60% sobe raridade | 25% mantÃ©m | 15% tudo destruÃ­do!"
            ),
            inline=False
        )
        e3.add_field(
            name="ğŸ“‹ Quests & Moral",
            value=(
                "`ver quests` | `realizar quest` | `finalizar quest` | `abandonar quest`\n"
                "`cenÃ¡rio` | `missÃ£o moral` | `alinhamento`"
            ),
            inline=False
        )
        e3.set_footer(text="PÃ¡gina 3/5 â€” Use 'comandos 4' para Itens, Magia, Guilda & Reino")

        # â”€â”€ PÃ¡gina 4: Itens, Magia, Guilda, Reino â”€â”€
        e4 = discord.Embed(
            title="ğŸ“‹ COMANDOS â€” World CSI  [4/5]",
            description="*Itens, magia, guilda, reino e AFK*",
            color=0x9B59B6
        )
        e4.add_field(
            name="ğŸ›’ Itens & Economia",
            value=(
                "`equipar [item]` | `[item], usar` | `usar poÃ§Ã£o`\n"
                "`vender [item]` | `trocar [item] com @user` | `trocar coins`"
            ),
            inline=False
        )
        e4.add_field(
            name="âœ¨ Magias & Livro de FeitiÃ§os",
            value=(
                "`livro de feitiÃ§os` â€” desbloqueado no **NÃ­vel 12**\n"
                "`feitiÃ§os` | `avanÃ§ar categoria mana` | `treinar mana`\n"
                "`curar @aliado` â€” Paladino / Druida / Mago / Bardo"
            ),
            inline=False
        )
        e4.add_field(
            name="ğŸ° Guilda",
            value=(
                "`criar guilda [nome]` | `entrar guilda [nome]` | `ver guilda`\n"
                "*Guildas compartilham XP e tÃªm rankings prÃ³prios!*"
            ),
            inline=False
        )
        e4.add_field(
            name="ğŸ‘‘ Sistema de Reino",
            value=(
                "`me tornar rei` | `meu reino` | `personalizar reino [nome]`\n"
                "`melhorar economia` | `reforÃ§ar exercito` | `atacar reino @rei`\n"
                "`nomear cavaleiro @user` | `governar` | `decretar lei`\n"
                "`trocar recursos @rei [valor]`"
            ),
            inline=False
        )
        e4.add_field(
            name="ğŸŒ Mundo PrÃ³prio & AFK",
            value=(
                "`criar mundo prÃ³prio` | `adicionar jogador @user` (dentro do canal)\n"
                "`farm afk` | `perÃ­odo` | `descansar` | `clima`"
            ),
            inline=False
        )
        e4.set_footer(text="PÃ¡gina 4/5 â€” Use 'comandos 5' para NPCs, FusÃ£o & Dicas")

        # â”€â”€ PÃ¡gina 5: NPCs, FusÃ£o, Dicas â”€â”€
        e5 = discord.Embed(
            title="ğŸ“‹ COMANDOS â€” World CSI  [5/5]",
            description="*NPCs, fusÃ£o de itens, sistemas especiais e dicas*",
            color=0xE74C3C
        )
        e5.add_field(
            name="ğŸ—£ï¸ Dialogar com NPCs",
            value=(
                "`dialogar com npc [nome]` â€” Lore, segredos e quests ocultas!\n"
                "NPCs: Theron, Elara, Sylvara, Bjorn, Ramses, Spectra, Imperador Astral...\n"
                "â€¢ 50% â†’ Lore | 25% â†’ Segredo | 25% â†’ Quest Oculta exclusiva!"
            ),
            inline=False
        )
        e5.add_field(
            name="ğŸ”¨ FusÃ£o de Itens (Ferreiro nÃ­vel 5+)",
            value=(
                "`forjar armas` â€” Abre o menu | `fundir [raridade]` â€” Funde 5 itens\n"
                "60% sobe raridade | 25% fica igual | 15% tudo destruÃ­do!\n"
                "*Cadeia:* Comumâ†’Incomumâ†’Raroâ†’Ã‰picoâ†’LendÃ¡rioâ†’MÃ­ticoâ†’Ancestralâ†’Divinoâ†’Primordial"
            ),
            inline=False
        )
        e5.add_field(
            name="ğŸ“š Info, Lore & AtualizaÃ§Ã£o",
            value=(
                "`atualizaÃ§Ã£o` â€” novidades da expansÃ£o (40 reinos, 5 dimensÃµes, 6 ciclos)\n"
                "`comandos` â€” esta lista | `abrir livro` | `falar npc especial`\n"
                "`ver conquistas` â€” veja as conquistas e progresso"
            ),
            inline=False
        )
        e5.add_field(
            name="ğŸ’¡ Dicas Importantes",
            value=(
                "â€¢ **60 Bosses de NÃ­vel:** XP acumula durante bloqueio, liberado ao vencer\n"
                "â€¢ **4 Ciclos:** Ciclo 2 (200), Ciclo 3 (400), Ciclo 4 (500) â€” cada um escala tudo\n"
                "â€¢ **Drops:** Monstros â†’ Ã‰pico | Bosses â†’ MÃ­tico+ | Ciclos avanÃ§ados â†’ Divino/Primordial\n"
                "â€¢ **RaÃ§a:** Escolha permanente â€” escolha com cuidado!\n"
                "â€¢ **Mundo PrÃ³prio:** Canal privado funciona com TODOS os comandos\n"
                "â€¢ Use `atualizaÃ§Ã£o` para ver o que foi adicionado recentemente!"
            ),
            inline=False
        )
        e5.set_footer(text="World CSI Bot â€” Use 'atualizaÃ§Ã£o' para ver novidades | 'comandos' para esta lista")

        await message.channel.send(embed=e1)
        await message.channel.send(embed=e2)
        await message.channel.send(embed=e3)
        await message.channel.send(embed=e4)
        await message.channel.send(embed=e5)
        return

    # â”€â”€ PÃGINAS INDIVIDUAIS DE COMANDOS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    if content in ["comandos 1"]:
        e1 = discord.Embed(title="ğŸ“‹ COMANDOS [1/5] â€” Personagem & InÃ­cio", color=0x3498DB)
        e1.add_field(name="ğŸ‘¤ Personagem", value="`ver perfil` | `inventÃ¡rio` | `escolher raÃ§a` | `evoluir raÃ§a` | `escolher classe` | `habilidades` | `evoluÃ§Ã£o classe` | `ver mana`", inline=False)
        e1.add_field(name="ğŸ’ª Treinamento", value="`treinar forÃ§a` | `treinar defesa` | `treinar vitalidade` | `treinar intensivo`", inline=False)
        e1.add_field(name="ğŸ† Conquistas & Alinhamento", value="`ver conquistas` | `alinhamento` | `ver tÃ­tulos` | `cenÃ¡rio` | `missÃ£o moral`", inline=False)
        e1.add_field(name="ğŸŒŸ 7 Tiers de EvoluÃ§Ã£o de Classe", value="NÃ­vel **40** â†’ **80** â†’ **120** â†’ **160** â†’ **200** (Transcendental) â†’ **400** (Dimensional) â†’ **500** (Absoluto)\nTier I Ã—1 â†’ II Ã—2.5 â†’ III Ã—5 â†’ IV Ã—10 â†’ V Ã—20 â†’ VI Ã—50 â†’ VII Ã—100", inline=False)
        e1.add_field(name="ğŸ”„ Ciclos de Mundo", value="`ver perfil` mostra seu ciclo atual\nâš”ï¸ Ciclo 1 (1â€“199) | ğŸŒŒ Ciclo 2 (200â€“399) | ğŸ’« Ciclo 3 (400â€“499) | â™¾ï¸ Ciclo 4 (500â€“600)", inline=False)
        e1.set_footer(text="PÃ¡gina 1/5 â€” Use 'comandos 2' para continuar")
        await message.channel.send(embed=e1)
        return
    if content in ["comandos 2"]:
        e2 = discord.Embed(title="ğŸ“‹ COMANDOS [2/5] â€” ExploraÃ§Ã£o & Combate", color=0x2ECC71)
        e2.add_field(name="ğŸŒ ExploraÃ§Ã£o", value="`explorar` | `coletar` | `minerar` | `dungeon` | `procurar dungeon` | `abrir mapa` | `viajar [local]`", inline=False)
        e2.add_field(name="ğŸ‘¹ Boss & Combate", value="`encontrar boss` | `desafiar boss` | `juntar boss` | `iniciar batalha boss` | `desafiar @jogador`", inline=False)
        e2.add_field(name="ğŸš¨ Boss de NÃ­vel (40+ bosses)", value="**NÃ­veis 9/19/29/.../599** â€” XP bloqueado atÃ© vencer!\nBoss de NÃ­vel desbloqueia o prÃ³ximo reino e novas habilidades.", inline=False)
        e2.add_field(name="ğŸ’ª Treinamento pÃ³s-derrota", value="`treinar forÃ§a` (+ATK) | `treinar defesa` (+DEF) | `treinar vitalidade` (+HP) | `treinar intensivo`", inline=False)
        e2.add_field(name="ğŸ—ºï¸ Mapa & Viagem", value="`abrir mapa` â€” navega pelos 40 reinos + 5 dimensÃµes | `procurar cidade` | `viajar [local]`", inline=False)
        e2.set_footer(text="PÃ¡gina 2/5 â€” Use 'comandos 3' para continuar")
        await message.channel.send(embed=e2)
        return
    if content in ["comandos 3"]:
        e3 = discord.Embed(title="ğŸ“‹ COMANDOS [3/5] â€” Pets, Empregos & Quests", color=0xF39C12)
        e3.add_field(name="ğŸ¾ Pets", value="`procurar pet` | `domesticar` | `evoluir pet` | `fazenda` | `ver fazenda` | `trocar pet` | `guardar pet` | `stats pet`", inline=False)
        e3.add_field(name="ğŸ¾ Formas Especiais de Pet", value="`quarta forma pet` (Comuns, nÃ­vel 3+) | `forma bestial pet` (LendÃ¡rio+, nÃ­vel 80+)\nPets participam **automaticamente** de batalhas de boss!", inline=False)
        e3.add_field(name="ğŸ’¼ Empregos", value="`procurar emprego` | `ver emprego` | `trabalhar` | `largar emprego`\n`forjar armas` | `fundir [raridade]` â€” Ferreiro nÃ­vel 5+", inline=False)
        e3.add_field(name="ğŸ“‹ Quests & Moral", value="`ver quests` | `realizar quest` | `finalizar quest` | `abandonar quest`\n`cenÃ¡rio` | `missÃ£o moral` | `alinhamento`", inline=False)
        e3.set_footer(text="PÃ¡gina 3/5 â€” Use 'comandos 4' para continuar")
        await message.channel.send(embed=e3)
        return
    if content in ["comandos 4"]:
        e4 = discord.Embed(title="ğŸ“‹ COMANDOS [4/5] â€” Itens, Magia, Guilda & Reino", color=0x9B59B6)
        e4.add_field(name="ğŸ›’ Itens & Economia", value="`equipar [item]` | `[item], usar` | `usar poÃ§Ã£o` | `vender [item]`\n`trocar [item] com @user` | `trocar coins` / `converter coins`", inline=False)
        e4.add_field(name="âœ¨ Magias & Mana", value="`livro de feitiÃ§os` | `feitiÃ§os` | `avanÃ§ar categoria mana`\n`treinar mana` | `curar @aliado`", inline=False)
        e4.add_field(name="ğŸ° Guilda", value="`criar guilda [nome]` | `entrar guilda [nome]` | `ver guilda`", inline=False)
        e4.add_field(name="ğŸ‘‘ Reino", value="`me tornar rei` | `meu reino` | `personalizar reino [nome]`\n`melhorar economia` | `reforÃ§ar exercito` | `atacar reino @rei`\n`nomear cavaleiro @user` | `governar` | `decretar lei`", inline=False)
        e4.add_field(name="ğŸŒ Mundo PrÃ³prio & AFK", value="`criar mundo prÃ³prio` | `adicionar jogador @user`\n`farm afk` | `perÃ­odo` | `descansar` | `clima`", inline=False)
        e4.set_footer(text="PÃ¡gina 4/5 â€” Use 'comandos 5' para continuar")
        await message.channel.send(embed=e4)
        return
    if content in ["comandos 5"]:
        e5 = discord.Embed(title="ğŸ“‹ COMANDOS [5/5] â€” NPCs, FusÃ£o & Dicas", color=0xE74C3C)
        e5.add_field(name="ğŸ—£ï¸ NPCs & Lore", value="`dialogar com npc [nome]` â€” Lore, segredos e quests ocultas!\nNPCs: Theron, Elara, Sylvara, Bjorn, Ramses, Spectra, Imperador Astral...\n`falar npc especial` | `npc lore` | `abrir livro`", inline=False)
        e5.add_field(name="ğŸ”¨ FusÃ£o de Itens (Ferreiro nÃ­vel 5+)", value="`forjar armas` | `fundir [raridade]` â€” Funde 5 itens\n60% sobe raridade | 25% fica igual | 15% tudo destruÃ­do!\nCadeia: Comumâ†’Incomumâ†’Raroâ†’Ã‰picoâ†’LendÃ¡rioâ†’MÃ­ticoâ†’Ancestralâ†’Divinoâ†’Primordial", inline=False)
        e5.add_field(name="ğŸ“š Info & AtualizaÃ§Ã£o", value="`atualizaÃ§Ã£o` â€” novidades da expansÃ£o | `comandos` â€” esta lista", inline=False)
        e5.add_field(name="ğŸ’¡ Dicas Importantes", value=(
            "â€¢ **Boss de NÃ­vel (40+ bosses):** XP acumula durante bloqueio, liberado ao vencer\n"
            "â€¢ **Ciclos:** Ciclo 2 (nÃ­vel 200), Ciclo 3 (400), Ciclo 4 (500) â€” cada um escala tudo\n"
            "â€¢ **Drops:** Monstros â†’ atÃ© Ã‰pico | Bosses â†’ MÃ­tico+ | Ciclos avanÃ§ados â†’ Divino/Primordial\n"
            "â€¢ **RaÃ§a:** Escolha permanente â€” pense bem! | **Classe:** 7 tiers de evoluÃ§Ã£o atÃ© o Absoluto\n"
            "â€¢ **Mundo PrÃ³prio:** Canal privado funciona com TODOS os comandos"
        ), inline=False)
        e5.set_footer(text="World CSI Bot â€” Use 'atualizaÃ§Ã£o' para ver novidades | 'comandos' para esta lista")
        await message.channel.send(embed=e5)
        return

    # â”€â”€ ATUALIZAÃ‡ÃƒO / NOVIDADES / CHANGELOG â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    if content in ["atualizaÃ§Ã£o", "atualizacao", "novidades", "update", "changelog", "o que Ã© novo", "o que foi adicionado", "novidades do bot", "patch notes"]:
        e_atu1 = discord.Embed(
            title="ğŸ“° ATUALIZAÃ‡ÃƒO â€” 40 Reinos & 5 DimensÃµes",
            description=(
                "**VersÃ£o:** Reinos & DimensÃµes â€” Fevereiro 2026\n\n"
                "*O mundo foi reorganizado em 6 CapÃ­tulos. Cada reino tem identidade prÃ³pria.*\n\n"
                "```\n"
                "  40 reinos  â€¢  5 dimensÃµes  â€¢  6 capÃ­tulos  â€¢  level mÃ¡ximo 600\n"
                "```"
            ),
            color=0xFF6B00
        )
        e_atu1.add_field(
            name="ğŸ“— CapÃ­tulo I â€” Terras Iniciais  Â·  nÃ­vel 1â€“100",
            value=(
                "ğŸŒ± R1 Campos Iniciais  ğŸŒ² R2 Floresta Sombria  ğŸœï¸ R3 Deserto das Almas\n"
                "â„ï¸ R4 Montanhas Geladas  ğŸŒ‹ R5 Terras VulcÃ¢nicas  ğŸŒŒ R6 Abismo Arcano\n"
                "ğŸ‘‘ R7 Trono Celestial  ğŸŒ¿ R8 PÃ¢ntanos de Morthak  ğŸ’ R9 Floresta Cristalina\n"
                "ğŸŒ‘ R10 Sombras Eternas\n"
                "> ğŸ—ï¸ Chave **Antiga** destranca as masmorras secretas"
            ),
            inline=False
        )
        e_atu1.add_field(
            name="ğŸ“˜ CapÃ­tulo II â€” NaÃ§Ãµes IntermediÃ¡rias  Â·  nÃ­vel 101â€“200",
            value=(
                "âš¡ R11 PlanÃ­cies do TrovÃ£o  ğŸ—¿ R12 Terra dos Gigantes  ğŸŒŠ R13 Mar das Almas\n"
                "ğŸŒ€ R14 Reino do Caos  ğŸŒ¸ R15 Jardim dos Deuses  ğŸ§Š R16 Gelo Eterno\n"
                "ğŸ›ï¸ R17 RuÃ­nas Esquecidas  âœ¨ R18 Plano Astral  ğŸŒŒ R19 AlÃ©m da ExistÃªncia\n"
                "â­ R20 Trono Primordial\n"
                "> ğŸ”‘ Chave **Arcana** destranca as masmorras secretas"
            ),
            inline=False
        )
        e_atu1.add_field(
            name="ğŸ“™ CapÃ­tulo III â€” ImpÃ©rios AvanÃ§ados  Â·  nÃ­vel 201â€“300",
            value=(
                "âš”ï¸ R21 Â· ğŸŒŠ R22 Â· âš–ï¸ R23 Â· ğŸŸï¸ R24 Â· ğŸ”— R25\n"
                "ğŸŒ¸ R26 Â· ğŸŒ‘ R27 Â· ğŸŒŒ R28 Â· ğŸ”¥ R29 Â· âœ¨ R30\n"
                "> ğŸ—¡ï¸ Chave **Sombria** destranca as masmorras secretas"
            ),
            inline=False
        )
        e_atu1.add_field(
            name="ğŸ“• CapÃ­tulo IV â€” Corrompidas & Dimensionais  Â·  nÃ­vel 301â€“400",
            value=(
                "ğŸ©¸ R31 Â· ğŸ¦  R32 Â· ğŸ’€ R33 Â· ğŸŒ‘ R34 Â· â›“ï¸ R35  *(Corrompidas)*\n"
                "ğŸŒ€ R36 Â· ğŸ”® R37 Â· ğŸŒŠ R38 Â· â­ R39 Â· ğŸŒŒ R40  *(Dimensionais)*\n"
                "> ğŸ’¥ Bosses Dimensionais liberam **passivas globais** e **slots extras**!"
            ),
            inline=False
        )
        e_atu1.add_field(
            name="ğŸŒŒ CapÃ­tulo V â€” As Cinco DimensÃµes  Â·  nÃ­vel 401â€“500",
            value=(
                "ğŸ•Šï¸ **Celestial** â€” buff sagrado\n"
                "ğŸ”¥ **Infernal** â€” dano de fogo contÃ­nuo\n"
                "ğŸŒªï¸ **Badlands** â€” caos puro, eventos aleatÃ³rios\n"
                "ğŸŒ‘ **Abissal** â€” debuff de sanidade\n"
                "ğŸŒ€ **Vazio** â€” distorÃ§Ã£o da realidade"
            ),
            inline=False
        )
        e_atu1.add_field(
            name="â™¾ï¸ CapÃ­tulo VI â€” Planos Absolutos  Â·  nÃ­vel 501â€“600",
            value="Raridades: Divino, Primordial, Absoluto. **NÃ­vel 600** = o fim da jornada.",
            inline=False
        )
        e_atu1.set_footer(text="Use 'atualizaÃ§Ã£o' a qualquer hora para rever | PÃ¡gina 1/2")
        await message.channel.send(embed=e_atu1)

        e_atu2 = discord.Embed(
            title="ğŸ“° ATUALIZAÃ‡ÃƒO â€” Dungeons, Chaves & Sistemas",
            description="*ContinuaÃ§Ã£o das novidades da expansÃ£o 40 Reinos & 5 DimensÃµes...*",
            color=0xFF6B00
        )
        e_atu2.add_field(
            name="ğŸ—ï¸ 5 Tipos de Chave para Dungeons Secretas",
            value=(
                "Cada grupo de reinos tem chaves especÃ­ficas:\n"
                "ğŸ—ï¸ **Chave Antiga** â€” Terras Iniciais (reinos 1â€“10)\n"
                "ğŸ”‘ **Chave Arcana** â€” NaÃ§Ãµes IntermediÃ¡rias (reinos 11â€“20)\n"
                "ğŸ—¡ï¸ **Chave Sombria** â€” ImpÃ©rios AvanÃ§ados + Terras Corrompidas (reinos 21â€“35)\n"
                "âœ¨ **Chave Celestial** â€” Reinos Dimensionais + Dim. Celestial (reinos 36â€“40)\n"
                "ğŸŒ‘ **Chave Abissal** â€” DimensÃµes Infernal, Badlands, Abissal e Vazio"
            ),
            inline=False
        )
        e_atu2.add_field(
            name="ğŸ° Estrutura de Cada Reino",
            value=(
                "Cada um dos 40 reinos agora tem estrutura completa:\n"
                "â€¢ ğŸ™ï¸ Cidade principal\n"
                "â€¢ 4â€“6 Ã¡reas explorÃ¡veis\n"
                "â€¢ 1 Dungeon comum | 1 Dungeon avanÃ§ada\n"
                "â€¢ 1 Dungeon secreta (ativada por chave)\n"
                "â€¢ 1 Boss de Level | 1â€“2 Bosses opcionais\n"
                "â€¢ 1 World Event raro"
            ),
            inline=False
        )
        e_atu2.add_field(
            name="ğŸŒŒ DimensÃµes: Efeitos Ambientais",
            value=(
                "Cada dimensÃ£o tem efeito ambiental Ãºnico:\n"
                "ğŸ•Šï¸ Celestial: **buff sagrado** passivo | ğŸ”¥ Infernal: **dano contÃ­nuo**\n"
                "ğŸŒªï¸ Badlands: **caos** (eventos aleatÃ³rios) | ğŸŒ‘ Abissal: **debuff de sanidade**\n"
                "ğŸŒ€ Vazio: **distorÃ§Ã£o da realidade** (stats alterados aleatoriamente)"
            ),
            inline=False
        )
        e_atu2.add_field(
            name="ğŸ“Š Hierarquia de Raridades (inalterada)",
            value=(
                "âšª Comum â†’ ğŸŸ¢ Incomum â†’ ğŸ”µ Raro â†’ ğŸŸ£ Ã‰pico â†’ ğŸŸ¡ LendÃ¡rio\n"
                "ğŸ”´ MÃ­tico â†’ ğŸŸ  Ancestral â†’ ğŸ’ Divino â†’ ğŸŒˆ Primordial\n"
                "*Raridades superiores surgem com mais frequÃªncia nos ciclos 5 e 6.*"
            ),
            inline=False
        )
        e_atu2.add_field(
            name="ğŸ—ºï¸ Sistemas Anteriores Mantidos",
            value=(
                "âœ… Dungeons secretas com chaves | âœ… FusÃ£o de itens (Ferreiro)\n"
                "âœ… Pets com quarta forma e forma bestial | âœ… Empregos, reino, guilda\n"
                "âœ… DiÃ¡logo com NPCs e quests ocultas | âœ… Mundo prÃ³prio | âœ… Farm AFK"
            ),
            inline=False
        )
        e_atu2.set_footer(text="World CSI Bot â€” ExpansÃ£o 40 Reinos & 5 DimensÃµes | PÃ¡gina 2/3 | 'atualizaÃ§Ã£o' para rever")
        await message.channel.send(embed=e_atu2)

        e_atu3 = discord.Embed(
            title="ğŸ“– Todos os CapÃ­tulos â€” Guia RÃ¡pido",
            description=(
                "*Use `abrir mapa` e navegue com **â—€ â–¶** para ver cada capÃ­tulo em detalhes.*\n\n"
                "Resumo completo dos 40 reinos + 5 dimensÃµes:"
            ),
            color=0xFF6B00
        )
        e_atu3.add_field(
            name="ğŸ“— Cap. I  â€¢  Terras Iniciais  (1â€“100)",
            value="ğŸŒ±ğŸŒ²ğŸœï¸â„ï¸ğŸŒ‹ğŸŒŒğŸ‘‘ğŸŒ¿ğŸ’ğŸŒ‘  â€¢  ğŸ—ï¸ Chave Antiga",
            inline=False
        )
        e_atu3.add_field(
            name="ğŸ“˜ Cap. II  â€¢  NaÃ§Ãµes IntermediÃ¡rias  (101â€“200)",
            value="âš¡ğŸ—¿ğŸŒŠğŸŒ€ğŸŒ¸ğŸ§ŠğŸ›ï¸âœ¨ğŸŒŒâ­  â€¢  ğŸ”‘ Chave Arcana",
            inline=False
        )
        e_atu3.add_field(
            name="ğŸ“™ Cap. III  â€¢  ImpÃ©rios AvanÃ§ados  (201â€“300)",
            value="ğŸ”±âš¡ğŸŒ€ğŸ”ï¸ğŸŒŠğŸ”¥â„ï¸âš—ï¸ğŸŒŒâš–ï¸  â€¢  ğŸ—¡ï¸ Chave Sombria",
            inline=False
        )
        e_atu3.add_field(
            name="ğŸ“• Cap. IV  â€¢  Terras Corrompidas  (301â€“350)",
            value="ğŸ—¡ï¸ğŸ‘ï¸ğŸ”®ğŸ’ğŸŒ‘  â€¢  ğŸ—¡ï¸ Chave Sombria",
            inline=False
        )
        e_atu3.add_field(
            name="ğŸ“’ Cap. V  â€¢  Reinos Dimensionais  (351â€“400)",
            value="â˜„ï¸ğŸŒğŸ•³ï¸ğŸŒâš¡  â€¢  âœ¨ Chave Celestial  â€¢  ğŸ’¥ Bosses liberam passivas & slots!",
            inline=False
        )
        e_atu3.add_field(
            name="ğŸŒŒ Cap. VI  â€¢  As 5 DimensÃµes  (401â€“500)",
            value="ğŸ•Šï¸ Celestial  â€¢  ğŸ”¥ Infernal  â€¢  ğŸŒªï¸ Badlands  â€¢  ğŸŒ‘ Abissal  â€¢  ğŸŒ€ Vazio  â€¢  ğŸŒ‘ Chave Abissal",
            inline=False
        )
        e_atu3.add_field(
            name="â™¾ï¸ Cap. VII  â€¢  Planos Absolutos  (501â€“600)",
            value="ğŸ”±ğŸŒ ğŸ’«ğŸŒ€ğŸ›ï¸â­ğŸŒŒâš¡ğŸ”±ğŸ’ğŸŒ â™¾ï¸ğŸŒ‘ğŸŒŸâš–ï¸ğŸ”¥ğŸŒŠğŸ’¨âš¡ğŸŒŒâ™¾ï¸  â€¢  ğŸŒ‘ Chave Abissal",
            inline=False
        )
        e_atu3.set_footer(text="ğŸ—ºï¸ `abrir mapa` â†’ botÃµes â—€ â–¶ para explorar cada capÃ­tulo | 40 reinos â€¢ 5 dimensÃµes | PÃ¡gina 3/3")
        await message.channel.send(embed=e_atu3)
        return

    # ======================================================
    # ================= EXPLORAR ===========================
    # ======================================================
    if any(word in content for word in ["explorar", "vou explorar", "andar", "caminhar", "vou para"]):
        player = get_player(user_id)
        if player["level"] >= 2 and not player.get("class"):
            await message.channel.send("âš ï¸ Escolha uma classe primeiro! Use: `escolher classe`")
            return
        world = get_world(player["level"], player)
        roll = roll_with_bonus(player)
        luck = get_luck(roll)
        event = random.choice(world["events"])

        embed = discord.Embed(
            title=f"{world['emoji']} {world['name']}",
            description=f"*'{event}'*",
            color=discord.Color.blue()
        )
        embed.add_field(name="ğŸ² Dado do Destino", value=f"`{roll}` {luck['emoji']} **{luck['name']}**", inline=False)

        if roll == 1:
            result, xp_loss = remove_xp(user_id, random.randint(30, 50))
            embed.add_field(
                name="ğŸ’€ Desastre!",
                value=f"*'Seus passos tropeÃ§am no destino cruel!'*\n\nâŒ **âˆ’{xp_loss} XP**",
                inline=False
            )
            if result == "reset":
                embed.add_field(name="ğŸŒ‘ Fim da Jornada", value="*'Sua histÃ³ria encontra um fim abrupto...'*\n\n**VocÃª desperta nos Campos Iniciais.**", inline=False)
                embed.color = discord.Color.dark_red()

        elif roll == 2:
            result, xp_loss = remove_xp(user_id, random.randint(15, 30))
            embed.add_field(name="â˜ ï¸ InfortÃºnio", value=f"*'Nem sempre o caminho Ã© gentil...'*\n\nâŒ **âˆ’{xp_loss} XP**", inline=False)
            embed.color = discord.Color.red()

        elif roll in [3, 4]:
            embed.add_field(name="ğŸ˜ Nada de Especial", value="*'VocÃª continua sua jornada sem nada digno de nota.'*", inline=False)
            embed.color = discord.Color.light_grey()

        elif roll == 5:
            res = random.choice(world["resources"])
            player = get_player(user_id)
            player["inventory"].append(res)
            if player.get("class") == "Druida":
                player["hp"] = min(player["hp"] + random.randint(5, 15), player["max_hp"])
            save_player_db(user_id, player)
            embed.add_field(name="ğŸ˜¶ Descoberta Modesta", value=f"*'VocÃª encontra algo que pode ser Ãºtil...'*\n\nğŸ“¦ **{res}**", inline=False)

            # Progresso de quest
            if player.get("active_quest") and player["active_quest"].get("objective") == "collect":
                player["active_quest"]["progress"] = player["active_quest"].get("progress", 0) + 1
                if player["active_quest"]["progress"] >= player["active_quest"].get("count", 1):
                    await complete_quest(message.channel, user_id, player)
                else:
                    save_player_db(user_id, player)

        elif roll in [6, 7]:
            xp = random.randint(20, 40)
            res = random.choice(world["resources"])
            player = get_player(user_id)
            player["inventory"].append(res)
            if player.get("class") == "Druida":
                player["hp"] = min(player["hp"] + random.randint(10, 20), player["max_hp"])
            save_player_db(user_id, player)
            leveled = add_xp(user_id, xp)

            embed.add_field(name="ğŸ™‚ Boa Descoberta!", value=f"*'A sorte estÃ¡ ao seu lado hoje!'*\n\nğŸ“¦ **{res}**\nâ­ **+{xp} XP**", inline=False)
            if leveled:
                player = get_player(user_id)
                embed.add_field(name="ğŸ†™ EvoluÃ§Ã£o!", value=f"*'Um novo capÃ­tulo se abre!'*\n\n**NÃ­vel {player['level']}**", inline=False)
                embed.color = discord.Color.gold()
            else:
                embed.color = discord.Color.green()

            # Progresso de quest explore
            player = get_player(user_id)
            if player.get("active_quest") and player["active_quest"].get("objective") == "explore":
                player["active_quest"]["progress"] = player["active_quest"].get("progress", 0) + 1
                if player["active_quest"]["progress"] >= player["active_quest"].get("count", 1):
                    await complete_quest(message.channel, user_id, player)
                else:
                    save_player_db(user_id, player)

        elif roll == 8:
            xp = random.randint(40, 70)
            resources = random.sample(world["resources"], min(2, len(world["resources"])))
            player = get_player(user_id)
            for r in resources:
                player["inventory"].append(r)
            if player.get("class") == "Druida":
                player["hp"] = min(player["hp"] + random.randint(15, 30), player["max_hp"])

            # Chance de dungeon secreta ao explorar
            secret_found = False
            if "secret_dungeons" in world and random.random() < 0.15:
                secret_dungeon = random.choice(world["secret_dungeons"])
                secret_found = True
                embed.add_field(
                    name="ğŸ”® Dungeon Secreta Encontrada!",
                    value=f"*'Explorando os arredores, vocÃª descobre uma entrada oculta...'*\n\n**{secret_dungeon['name']}**",
                    inline=False
                )

            save_player_db(user_id, player)
            leveled = add_xp(user_id, xp)
            items_text = "\n".join([f"â€¢ **{r}**" for r in resources])
            embed.add_field(name="ğŸ€ Tesouro Escondido!", value=f"*'Seus olhos captam o que outros perderiam!'*\n\n{items_text}\nâ­ **+{xp} XP**", inline=False)
            if leveled:
                player = get_player(user_id)
                embed.add_field(name="ğŸ†™ Level Up!", value=f"**NÃ­vel {player['level']}**", inline=False)
            embed.color = discord.Color.green()

            if secret_found:
                await message.channel.send(embed=embed)
                await asyncio.sleep(1)
                view = DungeonSelectButton(user_id, [secret_dungeon], world)
                await message.channel.send("ğŸ”® **Dungeon Secreta!** Deseja explorar?", view=view)
                return

        elif roll == 9:
            item_type = random.choice(["weapon", "armor"])
            item_list = "weapons" if item_type == "weapon" else "armor"
            rarity = random.choices(["Incomum", "Raro", "Ã‰pico"], weights=[40, 40, 20])[0]
            items_filtered = [i for i in ITEMS[item_list] if i["rarity"] == rarity]
            item = random.choice(items_filtered) if items_filtered else random.choice(ITEMS[item_list])
            xp = random.randint(80, 140)
            leveled = add_xp(user_id, xp)
            rarity_info = RARITIES[item["rarity"]]
            embed.add_field(
                name="âœ¨ Descoberta Rara!",
                value=f"*'Seus olhos brilham ao ver algo extraordinÃ¡rio!'*\n\n{rarity_info['emoji']} **{item['name']}**\nâ­ **+{xp} XP**",
                inline=False
            )
            if leveled:
                player = get_player(user_id)
                embed.add_field(name="ğŸ†™ Level Up!", value=f"**NÃ­vel {player['level']}**", inline=False)
            embed.color = rarity_info["color"]
            # Chance de dungeon secreta no 9 (15%)
            secret_dungeons_avail = world.get("secret_dungeons", [])
            if secret_dungeons_avail and random.random() < 0.15:
                secret_dungeon = random.choice(secret_dungeons_avail)
                await message.channel.send(embed=embed)
                await asyncio.sleep(1)
                player_now = get_player(user_id)
                player_now["inventory"].append(item["name"])
                save_player_db(user_id, player_now)
                view = DungeonSelectButton(user_id, [secret_dungeon], world)
                await message.channel.send(f"ğŸ”® **VocÃª encontrou uma entrada oculta: {secret_dungeon['name']}!** Deseja explorar?", view=view)
                await check_level_boss(message.channel, user_id)
                return
            player_now = get_player(user_id)
            player_now["inventory"].append(item["name"])
            save_player_db(user_id, player_now)
            await message.channel.send(embed=embed)
            await asyncio.sleep(1)
            view = EquipButton(user_id, item["name"], item_type)
            await message.channel.send(f"âœ¨ **{item['name']}** aguarda!\n\n*'Deseja equipar?'*", view=view)
            await check_level_boss(message.channel, user_id)
            return

        else:  # roll == 10
            item_type = random.choice(["weapon", "armor"])
            item_list = "weapons" if item_type == "weapon" else "armor"
            epic_pool = [i for i in ITEMS[item_list] if i["rarity"] in ["Raro", "Ã‰pico", "LendÃ¡rio"]]
            item = random.choice(epic_pool) if epic_pool else random.choice(ITEMS[item_list])
            xp = random.randint(150, 250)
            leveled = add_xp(user_id, xp)
            embed.add_field(
                name="ğŸŒŸ EVENTO LENDÃRIO!",
                value=f"*'OS DEUSES SORRIEM PARA VOCÃŠ!'*\n\n{RARITIES[item['rarity']]['emoji']} **{item['name']}**\nâ­ **+{xp} XP**",
                inline=False
            )
            if leveled:
                player = get_player(user_id)
                embed.add_field(name="ğŸ†™ AscensÃ£o!", value=f"**NÃ­vel {player['level']}**", inline=False)
            embed.color = discord.Color.gold()
            # Chance de dungeon secreta no 10 (30%)
            secret_dungeons_avail = world.get("secret_dungeons", [])
            if secret_dungeons_avail and random.random() < 0.30:
                secret_dungeon = random.choice(secret_dungeons_avail)
                await message.channel.send(embed=embed)
                await asyncio.sleep(1)
                player_now = get_player(user_id)
                player_now["inventory"].append(item["name"])
                save_player_db(user_id, player_now)
                view_eq = EquipButton(user_id, item["name"], item_type)
                await message.channel.send(f"ğŸŒŸ **{item['name']}** pulsa com poder!\n*Deseja equipar?*", view=view_eq)
                await asyncio.sleep(1)
                view_sd = DungeonSelectButton(user_id, [secret_dungeon], world)
                await message.channel.send(f"ğŸ”® **VocÃª encontrou uma entrada oculta: {secret_dungeon['name']}!** Deseja explorar?", view=view_sd)
                await check_level_boss(message.channel, user_id)
                return
            player_now = get_player(user_id)
            player_now["inventory"].append(item["name"])
            save_player_db(user_id, player_now)
            await message.channel.send(embed=embed)
            await asyncio.sleep(1)
            view = EquipButton(user_id, item["name"], item_type)
            await message.channel.send(f"ğŸŒŸ **{item['name']}** pulsa com poder divino!\n\n*'Deseja equipar?'*", view=view)
            await check_level_boss(message.channel, user_id)
            return

        await message.channel.send(embed=embed)
        # Track exploration
        p_explore = get_player(user_id)
        if roll >= 5:  # Count successful explorations
            p_explore["areas_explored"] = p_explore.get("areas_explored", 0) + 1
            save_player_db(user_id, p_explore)
        await check_achievements(message.channel, user_id)
        await check_level_boss(message.channel, user_id)
        return

    # ======================================================
    # ================= CAÃ‡AR ==============================
    # ======================================================
    elif any(word in content for word in ["caÃ§ar", "cacar", "lutar", "atacar", "batalhar"]):
        player = get_player(user_id)
        if player["level"] >= 2 and not player.get("class"):
            await message.channel.send("âš ï¸ Escolha uma classe primeiro! Use: `escolher classe`")
            return

        world = get_world(player["level"], player)
        monster_name = random.choice(list(world["monsters"].keys()))
        monster = world["monsters"][monster_name]
        roll = roll_with_bonus(player)
        luck = get_luck(roll)

        embed = discord.Embed(
            title=f"âš”ï¸ Encontro de Batalha",
            description=f"*'Um **{monster_name}** surge diante de vocÃª!'*",
            color=discord.Color.red()
        )
        embed.add_field(name="ğŸ² Dado da Batalha", value=f"`{roll}` {luck['emoji']} **{luck['name']}**", inline=False)

        if roll <= 3:
            dmg = random.randint(10, 30)
            player = get_player(user_id)
            player["hp"] -= dmg
            if player["hp"] <= 0:
                player["hp"] = player["max_hp"] // 2
            save_player_db(user_id, player)
            result, xp_loss = remove_xp(user_id, random.randint(20, 40))
            embed.add_field(
                name="ğŸ’€ Derrota Dolorosa",
                value=f"*'O {monster_name} te supera!'*\n\nâŒ **âˆ’{xp_loss} XP**\nğŸ’” **âˆ’{dmg} HP**",
                inline=False
            )
            embed.color = discord.Color.dark_red()

        elif roll <= 5:
            xp = random.randint(monster["xp"][0], monster["xp"][0] + 5) * 2
            coins = random.randint(monster["coins"][0], monster["coins"][1]) * 2
            dmg = random.randint(5, 15)
            player = get_player(user_id)
            player["hp"] -= dmg
            save_player_db(user_id, player)
            leveled = add_xp(user_id, xp)
            add_coins(user_id, coins)
            embed.add_field(
                name="ğŸ˜“ VitÃ³ria Suada",
                value=f"*'A batalha foi feroz, mas vocÃª prevalece!'*\n\nâ­ **+{xp} XP**\nğŸ’° **+{coins} CSI**\nğŸ’” **âˆ’{dmg} HP**",
                inline=False
            )
            if leveled:
                player = get_player(user_id)
                embed.add_field(name="ğŸ†™ Crescimento!", value=f"**NÃ­vel {player['level']}**", inline=False)
            embed.color = discord.Color.orange()

        elif roll <= 7:
            xp = random.randint(monster["xp"][0], monster["xp"][1]) * 3
            coins = random.randint(monster["coins"][0], monster["coins"][1]) * 3
            leveled = add_xp(user_id, xp)
            add_coins(user_id, coins)
            # Chance de drop de poÃ§Ã£o (baixa)
            drop_potion = None
            if random.random() < 0.10:
                potion_list = [name for name, data in POTIONS.items() if data["rarity"] in ["Comum", "Incomum"]]
                drop_potion = random.choice(potion_list)
                p2 = get_player(user_id)
                p2["inventory"].append(drop_potion)
                save_player_db(user_id, p2)

            potion_text = f"\nğŸ§ª Drop: **{drop_potion}**" if drop_potion else ""
            embed.add_field(
                name="âš”ï¸ VitÃ³ria!",
                value=f"*'Cada golpe seu Ã© preciso!'*\n\nâ­ **+{xp} XP**\nğŸ’° **+{coins} CSI**{potion_text}",
                inline=False
            )
            if leveled:
                player = get_player(user_id)
                embed.add_field(name="ğŸ†™ Level Up!", value=f"**NÃ­vel {player['level']}**", inline=False)
            embed.color = discord.Color.green()

            # Track monster kill
            p_kill2 = get_player(user_id)
            p_kill2["monsters_killed"] = p_kill2.get("monsters_killed", 0) + 1
            save_player_db(user_id, p_kill2)

            # Progresso de quest de caÃ§a
            player = get_player(user_id)
            if player.get("active_quest") and player["active_quest"].get("objective") == "hunt":
                if player["active_quest"].get("target", "") in monster_name or monster_name in player["active_quest"].get("target", ""):
                    player["active_quest"]["progress"] = player["active_quest"].get("progress", 0) + 1
                    if player["active_quest"]["progress"] >= player["active_quest"].get("count", 1):
                        await message.channel.send(embed=embed)
                        await complete_quest(message.channel, user_id, player)
                        return
                    else:
                        save_player_db(user_id, player)

        else:  # 8-10
            xp = random.randint(monster["xp"][1], monster["xp"][1] + 15) * 4
            coins = random.randint(monster["coins"][1], monster["coins"][1] + 5) * 4
            leveled = add_xp(user_id, xp)
            add_coins(user_id, coins)

            drop_item = None
            drop_item = None
            drop_potion = None

            # CaÃ§ar: dropa armas/armaduras dos monstros (mÃ¡x Ã‰pico â€” MÃ­tico+ APENAS de boss)
            monster_drops_pool = MONSTER_DROPS.get(monster_name, MONSTER_DROPS.get("default", []))
            allowed_rarities = ("Comum", "Incomum", "Raro", "Ã‰pico")
            equip_drops = [d for d in monster_drops_pool if d.get("type") in ("weapon", "armor")
                           and d.get("rarity") in allowed_rarities]
            # Chance de drop de equipamento baseada no dado (roll 8-10 jÃ¡ Ã© alto)
            drop_chance = 0.25 if roll >= 9 else 0.15
            if equip_drops and random.random() < drop_chance:
                drop_def = random.choice(equip_drops)
                rarity = drop_def["rarity"]
                itype = drop_def["type"]
                ilist = "weapons" if itype == "weapon" else "armor"
                items_filtered = [i for i in ITEMS[ilist] if i["rarity"] == rarity]
                if items_filtered:
                    drop_item = random.choice(items_filtered)
                    p2 = get_player(user_id)
                    p2["inventory"].append(drop_item["name"])
                    save_player_db(user_id, p2)

            # 8% chance poÃ§Ã£o Comum/Incomum
            if random.random() < 0.08:
                potion_rarities = ["Comum", "Incomum"]
                drop_potion = random.choice([name for name, data in POTIONS.items() if data["rarity"] in potion_rarities])
                p2 = get_player(user_id)
                p2["inventory"].append(drop_potion)
                save_player_db(user_id, p2)

            drop_text = ""
            if drop_item:
                drop_text += f"\n{RARITIES[drop_item['rarity']]['emoji']} **{drop_item['name']}** ({drop_item['rarity']}) â€” drop do monstro!"
            if drop_potion:
                drop_text += f"\nğŸ§ª **{drop_potion}**!"

            embed.add_field(
                name="âœ¨ DomÃ­nio Total!",
                value=f"*'VitÃ³ria absoluta!'*\n\nâ­ **+{xp} XP**\nğŸ’° **+{coins} CSI**{drop_text}",
                inline=False
            )
            if leveled:
                player = get_player(user_id)
                embed.add_field(name="ğŸ†™ EvoluÃ§Ã£o!", value=f"**NÃ­vel {player['level']}**", inline=False)
            embed.color = discord.Color.gold()

            # Track monster kill
            p_kill = get_player(user_id)
            p_kill["monsters_killed"] = p_kill.get("monsters_killed", 0) + 1
            save_player_db(user_id, p_kill)

            await message.channel.send(embed=embed)

            # Progresso de quest de caÃ§a
            player = get_player(user_id)
            if player.get("active_quest") and player["active_quest"].get("objective") == "hunt":
                if player["active_quest"].get("target", "") in monster_name or monster_name in player["active_quest"].get("target", ""):
                    player["active_quest"]["progress"] = player["active_quest"].get("progress", 0) + 1
                    if player["active_quest"]["progress"] >= player["active_quest"].get("count", 1):
                        await complete_quest(message.channel, user_id, player)
                        return
                    else:
                        save_player_db(user_id, player)

            await check_achievements(message.channel, user_id)
            await check_level_boss(message.channel, user_id)
            return

        await message.channel.send(embed=embed)
        await check_level_boss(message.channel, user_id)
        return

    # ======================================================
    # ================= COLETAR ============================
    # ======================================================
    elif any(word in content for word in ["coletar", "minerar", "colher", "pegar recursos"]):
        player = get_player(user_id)
        if player["level"] >= 2 and not player.get("class"):
            await message.channel.send("âš ï¸ Escolha uma classe primeiro! Use: `escolher classe`")
            return

        world = get_world(player["level"], player)
        roll = roll_with_bonus(player)
        luck = get_luck(roll)

        embed = discord.Embed(
            title=f"â›ï¸ Coleta de Recursos",
            description=f"*'VocÃª procura cuidadosamente por recursos valiosos...'*",
            color=discord.Color.blue()
        )
        embed.add_field(name="ğŸ² Dado da Sorte", value=f"`{roll}` {luck['emoji']} **{luck['name']}**", inline=False)

        if roll <= 3:
            embed.add_field(name="ğŸ˜” Busca InfrutÃ­fera", value="*'Suas mÃ£os voltam vazias...'*", inline=False)
            embed.color = discord.Color.light_grey()

            # Chance de dungeon secreta ao minerar (baixa)
            if "secret_dungeons" in world and random.random() < 0.08:
                secret_dungeon = random.choice(world["secret_dungeons"])
                embed.add_field(
                    name="ğŸ”® Mas vocÃª encontra algo...",
                    value=f"*'Enquanto minerava, vocÃª descobre uma entrada oculta: **{secret_dungeon['name']}**!'*",
                    inline=False
                )
                await message.channel.send(embed=embed)
                await asyncio.sleep(1)
                view = DungeonSelectButton(user_id, [secret_dungeon], world)
                await message.channel.send("ğŸ”® Explorar a dungeon secreta?", view=view)
                return

        elif roll <= 6:
            res = random.choice(world["resources"])
            player = get_player(user_id)
            player["inventory"].append(res)
            if player.get("class") == "Druida":
                player["hp"] = min(player["hp"] + random.randint(10, 20), player["max_hp"])
            save_player_db(user_id, player)
            embed.add_field(name="ğŸ“¦ Recurso Encontrado", value=f"*'VocÃª encontra algo Ãºtil!'*\n\n**{res}**", inline=False)
            embed.color = discord.Color.green()

            # Progresso quest coleta
            player = get_player(user_id)
            if player.get("active_quest") and player["active_quest"].get("objective") == "collect":
                player["active_quest"]["progress"] = player["active_quest"].get("progress", 0) + 1
                if player["active_quest"]["progress"] >= player["active_quest"].get("count", 1):
                    await message.channel.send(embed=embed)
                    await complete_quest(message.channel, user_id, player)
                    return
                else:
                    save_player_db(user_id, player)

        elif roll <= 8:
            resources = [random.choice(world["resources"]) for _ in range(2)]
            player = get_player(user_id)
            for r in resources:
                player["inventory"].append(r)
            if player.get("class") == "Druida":
                player["hp"] = min(player["hp"] + random.randint(15, 30), player["max_hp"])
            save_player_db(user_id, player)
            items_text = "\n".join([f"â€¢ **{r}**" for r in resources])
            embed.add_field(name="ğŸ€ Coleta Proveitosa!", value=f"*'MÃºltiplos recursos encontrados!'*\n\n{items_text}", inline=False)
            embed.color = discord.Color.green()

            # Progresso quest
            player = get_player(user_id)
            if player.get("active_quest") and player["active_quest"].get("objective") == "collect":
                player["active_quest"]["progress"] = player["active_quest"].get("progress", 0) + 2
                if player["active_quest"]["progress"] >= player["active_quest"].get("count", 1):
                    await message.channel.send(embed=embed)
                    await complete_quest(message.channel, user_id, player)
                    return
                else:
                    save_player_db(user_id, player)

        else:  # 9-10
            count = 3 if roll == 9 else 4
            resources = [random.choice(world["resources"]) for _ in range(count)]
            player = get_player(user_id)
            for r in resources:
                player["inventory"].append(r)
            if player.get("class") == "Druida":
                player["hp"] = min(player["hp"] + random.randint(20, 40), player["max_hp"])

            # Dungeon secreta ao minerar (chance maior em 9-10)
            secret_found = False
            if "secret_dungeons" in world and random.random() < 0.2:
                secret_dungeon = random.choice(world["secret_dungeons"])
                secret_found = True
                embed.add_field(
                    name="ğŸ”® Dungeon Secreta Revelada!",
                    value=f"*'Sua ferramenta perfura uma parede falsa e revela: **{secret_dungeon['name']}**!'*",
                    inline=False
                )

            save_player_db(user_id, player)
            items_text = "\n".join([f"â€¢ **{r}**" for r in resources])
            embed.add_field(name="âœ¨ Coleta Abundante!", value=f"*'Uma descoberta magnÃ­fica!'*\n\n{items_text}", inline=False)
            embed.color = discord.Color.gold()

            # Progresso quest
            player = get_player(user_id)
            if player.get("active_quest") and player["active_quest"].get("objective") == "collect":
                player["active_quest"]["progress"] = player["active_quest"].get("progress", 0) + count
                if player["active_quest"]["progress"] >= player["active_quest"].get("count", 1):
                    await message.channel.send(embed=embed)
                    if secret_found:
                        view = DungeonSelectButton(user_id, [secret_dungeon], world)
                        await message.channel.send("ğŸ”® Explorar a dungeon secreta?", view=view)
                    await complete_quest(message.channel, user_id, player)
                    return
                else:
                    save_player_db(user_id, player)

            await message.channel.send(embed=embed)
            if secret_found:
                await asyncio.sleep(1)
                view = DungeonSelectButton(user_id, [secret_dungeon], world)
                await message.channel.send("ğŸ”® Explorar a dungeon secreta?", view=view)
            return

        await message.channel.send(embed=embed)
        return

    # ======================================================
    # ================= DUNGEON ============================
    # ======================================================
    elif any(word in content for word in ["achar dungeon", "procurar dungeon", "buscar dungeon", "dungeon"]):
        player = get_player(user_id)
        if player["level"] >= 2 and not player.get("class"):
            await message.channel.send("âš ï¸ Escolha uma classe primeiro! Use: `escolher classe`")
            return

        world = get_world(player["level"], player)
        if "dungeons" not in world or not world["dungeons"]:
            await message.channel.send("*'NÃ£o hÃ¡ dungeons conhecidas nesta regiÃ£o...'*")
            return

        roll = roll_dice()
        luck = get_luck(roll)

        embed = discord.Embed(
            title="ğŸ—ºï¸ Mapa de Dungeons da RegiÃ£o",
            description="*'VocÃª consulta seu mapa e identifica as masmorras desta regiÃ£o...'*",
            color=discord.Color.purple()
        )
        embed.add_field(name="ğŸ² Dado da ExploraÃ§Ã£o", value=f"`{roll}` {luck['emoji']} **{luck['name']}**", inline=False)

        if roll <= 3:
            embed.add_field(name="âŒ ExploraÃ§Ã£o Fracassada", value="*'VocÃª vaga por horas mas nÃ£o encontra nenhuma entrada...'*", inline=False)
            embed.color = discord.Color.red()
            await message.channel.send(embed=embed)
            return

        # â”€â”€â”€ DUNGEONS COMUNS (sempre visÃ­veis) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        dungeons_comuns = list(world["dungeons"])
        embed.add_field(
            name="ğŸ›ï¸ â”€â”€â”€ DUNGEONS COMUNS â”€â”€â”€",
            value="*'Masmorras conhecidas da regiÃ£o. Explore para encontrar baÃºs com recompensas e chaves!'*",
            inline=False
        )
        for i, dungeon in enumerate(dungeons_comuns, 1):
            embed.add_field(
                name=f"  {i}. {dungeon['name']} (NÃ­vel {dungeon['level']})",
                value=f"  âš”ï¸ Boss: **{dungeon['boss']}**\n  ğŸ BaÃºs podem conter: ouro, equipamentos, materiais raros e **chaves de dungeon secreta**",
                inline=False
            )

        # â”€â”€â”€ DUNGEONS MISTERIOSAS / SECRETAS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        secret_dungeons_all = world.get("secret_dungeons", [])
        embed.add_field(
            name="ğŸ”® â”€â”€â”€ DUNGEON MISTERIOSA (SECRETA) â”€â”€â”€",
            value="*'Masmorras ocultas e perigosas. Requerem uma Chave especÃ­fica para entrar. Inimigos muito mais fortes â€” recompensas de raridade MÃ­tica ou superior!'*",
            inline=False
        )

        if secret_dungeons_all:
            for sd in secret_dungeons_all:
                key_name = sd.get("key_name", "ğŸ—ï¸ Chave Desconhecida")
                has_key = player_has_key(player, key_name)
                key_status = f"âœ… **VocÃª TEM a chave!**" if has_key else f"ğŸ”’ Necessita: **{key_name}**\n  *(Encontre esta chave em baÃºs de dungeons comuns desta regiÃ£o)*"
                drop_rarity = sd.get("special_boss_drop", "MÃ­tico")
                rarity_info = RARITIES.get(drop_rarity, RARITIES["MÃ­tico"])
                embed.add_field(
                    name=f"  ğŸ”® {sd['name']} (NÃ­vel {sd['level']})",
                    value=(
                        f"  ğŸ‘¹ Boss Especial: **{sd['boss']}**\n"
                        f"  {rarity_info['emoji']} Recompensa mÃ¡xima: **{drop_rarity}**\n"
                        f"  {key_status}"
                    ),
                    inline=False
                )
        else:
            embed.add_field(name="  ğŸ”’ Sem dungeons secretas", value="  *'Nenhuma dungeon secreta foi descoberta nesta regiÃ£o.'*", inline=False)

        embed.color = discord.Color.gold()
        embed.set_footer(text="ğŸ’¡ Complete dungeons comuns para obter chaves | Chaves desbloqueiam dungeons secretas com drops MÃ­ticos ou superiores!")
        await message.channel.send(embed=embed)
        await asyncio.sleep(1)

        # Monta lista para seleÃ§Ã£o: comuns primeiro, depois secretas (com verificaÃ§Ã£o de chave)
        dungeons_para_selecao = list(dungeons_comuns)
        if secret_dungeons_all and roll >= 6:
            for sd in secret_dungeons_all:
                key_name = sd.get("key_name", "")
                if player_has_key(player, key_name):
                    dungeons_para_selecao.append(sd)
                elif roll >= 9:  # Alta sorte: mostra secretas mesmo sem chave (mas nÃ£o deixa entrar)
                    dungeons_para_selecao.append(dict(sd, **{"locked": True}))

        view = DungeonSelectButton(user_id, dungeons_para_selecao, world)
        await message.channel.send("*'Qual dungeon deseja explorar?'*", view=view)
        return

    # ======================================================
    # ================= VER PERFIL =========================
    # ======================================================
    elif any(word in content for word in ["ver perfil", "meu perfil", "perfil", "status"]):
        player = get_player(user_id)
        world = get_world(player["level"], player)
        xp_need = calc_xp(player["level"])

        embed = discord.Embed(
            title=f"ğŸ‘¤ {message.author.display_name}",
            description=f"*'O narrador revela sua histÃ³ria atÃ© agora...'*",
            color=discord.Color.blue()
        )
        embed.set_thumbnail(url=message.author.display_avatar.url)
        embed.add_field(name="â­ NÃ­vel", value=f"`{player['level']}`", inline=True)
        embed.add_field(name="âœ¨ XP", value=f"`{player['xp']}/{xp_need}`", inline=True)
        embed.add_field(name="ğŸ’° Moedas CSI", value=f"`{player['coins']}`", inline=True)
        embed.add_field(name="â¤ï¸ HP", value=f"`{player['hp']}/{player['max_hp']}`", inline=True)

        if player.get("class"):
            max_mana = calc_max_mana(player)
            cur_mana = player.get("mana", max_mana)
            embed.add_field(name="ğŸ’™ Mana", value=f"`{cur_mana}/{max_mana}`", inline=True)

        if player.get("class"):
            class_data = CLASSES[player["class"]]
            spec = player.get("specialization")
            class_display = f"{player['class']}"
            if spec:
                spec_emoji = CLASS_SPECIALIZATIONS.get(spec, {}).get("emoji", "â­")
                class_display += f" â€º {spec_emoji} {spec}"
            embed.add_field(name=f"{class_data['emoji']} Classe", value=class_display, inline=True)
        if player.get("race"):
            race_data = RACES.get(player["race"], {})
            race_stage = player.get("race_stage", 0)
            evos = RACE_EVOLUTION_TREE.get(player["race"], [])
            if race_stage > 0 and race_stage <= len(evos):
                evo_data = evos[race_stage - 1]
                race_display = f"{evo_data['name']} *(EstÃ¡gio {race_stage}/3)*"
                race_emoji = evo_data['emoji']
            else:
                race_display = player["race"]
                race_emoji = race_data.get('emoji', 'ğŸ§¬')
                if evos:
                    next_req = evos[0]["level"]
                    if player.get("level", 1) >= next_req:
                        race_display += " âš¡ *(evoluÃ§Ã£o disponÃ­vel!)*"
            embed.add_field(name=f"{race_emoji} RaÃ§a", value=race_display, inline=True)
        if player.get("pet"):
            embed.add_field(name="ğŸ‰ Pet", value=player["pet"], inline=True)
        embed.add_field(name="ğŸŒ LocalizaÃ§Ã£o", value=f"{world['emoji']} **{world['name']}**", inline=False)
        cycle_num, cycle_name, cycle_range = get_world_cycle(player['level'])
        embed.add_field(name="ğŸ”„ Ciclo de Mundo", value=f"**Ciclo {cycle_num}** â€” {cycle_name}\n*{cycle_range}*", inline=False)
        embed.add_field(name="âš”ï¸ Arma", value=player["weapon"] or "*Nenhuma*", inline=True)
        embed.add_field(name="ğŸ›¡ï¸ Armadura", value=player["armor"] or "*Nenhuma*", inline=True)
        embed.add_field(name="ğŸ‘¹ Bosses Derrotados", value=f"`{len(player['bosses'])}`", inline=True)

        active_quest = player.get("active_quest")
        if active_quest:
            progress = active_quest.get("progress", 0)
            total = active_quest.get("count", 1)
            embed.add_field(name="ğŸ“œ Quest Ativa", value=f"{active_quest['name']}\n**Progresso:** {progress}/{total}", inline=False)

        if player.get("guild_id"):
            conn = sqlite3.connect(DB_FILE)
            c = conn.cursor()
            c.execute("SELECT name FROM guilds WHERE id = ?", (player["guild_id"],))
            result = c.fetchone()
            conn.close()
            if result:
                embed.add_field(name="ğŸ° Guilda", value=result[0], inline=True)

        # Biografia personalizada
        bio_text = player.get("bio", "")
        if bio_text:
            embed.add_field(name="ğŸ“– Biografia", value=f"*{bio_text}*", inline=False)

        await message.channel.send(embed=embed)
        return

    # ======================================================
    # ================= INVENTÃRIO =========================
    # ======================================================
    elif any(word in content for word in ["ver inventario", "inventario", "inventÃ¡rio", "mochila", "itens"]):
        player = get_player(user_id)
        embed = discord.Embed(
            title=f"ğŸ’ InventÃ¡rio de {message.author.display_name}",
            description=f"*'O narrador vasculha sua mochila...'*",
            color=discord.Color.gold()
        )

        if not player["inventory"]:
            embed.add_field(name="Vazio", value="*'Suas bolsas estÃ£o vazias...'*", inline=False)
        else:
            items_count = {}
            for item in player["inventory"]:
                items_count[item] = items_count.get(item, 0) + 1

            RARITY_ORDER = ["Primordial", "Divino", "MÃ­tico", "LendÃ¡rio", "Ã‰pico", "Raro", "Incomum", "Comum"]

            def get_item_rarity_name(item_name):
                for w in ITEMS["weapons"]:
                    if w["name"] == item_name:
                        return w.get("rarity", "Comum")
                for a in ITEMS["armor"]:
                    if a["name"] == item_name:
                        return a.get("rarity", "Comum")
                if item_name in POTIONS:
                    return POTIONS[item_name].get("rarity", "Comum")
                return "Comum"

            weapons_in_inv = [i for i in items_count if any(w["name"] == i for w in ITEMS["weapons"])]
            armors_in_inv = [i for i in items_count if any(a["name"] == i for a in ITEMS["armor"])]
            potions_in_inv = [i for i in items_count if i in POTIONS]
            resources_in_inv = [i for i in items_count if i not in potions_in_inv and i not in weapons_in_inv and i not in armors_in_inv]

            def sort_by_rarity(item_list):
                return sorted(item_list, key=lambda i: RARITY_ORDER.index(get_item_rarity_name(i)) if get_item_rarity_name(i) in RARITY_ORDER else 99)

            def format_items_by_rarity(item_list, category_emoji):
                lines = []
                for rarity in RARITY_ORDER:
                    r_items = [i for i in item_list if get_item_rarity_name(i) == rarity]
                    if r_items:
                        r_emoji = RARITIES.get(rarity, {}).get("emoji", "â€¢")
                        for i in r_items:
                            lines.append(f"{r_emoji} **{i}** x{items_count[i]}")
                return lines

            fields_added = 0
            if weapons_in_inv:
                lines = format_items_by_rarity(weapons_in_inv, "âš”ï¸")
                chunk = "\n".join(lines)[:1024]
                embed.add_field(name="âš”ï¸ Armas", value=chunk or "â€”", inline=False)
                fields_added += 1
            if armors_in_inv:
                lines = format_items_by_rarity(armors_in_inv, "ğŸ›¡ï¸")
                chunk = "\n".join(lines)[:1024]
                embed.add_field(name="ğŸ›¡ï¸ Armaduras", value=chunk or "â€”", inline=False)
                fields_added += 1
            if potions_in_inv:
                lines = format_items_by_rarity(potions_in_inv, "ğŸ§ª")
                chunk = "\n".join(lines)[:1024]
                embed.add_field(name="ğŸ§ª PoÃ§Ãµes", value=chunk or "â€”", inline=False)
                fields_added += 1
            if resources_in_inv:
                # Separar chaves de dungeon dos demais recursos
                keys_in_inv = [i for i in resources_in_inv if i.startswith("ğŸ—ï¸")]
                regular_resources = [i for i in resources_in_inv if not i.startswith("ğŸ—ï¸")]
                if keys_in_inv:
                    embed.add_field(
                        name="ğŸ—ï¸ Chaves de Dungeon Secreta",
                        value="\n".join([f"ğŸ—ï¸ **{i}** x{items_count[i]}" for i in keys_in_inv])[:1024],
                        inline=False
                    )
                if regular_resources:
                    embed.add_field(name="ğŸ“¦ Recursos", value="\n".join([f"â€¢ **{i}** x{items_count[i]}" for i in regular_resources])[:1024], inline=False)

            if player.get("weapon") or player.get("armor"):
                equip_txt = []
                if player.get("weapon"):
                    r = get_item_rarity_name(player["weapon"])
                    equip_txt.append(f"{RARITIES.get(r,{}).get('emoji','âš”ï¸')} Arma: **{player['weapon']}**")
                if player.get("armor"):
                    r = get_item_rarity_name(player["armor"])
                    equip_txt.append(f"{RARITIES.get(r,{}).get('emoji','ğŸ›¡ï¸')} Armadura: **{player['armor']}**")
                embed.add_field(name="ğŸ–ï¸ Equipado", value="\n".join(equip_txt), inline=False)

        embed.set_footer(text=f"Total: {len(player['inventory'])} itens | Moedas CSI: {player['coins']:,} | Conquistas: {len(player.get('achievements', []))}/{len(ACHIEVEMENTS)}")
        await message.channel.send(embed=embed)
        return

    # ======================================================
    # ================= VER CHAVES ========================
    # ======================================================
    elif any(word in content for word in ["ver chaves", "minhas chaves", "chaves dungeon", "chaves"]):
        player = get_player(user_id)
        world = get_world(player["level"], player)

        keys_in_inv = [i for i in player.get("inventory", []) if i.startswith("ğŸ—ï¸")]
        keys_count = {}
        for k in keys_in_inv:
            keys_count[k] = keys_count.get(k, 0) + 1

        embed = discord.Embed(
            title=f"ğŸ—ï¸ Chaves de Dungeon de {message.author.display_name}",
            description="*'Chaves desbloqueiam as Dungeons Secretas de cada reino. Encontre-as em baÃºs de dungeons comuns!'*",
            color=discord.Color.dark_gold()
        )

        if not keys_count:
            embed.add_field(name="ğŸ”’ Sem Chaves", value="*'VocÃª nÃ£o possui nenhuma chave de dungeon secreta ainda.'*\n\nğŸ’¡ **Dica:** Explore dungeons comuns (comando `dungeon`) para encontrar chaves em baÃºs!\n\n*A cada 5 dungeons completadas, uma chave cai garantida!*", inline=False)
        else:
            for key, qty in keys_count.items():
                # Encontra qual dungeon esta chave abre
                dungeon_alvo = None
                for w_data in WORLDS.values():
                    for sd in w_data.get("secret_dungeons", []):
                        if sd.get("key_name", "") == key:
                            dungeon_alvo = sd["name"]
                            break
                    if dungeon_alvo:
                        break
                uso_txt = f"**Abre:** {dungeon_alvo}\n`usar chave {dungeon_alvo.split(' ', 1)[-1] if dungeon_alvo else '...'}`" if dungeon_alvo else "âœ… Use: `usar chave [nome da dungeon]`"
                embed.add_field(name=f"{key} x{qty}", value=uso_txt, inline=False)

        # Mostrar quais chaves sÃ£o necessÃ¡rias no reino atual
        secret_dungeons = world.get("secret_dungeons", [])
        if secret_dungeons:
            needed_keys = []
            for sd in secret_dungeons:
                kn = sd.get("key_name", "")
                if kn and kn not in keys_count:
                    needed_keys.append(f"ğŸ”’ **{kn}** â†’ Dungeon: {sd['name']}")
            if needed_keys:
                embed.add_field(
                    name=f"ğŸ”’ Chaves NecessÃ¡rias no {world['name']}",
                    value="\n".join(needed_keys),
                    inline=False
                )

        embed.set_footer(text="Como usar: 'usar chave [nome da dungeon]' | Ex: 'usar chave Gruta Esquecida'")
        await message.channel.send(embed=embed)
        return

    # ======================================================
    # ================= VER MANA ==========================
    # ======================================================
    elif any(word in content for word in ["ver mana", "minha mana", "mana"]):
        player = get_player(user_id)
        max_mana = calc_max_mana(player)
        player["max_mana"] = max_mana
        if player.get("mana", 0) > max_mana:
            player["mana"] = max_mana
        save_player_db(user_id, player)

        cls = player.get("class", "Sem Classe")
        embed = discord.Embed(
            title="âœ¨ Status de Mana",
            description=f"*O narrador examina sua energia arcana...*",
            color=discord.Color.blue()
        )
        mana_bar = "ğŸ”µ" * (player["mana"] // 10) + "âš«" * ((max_mana - player["mana"]) // 10)
        embed.add_field(name="ğŸ’™ Mana Atual", value=f"`{player['mana']}/{max_mana}`\n{mana_bar}", inline=False)
        if cls and cls in CLASSES:
            skills_text = "\n".join([f"{s['name']} â€” {s['mana_cost']} mana | {s['desc']}" for s in get_player_skills(player)[:6]])
            embed.add_field(name=f"âš¡ Habilidades de {cls}", value=skills_text[:1024], inline=False)
        embed.set_footer(text="Mana se recupera ao subir de nÃ­vel e ao descansar!")
        await message.channel.send(embed=embed)
        return

    # ======================================================
    # ================= VER CONQUISTAS ====================
    # ======================================================
    elif any(word in content for word in ["ver conquista", "conquistas", "ver conquistas", "achievements", "minhas conquistas"]):
        player = get_player(user_id)
        earned_ids = player.get("achievements", [])
        earned_set = set(earned_ids)

        # Group by category
        cats = {}
        for ach in ACHIEVEMENTS:
            c = ach["cat"]
            if c not in cats:
                cats[c] = {"earned": [], "locked": []}
            if ach["id"] in earned_set:
                cats[c]["earned"].append(ach)
            else:
                cats[c]["locked"].append(ach)

        total = len(ACHIEVEMENTS)
        earned_count = len(earned_ids)
        pct = int(earned_count / total * 100) if total > 0 else 0
        bar_filled = pct // 10
        prog_bar = "ğŸŸ¨" * bar_filled + "â¬›" * (10 - bar_filled)

        embed = discord.Embed(
            title=f"ğŸ† Conquistas de {message.author.display_name}",
            description=f"*'O narrador registra seus feitos na Grande CrÃ´nica...'*\n\n{prog_bar} `{earned_count}/{total}` ({pct}%)",
            color=discord.Color.gold()
        )

        for cat_name, data in cats.items():
            is_secret = cat_name == "ğŸ”® Secreta"
            earned_list = data["earned"]
            locked_list = data["locked"]
            value_parts = []
            for ach in earned_list[:5]:
                value_parts.append(f"âœ… **{ach['name']}** â€” {ach['desc']} *(+{ach['xp']:,} XP)*")
            if locked_list:
                remaining = len(locked_list)
                if is_secret:
                    value_parts.append(f"ğŸ”’ *{remaining} conquista(s) secreta(s) ainda oculta(s)...*")
                else:
                    # Show next 2 locked
                    for ach in locked_list[:2]:
                        value_parts.append(f"ğŸ”’ ~~{ach['name']}~~ â€” {ach['desc']}")
                    if len(locked_list) > 2:
                        value_parts.append(f"*... e mais {len(locked_list)-2} conquista(s) bloqueada(s)*")
            if value_parts:
                embed.add_field(name=f"{cat_name} ({len(earned_list)}/{len(earned_list)+len(locked_list)})", value="\n".join(value_parts)[:1024], inline=False)

        embed.set_footer(text=f"XP total de conquistas: {sum(a['xp'] for a in ACHIEVEMENTS if a['id'] in earned_set):,} XP")
        await message.channel.send(embed=embed)
        return

    # ======================================================
    # ================= TREINAR ==========================
    # ======================================================
    elif content.startswith("treinar "):
        player = get_player(user_id)
        training_key = content[8:].strip().lower()

        # Detectar multiplicador: "treinar forÃ§a 3x", "treinar forÃ§a 10x", etc.
        multiplier = 1
        for suffix in ["20x", "10x", "5x", "3x", "2x"]:
            if training_key.endswith(f" {suffix}"):
                multiplier = int(suffix[:-1])
                training_key = training_key[: -(len(suffix) + 1)].strip()
                break

        opt = TRAINING_OPTIONS.get(training_key)
        if not opt:
            opts_list = " | ".join([f"`treinar {k}`" for k in TRAINING_OPTIONS])
            await message.channel.send(
                f"âŒ Tipo de treino invÃ¡lido!\n\nOpÃ§Ãµes disponÃ­veis: {opts_list}\n\n"
                f"ğŸ’¡ **Treino mÃºltiplo:** `treinar forÃ§a 3x` | `treinar forÃ§a 10x` | `treinar intensivo 3x`\n"
                f"âš ï¸ O custo **dobra** a cada treino acumulado (200 â†’ 400 â†’ 800 â†’ ...)!"
            )
            return

        # Custo escala exponencialmente com training_points (dobra a cada 10 treinos)
        training_done = player.get("training_points", 0)
        base_cost = opt["cost"]
        # A cada 10 treinos, o custo base dobra (mÃ¡ximo 8x o base)
        tier = min(training_done // 10, 5)  # 0â€“5 tiers
        tier_mult = 2 ** tier  # 1, 2, 4, 8, 16, 32
        cost_per = base_cost * tier_mult
        # Adicional linear dentro do tier (+base*tier*0.1 por treino no tier)
        within_tier = training_done % 10
        cost_per = cost_per + int(base_cost * tier * 0.1 * within_tier)
        total_cost = cost_per * multiplier

        if player["coins"] < total_cost:
            await message.channel.send(
                f"âŒ VocÃª nÃ£o tem CSI suficiente!\n"
                f"Custo: `{total_cost:,}` CSI ({multiplier}Ã— `{cost_per:,}`) | VocÃª tem: `{player['coins']:,}`\n"
                f"âš ï¸ *O custo dobra a cada 10 treinos! Tier atual: {tier+1}/6 (x{tier_mult})*"
            )
            return

        player["coins"] -= total_cost
        boosts = []
        for _ in range(multiplier):
            if opt.get("atk_boost"):
                player["temp_atk_boost"] = player.get("temp_atk_boost", 0) + opt["atk_boost"]
            if opt.get("def_boost"):
                player["temp_def_boost"] = player.get("temp_def_boost", 0) + opt["def_boost"]
            if opt.get("hp_boost"):
                player["temp_hp_boost"] = player.get("temp_hp_boost", 0) + opt["hp_boost"]
                player["max_hp"] = player.get("max_hp", 100) + opt["hp_boost"]
                player["hp"] = min(player["hp"] + opt["hp_boost"], player["max_hp"])

        if opt.get("atk_boost"):
            boosts.append(f"+{opt['atk_boost'] * multiplier} ATK")
        if opt.get("def_boost"):
            boosts.append(f"+{opt['def_boost'] * multiplier} DEF")
        if opt.get("hp_boost"):
            boosts.append(f"+{opt['hp_boost'] * multiplier} HP Max")

        training_count = player.get("training_points", 0) + multiplier
        player["training_points"] = training_count
        save_player_db(user_id, player)

        # Calcular custo do prÃ³ximo treino
        next_tier = min(training_count // 10, 5)
        next_tier_mult = 2 ** next_tier
        next_cost = base_cost * next_tier_mult

        mult_txt = f" Ã—{multiplier}" if multiplier > 1 else ""
        tier_bars = "ğŸŸ¥" * (tier+1) + "â¬›" * (5 - tier)
        embed = discord.Embed(
            title=f"ğŸ’ª Treino{mult_txt} Completo!",
            description=f"*'Seus mÃºsculos queimam, mas vocÃª fica mais forte!'*\n\n{opt['emoji']} **Treino de {training_key.capitalize()}**{mult_txt} realizado!\n\nğŸ“ˆ **Melhorias:** {', '.join(boosts)}\nğŸ’° **Custo:** âˆ’{total_cost:,} CSI",
            color=discord.Color.green()
        )
        embed.add_field(name="ğŸ“Š Stats BÃ´nus Totais", value=f"âš”ï¸ ATK: +{player.get('temp_atk_boost',0)}\nğŸ›¡ï¸ DEF: +{player.get('temp_def_boost',0)}\nâ¤ï¸ HP Max: +{player.get('temp_hp_boost',0)}", inline=True)
        embed.add_field(name="ğŸ’° PrÃ³ximo custo", value=f"`{next_cost:,}` CSI\nTier {next_tier+1}/6 {tier_bars}", inline=True)
        embed.add_field(name="âš ï¸ Escalonamento", value=f"Tier atual: **{tier+1}** (Ã—{tier_mult} do base)\nA cada 10 treinos o custo **dobra**!\nUso: `treinar {training_key} 3x` para 3 de uma vez", inline=False)
        embed.set_footer(text=f"Treinos realizados: {training_count} | Multiplicadores: 2x 3x 5x 10x 20x")
        await message.channel.send(embed=embed)
        if training_count >= 10:
            await check_achievements(message.channel, user_id, "training_10")
        await check_achievements(message.channel, user_id)
        return

    # ======================================================
    # ================= REALIZAR QUEST ====================
    # ======================================================
    elif any(word in content for word in ["realizar quest", "fazer quest", "iniciar quest", "minha quest", "status da quest"]):
        player = get_player(user_id)
        quest = player.get("active_quest")

        if not quest:
            await message.channel.send(
                "ğŸ“‹ **VocÃª nÃ£o tem nenhuma quest ativa!**\n\n*Use `ver quests` para ver as missÃµes disponÃ­veis e `aceitar quest [nome]` para iniciar uma.*"
            )
            return

        objective = quest.get("objective", "")
        progress = quest.get("progress", 0)
        total = quest.get("count", 1)
        pct = int((progress / total) * 100) if total > 0 else 0
        bar_filled = int(pct / 10)
        progress_bar = "ğŸŸ©" * bar_filled + "â¬›" * (10 - bar_filled)

        embed = discord.Embed(
            title=f"ğŸ“œ Realizando: {quest['name']}",
            description=f"*{quest['npc']} aguarda seu progresso...*\n\n*'{quest['lore']}'*",
            color=discord.Color.gold()
        )
        embed.add_field(name="ğŸ¯ Objetivo", value=quest["description"], inline=False)
        embed.add_field(name="ğŸ“Š Progresso", value=f"`{progress}/{total}` â€” {pct}%\n{progress_bar}", inline=False)

        obj_tip = {
            "hunt": f"**Como avanÃ§ar:** Use `caÃ§ar` para derrotar **{quest.get('target', 'monstros')}**!",
            "collect": "**Como avanÃ§ar:** Use `coletar` ou `minerar` para coletar recursos!",
            "explore": "**Como avanÃ§ar:** Use `explorar` para percorrer o mundo!",
            "boss": "**Como avanÃ§ar:** Use `desafiar boss` para enfrentar o boss da missÃ£o!",
        }
        embed.add_field(name="ğŸ’¡ Dica", value=obj_tip.get(objective, "Explore o mundo!"), inline=False)

        # Recompensas
        rewards = f"â­ **{quest['reward_xp']} XP** | ğŸ’° **{quest['reward_coins']} CSI**"
        if quest.get("reward_item"):
            rewards += f" | ğŸ **{quest['reward_item']}**"
        embed.add_field(name="ğŸ† Recompensas ao Completar", value=rewards, inline=False)
        embed.add_field(name="âš”ï¸ Dificuldade", value=quest.get("difficulty", "?"), inline=True)

        if progress >= total:
            embed.add_field(name="âœ… Status", value="**COMPLETO! Use `finalizar quest` para receber as recompensas!**", inline=False)
            embed.color = discord.Color.green()
        else:
            remaining = total - progress
            embed.add_field(name="â³ Faltam", value=f"`{remaining}` aÃ§Ãµes para completar", inline=True)

        await message.channel.send(embed=embed)
        return

    # ======================================================
    # ================= FINALIZAR QUEST ===================
    # ======================================================
    elif any(word in content for word in ["finalizar quest", "entregar quest", "completar quest"]):
        player = get_player(user_id)
        quest = player.get("active_quest")

        if not quest:
            await message.channel.send("âŒ VocÃª nÃ£o tem quest ativa!")
            return

        progress = quest.get("progress", 0)
        total = quest.get("count", 1)

        if progress < total and quest.get("objective") != "boss":
            await message.channel.send(
                f"â³ **Quest ainda nÃ£o concluÃ­da!**\n\nProgresso: `{progress}/{total}`\n\n*Continue realizando as atividades para completar a missÃ£o!*"
            )
            return

        await complete_quest(message.channel, user_id, player)
        return

    # ======================================================
    # ================= ABANDONAR QUEST ===================
    # ======================================================
    elif any(word in content for word in ["abandonar quest", "desistir da quest", "cancelar quest"]):
        player = get_player(user_id)
        if not player.get("active_quest"):
            await message.channel.send("âŒ VocÃª nÃ£o tem quest ativa!")
            return

        quest_name = player["active_quest"]["name"]
        player["active_quest"] = None
        save_player_db(user_id, player)

        embed = discord.Embed(
            title="ğŸš« Quest Abandonada",
            description=f"*'VocÃª abandona **{quest_name}**...'*\n\n*O narrador suspira com decepÃ§Ã£o.*",
            color=discord.Color.red()
        )
        embed.set_footer(text="Use 'ver quests' para encontrar novas missÃµes.")
        await message.channel.send(embed=embed)
        return

    # ======================================================
    # ================= PROCURAR CIDADES / VILAREJOS =======
    # ======================================================
    elif any(word in content for word in ["procurar cidade", "procurar vilarejo", "buscar cidade",
                                           "explorar cidade", "visitar cidade", "visitar vilarejo",
                                           "ver cidades", "cidades prÃ³ximas", "mapa de cidades"]):
        player = get_player(user_id)
        world_key = max([k for k in CITY_NPCS.keys() if k in player["worlds"]], default=1)
        city_data = CITY_NPCS[world_key]
        world = get_world(player["level"], player)

        embed = discord.Embed(
            title=f"ğŸ—ºï¸ Explorando Cidades â€” {world['emoji']} {world['name']}",
            description=f"*O narrador revela os assentamentos desta regiÃ£o...*",
            color=discord.Color.blue()
        )

        # Mostra a cidade do mundo atual
        embed.add_field(
            name=f"ğŸ“ {city_data['city_name']}",
            value=f"**Habitantes notÃ¡veis:**\n" + "\n".join([f"{npc['emoji']} **{npc['name']}** â€” {npc['role']}" for npc in city_data["npcs"]]),
            inline=False
        )

        # Mostra outras cidades desbloqueadas
        other_cities = []
        for wk in sorted(player["worlds"]):
            if wk != world_key and wk in CITY_NPCS:
                cd = CITY_NPCS[wk]
                wn = WORLDS[wk]["name"]
                other_cities.append(f"{WORLDS[wk]['emoji']} **{cd['city_name']}** ({wn})")

        if other_cities:
            embed.add_field(name="ğŸŒ Outras Cidades Conhecidas", value="\n".join(other_cities[:5]), inline=False)

        embed.add_field(
            name="ğŸ’¡ Comandos",
            value="`visitar cidade` â€” visita a cidade e conversa com NPCs\n`ver quests` â€” veja missÃµes disponÃ­veis",
            inline=False
        )
        await message.channel.send(embed=embed)

        # Visita automaticamente a cidade atual
        await asyncio.sleep(1)
        npc = random.choice(city_data["npcs"])
        dialogue = random.choice(npc["dialogues"])
        coins_found = random.randint(1, 3)
        add_coins(user_id, coins_found)

        visit_embed = discord.Embed(
            title=f"{npc['emoji']} {npc['name']} â€” {npc['role']}",
            description=f"*VocÃª se aproxima do NPC na cidade...*\n\n*'{dialogue}'*",
            color=discord.Color.green()
        )
        visit_embed.add_field(name="ğŸ’° Recompensa pela Visita", value=f"+{coins_found} CSI", inline=True)

        # 25% chance de livro de lore ao visitar
        if random.random() < 0.25:
            all_books = list(LORE_BOOKS.get(world_key, [])) + list(LORE_BOOKS_EXTRA.get(world_key, []))
            if all_books:
                book = random.choice(all_books)
                visit_embed.add_field(name=f"ğŸ“š {book['title']}", value=book["content"][:512] + "...", inline=False)

        await message.channel.send(embed=visit_embed)
        return

    # ======================================================
    # ================= DESAFIAR @USER (PvP PokÃ©mon) ======
    # ======================================================
    elif "desafiar" in content and "@" in message.content and "boss" not in content:
        mentions = message.mentions
        if not mentions:
            await message.channel.send("âŒ Mencione um jogador! Ex: `desafiar @jogador`")
            return

        target_user = mentions[0]
        if target_user.id == user_id:
            await message.channel.send("âŒ VocÃª nÃ£o pode se desafiar!")
            return
        if target_user.bot:
            await message.channel.send("âŒ VocÃª nÃ£o pode desafiar um bot!")
            return

        challenger = get_player(user_id)
        target = get_player(target_user.id)

        if not challenger.get("class"):
            await message.channel.send("âŒ Escolha uma classe primeiro! Use: `escolher classe`")
            return
        if not target.get("class"):
            await message.channel.send(f"âŒ **{target_user.display_name}** ainda nÃ£o escolheu uma classe!")
            return

        # Envia desafio
        view = PvPChallengeButton(user_id, target_user.id, message.author.display_name, target_user.display_name)
        embed = discord.Embed(
            title="âš”ï¸ DESAFIO DE BATALHA!",
            description=f"*O narrador anuncia com emoÃ§Ã£o:*\n\nğŸ¥Š **{message.author.display_name}** desafia **{target_user.display_name}** para um duelo!",
            color=discord.Color.red()
        )
        cls_ch = CLASSES[challenger["class"]]
        cls_tg = CLASSES[target["class"]]
        embed.add_field(name=f"{cls_ch['emoji']} {message.author.display_name}", value=f"**{challenger['class']}** | NÃ­vel {challenger['level']} | HP: {challenger['max_hp']} | Mana: {calc_max_mana(challenger)}", inline=True)
        embed.add_field(name=f"{cls_tg['emoji']} {target_user.display_name}", value=f"**{target['class']}** | NÃ­vel {target['level']} | HP: {target['max_hp']} | Mana: {calc_max_mana(target)}", inline=True)
        embed.set_footer(text=f"{target_user.mention}, vocÃª aceita o desafio?")
        await message.channel.send(content=f"{target_user.mention}", embed=embed, view=view)
        return

    # ======================================================
    # ================= VER QUESTS ========================
    # ======================================================
    elif any(word in content for word in ["ver quests", "quests", "missÃµes", "missoes", "aceitar quest"]):
        player = get_player(user_id)
        world_key = max([k for k in QUESTS.keys() if k in player["worlds"]], default=1)
        available_quests = list(QUESTS.get(world_key, []))
        # Adicionar quests extras do mundo
        available_quests += QUESTS_EXTRA.get(world_key, [])
        # Adicionar quests de alinhamento
        align = get_alignment(player)
        for key, qlist in ALIGNMENT_QUESTS.items():
            for q in qlist:
                req = q.get("align_required")
                if req is None or req == align:
                    available_quests.append(q)

        embed = discord.Embed(
            title="ğŸ“‹ Quadro de MissÃµes",
            description=f"*{WORLDS[world_key]['emoji']} MissÃµes disponÃ­veis em **{WORLDS[world_key]['name']}**...*",
            color=discord.Color.gold()
        )
        info = ALIGNMENT_TITLES[align]
        embed.add_field(name=f"{info['emoji']} Alinhamento", value=f"**{align}** â€” MisÃµes exclusivas desbloqueadas!", inline=True)

        if player.get("active_quest"):
            embed.add_field(
                name="âš ï¸ Quest Ativa",
                value=f"VocÃª estÃ¡ em: **{player['active_quest']['name']}**\nProgresso: {player['active_quest'].get('progress', 0)}/{player['active_quest'].get('count', 1)}\n\nUse `realizar quest` para ver detalhes.",
                inline=False
            )

        completed = player.get("completed_quests", [])
        for quest in available_quests[:12]:
            status = "âœ…" if quest["id"] in completed else ("ğŸ”„" if player.get("active_quest") and player["active_quest"].get("id") == quest["id"] else "ğŸ“Œ")
            q_type = "ğŸ‘¥ Equipe" if quest.get("type") == "team" else "ğŸ‘¤ Solo"
            xp_str = f"{quest['reward_xp']:,}"
            embed.add_field(
                name=f"{status} {quest['name']} [{q_type}]",
                value=f"**Dif:** {quest['difficulty']} | **XP:** {xp_str} | **Coins:** {quest['reward_coins']}\n{quest['description'][:80]}...",
                inline=False
            )

        embed.set_footer(text="Use 'aceitar quest [nome]' para iniciar uma missÃ£o! | 'missÃ£o moral' para quests de alinhamento")
        await message.channel.send(embed=embed)

        # Se o comando for "aceitar quest X"
        if "aceitar quest" in content:
            quest_name_search = content.replace("aceitar quest", "").strip()
            found_quest = None
            for quest in available_quests:
                if quest_name_search in quest["name"].lower() or quest_name_search in quest["id"]:
                    found_quest = quest
                    break

            if found_quest:
                view = QuestAcceptButton(user_id, found_quest)
                q_embed = discord.Embed(
                    title=f"ğŸ“œ {found_quest['name']}",
                    description=f"*{found_quest['npc']} se aproxima:*\n\n*'{found_quest['lore']}'*",
                    color=discord.Color.gold()
                )
                q_embed.add_field(name="ğŸ¯ MissÃ£o", value=found_quest["description"], inline=False)
                q_embed.add_field(name="â­ XP", value=f"{found_quest['reward_xp']:,}", inline=True)
                q_embed.add_field(name="ğŸ’° Coins", value=str(found_quest["reward_coins"]), inline=True)
                q_embed.add_field(name="âš”ï¸ Dificuldade", value=found_quest["difficulty"], inline=True)
                await message.channel.send(embed=q_embed, view=view)
        return

    await bot.process_commands(message)
# ================= FUNÃ‡Ã•ES AUXILIARES =================
# ======================================================

async def check_level_boss(channel, user_id):
    """Verifica e anuncia boss de level se necessÃ¡rio"""
    player = get_player(user_id)
    boss_levels = [9, 19, 29, 39, 49, 59]

    if player["level"] in boss_levels:
        boss_data = get_level_boss(player["level"])
        if boss_data and boss_data["name"] not in player["bosses"]:
            # *** CORREÃ‡ÃƒO: Salva o boss correto como pending_boss ***
            effects = player.get("active_effects", {})
            effects["pending_boss"] = boss_data
            player["active_effects"] = effects
            save_player_db(user_id, player)

            await asyncio.sleep(2)
            embed = discord.Embed(
                title=f"ğŸš¨ BOSS DE NÃVEL {boss_data.get('level', '?')} â€” PASSAGEM BLOQUEADA!",
                description=f"*'Um poder colossal bloqueia seu caminho...'*\n\nğŸ‘¹ **{boss_data['name']}** surge para impedir seu avanÃ§o!\n\nâš ï¸ **Seu XP estÃ¡ BLOQUEADO atÃ© vocÃª derrotÃ¡-lo!**\n*'NÃ£o hÃ¡ glÃ³ria sem superar os grandes obstÃ¡culos!'*",
                color=discord.Color.dark_red()
            )
            embed.add_field(name="â¤ï¸ HP", value=f"`{boss_data['hp']:,}`", inline=True)
            embed.add_field(name="âš”ï¸ ATK", value=f"`{boss_data['atk']}`", inline=True)
            embed.add_field(name="ğŸš« XP Bloqueado", value="VocÃª nÃ£o ganharÃ¡ mais XP atÃ© derrotÃ¡-lo!", inline=False)
            embed.add_field(name="ğŸ’¡ OpÃ§Ãµes", value="â€¢ `desafiar boss` â€” Enfrente o boss agora\nâ€¢ `treinar forÃ§a/defesa/vitalidade` â€” FortaleÃ§a-se antes\nâ€¢ `chamar aliados` â€” PeÃ§a ajuda!", inline=False)
            view = BossButton(user_id, boss_data["name"])
            await channel.send(embed=embed, view=view)


async def complete_quest(channel, user_id, player):
    """Completa uma quest e distribui recompensas"""
    quest = player["active_quest"]
    if not quest:
        return

    reward_xp = quest["reward_xp"]
    reward_coins = quest["reward_coins"]
    reward_item = quest.get("reward_item")

    completed = player.get("completed_quests", [])
    completed.append(quest["id"])
    player["completed_quests"] = completed
    player["active_quest"] = None

    save_player_db(user_id, player)
    add_xp(user_id, reward_xp)
    add_coins(user_id, reward_coins)

    if reward_item:
        player2 = get_player(user_id)
        player2["inventory"].append(reward_item)
        save_player_db(user_id, player2)

    embed = discord.Embed(
        title=f"ğŸ‰ QUEST COMPLETA!",
        description=f"**{quest['name']}** foi concluÃ­da!\n\n*'{quest['npc']} sorri e diz: ExtraordinÃ¡rio! VocÃª superou minhas expectativas!'*",
        color=discord.Color.gold()
    )
    embed.add_field(name="â­ XP Ganho", value=str(reward_xp), inline=True)
    embed.add_field(name="ğŸ’° Coins Ganhos", value=str(reward_coins), inline=True)
    if reward_item:
        embed.add_field(name="ğŸ Item Recebido", value=reward_item, inline=True)

    await channel.send(embed=embed)

    await channel.send(embed=embed)


# ================= HELPERS: ALINHAMENTO, MAPA, FAZENDA =================

def get_alignment(player):
    pts = player.get("alignment_points", 0)
    if pts >= 30:
        return "Heroi"
    elif pts <= -30:
        return "Vilao"
    elif -29 <= pts <= -5:
        return "Anti-Heroi"
    else:
        return "Neutro"

def get_alignment_info(player):
    align = get_alignment(player)
    return ALIGNMENT_TITLES[align]

def apply_alignment_points(user_id, points):
    player = get_player(user_id)
    cur = player.get("alignment_points", 0)
    player["alignment_points"] = max(-100, min(100, cur + points))
    save_player_db(user_id, player)
    return player

def get_player_map(player):
    """Retorna o mapa descoberto pelo jogador"""
    disc = player.get("discovered_map", {})
    result = {}
    for world_id, world_data in MAP_LOCATIONS.items():
        if world_id not in player.get("worlds", [1]):
            continue
        result[world_id] = {
            "world_name": world_data["world_name"],
            "locations": []
        }
        for loc in world_data["locations"]:
            # cidade principal sempre visÃ­vel
            disc_locs = disc.get(str(world_id), [])
            visible = loc["discovered"] or loc["id"] in disc_locs
            result[world_id]["locations"].append({**loc, "visible": visible})
    return result

def discover_location(user_id, world_id, loc_id):
    player = get_player(user_id)
    disc = player.get("discovered_map", {})
    key = str(world_id)
    if key not in disc:
        disc[key] = []
    if loc_id not in disc[key]:
        disc[key].append(loc_id)
    player["discovered_map"] = disc
    save_player_db(user_id, player)

# â”€â”€ ConfiguraÃ§Ã£o das pÃ¡ginas do mapa â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
MAP_PAGES = {
    1: {"title": "ğŸ—ºï¸ Mapa â€” Ciclo 1: Terras Iniciais",         "range": (1,   100), "color": 0x3498DB,
        "desc": "Reinos 1â€“10 â€¢ Terras Iniciais (nÃ­vel 1â€“100). Use `mapa 2` para as NaÃ§Ãµes IntermediÃ¡rias."},
    2: {"title": "ğŸ—ºï¸ Mapa â€” Ciclo 2: NaÃ§Ãµes IntermediÃ¡rias",   "range": (101, 200), "color": 0x2980B9,
        "desc": "Reinos 11â€“20 â€¢ NaÃ§Ãµes IntermediÃ¡rias (nÃ­vel 101â€“200). Use `mapa 3` para os ImpÃ©rios."},
    3: {"title": "ğŸ—ºï¸ Mapa â€” Ciclo 3: ImpÃ©rios AvanÃ§ados",      "range": (201, 300), "color": 0x8E44AD,
        "desc": "Reinos 21â€“30 â€¢ ImpÃ©rios AvanÃ§ados (nÃ­vel 201â€“300). Use `mapa 4` para as Terras Corrompidas."},
    4: {"title": "ğŸ—ºï¸ Mapa â€” Ciclo 4: Terras Corrompidas",      "range": (301, 400), "color": 0x6C3483,
        "desc": "Reinos 31â€“35 (Terras Corrompidas) + Reinos 36â€“40 (Reinos Dimensionais). Use `mapa 5` para as DimensÃµes."},
    5: {"title": "ğŸŒŒ Mapa â€” Ciclo 5: DimensÃµes (NÃ­vel 400+)",  "range": (401, 500), "color": 0xF39C12,
        "desc": "DimensÃµes: Celestial â€¢ Infernal â€¢ Badlands â€¢ Abissal â€¢ Vazio (nÃ­vel 401â€“500). Use `mapa 6` para o Absoluto."},
    6: {"title": "â™¾ï¸ Mapa â€” Ciclo 6: Planos Absolutos",        "range": (501, 600), "color": 0xE74C3C,
        "desc": "Ciclo Absoluto (nÃ­vel 501â€“600). O fim e o comeÃ§o de tudo. Level mÃ¡ximo: 600."},
}

MAP_TYPE_ICONS = {
    "cidade": "ğŸ™ï¸", "recurso": "â›ï¸", "dungeon": "ğŸ•³ï¸", "dungeon_secreta": "ğŸ”®",
    "boss_local": "ğŸ’€", "lore": "ğŸ“œ", "loja": "ğŸª", "crafting": "âš’ï¸",
    "portal": "ğŸŒ€", "evento_especial": "â­", "npc_especial": "ğŸ§™"
}

MAP_PAGE_NAVS = {
    1: "`mapa 2` â†’ Ciclo 2: NaÃ§Ãµes IntermediÃ¡rias",
    2: "`mapa` â† | `mapa 3` â†’ Ciclo 3: ImpÃ©rios",
    3: "`mapa 2` â† | `mapa 4` â†’ Ciclo 4: Terras Corrompidas",
    4: "`mapa 3` â† | `mapa 5` â†’ Ciclo 5: DimensÃµes",
    5: "`mapa 4` â† | `mapa 6` â†’ Ciclo 6: Absoluto",
    6: "`mapa 5` â† Ciclo 5: DimensÃµes",
}

MAP_CYCLE_LOCK_MSG = {
    2: "ğŸ”’ Ciclo 2 bloqueado â€” derrote o boss de nÃ­vel 99 para acessar as NaÃ§Ãµes IntermediÃ¡rias.",
    3: "ğŸ”’ Ciclo 3 bloqueado â€” derrote o boss de nÃ­vel 199 para acessar os ImpÃ©rios AvanÃ§ados.",
    4: "ğŸ”’ Ciclo 4 bloqueado â€” derrote o boss de nÃ­vel 299 para acessar as Terras Corrompidas.",
    5: "ğŸ”’ Ciclo 5 bloqueado â€” derrote o Boss Dimensional do nÃ­vel 399 para acessar as DimensÃµes (nÃ­vel 400+).",
    6: "ğŸ”’ Ciclo 6 bloqueado â€” derrote o Boss da DimensÃ£o do Vazio (nÃ­vel 499) para acessar os Planos Absolutos.",
}

async def show_map_page(message, player, page: int):
    """Exibe o mapa com botÃµes de navegaÃ§Ã£o < > por capÃ­tulo."""
    player["user_id"] = str(message.author.id)
    embed, view = build_map_embed(player, page)
    if embed is None:
        await message.channel.send("âŒ CapÃ­tulo de mapa invÃ¡lido!")
        return
    await message.channel.send(embed=embed, view=view)


async def _show_map_page_old_unused(message, player, page: int):
    """[DEPRECATED] VersÃ£o antiga sem botÃµes â€” mantida por referÃªncia."""
    page_data = MAP_PAGES.get(page)
    if not page_data:
        await message.channel.send("âŒ PÃ¡gina de mapa invÃ¡lida!")
        return

    player_map = get_player_map(player)
    current_world = max(player.get("worlds", [1]))
    rng_min, rng_max = page_data["range"]

    embed = discord.Embed(
        title=page_data["title"],
        description=page_data["desc"],
        color=page_data["color"]
    )

    worlds_shown = 0
    any_unlocked = False

    for world_id in sorted(MAP_LOCATIONS.keys()):
        if not (rng_min <= world_id <= rng_max):
            continue

        # Mundo desbloqueado?
        if world_id not in player.get("worlds", [1]):
            # Mostra como bloqueado mas sÃ³ se for prÃ³ximo do atual
            if world_id <= current_world + 20:
                embed.add_field(
                    name=f"ğŸ”’ {MAP_LOCATIONS[world_id]['world_name']} (bloqueado)",
                    value="*Derrote o boss do reino anterior para desbloquear.*",
                    inline=False
                )
            continue

        any_unlocked = True
        wdata = player_map.get(world_id)
        if not wdata:
            continue

        locs_text = ""
        for loc in wdata["locations"]:
            if loc.get("visible"):
                icon = MAP_TYPE_ICONS.get(loc["type"], "ğŸ“")
                marker = " ğŸ“Œ" if world_id == current_world else ""
                locs_text += f"{icon} {loc['name']}{marker}\n"
            else:
                locs_text += "â“ *Local Desconhecido*\n"

        if locs_text:
            current_marker = " â† **AQUI**" if world_id == current_world else ""
            embed.add_field(
                name=f"{wdata['world_name']}{current_marker}",
                value=locs_text.strip() or "_Nenhum local descoberto_",
                inline=False
            )
            worlds_shown += 1

        # Discord embed limit: max 25 fields
        if worlds_shown >= 20:
            embed.add_field(name="...", value="*Use a prÃ³xima pÃ¡gina para ver mais reinos.*", inline=False)
            break

    if not any_unlocked:
        lock_msg = MAP_CYCLE_LOCK_MSG.get(page, "ğŸ”’ Esta seÃ§Ã£o ainda estÃ¡ bloqueada.")
        embed.add_field(name="ğŸ”’ SeÃ§Ã£o Bloqueada", value=lock_msg, inline=False)

    nav = MAP_PAGE_NAVS.get(page, "")
    embed.set_footer(text=f"PÃ¡gina {page}/6 | {nav} | Use `viajar <local>` para se locomover | Seus mundos: {len(player.get('worlds', [1]))}/61")
    await message.channel.send(embed=embed)


def get_dungeon_difficulty_multiplier(player):
    """Dungeons secretas ficam mais difÃ­ceis conforme o nÃ­vel"""
    level = player.get("level", 1)
    return 1.0 + (level * 0.05)  # +5% por nÃ­vel


# ================= VIEW: ESCOLHER PET DA FAZENDA =================
# ================= VIEW: EMPREGOS =================
class JobSelectView(discord.ui.View):
    def __init__(self, user_id, available_jobs):
        super().__init__(timeout=90)
        self.user_id = user_id
        for job_name in available_jobs[:5]:
            jdata = JOBS[job_name]
            btn = discord.ui.Button(
                label=f"{jdata['emoji']} {job_name}",
                style=discord.ButtonStyle.primary
            )
            btn.callback = self._make_cb(job_name)
            self.add_item(btn)
        cancel = discord.ui.Button(label="âŒ Cancelar", style=discord.ButtonStyle.secondary)
        cancel.callback = self._cancel
        self.add_item(cancel)

    def _make_cb(self, job_name):
        async def callback(interaction: discord.Interaction):
            if str(interaction.user.id) != str(self.user_id):
                return await interaction.response.send_message("âŒ NÃ£o Ã© sua escolha!", ephemeral=True)
            player = get_player(self.user_id)
            jdata = JOBS[job_name]
            old_job = player.get("job")
            player["job"] = job_name
            player["job_since"] = int(__import__("time").time())
            # Aplicar bÃ´nus permanente de HP
            if job_name == "Cavaleiro":
                player["max_hp"] += 20
                player["hp"] = min(player["hp"] + 20, player["max_hp"])
            elif job_name == "Guarda_Real":
                player["max_hp"] += 35
                player["hp"] = min(player["hp"] + 35, player["max_hp"])
            elif job_name == "Arcano":
                player["max_mana"] = player.get("max_mana", 50) + 15
            save_player_db(self.user_id, player)
            embed = discord.Embed(
                title=f"{jdata['emoji']} Emprego Aceito: **{job_name}**!",
                description=f"*{jdata['work_action']}*\n\n{jdata['description']}",
                color=discord.Color.green()
            )
            perks_text = "\n".join([f"â€¢ {p}" for p in jdata["perks"]])
            embed.add_field(name="âœ¨ BenefÃ­cios", value=perks_text, inline=False)
            embed.add_field(name="ğŸ’° SalÃ¡rio", value=f"`{jdata['salary_coins'][0]}â€“{jdata['salary_coins'][1]}` coins por turno de trabalho", inline=True)
            embed.add_field(name="â­ XP por trabalho", value=f"`{jdata['salary_xp'][0]}â€“{jdata['salary_xp'][1]}`", inline=True)
            if old_job:
                embed.add_field(name="âš ï¸ Emprego anterior", value=f"VocÃª largou **{old_job}**.", inline=False)
            embed.set_footer(text="Use `trabalhar` para ganhar salÃ¡rio! | `ver emprego` para detalhes")
            for item in self.children:
                item.disabled = True
            await interaction.response.edit_message(embed=embed, view=self)
        return callback

    async def _cancel(self, interaction: discord.Interaction):
        if str(interaction.user.id) != str(self.user_id):
            return await interaction.response.send_message("âŒ NÃ£o Ã© sua!", ephemeral=True)
        await interaction.response.edit_message(content="âŒ Escolha de emprego cancelada.", embed=None, view=None)


# ================= VIEW: DEFESA DE CIDADE =================
class CityDefenseView(discord.ui.View):
    def __init__(self, user_id, invasion, channel, guild):
        super().__init__(timeout=120)
        self.user_id = user_id
        self.invasion = invasion
        self.channel = channel
        self.guild = guild
        self.helpers = []

        for i, opt in enumerate(invasion.get("dialogue_options", [])):
            btn = discord.ui.Button(
                label=opt["text"][:80],
                style=discord.ButtonStyle.blurple if "negoci" in opt["text"].lower() or "diÃ¡logo" in opt["text"].lower()
                      else discord.ButtonStyle.danger,
                row=i // 2
            )
            btn.callback = self._make_cb(i)
            self.add_item(btn)

        call_btn = discord.ui.Button(label="ğŸ“¯ Convocar Aliados", style=discord.ButtonStyle.success, row=2)
        call_btn.callback = self._call_allies
        self.add_item(call_btn)

    def _make_cb(self, idx):
        async def callback(interaction: discord.Interaction):
            if str(interaction.user.id) != str(self.user_id) and str(interaction.user.id) not in self.helpers:
                return await interaction.response.send_message("âŒ VocÃª nÃ£o estÃ¡ na defesa!", ephemeral=True)
            opt = self.invasion["dialogue_options"][idx]
            import random
            success = random.random() < opt["success_chance"]
            apply_alignment_points(str(interaction.user.id), opt.get("align", 0))
            for h in self.helpers:
                apply_alignment_points(h, opt.get("align", 0) // 2)
            if success:
                xp = self.invasion["xp_reward"]
                coins = self.invasion["coins_reward"]
                add_xp(str(interaction.user.id), xp)
                add_coins(str(interaction.user.id), coins)
                for h in self.helpers:
                    add_xp(h, xp // 2)
                    add_coins(h, coins // 2)
                embed = discord.Embed(
                    title=f"ğŸ† INVASÃƒO REPELIDA! â€” {self.invasion['title']}",
                    description=f"*Sua estratÃ©gia funcionou! {self.invasion['enemy']}s recuam!*\n\n"
                                f"ğŸ—¡ï¸ OpÃ§Ã£o: **{opt['text'][:60]}**",
                    color=discord.Color.green()
                )
                embed.add_field(name="â­ XP", value=f"`+{xp}`", inline=True)
                embed.add_field(name="ğŸ’° Coins", value=f"`+{coins}`", inline=True)
                if self.helpers:
                    embed.add_field(name="ğŸ‘¥ Aliados (XP/2)", value=f"{len(self.helpers)} jogadores ajudaram!", inline=True)
                embed.add_field(name="ğŸ“£ Povo", value="_As pessoas gritam vivas nas ruas!_", inline=False)
            else:
                xp_loss = self.invasion["xp_reward"] // 4
                remove_xp(str(interaction.user.id), xp_loss)
                embed = discord.Embed(
                    title=f"ğŸ’€ INVASÃƒO AVANÃ‡A! â€” {self.invasion['title']}",
                    description=f"*Sua estratÃ©gia falhou! Os inimigos avanÃ§am mais!*\n\n"
                                f"âŒ OpÃ§Ã£o: **{opt['text'][:60]}**",
                    color=discord.Color.red()
                )
                embed.add_field(name="âŒ XP Perdido", value=f"`-{xp_loss}`", inline=True)
                embed.add_field(name="ğŸ’¡ Dica", value="Tente outra abordagem ou `lutar` diretamente!", inline=False)
            for item in self.children:
                item.disabled = True
            await interaction.response.edit_message(embed=embed, view=self)
        return callback

    async def _call_allies(self, interaction: discord.Interaction):
        if str(interaction.user.id) != str(self.user_id):
            return await interaction.response.send_message("âŒ SÃ³ o defensor pode convocar!", ephemeral=True)
        embed = discord.Embed(
            title=f"ğŸ“¯ CONVOCAÃ‡ÃƒO DE DEFESA!",
            description=f"**{interaction.user.display_name}** convoca aliados para defender contra:\n"
                        f"**{self.invasion['title']}**\n\n"
                        f"*Responda `ajudar defesa` para participar!*\n"
                        f"ğŸ‘¥ MÃ­nimo necessÃ¡rio: **{self.invasion['min_defenders']}** defensores",
            color=discord.Color.orange()
        )
        await self.channel.send(embed=embed)
        await interaction.response.send_message("ğŸ“¯ ConvocaÃ§Ã£o enviada ao canal!", ephemeral=True)


class CityDefenseJoinView(discord.ui.View):
    """View para aliados entrarem na defesa ativa"""
    def __init__(self, defense_view: CityDefenseView):
        super().__init__(timeout=60)
        self.dview = defense_view

    @discord.ui.button(label="âš”ï¸ Entrar na Defesa!", style=discord.ButtonStyle.danger)
    async def join(self, interaction: discord.Interaction, button: discord.ui.Button):
        uid = str(interaction.user.id)
        if uid == self.dview.user_id:
            return await interaction.response.send_message("VocÃª jÃ¡ Ã© o defensor principal!", ephemeral=True)
        if uid in self.dview.helpers:
            return await interaction.response.send_message("VocÃª jÃ¡ estÃ¡ na defesa!", ephemeral=True)
        player = get_player(uid)
        if not player:
            return await interaction.response.send_message("âŒ Crie seu personagem primeiro!", ephemeral=True)
        self.dview.helpers.append(uid)
        await interaction.response.send_message(
            f"âš”ï¸ **{interaction.user.display_name}** entra na defesa! ({len(self.dview.helpers)+1} defensores total)",
            ephemeral=False
        )


class NomearCavaleiroView(discord.ui.View):
    """View para Rei nomear cavaleiros"""
    def __init__(self, king_id, target_user):
        super().__init__(timeout=60)
        self.king_id = king_id
        self.target_user = target_user

    @discord.ui.button(label="âš”ï¸ Aceitar o TÃ­tulo", style=discord.ButtonStyle.success)
    async def accept(self, interaction: discord.Interaction, button: discord.ui.Button):
        if str(interaction.user.id) != str(self.target_user.id):
            return await interaction.response.send_message("âŒ NÃ£o Ã© para vocÃª!", ephemeral=True)
        player = get_player(str(self.target_user.id))
        if player:
            player["city_title"] = "Cavaleiro"
            save_player_db(str(self.target_user.id), player)
            king = get_player(self.king_id)
            knights = king.get("knights", [])
            knights.append(str(self.target_user.id))
            king["knights"] = knights
            save_player_db(self.king_id, king)
        embed = discord.Embed(
            title="âš”ï¸ Cavaleiro do Reino!",
            description=f"**{self.target_user.display_name}** aceita o tÃ­tulo de **Cavaleiro** e ajoelha diante do Rei!\n\n*'Com este tÃ­tulo, juro proteger o povo com minha vida!'*",
            color=discord.Color.gold()
        )
        for item in self.children:
            item.disabled = True
        await interaction.response.edit_message(embed=embed, view=self)

    @discord.ui.button(label="âŒ Recusar", style=discord.ButtonStyle.danger)
    async def decline(self, interaction: discord.Interaction, button: discord.ui.Button):
        if str(interaction.user.id) != str(self.target_user.id):
            return await interaction.response.send_message("âŒ NÃ£o Ã© para vocÃª!", ephemeral=True)
        for item in self.children:
            item.disabled = True
        await interaction.response.edit_message(content="*O guerreiro recusa a genuflexÃ£o. Um rei deve respeitar isso.*", embed=None, view=self)


class PetFarmSelectView(discord.ui.View):
    def __init__(self, user_id, farm_pets):
        super().__init__(timeout=60)
        self.user_id = user_id
        self.farm_pets = farm_pets
        for i, pet in enumerate(farm_pets[:5]):
            btn = discord.ui.Button(
                label=f"{pet.get('emoji','ğŸ¾')} {pet['name']}",
                style=discord.ButtonStyle.primary,
                custom_id=f"farm_pet_{i}"
            )
            btn.callback = self._make_callback(i)
            self.add_item(btn)

    def _make_callback(self, index):
        async def callback(interaction: discord.Interaction):
            if str(interaction.user.id) != str(self.user_id):
                await interaction.response.send_message("âŒ NÃ£o Ã© sua fazenda!", ephemeral=True)
                return
            player = get_player(self.user_id)
            chosen = self.farm_pets[index]
            old_pet = player.get("pet")
            farm = player.get("pet_farm", [])
            # Remover da fazenda e colocar equipado
            farm = [p for p in farm if p["name"] != chosen["name"]]
            # Enviar atual para fazenda se tinha
            if old_pet:
                try:
                    old_pet_obj = json.loads(old_pet) if isinstance(old_pet, str) else old_pet
                    farm.append(old_pet_obj)
                except:
                    pass
            player["pet"] = json.dumps(chosen)
            player["pet_farm"] = farm
            save_player_db(self.user_id, player)
            embed = discord.Embed(
                title=f"ğŸ”„ Pet Trocado!",
                description=f"{chosen.get('emoji','ğŸ¾')} **{chosen['name']}** saiu da fazenda e agora te acompanha!",
                color=discord.Color.green()
            )
            if old_pet:
                try:
                    old_obj = json.loads(old_pet) if isinstance(old_pet, str) else old_pet
                    embed.add_field(name="ğŸ¡ Enviado Ã  Fazenda", value=f"{old_obj.get('emoji','ğŸ¾')} {old_obj['name']}", inline=False)
                except:
                    pass
            await interaction.response.edit_message(embed=embed, view=None)
        return callback


# ================= VIEW: MIMIC CHEST =================
class MimicChestView(discord.ui.View):
    def __init__(self, user_id, tier_idx, world):
        super().__init__(timeout=30)
        self.user_id = user_id
        self.tier = MIMIC_TIERS[tier_idx]
        self.world = world

    @discord.ui.button(label="ğŸ”“ Abrir o BaÃº", style=discord.ButtonStyle.danger)
    async def open_chest(self, interaction: discord.Interaction, button: discord.ui.Button):
        if str(interaction.user.id) != str(self.user_id):
            await interaction.response.send_message("âŒ NÃ£o Ã© seu baÃº!", ephemeral=True)
            return
        player = get_player(self.user_id)
        tier = self.tier
        is_mimic = random.random() < tier["mimic_chance"]

        if is_mimic:
            dmg = random.randint(*tier["mimic_dmg"])
            xp_loss = random.randint(*tier["mimic_xp_loss"])
            player["hp"] = max(1, player["hp"] - dmg)
            save_player_db(self.user_id, player)
            # Remove some XP
            remove_xp(self.user_id, xp_loss)
            embed = discord.Embed(
                title=f"ğŸ’€ MIMIC! {tier['emoji']} â€” {tier['name']}",
                description=tier["mimic_desc"],
                color=discord.Color.dark_red()
            )
            embed.add_field(name="ğŸ’¥ Dano Sofrido", value=f"`-{dmg} HP`", inline=True)
            embed.add_field(name="ğŸ’€ XP Perdido", value=f"`-{xp_loss} XP`", inline=True)
            embed.add_field(name="â¤ï¸ HP Restante", value=f"`{player['hp']}/{player['max_hp']}`", inline=True)
            embed.add_field(name="ğŸ“ LiÃ§Ã£o", value="_Mimics aprenderam a imitar baÃºs para sobreviver. VocÃª foi enganado pelo mais antigo truque das masmorras._", inline=False)
            embed.set_footer(text="Use `curar` para recuperar HP!")
        else:
            loot_xp = random.randint(*tier["loot_xp"])
            loot_coins = random.randint(*tier["loot_coins"])
            # Item aleatÃ³rio pela raridade permitida
            rarity_pool = tier["loot_items"]
            loot_item = None
            world_items = WORLDS[self.world].get("items", []) if self.world in WORLDS else []
            filtered = [i for i in world_items if i.get("rarity") in rarity_pool]
            if filtered:
                loot_item = random.choice(filtered)["name"]
            add_xp(self.user_id, loot_xp)
            add_coins(self.user_id, loot_coins)
            if loot_item:
                p2 = get_player(self.user_id)
                p2["inventory"].append(loot_item)
                save_player_db(self.user_id, p2)
            embed = discord.Embed(
                title=f"âœ¨ BaÃº Aberto! {tier['emoji']} â€” {tier['name']}",
                description=f"*O baÃº cede com um estalido. Uma aura dourada emana de dentro...*",
                color=discord.Color.gold()
            )
            embed.add_field(name="â­ XP", value=f"`+{loot_xp}`", inline=True)
            embed.add_field(name="ğŸ’° Coins", value=f"`+{loot_coins}`", inline=True)
            if loot_item:
                embed.add_field(name="ğŸ Item", value=f"`{loot_item}`", inline=True)

        for item in self.children:
            item.disabled = True
        await interaction.response.edit_message(embed=embed, view=self)

    @discord.ui.button(label="ğŸš¶ Deixar pra lÃ¡", style=discord.ButtonStyle.secondary)
    async def leave_chest(self, interaction: discord.Interaction, button: discord.ui.Button):
        if str(interaction.user.id) != str(self.user_id):
            await interaction.response.send_message("âŒ NÃ£o Ã© seu baÃº!", ephemeral=True)
            return
        await interaction.response.edit_message(
            embed=discord.Embed(
                title="ğŸš¶ VocÃª se afastou do baÃº",
                description="*Ã€s vezes a prudÃªncia Ã© o maior tesouro.*",
                color=discord.Color.greyple()
            ), view=None
        )


# ================= VIEW: CENÃRIO MORAL =================
class ScenarioChoiceView(discord.ui.View):
    def __init__(self, user_id, scenario):
        super().__init__(timeout=60)
        self.user_id = user_id
        self.scenario = scenario
        for i, choice in enumerate(scenario["choices"]):
            btn = discord.ui.Button(
                label=choice["text"][:80],
                style=discord.ButtonStyle.primary if choice["align"] > 0 else (
                    discord.ButtonStyle.danger if choice["align"] < -5 else discord.ButtonStyle.secondary
                ),
                row=i // 2
            )
            btn.callback = self._make_callback(i)
            self.add_item(btn)

    def _make_callback(self, index):
        async def callback(interaction: discord.Interaction):
            if str(interaction.user.id) != str(self.user_id):
                await interaction.response.send_message("âŒ NÃ£o Ã© sua escolha!", ephemeral=True)
                return
            choice = self.scenario["choices"][index]
            player = apply_alignment_points(self.user_id, choice["align"])
            add_xp(self.user_id, choice["xp"])
            add_coins(self.user_id, choice["coins"])
            new_align = get_alignment(player)
            info = ALIGNMENT_TITLES[new_align]
            color = discord.Color(info["color"])
            embed = discord.Embed(
                title=f"{info['emoji']} ConsequÃªncia",
                description=f"*{choice['result']}*",
                color=color
            )
            if choice["xp"]:
                embed.add_field(name="â­ XP", value=f"`+{choice['xp']}`", inline=True)
            if choice["coins"]:
                embed.add_field(name="ğŸ’° Coins", value=f"`+{choice['coins']}`", inline=True)
            align_pts = player.get("alignment_points", 0)
            embed.add_field(name=f"{info['emoji']} Alinhamento", value=f"**{new_align}** ({align_pts:+d} pts)", inline=False)
            embed.set_footer(text=info["desc"])
            for item in self.children:
                item.disabled = True
            await interaction.response.edit_message(embed=embed, view=self)
        return callback


# ================= COMANDOS NOVOS =================
BOT_OWNER_ID = os.getenv("OWNER_ID", str(ADMIN_ID))  # Defina no .env OWNER_ID=seu_discord_id

@bot.listen("on_message")
async def handle_new_commands(message):
    if message.author.bot:
        return
    if message.channel.name != CANAL_BETA and message.channel.id not in MUNDO_PROPRIO_CHANNELS.values():
        return
    content = message.content.lower().strip()
    uid = str(message.author.id)

    # ===== FAZENDA DE PETS =====
    if content in ["fazenda", "minha fazenda", "pet fazenda", "pets fazenda"]:
        player = get_player(uid)
        if not player:
            await message.channel.send("âŒ Crie seu personagem primeiro com `comeÃ§ar`!")
            return
        farm = player.get("pet_farm", [])
        current_pet = player.get("pet")
        embed = discord.Embed(title="ğŸ¡ Sua Fazenda de Pets", color=discord.Color.green())
        if current_pet:
            try:
                cp = json.loads(current_pet) if isinstance(current_pet, str) else current_pet
                embed.add_field(
                    name="ğŸ¾ Pet Equipado",
                    value=f"{cp.get('emoji','ğŸ¾')} **{cp['name']}** [{cp.get('rarity','?')}]\n`+{cp.get('bonus_hp',0)} HP` | `+{cp.get('bonus_atk',0)} ATK`",
                    inline=False
                )
            except:
                embed.add_field(name="ğŸ¾ Pet Equipado", value=str(current_pet), inline=False)
        else:
            embed.add_field(name="ğŸ¾ Pet Equipado", value="_Nenhum_", inline=False)

        if farm:
            farm_text = ""
            for i, pet in enumerate(farm[:10]):
                farm_text += f"{i+1}. {pet.get('emoji','ğŸ¾')} **{pet['name']}** [{pet.get('rarity','?')}] â€” `+{pet.get('bonus_hp',0)} HP` / `+{pet.get('bonus_atk',0)} ATK`\n"
            embed.add_field(name=f"ğŸŒ¾ Na Fazenda ({len(farm)} pets)", value=farm_text, inline=False)
            embed.set_footer(text="Use `trocar pet` para escolher um da fazenda!")
        else:
            embed.add_field(name="ğŸŒ¾ Na Fazenda", value="_Vazia. CaÃ§e pets para populÃ¡-la!_", inline=False)
        await message.channel.send(embed=embed)

    # ===== TROCAR PET =====
    elif content.startswith("trocar pet") and "@" not in content and content != "trocar pet":
        # trocar pet [nome] â€” troca diretamente por nome
        player = get_player(uid)
        if not player:
            return
        pet_name_search = content.replace("trocar pet", "").strip()
        all_pets = player.get("pets_list", []) + player.get("pet_farm", [])
        found = None
        for p in all_pets:
            if pet_name_search.lower() in p.get("name", "").lower():
                found = p
                break
        if not found:
            await message.channel.send(f"âŒ Pet '{pet_name_search}' nÃ£o encontrado na sua fazenda.\nUse `ver fazenda` para listar seus pets.")
            return
        # Swap active pet with found pet
        current = player.get("pet")
        new_active_name = found["name"]
        # Remove found from farm lists
        plist = player.get("pets_list", [])
        pfarm = player.get("pet_farm", [])
        if found in plist:
            plist.remove(found)
        elif found in pfarm:
            pfarm.remove(found)
        # Send current to farm
        if current:
            cur_name = current if isinstance(current, str) else current.get("name", "?")
            # Find current pet data in PETS and PETS_EXTRA to preserve rarity/bonuses
            cur_pet_obj = {"name": cur_name, "emoji": "ğŸ¾", "rarity": "Comum", "bonus_hp": 0, "bonus_atk": 0}
            all_pet_sources = list(PETS.values()) + list(PETS_EXTRA.values())
            for world_pets in all_pet_sources:
                for pp in world_pets:
                    if pp["name"] == cur_name:
                        cur_pet_obj = {**pp, "evo_stage": 1, "pet_xp": 0}
                        break
            plist.append(cur_pet_obj)
        player["pets_list"] = plist
        player["pet_farm"] = pfarm
        player["pet"] = new_active_name
        save_player_db(uid, player)
        # Find new pet data for display â€” check PETS and PETS_EXTRA
        new_pet_data = found
        all_pet_sources = list(PETS.values()) + list(PETS_EXTRA.values())
        for world_pets in all_pet_sources:
            for pp in world_pets:
                if pp["name"] == new_active_name:
                    new_pet_data = pp
                    break
        await message.channel.send(
            f"ğŸ”„ **Pet trocado!**\n\n"
            f"{new_pet_data.get('emoji','ğŸ¾')} **{new_active_name}** Ã© agora seu pet ativo!\n"
            f"+{new_pet_data.get('bonus_atk',0)} ATK | +{new_pet_data.get('bonus_hp',0)} HP\n"
            f"*O pet anterior foi para a fazenda.*"
        )

    elif content in ["trocar pet", "mudar pet", "escolher pet"]:
        player = get_player(uid)
        if not player:
            await message.channel.send("âŒ Crie seu personagem primeiro!")
            return
        all_pets = player.get("pets_list", []) + player.get("pet_farm", [])
        if not all_pets:
            await message.channel.send("ğŸ¡ Sua fazenda estÃ¡ vazia! NÃ£o hÃ¡ pets para trocar.\nCapture mais pets com `domesticar`.")
            return
        embed = discord.Embed(
            title="ğŸ”„ Trocar Pet",
            description="Escolha um pet da fazenda para equipar. O pet atual serÃ¡ enviado para a fazenda.\nOu use `trocar pet [nome]` diretamente!",
            color=discord.Color.blurple()
        )
        for pet in all_pets[:6]:
            evo_info = PET_EVOLUTIONS.get(pet.get("name",""))
            evo_txt = f"\nğŸ”„ Evo: {evo_info['next']}" if evo_info else ""
            embed.add_field(
                name=f"{pet.get('emoji','ğŸ¾')} {pet['name']}",
                value=f"{RARITIES[pet.get('rarity','Comum')]['emoji']} {pet.get('rarity','?')}\n+{pet.get('bonus_hp',0)} HP | +{pet.get('bonus_atk',0)} ATK{evo_txt}",
                inline=True
            )
        view = PetFarmSelectView(uid, all_pets)
        await message.channel.send(embed=embed, view=view)

    # ===== ENVIAR PET PARA FAZENDA =====
    elif content.startswith("enviar pet fazenda") or content in ["guardar pet", "depositar pet"]:
        player = get_player(uid)
        if not player:
            return
        current_pet = player.get("pet")
        if not current_pet:
            await message.channel.send("âŒ VocÃª nÃ£o tem pet equipado!")
            return
        try:
            cp = json.loads(current_pet) if isinstance(current_pet, str) else current_pet
            farm = player.get("pet_farm", [])
            farm.append(cp)
            player["pet"] = None
            player["pet_farm"] = farm
            save_player_db(uid, player)
            embed = discord.Embed(
                title="ğŸ¡ Pet Enviado!",
                description=f"{cp.get('emoji','ğŸ¾')} **{cp['name']}** foi para a fazenda feliz!",
                color=discord.Color.green()
            )
            embed.set_footer(text="Use `trocar pet` para escolhÃª-lo de volta quando quiser.")
            await message.channel.send(embed=embed)
        except Exception as e:
            await message.channel.send(f"âŒ Erro ao enviar pet: {e}")

    # ===== TROCAR CSI COINS POR MONSTRINHOS COINS =====
    elif content.startswith("trocar coins") or content.startswith("converter coins"):
        player = get_player(uid)
        if not player:
            await message.channel.send("âŒ Crie seu personagem primeiro!")
            return
        parts = content.split()
        amount = 0
        for p in parts:
            if p.isdigit():
                amount = int(p)
                break
        if amount <= 0:
            await message.channel.send(
                "ğŸ’± **Como trocar coins:**\n`trocar coins 100` â€” envia pedido de troca de 100 CSI Coins por Monstrinhos Coins.\n"
                "O dono do servidor serÃ¡ notificado e aprovarÃ¡ a troca.\n\n"
                f"Seu saldo atual: **{player['coins']} CSI Coins** ğŸ’°"
            )
            return
        if player["coins"] < amount:
            await message.channel.send(f"âŒ VocÃª tem apenas **{player['coins']}** coins! Pediu {amount}.")
            return

        # Salvar pedido no DB
        conn = sqlite3.connect(DB_FILE)
        c = conn.cursor()
        c.execute("INSERT INTO coin_exchange_requests (user_id, username, csi_coins) VALUES (?, ?, ?)",
                  (uid, str(message.author), amount))
        req_id = c.lastrowid
        conn.commit()
        conn.close()

        # Notificar dono via DM
        owner_id = int(BOT_OWNER_ID) if BOT_OWNER_ID != "0" else None
        if owner_id:
            try:
                owner = await bot.fetch_user(owner_id)
                dm_embed = discord.Embed(
                    title="ğŸ’± PEDIDO DE TROCA DE COINS",
                    description=f"**UsuÃ¡rio:** {message.author} (`{uid}`)\n**Servidor:** {message.guild.name if message.guild else 'DM'}\n**Pedido:** {amount} CSI Coins â†’ Monstrinhos Coins\n**ID do Pedido:** #{req_id}",
                    color=discord.Color.orange()
                )
                dm_embed.add_field(name="âœ… Para APROVAR", value=f"`aprovar troca {req_id}`", inline=True)
                dm_embed.add_field(name="âŒ Para RECUSAR", value=f"`recusar troca {req_id}`", inline=True)
                await owner.send(embed=dm_embed)
            except Exception as e:
                print(f"Erro ao enviar DM ao owner: {e}")

        embed = discord.Embed(
            title="ğŸ“¤ Pedido Enviado!",
            description=f"Seu pedido de troca de **{amount} CSI Coins** foi registrado e enviado ao administrador.\nAguarde a aprovaÃ§Ã£o!",
            color=discord.Color.blurple()
        )
        embed.add_field(name="ğŸ“‹ ID do Pedido", value=f"#{req_id}", inline=True)
        embed.add_field(name="ğŸ’° Coins Solicitados", value=f"{amount}", inline=True)
        await message.channel.send(embed=embed)

    # ===== OWNER: APROVAR/RECUSAR TROCA =====
    elif content.startswith("aprovar troca ") and uid == BOT_OWNER_ID:
        parts = content.split()
        if len(parts) < 3 or not parts[2].isdigit():
            await message.channel.send("âŒ Uso: `aprovar troca <id>`")
            return
        req_id = int(parts[2])
        conn = sqlite3.connect(DB_FILE)
        c = conn.cursor()
        c.execute("SELECT user_id, username, csi_coins, status FROM coin_exchange_requests WHERE id = ?", (req_id,))
        row = c.fetchone()
        if not row:
            await message.channel.send(f"âŒ Pedido #{req_id} nÃ£o encontrado.")
            conn.close()
            return
        req_uid, req_uname, req_coins, status = row
        if status != "pending":
            await message.channel.send(f"âŒ Pedido #{req_id} jÃ¡ foi processado ({status}).")
            conn.close()
            return
        # Resetar coins do jogador
        player = get_player(req_uid)
        if player:
            old_coins = player["coins"]
            player["coins"] = max(0, player["coins"] - req_coins)
            save_player_db(req_uid, player)
        c.execute("UPDATE coin_exchange_requests SET status = 'approved' WHERE id = ?", (req_id,))
        conn.commit()
        conn.close()
        # Notificar jogador
        try:
            target_user = await bot.fetch_user(int(req_uid))
            notify_embed = discord.Embed(
                title="âœ… Troca Aprovada!",
                description=f"Sua troca de **{req_coins} CSI Coins** por Monstrinhos Coins foi **APROVADA**!\nSeus coins foram descontados. Entre em contato com o administrador para receber seus Monstrinhos Coins! ğŸ‰",
                color=discord.Color.green()
            )
            await target_user.send(embed=notify_embed)
        except:
            pass
        await message.channel.send(f"âœ… Pedido #{req_id} de **{req_uname}** aprovado! {req_coins} coins descontados.")

    elif content.startswith("recusar troca ") and uid == BOT_OWNER_ID:
        parts = content.split()
        if len(parts) < 3 or not parts[2].isdigit():
            await message.channel.send("âŒ Uso: `recusar troca <id>`")
            return
        req_id = int(parts[2])
        conn = sqlite3.connect(DB_FILE)
        c = conn.cursor()
        c.execute("SELECT user_id, username, csi_coins, status FROM coin_exchange_requests WHERE id = ?", (req_id,))
        row = c.fetchone()
        conn.close()
        if not row:
            await message.channel.send(f"âŒ Pedido #{req_id} nÃ£o encontrado.")
            return
        req_uid, req_uname, req_coins, status = row
        conn2 = sqlite3.connect(DB_FILE)
        c2 = conn2.cursor()
        c2.execute("UPDATE coin_exchange_requests SET status = 'refused' WHERE id = ?", (req_id,))
        conn2.commit()
        conn2.close()
        try:
            target_user = await bot.fetch_user(int(req_uid))
            await target_user.send(embed=discord.Embed(
                title="âŒ Troca Recusada",
                description=f"Seu pedido de troca de **{req_coins} CSI Coins** foi recusado. Entre em contato com o administrador para mais detalhes.",
                color=discord.Color.red()
            ))
        except:
            pass
        await message.channel.send(f"âŒ Pedido #{req_id} de **{req_uname}** recusado.")

    # ===== ALINHAMENTO MORAL =====
    elif content in ["alinhamento", "meu alinhamento", "ver alinhamento", "moralidade"]:
        player = get_player(uid)
        if not player:
            await message.channel.send("âŒ Crie seu personagem primeiro!")
            return
        align = get_alignment(player)
        info = ALIGNMENT_TITLES[align]
        pts = player.get("alignment_points", 0)
        color = discord.Color(info["color"])

        bar_fill = int((pts + 100) / 200 * 20)
        bar = "ğŸŸ¥" * max(0, 10 - bar_fill // 2) + "â¬›" * max(0, bar_fill - 10) if pts < 0 else "â¬›" * max(0, 10 - bar_fill // 2) + "ğŸŸ¨" * max(0, bar_fill // 2)
        villain_bar = "ğŸ”´" * min(10, max(0, (-pts) // 10))
        hero_bar = "ğŸŸ¡" * min(10, max(0, pts // 10))
        full_bar = "ğŸ’€" * max(0, 10 - len(villain_bar) - len(hero_bar)) + villain_bar + "âš–ï¸" + hero_bar + "âœ¨" * max(0, 10 - len(hero_bar))

        embed = discord.Embed(
            title=f"{info['emoji']} {align} â€” {message.author.display_name}",
            description=f"*{info['desc']}*",
            color=color
        )
        embed.add_field(name="ğŸ“Š Pontos de Alinhamento", value=f"`{pts:+d} / 100`", inline=True)
        evil_bar = "ğŸ”´" * min(10, max(0, 10 - (pts + 100) // 20))
        good_bar = "ğŸŸ¡" * min(10, max(0, (pts + 100) // 20))
        embed.add_field(name="â˜¯ï¸ Espectro Moral", value=f"ğŸ’€ {evil_bar}|{good_bar} âœ¨", inline=False)
        embed.add_field(
            name="ğŸ¯ PrÃ³ximo Alinhamento",
            value=(
                f"**HerÃ³i** em `{max(0, 30 - pts)} pts`" if pts < 30 else
                f"**VilÃ£o** em `{max(0, pts + 30)} pts negativos`" if pts > -30 else
                "VocÃª estÃ¡ no extremo!"
            ),
            inline=False
        )
        quests_available = []
        for key, qlist in ALIGNMENT_QUESTS.items():
            for q in qlist:
                req = q.get("align_required")
                if req is None or req == align:
                    quests_available.append(q["name"])
        if quests_available:
            embed.add_field(name="ğŸ“‹ Quests DisponÃ­veis pro seu Alinhamento", value="\n".join(quests_available[:5]), inline=False)
        await message.channel.send(embed=embed)

    # ===== CENÃRIO MORAL =====
    elif content in ["cenÃ¡rio", "cenario", "evento moral", "situaÃ§Ã£o", "situacao"]:
        player = get_player(uid)
        if not player:
            await message.channel.send("âŒ Crie seu personagem primeiro!")
            return
        world_key = max(k for k in player.get("worlds", [1]))
        scenario_pool = ALIGNMENT_SCENARIOS.get(world_key, ALIGNMENT_SCENARIOS.get(1, []))
        if not scenario_pool:
            await message.channel.send("ğŸŒ NÃ£o hÃ¡ cenÃ¡rios para este reino ainda.")
            return
        scenario = random.choice(scenario_pool)
        embed = discord.Embed(
            title=f"{scenario['emoji']} {scenario['title']}",
            description=scenario["description"],
            color=discord.Color.gold()
        )
        align = get_alignment(player)
        info = ALIGNMENT_TITLES[align]
        embed.set_footer(text=f"Alinhamento atual: {info['emoji']} {align} | Suas escolhas definem quem vocÃª Ã©.")
        view = ScenarioChoiceView(uid, scenario)
        await message.channel.send(embed=embed, view=view)

    # ===== ABRIR MAPA =====
    elif content in ["abrir mapa", "mapa", "meu mapa", "ver mapa", "mapa 1"]:
        player = get_player(uid)
        if not player:
            await message.channel.send("âŒ Crie seu personagem primeiro!")
            return
        await show_map_page(message, player, 1)

    elif content in ["mapa 2", "abrir mapa 2"]:
        player = get_player(uid)
        if not player:
            await message.channel.send("âŒ Crie seu personagem primeiro!")
            return
        await show_map_page(message, player, 2)

    elif content in ["mapa 3", "abrir mapa 3"]:
        player = get_player(uid)
        if not player:
            await message.channel.send("âŒ Crie seu personagem primeiro!")
            return
        await show_map_page(message, player, 3)

    elif content in ["mapa 4", "abrir mapa 4"]:
        player = get_player(uid)
        if not player:
            await message.channel.send("âŒ Crie seu personagem primeiro!")
            return
        await show_map_page(message, player, 4)

    elif content in ["mapa 5", "abrir mapa 5"]:
        player = get_player(uid)
        if not player:
            await message.channel.send("âŒ Crie seu personagem primeiro!")
            return
        await show_map_page(message, player, 5)

    elif content in ["mapa 6", "abrir mapa 6"]:
        player = get_player(uid)
        if not player:
            await message.channel.send("âŒ Crie seu personagem primeiro!")
            return
        await show_map_page(message, player, 6)

    # ===== VIAJAR =====
    elif content.startswith("viajar ") or content.startswith("ir para ") or content.startswith("ir pra "):
        player = get_player(uid)
        if not player:
            await message.channel.send("âŒ Crie seu personagem primeiro!")
            return
        destination = content.split(maxsplit=1)[1].strip().lower()
        player_map = get_player_map(player)
        found_loc = None
        found_world = None
        for world_id, wdata in player_map.items():
            for loc in wdata["locations"]:
                if loc.get("visible") and destination in loc["name"].lower():
                    found_loc = loc
                    found_world = world_id
                    break
        # TambÃ©m verificar por nÃºmero de mundo
        if not found_loc:
            for world_id in player.get("worlds", [1]):
                world_name = MAP_LOCATIONS.get(world_id, {}).get("world_name", "")
                if destination in world_name.lower():
                    found_world = world_id
                    found_loc = {"name": world_name, "id": f"world_{world_id}", "type": "cidade"}
                    break
        if not found_loc:
            await message.channel.send(
                f"â“ Local '**{destination}**' nÃ£o encontrado ou ainda nÃ£o descoberto.\n"
                "Use `abrir mapa` para ver seus locais conhecidos."
            )
            return
        # Verificar se o mundo estÃ¡ desbloqueado
        if found_world not in player.get("worlds", [1]):
            await message.channel.send(f"ğŸ”’ O reino **{MAP_LOCATIONS.get(found_world, {}).get('world_name', '?')}** ainda estÃ¡ bloqueado! Derrote o boss do reino anterior.")
            return
        # Atualizar mundo atual do jogador
        worlds = player.get("worlds", [1])
        if found_world not in worlds:
            await message.channel.send(f"ğŸ”’ VocÃª ainda nÃ£o desbloqueou este reino!")
            return
        # Registrar viagem â€” salva current_world para explorar no reino certo
        player["worlds"] = worlds  # mantÃ©m tudo que jÃ¡ tem
        player["current_world"] = found_world
        save_player_db(uid, player)
        world_name = MAP_LOCATIONS.get(found_world, {}).get("world_name", str(found_world))
        embed = discord.Embed(
            title=f"âœˆï¸ Viajando para {found_loc['name']}",
            description=f"*VocÃª parte em direÃ§Ã£o a **{world_name}**...*\n\nChegou em **{found_loc['name']}**! O ar aqui Ã© diferente.",
            color=discord.Color.teal()
        )
        embed.add_field(name="ğŸ“ Local", value=found_loc["name"], inline=True)
        embed.add_field(name="ğŸŒ Reino", value=world_name, inline=True)
        embed.set_footer(text="Use `explorar` para comeÃ§ar a aventura neste local!")
        # Descobrir local se ainda nÃ£o estava marcado
        disc = player.get("discovered_map", {})
        key = str(found_world)
        if key not in disc:
            disc[key] = []
        if found_loc.get("id") and found_loc["id"] not in disc[key]:
            disc[key].append(found_loc["id"])
            player["discovered_map"] = disc
            save_player_db(uid, player)
            embed.add_field(name="ğŸ—ºï¸ Descoberta!", value=f"Local adicionado ao mapa!", inline=False)
        await message.channel.send(embed=embed)

    # ===== MISSÃƒO MORAL =====
    elif content in ["missÃ£o moral", "missao moral", "quest moral", "missÃ£o alinhamento"]:
        player = get_player(uid)
        if not player:
            return
        align = get_alignment(player)
        all_quests = []
        for key, qlist in ALIGNMENT_QUESTS.items():
            for q in qlist:
                req = q.get("align_required")
                if req is None or req == align:
                    all_quests.append(q)
        if not all_quests:
            await message.channel.send("âŒ Nenhuma missÃ£o disponÃ­vel para seu alinhamento.")
            return
        quest = random.choice(all_quests)
        if player.get("active_quest"):
            await message.channel.send("âŒ VocÃª jÃ¡ tem uma quest ativa! Use `finalizar quest` ou `abandonar quest`.")
            return
        info = ALIGNMENT_TITLES[align]
        embed = discord.Embed(
            title=f"{info['emoji']} {quest['name']}",
            description=quest["description"],
            color=discord.Color(info["color"])
        )
        embed.add_field(name="ğŸ“ Lore", value=quest["lore"], inline=False)
        embed.add_field(name="ğŸ‘¤ NPC", value=quest["npc"], inline=True)
        embed.add_field(name="âš”ï¸ Dificuldade", value=quest["difficulty"], inline=True)
        embed.add_field(name="â­ Recompensa XP", value=f"{quest['reward_xp']:,}", inline=True)
        embed.add_field(name="ğŸ’° Recompensa Coins", value=str(quest["reward_coins"]), inline=True)
        view = QuestAcceptButton(str(uid), quest)
        await message.channel.send(embed=embed, view=view)

    # ===== DESCOBRIR LOCAL (ao explorar) â€” trigger automÃ¡tico =====
    # Isso Ã© chamado internamente, nÃ£o diretamente pelo usuÃ¡rio

    # ===== VER PEDIDOS DE TROCA (admin) =====
    elif content in ["ver trocas", "pedidos de troca"] and uid == BOT_OWNER_ID:
        conn = sqlite3.connect(DB_FILE)
        c = conn.cursor()
        c.execute("SELECT id, user_id, username, csi_coins, status, created_at FROM coin_exchange_requests WHERE status = 'pending' ORDER BY created_at DESC LIMIT 10")
        rows = c.fetchall()
        conn.close()
        if not rows:
            await message.channel.send("ğŸ“‹ Nenhum pedido de troca pendente.")
            return
        embed = discord.Embed(title="ğŸ’± Pedidos de Troca Pendentes", color=discord.Color.orange())
        for row in rows:
            req_id, req_uid, req_uname, req_coins, req_status, created = row
            embed.add_field(
                name=f"#{req_id} â€” {req_uname}",
                value=f"ğŸ’° **{req_coins}** CSI Coins\n`aprovar troca {req_id}` | `recusar troca {req_id}`",
                inline=False
            )
        await message.channel.send(embed=embed)

    # ===== EMPREGOS =====
    elif content in ["procurar emprego", "empregos", "quero emprego", "ver empregos", "escolher emprego"]:
        player = get_player(uid)
        if not player:
            await message.channel.send("âŒ Crie seu personagem primeiro!")
            return
        if player["level"] < 5:
            await message.channel.send(
                f"âš ï¸ VocÃª precisa ser **nÃ­vel 5** para procurar emprego!\n"
                f"NÃ­vel atual: **{player['level']}**\nContinue explorando!"
            )
            return
        current_job = player.get("job")
        avail = [name for name, jdata in JOBS.items() if player["level"] >= jdata["min_level"]]
        embed = discord.Embed(
            title="ğŸ’¼ Empregos do Reino",
            description="*O taberneiro pregou uma lista de vagas na parede. VocÃª se aproxima para ler...*",
            color=discord.Color.blurple()
        )
        if current_job:
            jd = JOBS.get(current_job, {})
            embed.add_field(
                name=f"ğŸ”– Emprego Atual: {jd.get('emoji','?')} {current_job}",
                value=f"_{jd.get('description','')}_\nUse `trabalhar` para ganhar salÃ¡rio!",
                inline=False
            )
        for jname in avail:
            jd = JOBS[jname]
            embed.add_field(
                name=f"{jd['emoji']} {jname} (NÃ­vel {jd['min_level']}+)",
                value=f"_{jd['description']}_\nğŸ’° `{jd['salary_coins'][0]}â€“{jd['salary_coins'][1]}` coins | â­ `{jd['salary_xp'][0]}â€“{jd['salary_xp'][1]}` XP",
                inline=True
            )
        embed.set_footer(text="Escolha um emprego abaixo! VocÃª pode trocar a qualquer momento.")
        view = JobSelectView(uid, avail)
        await message.channel.send(embed=embed, view=view)

    elif content in ["ver emprego", "meu emprego", "emprego atual"]:
        player = get_player(uid)
        if not player:
            return
        job = player.get("job")
        if not job:
            await message.channel.send("ğŸ’¼ VocÃª nÃ£o tem emprego! Use `procurar emprego` para ver vagas disponÃ­veis.")
            return
        jd = JOBS[job]
        import time
        since = player.get("job_since", 0)
        hours_working = int((time.time() - since) / 3600) if since else 0
        embed = discord.Embed(
            title=f"{jd['emoji']} Seu Emprego: **{job}**",
            description=f"*{jd['work_action']}*\n\n{jd['description']}",
            color=discord.Color.green()
        )
        perks_text = "\n".join([f"â€¢ {p}" for p in jd["perks"]])
        embed.add_field(name="âœ¨ BenefÃ­cios", value=perks_text, inline=False)
        embed.add_field(name="ğŸ’° SalÃ¡rio por turno", value=f"`{jd['salary_coins'][0]}â€“{jd['salary_coins'][1]}` coins", inline=True)
        embed.add_field(name="â­ XP por turno", value=f"`{jd['salary_xp'][0]}â€“{jd['salary_xp'][1]}`", inline=True)
        embed.add_field(name="â±ï¸ Trabalhando hÃ¡", value=f"`{hours_working}h`", inline=True)
        title = player.get("city_title")
        if title:
            embed.add_field(name="ğŸ… TÃ­tulo na Cidade", value=f"**{title}**", inline=False)
        embed.set_footer(text="Use `trabalhar` para ganhar salÃ¡rio!")
        await message.channel.send(embed=embed)

    elif content in ["trabalhar", "ir trabalhar", "fazer trabalho"]:
        import time
        player = get_player(uid)
        if not player:
            return
        job = player.get("job")
        if not job:
            await message.channel.send("ğŸ’¼ VocÃª nÃ£o tem emprego! Use `procurar emprego`.")
            return
        jd = JOBS[job]
        last_work = player.get("last_work", 0)
        now = int(time.time())
        cooldown = 300  # 5 min
        if now - last_work < cooldown:
            remaining = cooldown - (now - last_work)
            secs = remaining % 60
            mins = remaining // 60
            wait_txt = f"{mins}m {secs}s" if mins > 0 else f"{secs}s"
            await message.channel.send(f"â³ VocÃª jÃ¡ trabalhou recentemente! PrÃ³ximo turno em **{wait_txt}**.")
            return

        # Determinar nÃ­vel do emprego
        job_works = player.get("job_works", {})
        job_work_count = job_works.get(job, 0)
        job_level = 1
        job_levels = jd.get("levels", {})
        for lvl_num in sorted(job_levels.keys(), reverse=True):
            req = job_levels[lvl_num].get("req_work", 0)
            if job_work_count >= req:
                job_level = lvl_num
                break
        lvl_data = job_levels.get(job_level, {})
        salary_mult = lvl_data.get("salary_mult", 1.0)

        coins = int(random.randint(*jd["salary_coins"]) * salary_mult)
        xp = int(random.randint(*jd["salary_xp"]) * salary_mult)
        work_msg = random.choice(jd["work_msgs"])

        # BÃ´nus de curandeiro por nÃ­vel
        hp_bonus = 0
        if job == "Curandeiro":
            hp_bonus = lvl_data.get("hp_regen_bonus", 10)
            player["hp"] = min(player["max_hp"], player["hp"] + hp_bonus)

        # Escriba: chance de coletar pergaminho ao trabalhar (nÃ­vel 2+)
        scroll_found = None
        if job == "Escriba" and job_level >= 1:
            scrolls_per_day = lvl_data.get("scrolls_per_day", 1)
            scroll_chance = min(0.15 * scrolls_per_day, 0.60)
            if random.random() < scroll_chance:
                scrolls = [
                    "ğŸ“œ Pergaminho de Sabedoria Antiga",
                    "ğŸ“œ Pergaminho de Rota Perdida",
                    "ğŸ“œ Pergaminho de FeitiÃ§os Arcanos",
                    "ğŸ“œ Pergaminho de BestiÃ¡rio",
                    "ğŸ“œ Pergaminho de Lore Proibido",
                    "ğŸ“œ Pergaminho de Mapa Ã‰lfico",
                    "ğŸ“œ Pergaminho de CrÃ´nicas Reais",
                ]
                scroll_found = random.choice(scrolls)
                inv = player.get("inventory", [])
                inv.append({"name": scroll_found, "type": "scroll", "qty": 1})
                player["inventory"] = inv

        player["last_work"] = now
        # Incrementar contador de trabalhos do emprego
        job_works[job] = job_work_count + 1
        player["job_works"] = job_works
        save_player_db(uid, player)
        add_coins(uid, coins)
        leveled = add_xp(uid, xp)

        # Verificar se subiu de nÃ­vel no emprego
        new_job_level = 1
        for lvl_num in sorted(job_levels.keys(), reverse=True):
            req = job_levels[lvl_num].get("req_work", 0)
            if (job_work_count + 1) >= req:
                new_job_level = lvl_num
                break
        job_leveled_up = new_job_level > job_level

        embed = discord.Embed(
            title=f"{jd['emoji']} Turno de Trabalho â€” {job}",
            description=work_msg,
            color=discord.Color.green()
        )
        embed.add_field(name="ğŸ’° SalÃ¡rio", value=f"`+{coins}` coins", inline=True)
        embed.add_field(name="â­ XP", value=f"`+{xp}`", inline=True)
        if hp_bonus:
            embed.add_field(name="ğŸ’š Cura", value=f"`+{hp_bonus} HP`", inline=True)
        if scroll_found:
            embed.add_field(name="ğŸ“œ Pergaminho Encontrado!", value=f"**{scroll_found}** adicionado ao inventÃ¡rio!", inline=False)
        # Mostrar nÃ­vel do emprego
        next_lvl_req = None
        if job_level < 3:
            next_lvl_data = job_levels.get(job_level + 1, {})
            next_lvl_req = next_lvl_data.get("req_work", "?")
        job_level_name = lvl_data.get("name", job)
        embed.add_field(
            name=f"ğŸ’¼ NÃ­vel do Emprego: {job_level}/3",
            value=f"**{job_level_name}** | Trabalhos: {job_work_count + 1}"
                  + (f"\nğŸ”¼ PrÃ³ximo nÃ­vel em: {next_lvl_req} trabalhos" if next_lvl_req else "\nğŸ† NÃ­vel mÃ¡ximo atingido!"),
            inline=False
        )
        if job_leveled_up:
            new_lvl_data = job_levels.get(new_job_level, {})
            embed.add_field(
                name=f"ğŸ‰ PROMOÃ‡ÃƒO! NÃ­vel {new_job_level}/3!",
                value=f"**{new_lvl_data.get('name', job)}**\nâœ¨ Novo bÃ´nus: {new_lvl_data.get('bonus', '')}",
                inline=False
            )
        if leveled:
            p2 = get_player(uid)
            embed.add_field(name="ğŸ†™ Level Up!", value=f"NÃ­vel **{p2['level']}**!", inline=False)
        embed.set_footer(text=f"PrÃ³ximo turno em 5 minutos. | Use 'ver emprego' para detalhes do cargo")
        await message.channel.send(embed=embed)

    elif content in ["largar emprego", "demissao", "demissÃ£o", "sair do emprego"]:
        player = get_player(uid)
        if not player:
            return
        job = player.get("job")
        if not job:
            await message.channel.send("ğŸ’¼ VocÃª nÃ£o tem emprego para largar!")
            return
        jd = JOBS[job]
        player["job"] = None
        save_player_db(uid, player)
        await message.channel.send(
            embed=discord.Embed(
                title=f"{jd['emoji']} VocÃª largou o emprego de **{job}**",
                description=f"*VocÃª entrega sua ferramenta e parte. Um novo capÃ­tulo comeÃ§a.*",
                color=discord.Color.greyple()
            )
        )

    elif content in ["largar emprego", "demissao", "demissÃ£o", "sair do emprego"]:
        player = get_player(uid)
        if not player:
            return
        job = player.get("job")
        if not job:
            await message.channel.send("ğŸ’¼ VocÃª nÃ£o tem emprego para largar!")
            return
        jd = JOBS[job]
        player["job"] = None
        save_player_db(uid, player)
        await message.channel.send(
            embed=discord.Embed(
                title=f"{jd['emoji']} VocÃª largou o emprego de **{job}**",
                description=f"*VocÃª entrega sua ferramenta e parte. Um novo capÃ­tulo comeÃ§a.*",
                color=discord.Color.greyple()
            )
        )

    # ===== INSPECIONAR ARMA =====
    elif content.startswith("inspecionar arma") or content.startswith("inspecionar "):
        player = get_player(uid)
        if not player:
            return
        # Detectar nome da arma: "inspecionar arma [nome]" ou "inspecionar [nome]"
        if content.startswith("inspecionar arma "):
            weapon_name_query = content[17:].strip()
        elif content.startswith("inspecionar ") and content != "inspecionar item":
            weapon_name_query = content[12:].strip()
        else:
            weapon_name_query = ""

        # Se nÃ£o especificou nome, inspeciona arma equipada
        if not weapon_name_query:
            weapon_name_query = player.get("weapon", "")

        if not weapon_name_query:
            await message.channel.send(
                "ğŸ” **Inspecionar Arma**\n\n"
                "VocÃª nÃ£o tem arma equipada!\n"
                "Uso: `inspecionar arma [nome da arma]`\n"
                "Exemplo: `inspecionar arma Espada de Ferro`"
            )
            return

        # Procurar arma no database (busca parcial insensÃ­vel a maiÃºsculas)
        wname_lower = weapon_name_query.lower()
        found_key = None
        found_data = None
        for wkey, wdata in WEAPON_DATABASE.items():
            if wname_lower in wkey.lower() or wkey.lower() in wname_lower:
                found_key = wkey
                found_data = wdata
                break

        if not found_data:
            # Tentar encontrar no inventÃ¡rio do jogador
            inv = player.get("inventory", [])
            for item in inv:
                if isinstance(item, dict) and wname_lower in item.get("name", "").lower():
                    # Item encontrado mas sem dados detalhados
                    rarity_color = {
                        "Comum": discord.Color.light_grey(),
                        "Incomum": discord.Color.green(),
                        "Raro": discord.Color.blue(),
                        "Ã‰pico": discord.Color.purple(),
                        "LendÃ¡rio": discord.Color.gold(),
                        "MÃ­tico": discord.Color.from_rgb(255, 50, 50),
                    }.get(item.get("rarity", "Comum"), discord.Color.light_grey())
                    embed = discord.Embed(
                        title=f"ğŸ” {item['name']}",
                        description=f"*Arma encontrada no inventÃ¡rio, mas sem ficha detalhada.*",
                        color=rarity_color
                    )
                    embed.add_field(name="âš”ï¸ Raridade", value=item.get("rarity", "?"), inline=True)
                    embed.add_field(name="ğŸ“¦ Tipo", value=item.get("type", "Arma"), inline=True)
                    embed.set_footer(text="Dica: PeÃ§a ao Ferreiro para identificar itens desconhecidos!")
                    await message.channel.send(embed=embed)
                    return

            await message.channel.send(
                f"ğŸ” Arma **'{weapon_name_query}'** nÃ£o encontrada no banco de dados.\n"
                f"Verifique o nome ou use `inventÃ¡rio` para ver suas armas.\n"
                f"*Dica: Armas mais raras podem precisar de um Ferreiro para ser inspecionadas!*"
            )
            return

        rarity_colors = {
            "Comum": discord.Color.light_grey(),
            "Incomum": discord.Color.green(),
            "Raro": discord.Color.blue(),
            "Ã‰pico": discord.Color.purple(),
            "LendÃ¡rio": discord.Color.gold(),
            "MÃ­tico": discord.Color.from_rgb(255, 50, 50),
        }
        rarity_emojis = {
            "Comum": "â¬œ", "Incomum": "ğŸŸ©", "Raro": "ğŸŸ¦",
            "Ã‰pico": "ğŸŸª", "LendÃ¡rio": "ğŸŸ¨", "MÃ­tico": "ğŸ”´"
        }
        color = rarity_colors.get(found_data["rarity"], discord.Color.light_grey())
        rar_emoji = rarity_emojis.get(found_data["rarity"], "â¬›")

        # Barra de ATK visual
        atk_bar_filled = min(int(found_data["atk"] / 5), 10)
        atk_bar = "ğŸŸ¥" * atk_bar_filled + "â¬›" * (10 - atk_bar_filled)
        crit_bar_filled = min(int(found_data["crit"] / 2), 10)
        crit_bar = "ğŸŸ¨" * crit_bar_filled + "â¬›" * (10 - crit_bar_filled)
        spd_bar_filled = min(int(found_data["speed"] / 2), 10)
        spd_bar = "ğŸŸ©" * spd_bar_filled + "â¬›" * (10 - spd_bar_filled)

        embed = discord.Embed(
            title=f"ğŸ” {rar_emoji} {found_key}",
            description=f"*\"{found_data.get('lore', 'Uma arma de origens desconhecidas.')}\"*",
            color=color
        )
        embed.add_field(name="ğŸ·ï¸ Tipo", value=found_data["type"], inline=True)
        embed.add_field(name=f"{rar_emoji} Raridade", value=found_data["rarity"], inline=True)
        embed.add_field(name="ğŸŒŸ Elemento", value=found_data.get("element") or "Nenhum", inline=True)
        embed.add_field(name=f"âš”ï¸ ATK: `{found_data['atk']}`", value=atk_bar, inline=False)
        embed.add_field(name=f"ğŸ’¥ CrÃ­tico: `{found_data['crit']}%`", value=crit_bar, inline=True)
        embed.add_field(name=f"âš¡ Velocidade: `{found_data['speed']}`", value=spd_bar, inline=True)

        # Habilidade especial
        skill_name = found_data.get("skill", "Ataque BÃ¡sico")
        skill_desc = found_data.get("skill_desc", "Ataque padrÃ£o sem efeito especial.")
        embed.add_field(
            name=f"âœ¨ Habilidade: **{skill_name}**",
            value=f"_{skill_desc}_",
            inline=False
        )

        # Habilidades do tipo de arma
        weapon_type = found_data["type"]
        type_skills = WEAPON_TYPE_SKILLS.get(weapon_type, [])
        if type_skills:
            embed.add_field(
                name=f"ğŸ“š Habilidades de {weapon_type}",
                value=" | ".join([f"`{s}`" for s in type_skills]),
                inline=False
            )

        # Checar se o jogador tem a arma equipada
        equipped = player.get("weapon", "") == found_key
        if equipped:
            embed.add_field(name="âœ… Status", value="**Equipada atualmente**", inline=True)
        embed.set_footer(text=f"Use 'equipar {found_key}' para equipÃ¡-la | Ferreiro pode aprimorÃ¡-la")
        await message.channel.send(embed=embed)
        return

    # ===== ESCRIBA: COLETAR PERGAMINHO =====
    elif content in ["coletar pergaminho", "procurar pergaminho", "buscar pergaminho"]:
        player = get_player(uid)
        if not player:
            return
        if player.get("job") != "Escriba":
            await message.channel.send("ğŸ“œ Apenas **Escribas** podem coletar pergaminhos especiais!\nUse `procurar emprego` e escolha Escriba.")
            return
        import time
        last_scroll = player.get("last_scroll_collect", 0)
        now2 = int(time.time())
        if now2 - last_scroll < 3600:
            mins_left = (3600 - (now2 - last_scroll)) // 60
            await message.channel.send(f"â³ VocÃª jÃ¡ coletou um pergaminho recentemente! PrÃ³xima coleta em **{mins_left} minutos**.")
            return
        # NÃ­vel do escriba
        job_works = player.get("job_works", {})
        jwork = job_works.get("Escriba", 0)
        jd_escriba = JOBS["Escriba"]
        job_levels = jd_escriba.get("levels", {})
        job_level = 1
        for lvl_num in sorted(job_levels.keys(), reverse=True):
            if jwork >= job_levels[lvl_num].get("req_work", 0):
                job_level = lvl_num
                break
        lvl_data = job_levels.get(job_level, {})
        scrolls_per_day = lvl_data.get("scrolls_per_day", 1)

        scrolls_pool = [
            {"name": "ğŸ“œ Pergaminho de Sabedoria Antiga", "xp": 500, "rarity": "Incomum"},
            {"name": "ğŸ“œ Pergaminho de Rota Perdida",     "xp": 400, "rarity": "Incomum"},
            {"name": "ğŸ“œ Pergaminho de FeitiÃ§os Arcanos", "xp": 600, "rarity": "Raro"},
            {"name": "ğŸ“œ Pergaminho de BestiÃ¡rio",        "xp": 350, "rarity": "Comum"},
            {"name": "ğŸ“œ Pergaminho de Lore Proibido",    "xp": 800, "rarity": "Ã‰pico"},
            {"name": "ğŸ“œ Pergaminho de Mapa Ã‰lfico",      "xp": 700, "rarity": "Raro"},
            {"name": "ğŸ“œ Pergaminho de CrÃ´nicas Reais",   "xp": 550, "rarity": "Incomum"},
            {"name": "ğŸ“œ Pergaminho de Rituais Antigos",  "xp": 900, "rarity": "Ã‰pico"},
        ]

        collected = []
        inv = player.get("inventory", [])
        for _ in range(scrolls_per_day):
            scroll = random.choice(scrolls_pool)
            if scroll["rarity"] == "Ã‰pico" and random.random() > 0.3:
                scroll = random.choice(scrolls_pool[:4])
            collected.append(scroll)
            inv.append({"name": scroll["name"], "type": "scroll", "qty": 1})
            add_xp(uid, scroll["xp"])

        player["last_scroll_collect"] = now2
        player["inventory"] = inv
        save_player_db(uid, player)

        embed = discord.Embed(
            title="ğŸ“œ Coleta de Pergaminhos!",
            description=f"*VocÃª vasculha arquivos, ruÃ­nas e bibliotecas em busca de conhecimento perdido...*",
            color=discord.Color.gold()
        )
        for sc in collected:
            embed.add_field(name=sc["name"], value=f"Raridade: **{sc['rarity']}** | +{sc['xp']} XP", inline=True)
        embed.set_footer(text=f"NÃ­vel Escriba: {job_level}/3 | Coletas por dia: {scrolls_per_day} | PrÃ³xima em 1h")
        await message.channel.send(embed=embed)
        return

    # ===== ESCRIBA: REGISTRAR FALA DE NPC =====
    elif content.startswith("registrar npc "):
        player = get_player(uid)
        if not player:
            return
        if player.get("job") != "Escriba":
            await message.channel.send("ğŸ“œ Apenas **Escribas** podem registrar falas de NPCs!\nUse `procurar emprego` e escolha Escriba.")
            return
        # Verificar nÃ­vel mÃ­nimo 2
        job_works = player.get("job_works", {})
        jwork = job_works.get("Escriba", 0)
        if jwork < 20:
            await message.channel.send(f"ğŸ“œ VocÃª precisa ser **Escriba Erudito** (20 trabalhos) para registrar falas!\nProgresso: `{jwork}/20` trabalhos.")
            return
        rest = content[14:].strip()
        parts = rest.split(" ", 1)
        if len(parts) < 2:
            await message.channel.send("ğŸ“œ Uso: `registrar npc [nome_do_npc] [fala]`\nExemplo: `registrar npc Mago_AnciÃ£o A sabedoria vem com o tempo.`")
            return
        npc_name = parts[0].replace("_", " ")
        fala = parts[1]
        # Armazenar na biblioteca do jogador
        biblioteca = player.get("biblioteca", {})
        npc_logs = biblioteca.get("npc_logs", [])
        npc_logs.append({"npc": npc_name, "fala": fala, "data": __import__("datetime").datetime.now().strftime("%d/%m/%Y")})
        if len(npc_logs) > 50:
            npc_logs = npc_logs[-50:]
        biblioteca["npc_logs"] = npc_logs
        player["biblioteca"] = biblioteca
        save_player_db(uid, player)
        xp_bonus = random.randint(100, 300)
        add_xp(uid, xp_bonus)
        await message.channel.send(
            embed=discord.Embed(
                title="âœï¸ Fala Registrada!",
                description=f"**{npc_name}** disse:\n*\"{fala}\"*\n\n+{xp_bonus} XP pela sua dedicaÃ§Ã£o ao conhecimento!",
                color=discord.Color.blue()
            ).set_footer(text="Use 'ver biblioteca' para consultar seus registros")
        )
        return

    # ===== ESCRIBA: ARMAZENAR LIVRO =====
    elif content.startswith("armazenar livro "):
        player = get_player(uid)
        if not player:
            return
        if player.get("job") != "Escriba":
            await message.channel.send("ğŸ“š Apenas **Escribas** podem armazenar livros!\nUse `procurar emprego` e escolha Escriba.")
            return
        book_name = content[16:].strip()
        if not book_name:
            await message.channel.send("ğŸ“š Uso: `armazenar livro [nome do livro]`")
            return
        # Verificar capacidade
        job_works = player.get("job_works", {})
        jwork = job_works.get("Escriba", 0)
        jd_e = JOBS["Escriba"]
        jl = 1
        for ln in sorted(jd_e["levels"].keys(), reverse=True):
            if jwork >= jd_e["levels"][ln].get("req_work", 0):
                jl = ln
                break
        max_books = jd_e["levels"][jl].get("max_books", 10)
        biblioteca = player.get("biblioteca", {})
        livros = biblioteca.get("livros", [])
        if len(livros) >= max_books:
            await message.channel.send(f"ğŸ“š Sua biblioteca estÃ¡ cheia! ({len(livros)}/{max_books} livros)\nEvoluir para o prÃ³ximo nÃ­vel de Escriba para expandir a capacidade!")
            return
        livros.append({"nome": book_name, "data": __import__("datetime").datetime.now().strftime("%d/%m/%Y")})
        biblioteca["livros"] = livros
        player["biblioteca"] = biblioteca
        save_player_db(uid, player)
        xp_bonus = random.randint(50, 150)
        add_xp(uid, xp_bonus)
        await message.channel.send(
            embed=discord.Embed(
                title="ğŸ“š Livro Armazenado!",
                description=f"**{book_name}** foi adicionado Ã  sua biblioteca!\n\n+{xp_bonus} XP\nğŸ“– Livros: `{len(livros)}/{max_books}`",
                color=discord.Color.orange()
            ).set_footer(text="Use 'ver biblioteca' para consultar seus livros")
        )
        return

    # ===== ESCRIBA: VER BIBLIOTECA =====
    elif content in ["ver biblioteca", "minha biblioteca", "biblioteca"]:
        player = get_player(uid)
        if not player:
            return
        if player.get("job") != "Escriba":
            await message.channel.send("ğŸ“š Apenas **Escribas** possuem biblioteca pessoal!")
            return
        biblioteca = player.get("biblioteca", {})
        livros = biblioteca.get("livros", [])
        npc_logs = biblioteca.get("npc_logs", [])
        inv = player.get("inventory", [])
        scrolls = [i for i in inv if isinstance(i, dict) and i.get("type") == "scroll"]

        embed = discord.Embed(
            title=f"ğŸ“š Biblioteca de {message.author.display_name}",
            description="*Seus registros do conhecimento do mundo...*",
            color=discord.Color.from_rgb(180, 120, 60)
        )
        # Livros
        if livros:
            livros_txt = "\n".join([f"ğŸ“– **{l['nome']}** _(adicionado: {l['data']})_" for l in livros[-10:]])
            if len(livros) > 10:
                livros_txt += f"\n*...e mais {len(livros)-10} livros*"
            embed.add_field(name=f"ğŸ“š Livros ({len(livros)})", value=livros_txt, inline=False)
        else:
            embed.add_field(name="ğŸ“š Livros (0)", value="*Nenhum livro armazenado. Use `armazenar livro [nome]`*", inline=False)

        # Pergaminhos
        if scrolls:
            sc_txt = "\n".join([f"ğŸ“œ {s['name']}" for s in scrolls[-8:]])
            embed.add_field(name=f"ğŸ“œ Pergaminhos ({len(scrolls)})", value=sc_txt, inline=False)
        else:
            embed.add_field(name="ğŸ“œ Pergaminhos (0)", value="*Nenhum. Use `coletar pergaminho`*", inline=False)

        # Logs de NPC
        if npc_logs:
            logs_txt = "\n".join([f"ğŸ’¬ **{l['npc']}**: _{l['fala'][:50]}..._" if len(l['fala']) > 50 else f"ğŸ’¬ **{l['npc']}**: _{l['fala']}_" for l in npc_logs[-5:]])
            embed.add_field(name=f"ğŸ—£ï¸ Falas de NPCs ({len(npc_logs)})", value=logs_txt, inline=False)
        else:
            embed.add_field(name="ğŸ—£ï¸ Falas de NPCs (0)", value="*Nenhuma. Use `registrar npc [nome] [fala]`*", inline=False)

        embed.set_footer(text="Comandos: 'armazenar livro [nome]' | 'coletar pergaminho' | 'registrar npc [nome] [fala]'")
        await message.channel.send(embed=embed)
        return

    # ===== VER NÃVEL DO EMPREGO =====
    elif content in ["nivel emprego", "nÃ­vel emprego", "ver nÃ­vel emprego", "ver nivel emprego", "cargo", "meu cargo"]:
        player = get_player(uid)
        if not player:
            return
        job = player.get("job")
        if not job or job not in JOBS:
            await message.channel.send("ğŸ’¼ VocÃª nÃ£o tem emprego! Use `procurar emprego`.")
            return
        jd = JOBS[job]
        job_works = player.get("job_works", {})
        job_work_count = job_works.get(job, 0)
        job_levels = jd.get("levels", {})
        job_level = 1
        for lvl_num in sorted(job_levels.keys(), reverse=True):
            if job_work_count >= job_levels[lvl_num].get("req_work", 0):
                job_level = lvl_num
                break
        lvl_data = job_levels.get(job_level, {})

        embed = discord.Embed(
            title=f"{jd['emoji']} {lvl_data.get('name', job)} â€” NÃ­vel {job_level}/3",
            description=jd["description"],
            color=discord.Color.gold()
        )
        embed.add_field(name="ğŸ“‹ Cargo Atual", value=f"**{lvl_data.get('name', job)}** (NÃ­vel {job_level}/3)", inline=True)
        embed.add_field(name="ğŸ”¨ Trabalhos Realizados", value=f"`{job_work_count}`", inline=True)
        embed.add_field(name="âœ¨ BÃ´nus Atual", value=lvl_data.get("bonus", "Sem bÃ´nus"), inline=False)

        # PrÃ³ximo nÃ­vel
        for i in range(1, 4):
            lvl_info = job_levels.get(i, {})
            req = lvl_info.get("req_work", 0)
            status = "âœ…" if job_work_count >= req else ("ğŸ”„" if i == job_level else "ğŸ”’")
            embed.add_field(
                name=f"{status} NÃ­vel {i}: {lvl_info.get('name', '?')}",
                value=f"BÃ´nus: _{lvl_info.get('bonus', '?')}_\nRequer: `{req}` trabalhos",
                inline=False
            )
        embed.set_footer(text=f"Use 'trabalhar' para avanÃ§ar no cargo! SalÃ¡rio x{lvl_data.get('salary_mult', 1.0):.1f}")
        await message.channel.send(embed=embed)
        return

    # ===== DEFENDER CIDADE (Cavaleiro/Guarda/Rei) =====
    elif content in ["defender cidade", "patrulhar", "defender reino", "modo defesa"]:
        import time
        player = get_player(uid)
        if not player:
            return
        job = player.get("job")
        title = player.get("city_title")
        has_defense_role = job in ["Cavaleiro", "Guarda_Real", "Rei"] or title in ["Cavaleiro", "Rei"]
        if not has_defense_role:
            await message.channel.send(
                "âš”ï¸ Apenas **Cavaleiros**, **Guardas Reais** e **Reis** podem defender a cidade!\n"
                "Use `procurar emprego` para se tornar um cavaleiro (requer nÃ­vel 10)."
            )
            return
        last_defend = player.get("last_defend", 0)
        now = int(time.time())
        if now - last_defend < 3600:
            remaining = (3600 - (now - last_defend)) // 60
            await message.channel.send(f"â³ VocÃª jÃ¡ patrulhou! PrÃ³xima defesa em **{remaining} minutos**.")
            return
        world_key = max(k for k in player.get("worlds", [1]))
        world_invasions = CITY_INVASION_EVENTS.get(world_key, CITY_INVASION_EVENTS.get(1, []))
        invasion = random.choice(world_invasions)
        player["last_defend"] = now
        save_player_db(uid, player)
        jd = JOBS.get(job, JOBS.get("Cavaleiro", {}))
        embed = discord.Embed(
            title=f"ğŸš¨ INVASÃƒO! â€” {invasion['title']}",
            description=f"*{invasion['description']}*\n\n"
                        f"ğŸ‘¹ Inimigo: **{invasion['enemy']}** Ã—{invasion['enemy_count']}\n"
                        f"ğŸ’ª Min. defensores: **{invasion['min_defenders']}**",
            color=discord.Color.red()
        )
        embed.add_field(name="â­ Recompensa", value=f"`+{invasion['xp_reward']} XP` | `+{invasion['coins_reward']} coins`", inline=True)
        embed.add_field(
            name="ğŸ’¡ Como agir",
            value="Escolha sua estratÃ©gia abaixo!\nUse **ğŸ“¯ Convocar Aliados** para chamar outros jogadores.",
            inline=False
        )
        embed.set_footer(text=f"Defensor: {message.author.display_name} | {jd.get('emoji','âš”ï¸')} {job}")
        view = CityDefenseView(uid, invasion, message.channel, message.guild)
        await message.channel.send(embed=embed, view=view)

    elif content in ["ajudar defesa", "defender junto", "entrar defesa"]:
        await message.channel.send(
            embed=discord.Embed(
                title="âš”ï¸ ProntidÃ£o para Defesa",
                description=f"**{message.author.display_name}** estÃ¡ pronto para defender!\nAguardando convocaÃ§Ã£o ativa de um Cavaleiro ou Rei.",
                color=discord.Color.blue()
            )
        )

    # ===== NOMEAR CAVALEIRO (sÃ³ Rei) =====
    elif content.startswith("nomear cavaleiro ") or content.startswith("nomear guerreiro "):
        player = get_player(uid)
        if not player:
            return
        if player.get("job") != "Rei" and player.get("city_title") != "Rei":
            await message.channel.send("ğŸ‘‘ Apenas o **Rei** pode nomear cavaleiros!")
            return
        mentions = message.mentions
        if not mentions:
            await message.channel.send("âŒ Mencione o jogador: `nomear cavaleiro @usuario`")
            return
        target = mentions[0]
        tplayer = get_player(str(target.id))
        if not tplayer:
            await message.channel.send("âŒ Esse jogador ainda nÃ£o comeÃ§ou sua jornada!")
            return
        embed = discord.Embed(
            title="âš”ï¸ CerimÃ´nia de NomeaÃ§Ã£o",
            description=f"**{message.author.display_name}** deseja nomear **{target.display_name}** como **Cavaleiro do Reino**!\n\n{target.mention}, vocÃª aceita a responsabilidade?",
            color=discord.Color.gold()
        )
        view = NomearCavaleiroView(uid, target)
        await message.channel.send(embed=embed, view=view)

    # ===== TORNAR-SE REI =====
    elif content in ["me tornar rei", "quero ser rei", "proclamar rei", "assumir trono"]:
        player = get_player(uid)
        if not player:
            return
        if player["level"] < 30:
            await message.channel.send(f"ğŸ‘‘ VocÃª precisa ser **nÃ­vel 30** para assumir um trono!\nNÃ­vel atual: **{player['level']}**")
            return
        if player.get("job") == "Rei":
            await message.channel.send("ğŸ‘‘ VocÃª **jÃ¡ Ã©** Rei! Governe com sabedoria.")
            return
        embed = discord.Embed(
            title="ğŸ‘‘ PROCLAMAÃ‡ÃƒO REAL",
            description=f"*{message.author.display_name} ergue a espada diante do povo reunido...*\n\n"
                        f"Tornar-se Rei significa:\n"
                        f"â€¢ Responsabilidade por **defender a cidade**\n"
                        f"â€¢ Receber **tributo diÃ¡rio** de coins\n"
                        f"â€¢ Poder **nomear cavaleiros** com `nomear cavaleiro @user`\n"
                        f"â€¢ Receber **alertas de invasÃ£o** em primeira mÃ£o\n\n"
                        f"âš ï¸ Requer: NÃ­vel 30+ e dedicaÃ§Ã£o!",
            color=discord.Color.gold()
        )
        confirm_view = discord.ui.View(timeout=30)
        yes_btn = discord.ui.Button(label="ğŸ‘‘ Assumir o Trono", style=discord.ButtonStyle.success)
        no_btn = discord.ui.Button(label="âŒ Recusar", style=discord.ButtonStyle.secondary)

        async def yes_cb(interaction: discord.Interaction):
            if str(interaction.user.id) != uid:
                return await interaction.response.send_message("âŒ NÃ£o Ã© vocÃª!", ephemeral=True)
            p = get_player(uid)
            old_job = p.get("job")
            p["job"] = "Rei"
            p["city_title"] = "Rei"
            p["job_since"] = int(__import__("time").time())
            save_player_db(uid, p)
            crown_embed = discord.Embed(
                title="ğŸ‘‘ LONGA VIDA AO REI!",
                description=f"*O povo ajoelha enquanto a coroa pousa na cabeÃ§a de **{interaction.user.display_name}**!*\n\n"
                            f"Que seu reino seja prÃ³spero e justo!",
                color=discord.Color.gold()
            )
            crown_embed.add_field(name="ğŸ“œ Seus poderes", value="Use `trabalhar` | `defender cidade` | `nomear cavaleiro @user` | `ver emprego`", inline=False)
            for item in confirm_view.children:
                item.disabled = True
            await interaction.response.edit_message(embed=crown_embed, view=confirm_view)

        async def no_cb(interaction: discord.Interaction):
            if str(interaction.user.id) != uid:
                return
            for item in confirm_view.children:
                item.disabled = True
            await interaction.response.edit_message(content="*O trono aguarda outro dia.*", embed=None, view=confirm_view)

        yes_btn.callback = yes_cb
        no_btn.callback = no_cb
        confirm_view.add_item(yes_btn)
        confirm_view.add_item(no_btn)
        await message.channel.send(embed=embed, view=confirm_view)

    # ===== ENCONTRAR BOSS (boss variado por mundo) =====
    elif content in ["encontrar boss", "procurar boss", "buscar boss", "caÃ§ar boss", "boss do reino"]:
        player = get_player(uid)
        if not player:
            await message.channel.send("âŒ Crie seu personagem primeiro!")
            return
        if not player.get("class"):
            await message.channel.send("âš ï¸ Escolha uma classe primeiro! Use: `escolher classe`")
            return
        # encontrar boss NUNCA mostra bosses de level â€” apenas variantes do mundo
        # Bosses de level (9/19/29/39/49/59) sÃ³ aparecem via check_level_boss/desafiar boss
        boss_gate_levels = {9, 19, 29, 39, 49, 59, 69, 79, 89, 99, 109, 119, 129, 139, 149, 159, 169, 179, 189, 199, 209, 219, 229, 239, 249, 259, 269, 279, 289, 299, 309, 319, 329, 339, 349, 359, 369, 379, 389, 399, 409, 419, 429, 439, 449, 459, 469, 479, 489, 499, 509, 519, 529, 539, 549, 559, 569, 579, 589, 599}
        if player["level"] in boss_gate_levels:
            boss_data_gate = get_level_boss(player["level"])
            if boss_data_gate and boss_data_gate["name"] not in player.get("bosses", []):
                await message.channel.send(
                    f"ğŸš¨ **VocÃª tem um Boss de NÃ­vel pendente!**\n\nğŸ‘¹ **{boss_data_gate['name']}** bloqueia sua passagem.\nâš ï¸ Seu XP estÃ¡ bloqueado atÃ© derrotÃ¡-lo!\n\nUse `desafiar boss` para enfrentÃ¡-lo."
                )
                return
        world_key = max(k for k in player.get("worlds", [1]))
        boss_pool = WORLD_BOSSES_VARIANTS.get(world_key, WORLD_BOSSES_VARIANTS.get(1, []))
        boss = random.choice(boss_pool)
        world_info = MAP_LOCATIONS.get(world_key, {})
        world_name = world_info.get("world_name", "este reino")
        intro_msgs = [
            "ğŸŒ‘ O ar fica pesado de magia maligna...",
            "âš¡ Um trovÃ£o ecoa sem nuvens no cÃ©u...",
            "ğŸ’€ A temperatura cai dez graus de repente...",
            "ğŸ‘ï¸ VocÃª sente que estÃ¡ sendo observado hÃ¡ minutos...",
            "ğŸ”¥ O chÃ£o treme levemente sob seus pÃ©s...",
        ]
        embed = discord.Embed(
            title=f"âš ï¸ BOSS ENCONTRADO â€” {world_name}",
            description=f"*{random.choice(intro_msgs)}*\n\n{boss['intro']}",
            color=discord.Color.dark_red()
        )
        embed.add_field(name="ğŸ‘¹ Boss", value=f"**{boss['name']}**", inline=True)
        embed.add_field(name="â¤ï¸ HP", value=f"`{boss['hp']:,}`", inline=True)
        embed.add_field(name="âš”ï¸ ATK", value=f"`{boss['atk']}`", inline=True)
        embed.add_field(name="â­ XP", value=f"`{boss['xp']:,}`", inline=True)
        embed.add_field(name="ğŸ’° Coins", value=f"`{boss['coins'][0]}â€“{boss['coins'][1]}`", inline=True)
        embed.add_field(name="ğŸ“– Lore", value=f"_{boss['desc']}_", inline=False)
        embed.set_footer(text="Use os botÃµes para lutar, chamar aliados ou fugir!")
        view = BossButton(uid, boss["name"])
        # Passar os dados do boss customizado para a batalha
        # Armazenar no player para a fight_boss poder pegar
        player2 = get_player(uid)
        effects = player2.get("active_effects", {})
        effects["pending_boss"] = boss
        player2["active_effects"] = effects
        save_player_db(uid, player2)
        await message.channel.send(embed=embed, view=view)


# ================= MODIFICAR MINERAR PARA INCLUIR MIMIC CHEST =================
# (Hook aplicado no on_message principal â€” ver abaixo)

@bot.listen("on_message")
async def handle_mining_mimic(message):
    if message.author.bot:
        return
    if message.channel.name != CANAL_BETA and message.channel.id not in MUNDO_PROPRIO_CHANNELS.values():
        return
    content = message.content.lower().strip()
    uid = str(message.author.id)

    if content in ["minerar baÃº", "minerar bau", "abrir bau", "abrir baÃº", "bau secreto", "baÃº secreto"]:
        player = get_player(uid)
        if not player:
            await message.channel.send("âŒ Crie seu personagem primeiro!")
            return
        world_key = max(k for k in player.get("worlds", [1]))
        # NÃ­vel do baÃº baseado no nÃ­vel do mundo
        tier_idx = min(len(MIMIC_TIERS) - 1, list(MAP_LOCATIONS.keys()).index(world_key) if world_key in MAP_LOCATIONS else 0)
        tier = MIMIC_TIERS[tier_idx]
        embed = discord.Embed(
            title=f"ğŸ”® BaÃº Encontrado! â€” {tier['emoji']} {tier['name']}",
            description=(
                f"*Enquanto minerava, vocÃª encontrou um baÃº misterioso...*\n\n"
                f"**Chance de ser Mimic:** `{int(tier['mimic_chance']*100)}%`\n"
                f"**XP potencial:** `{tier['loot_xp'][0]}â€“{tier['loot_xp'][1]}`\n"
                f"**Coins potenciais:** `{tier['loot_coins'][0]}â€“{tier['loot_coins'][1]}`\n\n"
                f"âš ï¸ *Mimics podem te atacar e roubar XP! VocÃª abre sabendo do risco?*"
            ),
            color=discord.Color.dark_gold()
        )
        view = MimicChestView(uid, tier_idx, world_key)
        await message.channel.send(embed=embed, view=view)


# ================= MODIFICAR EXPLORAR PARA DESCOBRIR LOCAIS =================
@bot.listen("on_message")
async def handle_map_discovery(message):
    """Ao explorar, hÃ¡ chance de descobrir novo local no mapa"""
    if message.author.bot:
        return
    if message.channel.name != CANAL_BETA and message.channel.id not in MUNDO_PROPRIO_CHANNELS.values():
        return
    content = message.content.lower().strip()
    uid = str(message.author.id)

    if content in ["explorar", "explorar regiÃ£o", "explorar regiao"]:
        # Este listener sÃ³ faz a descoberta de local â€” o explorar principal continua normalmente
        await asyncio.sleep(0.5)  # leve delay para nÃ£o conflitar
        player = get_player(uid)
        if not player:
            return
        if random.random() < 0.20:  # 20% de chance de descobrir algo
            world_key = max(k for k in player.get("worlds", [1]))
            world_locs = MAP_LOCATIONS.get(world_key, {}).get("locations", [])
            disc = player.get("discovered_map", {})
            key = str(world_key)
            known = disc.get(key, [])
            unknown = [l for l in world_locs if not l["discovered"] and l["id"] not in known]
            if unknown:
                new_loc = random.choice(unknown)
                discover_location(uid, world_key, new_loc["id"])
                type_icons = {
                    "cidade": "ğŸ™ï¸", "recurso": "â›ï¸", "dungeon": "ğŸ•³ï¸", "dungeon_secreta": "ğŸ”®",
                    "boss_local": "ğŸ’€", "lore": "ğŸ“œ", "loja": "ğŸª", "crafting": "âš’ï¸",
                    "portal": "ğŸŒ€", "evento_especial": "â­", "npc_especial": "ğŸ§™"
                }
                icon = type_icons.get(new_loc["type"], "ğŸ“")
                await message.channel.send(
                    embed=discord.Embed(
                        title=f"ğŸ—ºï¸ Novo Local Descoberto!",
                        description=f"{icon} **{new_loc['name']}** foi adicionado ao seu mapa!\nUse `abrir mapa` para ver.",
                        color=discord.Color.teal()
                    )
                )

# ================= MASMORRAS SECRETAS MAIS DIFÃCEIS =================
# A funÃ§Ã£o explore_dungeon jÃ¡ existe â€” vamos sobrecarregar o XP e dificuldade

@bot.listen("on_message")
async def handle_npc_lore(message):
    """NPCs extras que contam lore"""
    if message.author.bot:
        return
    if message.channel.name != CANAL_BETA and message.channel.id not in MUNDO_PROPRIO_CHANNELS.values():
        return
    content = message.content.lower().strip()
    uid = str(message.author.id)

    if content in ["falar npc especial", "conversar npc especial", "npc lore", "falar lore npc"]:
        player = get_player(uid)
        if not player:
            return
        world_key = max(k for k in player.get("worlds", [1]))
        npc_pool = WORLD_NPCS_EXTRA.get(world_key, WORLD_NPCS_EXTRA.get(1, []))
        if not npc_pool:
            await message.channel.send("ğŸ¤· Nenhum NPC especial aqui.")
            return
        npc = random.choice(npc_pool)
        dialogue = random.choice(npc["dialogues"])
        embed = discord.Embed(
            title=f"{npc['emoji']} {npc['name']} â€” _{npc['role']}_",
            description=f'*"{dialogue}"*',
            color=discord.Color.purple()
        )
        embed.set_footer(text=f"Fale novamente para ouvir mais histÃ³rias deste NPC.")
        await message.channel.send(embed=embed)




# ================= FARM AFK =================
@bot.listen("on_message")
async def handle_afk_farm(message):
    if message.author.bot:
        return
    if message.channel.name != CANAL_BETA and message.channel.id not in MUNDO_PROPRIO_CHANNELS.values():
        return
    content = message.content.lower().strip()
    uid = str(message.author.id)

    if content in ["farm afk", "iniciar afk", "afk", "modo afk"]:
        player = get_player(uid)
        if not player:
            await message.channel.send("âŒ Crie seu personagem primeiro!")
            return
        if player.get("afk_farming"):
            # Coletar XP acumulado
            elapsed = int(time.time()) - player.get("afk_start", int(time.time()))
            minutes = elapsed // 60
            # 1 XP por minuto (bem pouco, como pedido)
            xp_earned = max(1, min(minutes * 1, 200))  # mÃ¡x 200 XP por sessÃ£o
            player["afk_farming"] = 0
            player["afk_start"] = 0
            leveled = add_xp(uid, xp_earned, bypass_boss_gate=False)
            save_player_db(uid, player)
            embed = discord.Embed(
                title="â¹ï¸ Farm AFK Encerrado!",
                description=f"*'VocÃª retorna ao mundo apÃ³s um longo descanso...'*\n\n"
                            f"â±ï¸ Tempo farmando: **{minutes} minutos**\n"
                            f"â­ XP Ganho: **+{xp_earned}**",
                color=discord.Color.blue()
            )
            if leveled:
                p2 = get_player(uid)
                embed.add_field(name="ğŸ†™ Level Up!", value=f"**NÃ­vel {p2['level']}**", inline=False)
            embed.set_footer(text="Use 'farm afk' novamente para comeÃ§ar nova sessÃ£o.")
            await message.channel.send(embed=embed)
        else:
            player["afk_farming"] = 1
            player["afk_start"] = int(time.time())
            save_player_db(uid, player)
            await message.channel.send(
                f"ğŸŒ™ **{message.author.mention}** entrou em modo **Farm AFK**!\n\n"
                f"*VocÃª estÃ¡ treinando enquanto ausente...*\n"
                f"â­ VocÃª ganharÃ¡ **~1 XP por minuto** (mÃ¡x 200 XP).\n\n"
                f"Use `farm afk` novamente ao voltar para coletar o XP ganho!"
            )

    elif content in ["ver clima", "clima", "tempo", "clima atual"]:
        weather = CURRENT_WEATHER
        wdata = WEATHER_TYPES.get(weather["type"], WEATHER_TYPES["sol"])
        embed = discord.Embed(
            title=f"{wdata['emoji']} Clima Atual: {wdata['name']}",
            description=wdata["desc"],
            color=discord.Color.blue() if weather["type"] != "lua_sangue" else discord.Color.red()
        )
        if wdata.get("special_monsters"):
            embed.add_field(
                name="ğŸ‘¹ Criaturas Especiais Ativas",
                value=" | ".join(wdata["special_monsters"]),
                inline=False
            )
        embed.add_field(name="âš”ï¸ Boost Monstros", value=f"Ã—{wdata['monster_boost']}", inline=True)
        embed.add_field(name="ğŸ Boost Drops", value=f"Ã—{wdata['drop_boost']}", inline=True)
        embed.set_footer(text="O clima muda a cada 30 minutos. Lua de Sangue Ã© rara mas muito recompensadora!")
        await message.channel.send(embed=embed)


# ================= PET EVOLUTION =================
@bot.listen("on_message")
async def handle_pet_evolution(message):
    if message.author.bot:
        return
    if message.channel.name != CANAL_BETA and message.channel.id not in MUNDO_PROPRIO_CHANNELS.values():
        return
    content = message.content.lower().strip()
    uid = str(message.author.id)

    if content in ["evoluir pet", "evoluir meu pet", "evoluÃ§Ã£o pet"]:
        player = get_player(uid)
        if not player or not player.get("pet"):
            await message.channel.send("âŒ VocÃª nÃ£o tem um pet ativo! Use `procurar pet` ou `domesticar`.")
            return

        pet_name = player["pet"]
        if isinstance(pet_name, dict):
            pet_name = pet_name.get("name", "")

        evo_data = PET_EVOLUTIONS.get(pet_name)
        if not evo_data:
            await message.channel.send(f"ğŸ˜” **{pet_name}** nÃ£o tem evoluÃ§Ã£o disponÃ­vel ainda (ou jÃ¡ Ã© a forma final).")
            return

        if player["level"] < evo_data["level_required"]:
            await message.channel.send(
                f"âŒ **{pet_name}** precisa que vocÃª seja **NÃ­vel {evo_data['level_required']}** para evoluir!\n"
                f"Seu nÃ­vel atual: **{player['level']}**"
            )
            return

        # Evoluir!
        next_pet = evo_data["next_data"]
        player["pet"] = next_pet["name"]
        save_player_db(uid, player)

        embed = discord.Embed(
            title="â­ EVOLUÃ‡ÃƒO DO PET! â­",
            description=f"*'Uma luz intensa envolve {pet_name}...'*\n\n"
                        f"ğŸ¥š **{pet_name}** â†’ {next_pet['emoji']} **{next_pet['name']}**!\n\n"
                        f"*'Seu companheiro se tornou mais forte!'*",
            color=discord.Color.gold()
        )
        embed.add_field(name="ğŸ’ª Novo ATK BÃ´nus", value=f"+{next_pet['bonus_atk']}", inline=True)
        embed.add_field(name="â¤ï¸ Novo HP BÃ´nus", value=f"+{next_pet['bonus_hp']}", inline=True)
        embed.add_field(name="âœ¨ Raridade", value=f"{RARITIES[next_pet['rarity']]['emoji']} {next_pet['rarity']}", inline=True)
        await message.channel.send(embed=embed)

    elif content in ["ver fazenda", "meus pets", "todos pets", "pets"]:
        player = get_player(uid)
        if not player:
            return
        pets_list = player.get("pets_list", [])
        farm = player.get("pet_farm", [])
        # Combine both lists for display
        all_pets_farm = pets_list + farm
        active = player.get("pet")

        embed = discord.Embed(
            title="ğŸ¾ Sua Fazenda de Pets",
            description=f"Pets na fazenda: **{len(all_pets_farm)}/15**",
            color=discord.Color.green()
        )
        if active:
            aname = active if isinstance(active, str) else active.get("name", "?")
            # Find pet data
            pet_obj = None
            for world_pets in PETS.values():
                for p in world_pets:
                    if p["name"] == aname:
                        pet_obj = p
                        break
            if pet_obj:
                evo_info = PET_EVOLUTIONS.get(aname)
                evo_text = f"\nğŸ”„ PrÃ³x. evo: **{evo_info['next']}** (Nv. {evo_info['level_required']})" if evo_info else "\nâœ¨ Forma final!"
                embed.add_field(
                    name=f"â­ Pet Ativo: {pet_obj['emoji']} {aname}",
                    value=f"{RARITIES[pet_obj['rarity']]['emoji']} {pet_obj['rarity']} | +{pet_obj['bonus_atk']} ATK | +{pet_obj['bonus_hp']} HP{evo_text}",
                    inline=False
                )
            else:
                embed.add_field(name="â­ Pet Ativo", value=aname, inline=False)
        else:
            embed.add_field(name="â­ Pet Ativo", value="_Nenhum_", inline=False)

        if all_pets_farm:
            farm_lines = []
            for i, p in enumerate(all_pets_farm[:15]):
                pname = p.get("name", "?")
                pemoji = p.get("emoji", "ğŸ¾")
                prarity = p.get("rarity", "?")
                batk = p.get("bonus_atk", 0)
                bhp = p.get("bonus_hp", 0)
                farm_lines.append(f"`{i+1}.` {pemoji} **{pname}** [{prarity}] +{batk}ATK/+{bhp}HP")
            embed.add_field(name="ğŸŒ¾ Pets na Fazenda", value="\n".join(farm_lines), inline=False)
        else:
            embed.add_field(name="ğŸŒ¾ Fazenda", value="_Vazia! Use `domesticar` para capturar mais pets._", inline=False)

        embed.set_footer(text="Use 'trocar pet [nome]' para definir ativo | 'evoluir pet' para evoluir | 'trocar pet @user [nome]' para trocar")
        await message.channel.send(embed=embed)

    elif content.startswith("trocar pet") and "@" in content:
        # Pet trading between players
        player = get_player(uid)
        if not player:
            return
        parts = content.split()
        # Format: trocar pet @user [nome do pet]
        target_mention = None
        pet_name_parts = []
        for part in parts[2:]:
            if part.startswith("<@"):
                target_mention = part
            else:
                pet_name_parts.append(part)

        if not target_mention or not pet_name_parts:
            await message.channel.send("âŒ Uso: `trocar pet @usuario [nome do pet]`")
            return

        target_id = target_mention.replace("<@", "").replace(">", "").replace("!", "")
        target_player = get_player(target_id)
        if not target_player:
            await message.channel.send("âŒ Jogador alvo nÃ£o encontrado!")
            return

        pet_name = " ".join(pet_name_parts).title()
        pets_list = player.get("pets_list", [])
        farm = player.get("pet_farm", [])

        # Find the pet in sender's farm
        found_pet = None
        for p in pets_list + farm:
            if p.get("name", "").lower() == pet_name.lower():
                found_pet = p
                break

        if not found_pet:
            await message.channel.send(f"âŒ VocÃª nÃ£o tem **{pet_name}** na sua fazenda!\nUse `ver fazenda` para ver seus pets.")
            return

        # Remove from sender, add to target farm
        if found_pet in pets_list:
            pets_list.remove(found_pet)
            player["pets_list"] = pets_list
        elif found_pet in farm:
            farm.remove(found_pet)
            player["pet_farm"] = farm

        t_pets_list = target_player.get("pets_list", [])
        t_pets_list.append(found_pet)
        target_player["pets_list"] = t_pets_list

        save_player_db(uid, player)
        save_player_db(target_id, target_player)

        await message.channel.send(
            f"ğŸ¤ **{message.author.display_name}** enviou {found_pet.get('emoji','ğŸ¾')} **{found_pet['name']}** "
            f"para <@{target_id}>!\n"
            f"*A amizade une os aventureiros!*"
        )


# ================= SPELL BOOK / LIVRO DE FEITIÃ‡OS =================
@bot.listen("on_message")
async def handle_spell_book(message):
    if message.author.bot:
        return
    if message.channel.name != CANAL_BETA and message.channel.id not in MUNDO_PROPRIO_CHANNELS.values():
        return
    content = message.content.lower().strip()
    uid = str(message.author.id)

    if content in ["livro de feitiÃ§os", "abrir livro de feitiÃ§os", "feitiÃ§os", "ver feitiÃ§os", "spellbook"]:
        player = get_player(uid)
        if not player:
            return

        if player["level"] < 12:
            await message.channel.send(
                f"ğŸ“š **Livro de FeitiÃ§os** â€” Bloqueado!\n\n"
                f"*'VocÃª ainda nÃ£o tem poder suficiente para acessar as artes arcanas...'*\n"
                f"Desbloqueie ao atingir o **NÃ­vel 12**! (Atual: NÃ­vel {player['level']})"
            )
            return

        cls = player.get("class")
        mana_cat = player.get("mana_category", "none")

        # Find current category index
        cat_idx = -1
        for i, cat in enumerate(MANA_CATEGORIES):
            if cat["id"] == mana_cat:
                cat_idx = i
                break

        # Find eligible categories
        unlocked_cats = [cat for cat in MANA_CATEGORIES if player["level"] >= cat["level_req"]]
        current_cat = MANA_CATEGORIES[cat_idx] if cat_idx >= 0 else None

        embed = discord.Embed(
            title="ğŸ“š Livro de FeitiÃ§os",
            description=f"*'O livro brilha com energia arcana incontida...'*\n\n"
                        f"ğŸ­ Classe: **{cls or 'Sem Classe'}**\n"
                        f"ğŸ’ Categoria de Mana: **{current_cat['name'] if current_cat else 'Nenhuma'}**",
            color=discord.Color.purple()
        )

        # Show progression categories
        cat_text = ""
        for cat in MANA_CATEGORIES:
            req = cat["level_req"]
            status = "âœ…" if player["level"] >= req and cat["id"] in [c["id"] for c in unlocked_cats] else f"ğŸ”’ Nv.{req}"
            active = " â—„ ATIVA" if cat["id"] == mana_cat else ""
            cat_text += f"{status} {cat['name']} â€” {cat['desc']}{active}\n"
        embed.add_field(name="ğŸ“Š Categorias de Mana", value=cat_text, inline=False)

        # Show class spells if has category
        if cls and cls in SPELL_BOOK_SKILLS and current_cat:
            class_spells = SPELL_BOOK_SKILLS.get(cls, [])
            spell_list = [s for s in class_spells if s["cat"] == mana_cat]
            if spell_list:
                spell_text = "\n".join([f"â€¢ **{s['name']}** â€” Mana: {s['mana_cost']} | Dano: Ã—{s['dmg_mult']} | {s['desc']}" for s in spell_list])
                embed.add_field(name=f"âœ¨ FeitiÃ§os Desbloqueados ({cls})", value=spell_text, inline=False)

        # Show how to advance
        next_cats = [cat for cat in MANA_CATEGORIES if player["level"] < cat["level_req"]]
        if next_cats:
            nc = next_cats[0]
            embed.add_field(
                name="â¬†ï¸ PrÃ³xima Categoria",
                value=f"{nc['name']} â€” Atinja **NÃ­vel {nc['level_req']}** para desbloquear!",
                inline=False
            )

        embed.set_footer(text="Use 'avanÃ§ar categoria mana' para subir de categoria | 'treinar mana' para aumentar mana mÃ¡xima")
        await message.channel.send(embed=embed)

    elif content in ["avanÃ§ar categoria mana", "subir categoria mana", "avanÃ§ar mana", "upgrade mana"]:
        player = get_player(uid)
        if not player:
            return
        if player["level"] < 12:
            await message.channel.send("âŒ Desbloqueie o Livro de FeitiÃ§os primeiro (NÃ­vel 12)!")
            return

        mana_cat = player.get("mana_category", "none")
        cat_idx = -1
        for i, cat in enumerate(MANA_CATEGORIES):
            if cat["id"] == mana_cat:
                cat_idx = i
                break

        next_idx = cat_idx + 1
        if cat_idx == -1:
            # First unlock - start at goblin
            first_cat = MANA_CATEGORIES[0]
            if player["level"] < first_cat["level_req"]:
                await message.channel.send(f"âŒ Precisa ser NÃ­vel {first_cat['level_req']} para comeÃ§ar!")
                return
            player["mana_category"] = first_cat["id"]
            player["spell_book_unlocked"] = 1
            # Bonus max mana
            player["max_mana"] = player.get("max_mana", 50) + int(20 * first_cat["mana_mult"])
            save_player_db(uid, player)
            await message.channel.send(
                f"ğŸ“š **Livro de FeitiÃ§os Desbloqueado!**\n\n"
                f"VocÃª ingressou na categoria {first_cat['name']}!\n"
                f"ğŸ’ Mana MÃ¡xima aumentada em **+{int(20 * first_cat['mana_mult'])}**!\n"
                f"*Use `ver feitiÃ§os` para ver seus novos poderes!*"
            )
        elif next_idx >= len(MANA_CATEGORIES):
            await message.channel.send("ğŸ† VocÃª jÃ¡ atingiu a categoria mÃ¡xima: **ğŸ’ Supremo**!")
        else:
            next_cat = MANA_CATEGORIES[next_idx]
            if player["level"] < next_cat["level_req"]:
                await message.channel.send(
                    f"âŒ Precisa ser **NÃ­vel {next_cat['level_req']}** para avanÃ§ar para {next_cat['name']}!\n"
                    f"NÃ­vel atual: {player['level']}"
                )
                return
            player["mana_category"] = next_cat["id"]
            bonus_mana = int(15 * next_cat["mana_mult"])
            player["max_mana"] = player.get("max_mana", 50) + bonus_mana
            save_player_db(uid, player)
            await message.channel.send(
                f"â¬†ï¸ **Categoria AvanÃ§ada!**\n\n"
                f"VocÃª agora Ã© **{next_cat['name']}**!\n"
                f"ğŸ’ +{bonus_mana} Mana MÃ¡xima!\n"
                f"*{next_cat['desc']}*"
            )

    elif content.startswith("treinar mana"):
        player = get_player(uid)
        if not player:
            return
        if not player.get("spell_book_unlocked"):
            await message.channel.send("âŒ Desbloqueie o Livro de FeitiÃ§os primeiro! (NÃ­vel 12 + `avanÃ§ar categoria mana`)")
            return

        # Detectar multiplicador
        rest = content[12:].strip()
        multiplier = 1
        for suffix in ["20x", "10x", "5x", "3x", "2x"]:
            if rest == suffix:
                multiplier = int(suffix[:-1])
                break

        # Custo escala com quantidade de treinos de mana
        mana_trained = player.get("mana_training_points", 0)
        tier = min(mana_trained // 10, 5)
        tier_mult = 2 ** tier
        base_cost = 200
        cost_per = base_cost * tier_mult
        total_cost = cost_per * multiplier

        if player["coins"] < total_cost:
            await message.channel.send(
                f"âŒ Treinar mana custa **{total_cost:,} CSI** ({multiplier}Ã— {cost_per:,}). VocÃª tem: {player['coins']:,} CSI.\n"
                f"âš ï¸ *Custo aumenta a cada 10 treinos! Tier {tier+1}/6 (x{tier_mult})*"
            )
            return

        player["coins"] -= total_cost
        mana_boost = 15 * multiplier
        player["max_mana"] = player.get("max_mana", 50) + mana_boost
        player["mana"] = min(player.get("mana", 50) + mana_boost, player["max_mana"])
        player["mana_training_points"] = mana_trained + multiplier
        save_player_db(uid, player)

        mult_txt = f" Ã—{multiplier}" if multiplier > 1 else ""
        await message.channel.send(
            f"ğŸ’ **Treino de Mana{mult_txt} ConcluÃ­do!**\n\n"
            f"âˆ’{total_cost:,} CSI | +{mana_boost} Mana MÃ¡xima\n"
            f"Nova mana mÃ¡xima: **{player['max_mana']}**\n"
            f"Treinos de mana: **{player['mana_training_points']}** | Tier {tier+1}/6\n"
            f"ğŸ’¡ `treinar mana 3x` para treinar 3 vezes de uma vez!"
        )


# ================= KINGDOM SYSTEM =================
@bot.listen("on_message")
async def handle_kingdom(message):
    if message.author.bot:
        return
    if message.channel.name != CANAL_BETA and message.channel.id not in MUNDO_PROPRIO_CHANNELS.values():
        return
    content = message.content.lower().strip()
    uid = str(message.author.id)

    if content in ["meu reino", "ver reino", "status reino", "reino"]:
        player = get_player(uid)
        if not player:
            return
        if player.get("city_title") != "Rei" and "Rei" not in str(player.get("city_title", "")):
            await message.channel.send(
                "ğŸ‘‘ **Sistema de Reinos** â€” Apenas **Reis** podem gerenciar reinos!\n"
                "*Use `me tornar rei` quando atingir os requisitos!*"
            )
            return

        kd = player.get("kingdom_data") or KINGDOM_DEFAULTS.copy()
        kname = kd.get("name") or f"Reino de {message.author.display_name}"

        embed = discord.Embed(
            title=f"ğŸ‘‘ {kname}",
            description=f"*O seu domÃ­nio se estende pelo horizonte...*",
            color=discord.Color.gold()
        )
        def status_icon(s):
            return {"Ruim": "ğŸ”´", "Neutra": "ğŸŸ¡", "Boa": "ğŸŸ¢", "Excelente": "ğŸ’"}.get(s, "âšª")

        embed.add_field(name="ğŸ‘¥ PopulaÃ§Ã£o", value=f"{kd.get('population', 100)} habitantes", inline=True)
        embed.add_field(name=f"ğŸ’° Economia {status_icon(kd.get('economy','Neutra'))}", value=kd.get("economy", "Neutra"), inline=True)
        embed.add_field(name=f"âš”ï¸ ExÃ©rcito {status_icon(kd.get('army','Neutra'))}", value=kd.get("army", "Neutra"), inline=True)
        if kd.get("bio"):
            embed.add_field(name="ğŸ“œ DescriÃ§Ã£o", value=kd["bio"], inline=False)
        embed.add_field(name="ğŸ† Guerras Vencidas", value=str(kd.get("wars_won", 0)), inline=True)
        embed.add_field(name="ğŸ¤ Trocas Realizadas", value=str(kd.get("trades", 0)), inline=True)
        embed.add_field(
            name="ğŸ› ï¸ Comandos de Reino",
            value="`personalizar reino [nome]` â€” Renomear seu reino\n"
                  "`melhorar economia` â€” Invista CSI para melhorar\n"
                  "`reforÃ§ar exercito` â€” FortaleÃ§a suas tropas\n"
                  "`atacar reino @rei` â€” Declare guerra!\n"
                  "`trocar recursos @rei [valor]` â€” Coopere com outros reinos",
            inline=False
        )
        await message.channel.send(embed=embed)

    elif content.startswith("personalizar reino"):
        player = get_player(uid)
        if not player:
            return
        if player.get("city_title") != "Rei" and "Rei" not in str(player.get("city_title", "")):
            await message.channel.send("âŒ Apenas Reis podem personalizar reinos!")
            return
        parts = message.content.split(maxsplit=2)
        if len(parts) < 3:
            await message.channel.send("âŒ Use: `personalizar reino [Nome do Reino]`")
            return
        new_name = parts[2].strip()[:40]
        kd = player.get("kingdom_data") or KINGDOM_DEFAULTS.copy()
        kd["name"] = new_name
        player["kingdom_data"] = kd
        save_player_db(uid, player)
        await message.channel.send(f"ğŸ‘‘ Seu reino foi renomeado para **{new_name}**!\n*Que o nome ecoe por toda a terra!*")

    elif content in ["melhorar economia", "investir economia"]:
        player = get_player(uid)
        if not player:
            return
        if player.get("city_title") != "Rei" and "Rei" not in str(player.get("city_title", "")):
            await message.channel.send("âŒ Apenas Reis podem investir no reino!")
            return
        kd = player.get("kingdom_data") or KINGDOM_DEFAULTS.copy()
        levels = ["Ruim", "Neutra", "Boa", "Excelente"]
        current = kd.get("economy", "Neutra")
        cur_idx = levels.index(current) if current in levels else 1
        costs = [500, 1000, 2500]
        if cur_idx >= len(levels) - 1:
            await message.channel.send("ğŸ’ Sua economia jÃ¡ estÃ¡ em nÃ­vel **Excelente**!")
            return
        cost = costs[cur_idx]
        if player["coins"] < cost:
            await message.channel.send(f"âŒ Melhorar a economia custa **{cost} CSI**. VocÃª tem {player['coins']} CSI.")
            return
        player["coins"] -= cost
        kd["economy"] = levels[cur_idx + 1]
        player["kingdom_data"] = kd
        save_player_db(uid, player)
        await message.channel.send(
            f"ğŸ“ˆ **Economia melhorada!**\n\n{current} â†’ **{kd['economy']}**\n*Seu povo prospera!*"
        )

    elif content in ["reforÃ§ar exercito", "reforcar exercito", "melhorar exercito"]:
        player = get_player(uid)
        if not player:
            return
        if player.get("city_title") != "Rei" and "Rei" not in str(player.get("city_title", "")):
            await message.channel.send("âŒ Apenas Reis podem reforÃ§ar o exÃ©rcito!")
            return
        kd = player.get("kingdom_data") or KINGDOM_DEFAULTS.copy()
        levels = ["Ruim", "Neutra", "Boa", "Excelente"]
        current = kd.get("army", "Neutra")
        cur_idx = levels.index(current) if current in levels else 1
        costs = [400, 900, 2000]
        if cur_idx >= len(levels) - 1:
            await message.channel.send("âš”ï¸ Seu exÃ©rcito jÃ¡ estÃ¡ em nÃ­vel **Excelente**!")
            return
        cost = costs[cur_idx]
        if player["coins"] < cost:
            await message.channel.send(f"âŒ ReforÃ§ar o exÃ©rcito custa **{cost} CSI**. VocÃª tem {player['coins']} CSI.")
            return
        player["coins"] -= cost
        kd["army"] = levels[cur_idx + 1]
        player["kingdom_data"] = kd
        save_player_db(uid, player)
        await message.channel.send(
            f"âš”ï¸ **ExÃ©rcito reforÃ§ado!**\n\n{current} â†’ **{kd['army']}**\n*Suas tropas marcham com determinaÃ§Ã£o!*"
        )

    elif content.startswith("atacar reino"):
        player = get_player(uid)
        if not player:
            return
        if player.get("city_title") != "Rei" and "Rei" not in str(player.get("city_title", "")):
            await message.channel.send("âŒ Apenas Reis podem declarar guerra!")
            return
        if "@" not in content:
            await message.channel.send("âŒ Use: `atacar reino @rei`")
            return
        mention = message.mentions[0] if message.mentions else None
        if not mention:
            await message.channel.send("âŒ Mencione um @rei vÃ¡lido!")
            return
        target_player = get_player(mention.id)
        if not target_player:
            await message.channel.send("âŒ Jogador nÃ£o encontrado!")
            return

        my_kd = player.get("kingdom_data") or KINGDOM_DEFAULTS.copy()
        their_kd = target_player.get("kingdom_data") or KINGDOM_DEFAULTS.copy()

        army_power = {"Ruim": 1, "Neutra": 2, "Boa": 4, "Excelente": 7}
        my_power = army_power.get(my_kd.get("army", "Neutra"), 2) + player.get("temp_atk_boost", 0) // 10
        their_power = army_power.get(their_kd.get("army", "Neutra"), 2) + target_player.get("temp_atk_boost", 0) // 10

        my_roll = roll_dice() + my_power
        their_roll = roll_dice() + their_power

        their_name = their_kd.get("name") or f"Reino de {mention.display_name}"
        my_name = my_kd.get("name") or f"Reino de {message.author.display_name}"

        embed = discord.Embed(title="âš”ï¸ GUERRA DE REINOS!", color=discord.Color.red())
        embed.add_field(name=f"ğŸ° {my_name}", value=f"Poder: {my_power} + Dado: {my_roll % 10}", inline=True)
        embed.add_field(name="VS", value="âš”ï¸", inline=True)
        embed.add_field(name=f"ğŸ° {their_name}", value=f"Poder: {their_power} + Dado: {their_roll % 10}", inline=True)

        if my_roll > their_roll:
            reward = random.randint(200, 600)
            my_kd["wars_won"] = my_kd.get("wars_won", 0) + 1
            my_kd["population"] = my_kd.get("population", 100) + 20
            player["kingdom_data"] = my_kd
            player["coins"] += reward
            save_player_db(uid, player)
            save_player_db(mention.id, target_player)
            embed.add_field(
                name=f"ğŸ† {my_name} VENCEU!",
                value=f"*'{my_name} domina {their_name}!'*\n\n+{reward} CSI | +20 populaÃ§Ã£o",
                inline=False
            )
        else:
            their_kd["wars_won"] = their_kd.get("wars_won", 0) + 1
            target_player["kingdom_data"] = their_kd
            save_player_db(uid, player)
            save_player_db(mention.id, target_player)
            embed.add_field(
                name=f"ğŸ’€ {their_name} DEFENDEU!",
                value=f"*'{their_name} resistiu ao ataque!'*\n\n{their_name} ganhou +1 vitÃ³ria de guerra.",
                inline=False
            )
        await message.channel.send(embed=embed)

    elif content.startswith("trocar recursos"):
        player = get_player(uid)
        if not player:
            return
        if "@" not in content:
            await message.channel.send("âŒ Use: `trocar recursos @rei [valor em CSI]`")
            return
        parts = content.split()
        mention = message.mentions[0] if message.mentions else None
        if not mention:
            await message.channel.send("âŒ Mencione um @rei vÃ¡lido!")
            return
        amount = 0
        for p in parts:
            if p.isdigit():
                amount = int(p)
                break
        if amount <= 0:
            await message.channel.send("âŒ Use: `trocar recursos @rei [valor]` â€” ex: `trocar recursos @rei 500`")
            return
        if player["coins"] < amount:
            await message.channel.send(f"âŒ VocÃª tem apenas **{player['coins']} CSI**!")
            return

        target_player = get_player(mention.id)
        if not target_player:
            await message.channel.send("âŒ Jogador nÃ£o encontrado!")
            return

        player["coins"] -= amount
        target_player["coins"] += amount
        my_kd = player.get("kingdom_data") or KINGDOM_DEFAULTS.copy()
        my_kd["trades"] = my_kd.get("trades", 0) + 1
        player["kingdom_data"] = my_kd
        save_player_db(uid, player)
        save_player_db(mention.id, target_player)
        await message.channel.send(
            f"ğŸ¤ **Troca de Recursos!**\n\n"
            f"**{message.author.display_name}** enviou **{amount} CSI** para {mention.mention}!\n"
            f"*AlianÃ§as entre reinos fortalecem a todos!*"
        )


# ================= WEATHER SYSTEM (muda a cada 30 min) =================
@tasks.loop(minutes=30)
async def weather_change_loop():
    """Muda o clima global a cada 30 minutos"""
    weights = [30, 20, 20, 10, 12, 8]  # sol, chuva, noite, tempestade, neblina, lua_sangue
    new_type = random.choices(list(WEATHER_TYPES.keys()), weights=weights)[0]
    CURRENT_WEATHER["type"] = new_type
    CURRENT_WEATHER["changed_at"] = int(time.time())

    # Anunciar em todos os canais configurados
    wdata = WEATHER_TYPES[new_type]
    for guild in bot.guilds:
        chan = discord.utils.get(guild.text_channels, name=CANAL_BETA)
        if chan:
            embed = discord.Embed(
                title=f"{wdata['emoji']} MUDANÃ‡A DE CLIMA: {wdata['name']}",
                description=wdata["desc"],
                color=discord.Color.red() if new_type == "lua_sangue" else discord.Color.blue()
            )
            if wdata.get("special_monsters"):
                embed.add_field(
                    name="ğŸ‘¹ Criaturas Especiais Surgem!",
                    value=" | ".join(wdata["special_monsters"]),
                    inline=False
                )
            embed.add_field(name="âš”ï¸ Monstros Mais Fortes", value=f"Ã—{wdata['monster_boost']}", inline=True)
            embed.add_field(name="ğŸ Drops Melhorados", value=f"Ã—{wdata['drop_boost']}", inline=True)
            if new_type == "lua_sangue":
                embed.set_footer(text="âš ï¸ LUA DE SANGUE: Monstros extremamente perigosos mas recompensas lendÃ¡rias!")
            try:
                await chan.send(embed=embed)
            except:
                pass


# ================= SISTEMA DE PERÃODO =================
@bot.listen("on_message")
async def handle_period(message):
    if message.author.bot:
        return
    if message.channel.name != CANAL_BETA and message.channel.id not in MUNDO_PROPRIO_CHANNELS.values():
        return
    content = message.content.lower().strip()
    uid = str(message.author.id)

    if content in ["perÃ­odo", "periodo", "ver perÃ­odo", "hora", "que horas", "tempo do dia"]:
        period_data = TIME_PERIODS.get(CURRENT_PERIOD.get("type", "dia"), TIME_PERIODS["dia"])
        embed = discord.Embed(
            title=f"{period_data['emoji']} PerÃ­odo Atual: {period_data['name']}",
            description=period_data["desc"],
            color=discord.Color.orange()
        )
        embed.add_field(name="â­ BÃ´nus de XP", value=f"Ã—{period_data['xp_mult']}", inline=True)
        embed.add_field(name="ğŸ’° BÃ´nus de Coins", value=f"Ã—{period_data['coin_mult']}", inline=True)
        embed.add_field(name="âœ¨ Especial", value=period_data["special"], inline=False)
        embed.set_footer(text="Use 'descansar' para avanÃ§ar para o prÃ³ximo perÃ­odo.")
        await message.channel.send(embed=embed)

    elif content in ["descansar", "dormir", "passar tempo", "descanso"]:
        player = get_player(uid)
        if not player:
            return
        current_idx = PERIOD_ORDER.index(CURRENT_PERIOD.get("type", "dia"))
        next_idx = (current_idx + 1) % len(PERIOD_ORDER)
        next_period_key = PERIOD_ORDER[next_idx]
        CURRENT_PERIOD["type"] = next_period_key
        CURRENT_PERIOD["changed_at"] = int(time.time())
        next_data = TIME_PERIODS[next_period_key]

        # Restaurar HP e Mana ao descansar
        player["hp"] = player["max_hp"]
        player["mana"] = player.get("max_mana", 50)
        save_player_db(uid, player)

        embed = discord.Embed(
            title=f"ğŸ˜´ VocÃª descansou...",
            description=f"*O tempo passa enquanto vocÃª repousa suas forÃ§as.*\n\nO perÃ­odo avanÃ§ou para **{next_data['emoji']} {next_data['name']}**!\n\n_{next_data['desc']}_",
            color=discord.Color.dark_blue()
        )
        embed.add_field(name="ğŸ’š HP Restaurado", value=f"`{player['max_hp']}/{player['max_hp']}`", inline=True)
        embed.add_field(name="ğŸ’™ Mana Restaurada", value=f"`{player['mana']}/{player['mana']}`", inline=True)
        embed.add_field(name="â­ BÃ´nus do PerÃ­odo", value=f"XP Ã—{next_data['xp_mult']} | Coins Ã—{next_data['coin_mult']}", inline=False)
        if next_period_key == "meia_noite":
            embed.set_footer(text="ğŸ•› MEIA-NOITE! Hora dos drops lendÃ¡rios â€” explore agora!")
        await message.channel.send(embed=embed)


# ================= SUPORTE EM BATALHA PvP/Boss =================
@bot.listen("on_message")
async def handle_support_action(message):
    """Classes de suporte podem curar aliados usando 'curar @aliado'"""
    if message.author.bot:
        return
    if message.channel.name != CANAL_BETA and message.channel.id not in MUNDO_PROPRIO_CHANNELS.values():
        return
    content = message.content.lower().strip()
    uid = str(message.author.id)

    if (content.startswith("curar ") or content.startswith("apoiar ")) and message.mentions:
        player = get_player(uid)
        if not player:
            return
        cls = player.get("class", "")
        if cls not in SUPPORT_CLASSES:
            await message.channel.send(f"âŒ Apenas classes de suporte podem curar! ({', '.join(SUPPORT_CLASSES)})")
            return

        mana_cost = 20
        if player.get("mana", 0) < mana_cost:
            await message.channel.send(f"âŒ VocÃª nÃ£o tem mana suficiente! (Precisa de {mana_cost}, tem {player.get('mana', 0)})")
            return

        target = message.mentions[0]
        target_player = get_player(target.id)
        if not target_player:
            await message.channel.send("âŒ Alvo nÃ£o encontrado!")
            return

        # Rola dado para determinar efetividade da cura
        roll = roll_dice()
        luck = get_luck(roll)

        base_heal = CLASSES.get(cls, {}).get("hp_bonus", 10) + player["level"] * 2
        heal_mult = roll / 5  # dado 1-10 â†’ multiplicador 0.2â€“2.0
        heal_amount = max(10, int(base_heal * heal_mult))

        old_hp = target_player["hp"]
        target_player["hp"] = min(target_player["max_hp"], target_player["hp"] + heal_amount)
        actual_heal = target_player["hp"] - old_hp

        player["mana"] = max(0, player.get("mana", 0) - mana_cost)
        save_player_db(uid, player)
        save_player_db(target.id, target_player)

        cls_emoji = CLASSES.get(cls, {}).get("emoji", "âœ¨")
        embed = discord.Embed(
            title=f"{cls_emoji} Suporte Ativado!",
            description=f"*{message.author.display_name}* usa suas habilidades de **{cls}** para curar **{target.display_name}**!",
            color=discord.Color.green()
        )
        embed.add_field(name="ğŸ² Dado", value=f"`{roll}` {luck['emoji']} **{luck['name']}**", inline=True)
        embed.add_field(name="ğŸ’š HP Curado", value=f"+{actual_heal} HP", inline=True)
        embed.add_field(name="ğŸ’™ Mana Usada", value=f"-{mana_cost}", inline=True)
        embed.add_field(name=f"â¤ï¸ {target.display_name}", value=f"`{target_player['hp']}/{target_player['max_hp']}` HP", inline=False)
        await message.channel.send(embed=embed)


# ================= NOTIFICAÃ‡ÃƒO LIVRO DE FEITIÃ‡OS =================
@bot.listen("on_message")
async def handle_spellbook_notify(message):
    """Notifica quando jogador desbloqueou livro de feitiÃ§os no nÃ­vel 12"""
    if message.author.bot:
        return
    if message.channel.name != CANAL_BETA and message.channel.id not in MUNDO_PROPRIO_CHANNELS.values():
        return
    uid = str(message.author.id)
    player = get_player(uid)
    if not player:
        return
    effects = player.get("active_effects", {})
    if effects.get("notify_spellbook"):
        effects.pop("notify_spellbook")
        player["active_effects"] = effects
        save_player_db(uid, player)
        embed = discord.Embed(
            title="ğŸ“– LIVRO DE FEITIÃ‡OS DESBLOQUEADO!",
            description=f"*'As pÃ¡ginas do conhecimento arcano se abrem diante de vocÃª...'*\n\n"
                        f"**{message.author.mention}** chegou ao **NÃ­vel 12** e desbloqueou o **Livro de FeitiÃ§os**!\n\n"
                        f"Agora vocÃª pode acessar magias poderosas usando mana.\nUse `livro de feitiÃ§os` para ver seus feitiÃ§os disponÃ­veis.",
            color=discord.Color.purple()
        )
        embed.set_footer(text="ğŸ“– 'O conhecimento Ã© a arma mais poderosa de todas.'")
        await message.channel.send(embed=embed)




@bot.listen("on_message")
async def handle_admin_levelup(message):
    """Comando exclusivo do admin para upar de nivel automaticamente.
    Uso:
      !admin upar             -> +1 nivel no seu personagem
      !admin upar 5           -> +5 niveis no seu personagem
      !admin upar @user       -> +1 nivel no personagem do @user
      !admin upar @user 3     -> +3 niveis no @user
    """
    if message.author.bot:
        return
    if message.author.id != ADMIN_ID:
        return

    content = message.content.lower().strip()
    if not content.startswith("!admin upar"):
        return

    parts = message.content.strip().split()
    target_user = message.author
    levels_to_add = 1

    extra = parts[2:]
    for part in extra:
        if part.startswith("<@") and message.mentions:
            target_user = message.mentions[0]
        else:
            try:
                levels_to_add = max(1, min(int(part), 100))
            except ValueError:
                pass

    uid = str(target_user.id)
    player = get_player(uid)
    if not player:
        await message.channel.send(f"Jogador {target_user.display_name} nao encontrado!")
        return

    old_level = player["level"]

    for _ in range(levels_to_add):
        player["xp"] = 0
        player["level"] += 1
        class_bonus = 0
        if player.get("class") and player["class"] in CLASSES:
            class_bonus = CLASSES[player["class"]]["hp_bonus"] // 10
        player["max_hp"] += (10 + class_bonus)
        player["hp"] = player["max_hp"]
        new_max_mana = calc_max_mana(player)
        player["max_mana"] = new_max_mana
        player["mana"] = new_max_mana
        if player["level"] == 12 and not player.get("spell_book_unlocked"):
            player["spell_book_unlocked"] = 1

    save_player_db(uid, player)

    embed = discord.Embed(
        title="ADMIN - NIVEL AUMENTADO",
        description=f"{target_user.display_name} subiu de nivel por comando admin!",
        color=discord.Color.gold()
    )
    embed.add_field(name="Nivel Anterior", value=f"`{old_level}`", inline=True)
    embed.add_field(name="Novo Nivel", value=f"`{player['level']}`", inline=True)
    embed.add_field(name="Niveis Adicionados", value=f"`+{levels_to_add}`", inline=True)
    embed.add_field(name="HP Max", value=f"`{player['max_hp']}`", inline=True)
    embed.add_field(name="Mana Max", value=f"`{player['max_mana']}`", inline=True)
    embed.set_footer(text="Comando exclusivo do administrador")
    await message.channel.send(embed=embed)



# ================= ADMIN COMMANDS AVANÃ‡ADOS =================
@bot.listen("on_message")
async def handle_admin_commands(message):
    """Comandos admin â€” funcionam em QUALQUER canal."""
    if message.author.bot:
        return
    if message.author.id != ADMIN_ID:
        return

    content = message.content.strip()
    content_lower = content.lower()

    # â”€â”€ !coins @user N â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    if content_lower.startswith("!coins"):
        parts = content.split()
        if not message.mentions or len(parts) < 3:
            await message.channel.send("âŒ Uso: `!coins @user 5000`"); return
        target = message.mentions[0]
        try: amount = int(parts[-1])
        except ValueError:
            await message.channel.send("âŒ Quantidade invÃ¡lida."); return
        player = get_player(str(target.id))
        if not player:
            await message.channel.send(f"âŒ {target.display_name} nÃ£o tem personagem!"); return
        player["coins"] += amount
        save_player_db(str(target.id), player)
        await message.channel.send(embed=discord.Embed(
            title="ğŸ’° ADMIN â€” Coins",
            description=f"**{target.display_name}** recebeu `{amount:,}` CSI!\nTotal: `{player['coins']:,}`",
            color=discord.Color.gold()))

    # â”€â”€ !xp @user N â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    elif content_lower.startswith("!xp") and message.mentions:
        parts = content.split()
        target = message.mentions[0]
        try: xp_amount = int(parts[-1])
        except ValueError:
            await message.channel.send("âŒ Uso: `!xp @user 1000`"); return
        player = get_player(str(target.id))
        if not player:
            await message.channel.send(f"âŒ {target.display_name} nÃ£o tem personagem!"); return
        leveled = add_xp(str(target.id), xp_amount, bypass_boss_gate=True)
        player = get_player(str(target.id))
        embed = discord.Embed(title="â­ ADMIN â€” XP", description=f"**{target.display_name}** recebeu `{xp_amount:,}` XP!", color=discord.Color.purple())
        if leveled:
            embed.add_field(name="ğŸ†™ Level Up!", value=f"NÃ­vel **{player['level']}**!", inline=True)
        await message.channel.send(embed=embed)

    # â”€â”€ !setlevel @user N â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    elif content_lower.startswith("!setlevel") and message.mentions:
        parts = content.split()
        target = message.mentions[0]
        try:
            new_level = int(parts[-1])
            if new_level < 1 or new_level > 600: raise ValueError
        except ValueError:
            await message.channel.send("âŒ Uso: `!setlevel @user 50` (1â€“600)"); return
        player = get_player(str(target.id))
        if not player:
            await message.channel.send(f"âŒ {target.display_name} nÃ£o tem personagem!"); return
        player["level"] = new_level
        player["xp"] = 0
        player["max_hp"] = 100 + new_level * 10
        player["hp"] = player["max_hp"]
        player["max_mana"] = calc_max_mana(player)
        player["mana"] = player["max_mana"]
        save_player_db(str(target.id), player)
        await message.channel.send(embed=discord.Embed(
            title="ğŸ¯ ADMIN â€” NÃ­vel Definido",
            description=f"**{target.display_name}** agora estÃ¡ no **NÃ­vel {new_level}**!",
            color=discord.Color.gold()))

    # â”€â”€ !resetar @user â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    elif content_lower.startswith("!resetar") and message.mentions:
        target = message.mentions[0]
        new_player = {
            "level":1,"xp":0,"hp":100,"max_hp":100,"coins":0,"inventory":[],
            "weapon":None,"armor":None,"worlds":[1],"bosses":[],"class":None,
            "pet":None,"guild_id":None,"active_effects":{},"active_quest":None,
            "completed_quests":[],"mana":50,"max_mana":50,"pvp_battles":{},
            "alignment_points":0,"pet_farm":{},"discovered_map":{},"job":None,
            "job_since":0,"city_title":None,"knights":[],"last_work":0,
            "last_defend":0,"achievements":[],"training_points":0,
            "temp_atk_boost":0,"temp_def_boost":0,"temp_hp_boost":0,
            "level_boss_attempts":{},"monsters_killed":0,"bosses_defeated":0,
            "total_coins_earned":0,"total_xp_earned":0,"areas_explored":0,
            "dungeons_completed":0,"mana_category":"none","spell_book_unlocked":0,
            "afk_farming":0,"afk_start":0,"kingdom_data":None,"pets_list":[],
            "race":None,"specialization":None,"class_tier":0,"supreme_skills":[],
            "race_stage":0,"mount":None,"bio":"","last_force_entry":0,"job_works":{},
        }
        save_player_db(str(target.id), new_player)
        await message.channel.send(embed=discord.Embed(
            title="ğŸ”„ ADMIN â€” Personagem Resetado",
            description=f"**{target.display_name}** foi resetado para o nÃ­vel 1!",
            color=discord.Color.dark_red()))

    # â”€â”€ !ver @user â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    elif content_lower.startswith("!ver") and message.mentions:
        target = message.mentions[0]
        player = get_player(str(target.id))
        if not player:
            await message.channel.send(f"âŒ {target.display_name} nÃ£o tem personagem!"); return
        embed = discord.Embed(title=f"ğŸ‘¤ ADMIN â€” {target.display_name}", color=discord.Color.blurple())
        embed.add_field(name="âš¡ NÃ­vel", value=f"`{player['level']}`", inline=True)
        embed.add_field(name="â­ XP", value=f"`{player['xp']:,}`", inline=True)
        embed.add_field(name="ğŸ’° Coins", value=f"`{player['coins']:,}`", inline=True)
        embed.add_field(name="â¤ï¸ HP", value=f"`{player['hp']}/{player['max_hp']}`", inline=True)
        embed.add_field(name="ğŸ­ Classe", value=f"`{player.get('class','Nenhuma')}`", inline=True)
        embed.add_field(name="ğŸ§¬ RaÃ§a", value=f"`{player.get('race','Nenhuma')}`", inline=True)
        embed.add_field(name="âš”ï¸ Arma", value=f"`{player.get('weapon','Nenhuma')}`", inline=True)
        embed.add_field(name="ğŸ›¡ï¸ Armadura", value=f"`{player.get('armor','Nenhuma')}`", inline=True)
        embed.add_field(name="ğŸ’ InventÃ¡rio", value=f"`{len(player.get('inventory',[]))}` itens", inline=True)
        await message.channel.send(embed=embed)

    # â”€â”€ !admin curar @user â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    elif content_lower.startswith("!admin curar") and message.mentions:
        target = message.mentions[0]
        player = get_player(str(target.id))
        if not player:
            await message.channel.send(f"âŒ {target.display_name} nÃ£o tem personagem!"); return
        player["hp"] = player["max_hp"]
        player["mana"] = player["max_mana"]
        save_player_db(str(target.id), player)
        await message.channel.send(embed=discord.Embed(
            title="ğŸ’š ADMIN â€” Cura Total",
            description=f"**{target.display_name}** curado! â¤ï¸ `{player['hp']}/{player['max_hp']}` | ğŸ’™ `{player['mana']}/{player['max_mana']}`",
            color=discord.Color.green()))

    # â”€â”€ !admin dar classe @user [classe] â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    elif content_lower.startswith("!admin dar classe") and message.mentions:
        target = message.mentions[0]
        raw = content_lower.replace("!admin dar classe", "")
        for mid in [f"<@{target.id}>", f"<@!{target.id}>"]:
            raw = raw.replace(mid, "")
        class_name = raw.strip()
        found_class = next((cn for cn in CLASSES if class_name in cn.lower()), None)
        if not found_class:
            await message.channel.send(f"âŒ Classe nÃ£o encontrada: `{class_name}`"); return
        player = get_player(str(target.id))
        if not player:
            await message.channel.send(f"âŒ {target.display_name} nÃ£o tem personagem!"); return
        player["class"] = found_class
        player["max_hp"] += CLASSES[found_class]["hp_bonus"]
        player["hp"] = player["max_hp"]
        save_player_db(str(target.id), player)
        await message.channel.send(embed=discord.Embed(
            title="ğŸ­ ADMIN â€” Classe",
            description=f"**{target.display_name}** agora Ã© **{CLASSES[found_class]['emoji']} {found_class}**!",
            color=discord.Color.purple()))

    # â”€â”€ !admin dar raÃ§a @user [raÃ§a] â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    elif content_lower.startswith("!admin dar raÃ§a") or content_lower.startswith("!admin dar raca"):
        if message.mentions:
            target = message.mentions[0]
            raw = content_lower.replace("!admin dar raÃ§a","").replace("!admin dar raca","")
            for mid in [f"<@{target.id}>", f"<@!{target.id}>"]:
                raw = raw.replace(mid, "")
            race_name = raw.strip()
            found_race = next((rn for rn in RACES if race_name in rn.lower()), None)
            if not found_race:
                await message.channel.send(f"âŒ RaÃ§a nÃ£o encontrada: `{race_name}`"); return
            player = get_player(str(target.id))
            if not player:
                await message.channel.send(f"âŒ {target.display_name} nÃ£o tem personagem!"); return
            player["race"] = found_race
            player["max_hp"] += RACES[found_race]["hp_bonus"]
            player["hp"] = player["max_hp"]
            save_player_db(str(target.id), player)
            await message.channel.send(embed=discord.Embed(
                title="ğŸ§¬ ADMIN â€” RaÃ§a",
                description=f"**{target.display_name}** agora Ã© **{RACES[found_race]['emoji']} {found_race}**!\n{RACES[found_race]['description']}",
                color=discord.Color.teal()))

    # â”€â”€ !admin coins todos N â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    elif content_lower.startswith("!admin coins todos"):
        parts = content.split()
        try: amount = int(parts[-1])
        except (ValueError, IndexError):
            await message.channel.send("âŒ Uso: `!admin coins todos 500`"); return
        conn_a = sqlite3.connect(DB_FILE)
        rows = conn_a.execute("SELECT user_id FROM players").fetchall()
        conn_a.close()
        for (puid,) in rows:
            p = get_player(puid)
            if p:
                p["coins"] += amount
                save_player_db(puid, p)
        await message.channel.send(embed=discord.Embed(
            title="ğŸ’° ADMIN â€” Coins Para Todos",
            description=f"**{len(rows)} jogadores** receberam `{amount:,}` CSI cada!",
            color=discord.Color.gold()))

    # â”€â”€ !admin help â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    elif content_lower in ["!admin", "!admin help", "!adminhelp"]:
        embed = discord.Embed(title="âš™ï¸ ADMIN â€” Painel de Comandos", color=discord.Color.dark_gold())
        embed.add_field(
            name="ğŸ“ˆ Level & XP",
            value="`!admin upar @user [N]` â€” sobe N nÃ­veis\n`!setlevel @user N` â€” define nÃ­vel exato\n`!xp @user N` â€” dÃ¡ XP diretamente",
            inline=False
        )
        embed.add_field(
            name="ğŸ’° Economia",
            value="`!coins @user N` â€” dÃ¡ coins ao jogador\n`!admin coins todos N` â€” dÃ¡ coins para TODOS os jogadores",
            inline=False
        )
        embed.add_field(
            name="ğŸ‘¤ Gerenciar Jogador",
            value="`!ver @user` â€” ver ficha completa\n`!resetar @user` â€” resetar personagem para nÃ­vel 1\n`!admin curar @user` â€” cura HP e Mana totais",
            inline=False
        )
        embed.add_field(
            name="ğŸ­ Personagem",
            value="`!admin dar classe @user [classe]` â€” define classe\n`!admin dar raÃ§a @user [raÃ§a]` â€” define raÃ§a",
            inline=False
        )
        embed.add_field(
            name="ğŸ“‹ Classes disponÃ­veis",
            value="Guerreiro, Mago, Arqueiro, Paladino, Assassino, Necromante, Berserker, Druida, Monge, Bardo",
            inline=False
        )
        embed.add_field(
            name="ğŸ§¬ RaÃ§as disponÃ­veis",
            value="Humano, Ã‰lfico, AnÃ£o, Orc, Anjo, DemÃ´nio, DragÃ´nico, Vampiro, Lobisomem + mais",
            inline=False
        )
        embed.set_footer(text="âš ï¸ Todos os comandos funcionam em QUALQUER canal do servidor")
        await message.channel.send(embed=embed)


# ================= BATALHA DE PETS =================
# Desafios pendentes: {challenger_id: {"target_id": ..., "pet_name": ..., "timestamp": ...}}
PET_BATTLE_CHALLENGES = {}

def get_pet_battle_stats(player):
    """Retorna o pet ativo e seus stats de batalha."""
    pet_name = player.get("pet")
    if not pet_name:
        return None
    if isinstance(pet_name, dict):
        pet_name = pet_name.get("name", "")

    # Busca dados base do pet em PETS e em evoluÃ§Ãµes
    pet_data = None
    for world_pets in PETS.values():
        for p in world_pets:
            if p["name"] == pet_name:
                pet_data = dict(p)
                break
        if pet_data:
            break

    # Se nÃ£o achou (pet evoluÃ­do), busca nos next_data de PET_EVOLUTIONS
    if not pet_data:
        for evo in PET_EVOLUTIONS.values():
            nd = evo.get("next_data", {})
            if nd.get("name") == pet_name:
                pet_data = dict(nd)
                break

    if not pet_data:
        pet_data = {"name": pet_name, "emoji": "ğŸ¾", "rarity": "Comum", "bonus_hp": 10, "bonus_atk": 3}

    # HP e ATK de batalha â€” escala com nÃ­vel do dono
    owner_level = player.get("level", 1)
    base_hp  = pet_data["bonus_hp"] * 5 + owner_level * 3
    base_atk = pet_data["bonus_atk"] + owner_level // 2

    # BÃ´nus por raridade
    rarity_mult = {"Comum":1.0,"Incomum":1.1,"Raro":1.25,"Ã‰pico":1.4,
                   "LendÃ¡rio":1.6,"MÃ­tico":1.85,"Divino":2.2,"Primordial":2.8}
    mult = rarity_mult.get(pet_data.get("rarity","Comum"), 1.0)
    hp  = int(base_hp  * mult)
    atk = int(base_atk * mult)

    pet_data["battle_hp"]  = hp
    pet_data["battle_atk"] = atk
    return pet_data


@bot.listen("on_message")
async def handle_pet_battle(message):
    if message.author.bot:
        return
    if message.channel.name != CANAL_BETA and message.channel.id not in MUNDO_PROPRIO_CHANNELS.values():
        return

    content = message.content.lower().strip()
    uid = str(message.author.id)

    # â”€â”€â”€ DESAFIAR PET â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    # "batalha pet @user"
    if (content.startswith("batalha pet") or content.startswith("desafiar pet")) and message.mentions:
        challenger = get_player(uid)
        if not challenger:
            return
        if not challenger.get("pet"):
            await message.channel.send(f"âŒ {message.author.mention} vocÃª nÃ£o tem pet ativo! Use `trocar pet [nome]`.")
            return

        target_user = message.mentions[0]
        if target_user.id == message.author.id:
            await message.channel.send("âŒ VocÃª nÃ£o pode batalhar contra si mesmo!")
            return

        target = get_player(target_user.id)
        if not target:
            await message.channel.send(f"âŒ {target_user.display_name} ainda nÃ£o tem personagem.")
            return
        if not target.get("pet"):
            await message.channel.send(f"âŒ {target_user.display_name} nÃ£o tem pet ativo!")
            return

        c_pet = get_pet_battle_stats(challenger)
        t_pet = get_pet_battle_stats(target)

        PET_BATTLE_CHALLENGES[str(target_user.id)] = {
            "challenger_id": uid,
            "c_pet": c_pet,
            "t_pet": t_pet,
            "timestamp": time.time()
        }

        embed = discord.Embed(
            title="âš”ï¸ DESAFIO DE PETS!",
            description=f"{message.author.mention} desafia {target_user.mention} para uma batalha de pets!",
            color=discord.Color.orange()
        )
        embed.add_field(
            name=f"{c_pet['emoji']} {c_pet['name']} ({message.author.display_name})",
            value=f"â¤ï¸ HP: `{c_pet['battle_hp']}` | âš”ï¸ ATK: `{c_pet['battle_atk']}`\n{RARITIES[c_pet['rarity']]['emoji']} {c_pet['rarity']}",
            inline=True
        )
        embed.add_field(
            name=f"{t_pet['emoji']} {t_pet['name']} ({target_user.display_name})",
            value=f"â¤ï¸ HP: `{t_pet['battle_hp']}` | âš”ï¸ ATK: `{t_pet['battle_atk']}`\n{RARITIES[t_pet['rarity']]['emoji']} {t_pet['rarity']}",
            inline=True
        )
        embed.set_footer(text=f"{target_user.display_name}, responda com 'aceitar pet' para batalhar! (expira em 2 min)")
        await message.channel.send(embed=embed)
        return

    # â”€â”€â”€ ACEITAR BATALHA DE PET â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    if content in ["aceitar pet", "aceitar batalha pet"]:
        challenge = PET_BATTLE_CHALLENGES.get(uid)
        if not challenge:
            await message.channel.send(f"âŒ {message.author.mention} vocÃª nÃ£o tem desafio de pet pendente!")
            return
        if time.time() - challenge["timestamp"] > 120:
            PET_BATTLE_CHALLENGES.pop(uid, None)
            await message.channel.send("âŒ O desafio expirou! PeÃ§a para reenviar.")
            return

        PET_BATTLE_CHALLENGES.pop(uid, None)

        challenger_id = challenge["challenger_id"]
        try:
            challenger_user = await bot.fetch_user(int(challenger_id))
        except:
            challenger_user = None

        c_pet = challenge["c_pet"]
        t_pet = challenge["t_pet"]

        c_hp = c_pet["battle_hp"]
        t_hp = t_pet["battle_hp"]
        c_atk = c_pet["battle_atk"]
        t_atk = t_pet["battle_atk"]

        # â”€â”€ SIMULAÃ‡ÃƒO DA BATALHA â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        MOVES = {
            "Comum":     ["ArranhÃ£o", "Mordida", "Chute"],
            "Incomum":   ["Golpe RÃ¡pido", "Ataque Ãgil", "Investida"],
            "Raro":      ["Garra Afiada", "Impacto SÃ³lido", "Rugido"],
            "Ã‰pico":     ["ExplosÃ£o Ã‰pica", "Golpe Ã‰pico", "FÃºria"],
            "LendÃ¡rio":  ["LanÃ§a LendÃ¡ria", "Tempestade", "Poder LendÃ¡rio"],
            "MÃ­tico":    ["Raio MÃ­tico", "Abismo", "Colapso"],
            "Divino":    ["Luz Divina", "Julgamento", "PurificaÃ§Ã£o"],
            "Primordial":["ExtinÃ§Ã£o", "Caos Primordial", "AniquilaÃ§Ã£o"],
        }

        battle_log = []
        turn = 0
        c_cur = c_hp
        t_cur = t_hp

        c_rar = c_pet.get("rarity","Comum")
        t_rar = t_pet.get("rarity","Comum")

        while c_cur > 0 and t_cur > 0 and turn < 30:
            turn += 1
            # CrÃ­tico: 20% chance, 1.5x dano
            c_crit = random.random() < 0.20
            t_crit = random.random() < 0.20

            c_dmg = max(1, int(c_atk * random.uniform(0.8, 1.3) * (1.5 if c_crit else 1.0)))
            t_dmg = max(1, int(t_atk * random.uniform(0.8, 1.3) * (1.5 if t_crit else 1.0)))

            t_cur = max(0, t_cur - c_dmg)
            c_cur = max(0, c_cur - t_dmg)

            c_move = random.choice(MOVES.get(c_rar, MOVES["Comum"]))
            t_move = random.choice(MOVES.get(t_rar, MOVES["Comum"]))

            c_bar = "â–ˆ" * int(c_cur/c_hp*10) + "â–‘" * (10 - int(c_cur/c_hp*10))
            t_bar = "â–ˆ" * int(t_cur/t_hp*10) + "â–‘" * (10 - int(t_cur/t_hp*10))

            entry = (
                f"**Turno {turn}**\n"
                f"{c_pet['emoji']} **{c_move}**{'ğŸ’¥' if c_crit else ''}: `-{c_dmg}` â†’ {t_pet['emoji']} `{max(0,t_cur)}/{t_hp}` [{t_bar}]\n"
                f"{t_pet['emoji']} **{t_move}**{'ğŸ’¥' if t_crit else ''}: `-{t_dmg}` â†’ {c_pet['emoji']} `{max(0,c_cur)}/{c_hp}` [{c_bar}]"
            )
            battle_log.append(entry)

            if c_cur <= 0 or t_cur <= 0:
                break

        # â”€â”€ RESULTADO â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        if c_cur > t_cur:
            winner_name = challenger_user.display_name if challenger_user else "Desafiante"
            winner_pet  = c_pet
            loser_pet   = t_pet
            loser_name  = message.author.display_name
            winner_mention = challenger_user.mention if challenger_user else "Desafiante"
        elif t_cur > c_cur:
            winner_name    = message.author.display_name
            winner_pet     = t_pet
            loser_pet      = c_pet
            loser_name     = challenger_user.display_name if challenger_user else "Desafiante"
            winner_mention = message.author.mention
        else:
            winner_name    = None
            winner_mention = None

        # Envia turnos em embed (divide se muito longo)
        fight_embed = discord.Embed(
            title=f"ğŸ¥Š BATALHA DE PETS â€” {c_pet['emoji']} {c_pet['name']} vs {t_pet['emoji']} {t_pet['name']}",
            description=f"*'Que comecem os jogos!'*\n\n" + "\n\n".join(battle_log[:5]),
            color=discord.Color.red()
        )
        fight_embed.add_field(
            name="ğŸ“Š Stats Iniciais",
            value=(
                f"{c_pet['emoji']} **{c_pet['name']}**: `{c_hp}` HP | `{c_atk}` ATK\n"
                f"{t_pet['emoji']} **{t_pet['name']}**: `{t_hp}` HP | `{t_atk}` ATK"
            ),
            inline=False
        )
        await message.channel.send(embed=fight_embed)
        await asyncio.sleep(2)

        # Turnos do meio
        if len(battle_log) > 5:
            mid_embed = discord.Embed(
                title="âš”ï¸ A batalha continua...",
                description="\n\n".join(battle_log[5:10]),
                color=discord.Color.orange()
            )
            await message.channel.send(embed=mid_embed)
            await asyncio.sleep(2)

        if len(battle_log) > 10:
            mid2_embed = discord.Embed(
                title="ğŸ’¢ Fase final da batalha!",
                description="\n\n".join(battle_log[10:15]),
                color=discord.Color.dark_red()
            )
            await message.channel.send(embed=mid2_embed)
            await asyncio.sleep(2)

        # Resultado final
        if winner_name:
            xp_reward = max(30, (winner_pet["battle_atk"] + loser_pet["battle_atk"]) * 2)
            add_xp(str(challenger_id) if c_cur > t_cur else uid, xp_reward)

            result_embed = discord.Embed(
                title=f"ğŸ† {winner_pet['emoji']} {winner_pet['name']} VENCEU!",
                description=(
                    f"*'O pÃºblico enlouquece!'*\n\n"
                    f"ğŸ¥‡ **{winner_name}** e seu {winner_pet['emoji']} **{winner_pet['name']}** triunfam!\n"
                    f"ğŸ’€ **{loser_name}** e seu {loser_pet['emoji']} **{loser_pet['name']}** foram derrotados!\n\n"
                    f"â­ **{winner_name}** ganhou `+{xp_reward} XP`!"
                ),
                color=discord.Color.gold()
            )
            result_embed.add_field(
                name="ğŸ“Š HP Final",
                value=(
                    f"{winner_pet['emoji']} **{winner_pet['name']}**: `{max(c_cur,t_cur)}` HP restante\n"
                    f"{loser_pet['emoji']} **{loser_pet['name']}**: `0` HP"
                ),
                inline=False
            )
            result_embed.add_field(name="ğŸ² Turnos", value=f"`{turn}` turnos", inline=True)
        else:
            result_embed = discord.Embed(
                title="ğŸ¤ EMPATE!",
                description=f"*'Ambos os pets caem ao mesmo tempo!'*\n\n{c_pet['emoji']} **{c_pet['name']}** e {t_pet['emoji']} **{t_pet['name']}** empataram!",
                color=discord.Color.greyple()
            )

        result_embed.set_footer(text="Use 'batalha pet @user' para desafiar alguÃ©m | 'evoluir pet' para ficar mais forte!")
        await message.channel.send(embed=result_embed)
        return

    # â”€â”€â”€ VER STATS DO PET (para batalha) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    if content in ["stats pet", "poder pet", "meu pet stats"]:
        player = get_player(uid)
        if not player or not player.get("pet"):
            await message.channel.send("âŒ VocÃª nÃ£o tem pet ativo!")
            return
        pet = get_pet_battle_stats(player)
        evo_info = PET_EVOLUTIONS.get(pet["name"])
        evo_text = f"\nğŸ”„ PrÃ³x. evo: **{evo_info['next']}** (Nv. {evo_info['level_required']})" if evo_info else "\nâœ¨ Forma final!"
        embed = discord.Embed(
            title=f"{pet['emoji']} Stats de Batalha â€” {pet['name']}",
            description=f"{RARITIES[pet['rarity']]['emoji']} **{pet['rarity']}**{evo_text}",
            color=discord.Color.blue()
        )
        embed.add_field(name="â¤ï¸ HP Batalha",  value=f"`{pet['battle_hp']}`",  inline=True)
        embed.add_field(name="âš”ï¸ ATK Batalha", value=f"`{pet['battle_atk']}`", inline=True)
        embed.set_footer(text="Stats escalam com o nÃ­vel do dono + raridade do pet")
        await message.channel.send(embed=embed)


# ================= QUARTA FORMA EXCLUSIVA PARA PETS COMUNS =================
# Pets comuns (rarity="Comum") tÃªm uma quarta forma especial exclusiva para eles
# Pets de nÃ­vel mais alto (LendÃ¡rio+) podem ter Forma Bestial (desbloqueada no nÃ­vel 80 do jogador)

COMMON_PET_FOURTH_FORMS = {
    # â”€â”€ Mundo 1 â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    "Slime BebÃª": {
        "level_required": 3,
        "next": "Slime Rei Menor",
        "next_data": {"name": "Slime Rei Menor", "emoji": "ğŸ‘‘", "rarity": "Comum",
                      "bonus_hp": 80, "bonus_atk": 30, "special": True, "form": "quarta_forma",
                      "desc": "A forma final dos Slimes Comuns â€” um Rei Slime em miniatura! Nenhum pet raro jamais alcanÃ§arÃ¡ isto."}
    },
    "Slime Adolescente": {
        "level_required": 5,
        "next": "Slime Rei do Abismo",
        "next_data": {"name": "Slime Rei do Abismo", "emoji": "ğŸŒ‘", "rarity": "Comum",
                      "bonus_hp": 100, "bonus_atk": 40, "special": True, "form": "quarta_forma",
                      "desc": "O Slime que tocou o Abismo. Uma mutaÃ§Ã£o Ãºnica que nenhuma raridade superior pode replicar!"}
    },
    "Rato Selvagem Domesticado": {
        "level_required": 2,
        "next": "Rato Ancestral",
        "next_data": {"name": "Rato Ancestral", "emoji": "ğŸ€", "rarity": "Comum",
                      "bonus_hp": 60, "bonus_atk": 22, "special": True, "form": "quarta_forma",
                      "desc": "Pequeno mas absolutamente implacÃ¡vel. Superou todos os limites da sua raÃ§a!"}
    },
    "Fungo Espiritual": {
        "level_required": 4,
        "next": "Fungo Primordial",
        "next_data": {"name": "Fungo Primordial", "emoji": "ğŸ„", "rarity": "Comum",
                      "bonus_hp": 75, "bonus_atk": 18, "special": True, "form": "quarta_forma",
                      "desc": "Absorveu energia espiritual dos Campos Iniciais por geraÃ§Ãµes. TÃ³xico e misterioso!"}
    },
    "Lagarta Arcana": {
        "level_required": 3,
        "next": "Mariposa do Caos",
        "next_data": {"name": "Mariposa do Caos", "emoji": "ğŸ¦‹", "rarity": "Comum",
                      "bonus_hp": 65, "bonus_atk": 25, "special": True, "form": "quarta_forma",
                      "desc": "Nunca virou borboleta â€” virou Caos! Uma forma que nenhum pet raro pode imitar."}
    },
    # â”€â”€ Mundo 10 â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    "Toupeira das Sombras": {
        "level_required": 5,
        "next": "Toupeira Cega Ancestral",
        "next_data": {"name": "Toupeira Cega Ancestral", "emoji": "ğŸ¦¡", "rarity": "Comum",
                      "bonus_hp": 90, "bonus_atk": 28, "special": True, "form": "quarta_forma",
                      "desc": "Cega mas percebe o mundo de formas impossÃ­veis. Poder atravÃ©s da escuridÃ£o absoluta!"}
    },
    "Cogumelo Sombrio": {
        "level_required": 5,
        "next": "Cogumelo Maldito Eterno",
        "next_data": {"name": "Cogumelo Maldito Eterno", "emoji": "ğŸ„", "rarity": "Comum",
                      "bonus_hp": 85, "bonus_atk": 32, "special": True, "form": "quarta_forma",
                      "desc": "Absorveu a maldiÃ§Ã£o da floresta inteira. Venenoso ao extremo!"}
    },
    # â”€â”€ Mundo 20 â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    "Besouro do Deserto": {
        "level_required": 8,
        "next": "Besouro FaraÃ³",
        "next_data": {"name": "Besouro FaraÃ³", "emoji": "ğŸª²", "rarity": "Comum",
                      "bonus_hp": 110, "bonus_atk": 38, "special": True, "form": "quarta_forma",
                      "desc": "O FaraÃ³ dos besouros! Sobreviveu ao sol ardente por sÃ©culos. Carrega toda a forÃ§a do deserto!"}
    },
    "Cobra das Areias": {
        "level_required": 8,
        "next": "Cobra GuardiÃ£ das Areias",
        "next_data": {"name": "Cobra GuardiÃ£ das Areias", "emoji": "ğŸ", "rarity": "Comum",
                      "bonus_hp": 95, "bonus_atk": 42, "special": True, "form": "quarta_forma",
                      "desc": "Guardou os segredos das pirÃ¢mides por milÃªnios. Veneno que carrega memÃ³ria de mil faraÃ³s!"}
    },
}

BESTIAL_FORMS = {
    "Lobo Alpha LendÃ¡rio": {
        "name": "Lobo Bestial Primordial", "emoji": "ğŸº", "rarity": "LendÃ¡rio",
        "bonus_hp": 200, "bonus_atk": 100,
        "special": True, "form": "bestial",
        "desc": "A Forma Bestial desperta o poder ancestral do lobo primordial. Desbloqueada ao nÃ­vel 80."
    },
    "Esfinge Imortal": {
        "name": "Esfinge Bestial CÃ³smica", "emoji": "ğŸ¦", "rarity": "Divino",
        "bonus_hp": 350, "bonus_atk": 175,
        "special": True, "form": "bestial",
        "desc": "A Forma Bestial transforma a Esfinge na guarda cÃ³smica perfeita."
    },
    "FÃªnix Eterna": {
        "name": "FÃªnix Bestial do Caos", "emoji": "ğŸ”¥", "rarity": "Divino",
        "bonus_hp": 400, "bonus_atk": 200,
        "special": True, "form": "bestial",
        "desc": "A Forma Bestial desperta o fogo do caos primordial dentro da FÃªnix."
    },
    "DragÃ£o de Gelo AnciÃ£o": {
        "name": "DragÃ£o Bestial do Gelo Eterno", "emoji": "â„ï¸", "rarity": "Divino",
        "bonus_hp": 450, "bonus_atk": 225,
        "special": True, "form": "bestial",
        "desc": "A Forma Bestial libera o poder do gelo eterno que dormia no dragÃ£o anciÃ£o."
    },
    "Lobo Alpha LendÃ¡rio": {
        "name": "Lobo Bestial Primordial", "emoji": "ğŸº", "rarity": "LendÃ¡rio",
        "bonus_hp": 180, "bonus_atk": 90,
        "special": True, "form": "bestial",
        "desc": "O lobo unleashes power dormant since the first moon."
    },
    "Arcanjo Primordial": {
        "name": "Arcanjo Bestial Supremo", "emoji": "ğŸ•Šï¸", "rarity": "Primordial",
        "bonus_hp": 800, "bonus_atk": 400,
        "special": True, "form": "bestial",
        "desc": "A Forma Bestial de um Arcanjo Primordial Ã© simplesmente indescritÃ­vel."
    },
    "Deus Primordial": {
        "name": "Deus Bestial Absoluto", "emoji": "âœ¨", "rarity": "Primordial",
        "bonus_hp": 1000, "bonus_atk": 500,
        "special": True, "form": "bestial",
        "desc": "Forma Bestial do poder divino absoluto. Poucos sobrevivem para contar."
    },
}

# NPCs do mundo com diÃ¡logos de lore, segredos e quests ocultas
NPC_DIALOGUES_EXTENDED = {
    "Theron": {
        "full_name": "AldeÃ£o Theron",
        "emoji": "ğŸ‘¨â€ğŸŒ¾",
        "world": 1,
        "lore": [
            "Este reino existe hÃ¡ mais de mil anos. Mas poucos sabem que antes havia outro, engolido pelo Vazio.",
            "Minha avÃ³ dizia que o primeiro slime nÃ£o nasceu aqui. Ele caiu de uma fenda no cÃ©u â€” quando o Abismo tentou invadir.",
            "HÃ¡ uma cripta sob os Campos. Nunca entrei. Quem entra ouve vozes. Quem sai... nÃ£o Ã© mais a mesma pessoa.",
        ],
        "secrets": [
            "Se vocÃª cavar no centro exato dos Campos na lua cheia, encontrarÃ¡ uma pedra com um sÃ­mbolo estranho. Dizem que Ã© a marca do Primeiro Deus.",
            "O Slime Rei nÃ£o morre de verdade. Ele absorve a magia da terra e renasce. Sempre renascerÃ¡... a menos que a fonte seja destruÃ­da.",
        ],
        "hidden_quests": [
            {
                "id": "hq_theron_001",
                "name": "ğŸŒ‘ A Cripta dos Campos",
                "description": "Theron te conta sobre uma cripta oculta nos Campos. Explore e descubra o que hÃ¡ lÃ¡.",
                "type": "individual", "objective": "explore", "count": 1,
                "reward_xp": 2000, "reward_coins": 50, "reward_item": "Fragmento de Cristal Antigo",
                "lore": "A cripta guarda um segredo que os aldeÃµes preferiram esquecer.",
                "npc": "AldeÃ£o Theron", "difficulty": "Raro"
            }
        ]
    },
    "Elara": {
        "full_name": "Curandeira Elara",
        "emoji": "ğŸ‘©â€âš•ï¸",
        "world": 1,
        "lore": [
            "As ervas destes campos foram criadas por uma druida que deu sua vida para que elas crescessem para sempre.",
            "JÃ¡ curei feridas que nÃ£o deveriam existir. Marcas de algo que nÃ£o vive neste mundo.",
            "A magia de cura nÃ£o cria â€” ela restaura. Mas e se algo nunca foi inteiro para comeÃ§o de conversa?",
        ],
        "secrets": [
            "Existe uma poÃ§Ã£o que pode restaurar um item destruÃ­do. A receita estÃ¡ guardada num livro que sÃ³ aparece nas noites de neblina arcana.",
            "O veneno das Vespas Gigantes ao norte, se processado corretamente, cura qualquer maldiÃ§Ã£o. NinguÃ©m mais sabe fazer isso.",
        ],
        "hidden_quests": []
    },
    "Sylvara": {
        "full_name": "Druida Sylvara",
        "emoji": "ğŸ§™â€â™€ï¸",
        "world": 10,
        "lore": [
            "A Floresta Sombria tem memÃ³ria. Cada Ã¡rvore lembra de quem passou por aqui. VocÃª estÃ¡ sendo lembrado agora.",
            "O Ent AnciÃ£o tem 3.000 anos. Ele viu o mundo antes dos humanos. Seu primeiro pensamento foi: 'que barulhentos'.",
            "Existe uma linguagem que apenas Ã¡rvores falam. Levei 40 anos para aprender as primeiras trÃªs palavras.",
        ],
        "secrets": [
            "No coraÃ§Ã£o da floresta existe uma clareira que nÃ£o aparece em nenhum mapa. Nela, o tempo passa diferente.",
            "Os goblins desta floresta foram corrompidos por um artefato que ninguÃ©m encontrou ainda. Quem o destruir libertarÃ¡ a floresta.",
        ],
        "hidden_quests": [
            {
                "id": "hq_sylvara_001",
                "name": "ğŸŒ³ O Artefato Corrompido",
                "description": "Sylvara te pede para encontrar o artefato que corrompeu os goblins da floresta.",
                "type": "individual", "objective": "explore", "count": 5,
                "reward_xp": 4000, "reward_coins": 80, "reward_item": "EssÃªncia Pura da Floresta",
                "lore": "O artefato pulsa com uma energia estranha. Como chegou aqui ninguÃ©m sabe.",
                "npc": "Druida Sylvara", "difficulty": "DifÃ­cil"
            }
        ]
    },
    "Bjorn": {
        "full_name": "AnciÃ£o da Montanha Bjorn",
        "emoji": "ğŸ§™",
        "world": 30,
        "lore": [
            "Os TitÃ£s do Gelo nÃ£o foram destruÃ­dos. Eles dormiram. E sonham. E os sonhos deles moldam estas montanhas.",
            "Krom, o Yeti, uma vez me falou. Ele disse: 'Preciso proteger, mas esqueci do quÃª.' Meu coraÃ§Ã£o partiu.",
            "O Cristal do Inverno Eterno guarda memÃ³rias de mil anos de gelo. Quem o tocar verÃ¡ tudo que jÃ¡ morreu neste frio.",
        ],
        "secrets": [
            "HÃ¡ uma cÃ¢mara secreta dentro do Yeti. NÃ£o literalmente â€” mas uma caverna que brilha com a mesma luz dos seus olhos.",
            "Se vocÃª derrotar Krom com compaixÃ£o â€” sem habilidades destrutivas â€” ele sussurra um nome antes de cair. O nome Ã© a senha para a cÃ¢mara.",
        ],
        "hidden_quests": [
            {
                "id": "hq_bjorn_001",
                "name": "â„ï¸ O Segredo de Krom",
                "description": "Bjorn te conta que Krom guarda um segredo que pode revelar o paradeiro dos TitÃ£s do Gelo.",
                "type": "individual", "objective": "boss", "target": "Yeti Colossal",
                "reward_xp": 8000, "reward_coins": 200, "reward_item": "Fragmento de TitÃ£ do Gelo",
                "lore": "A verdade sobre os TitÃ£s do Gelo pode mudar tudo que vocÃª sabe sobre este mundo.",
                "npc": "AnciÃ£o Bjorn", "difficulty": "Muito DifÃ­cil"
            }
        ]
    },
    "Ramses": {
        "full_name": "ArqueÃ³logo Ramses",
        "emoji": "ğŸº",
        "world": 20,
        "lore": [
            "A DÃ©cima Dinastia durou 600 anos. Eu passei 30 tentando entender por que ela caiu em um Ãºnico dia.",
            "Os hierÃ³glifos mais antigos nÃ£o descrevem deuses. Descrevem algo muito mais velho e muito mais assustador.",
            "Kha-Mentu me visitou em sonho uma vez. Ele disse: 'O Olho de Ra nÃ£o Ã© uma joia. Ã‰ um olho de verdade.'",
        ],
        "secrets": [
            "Existe uma pirÃ¢mide no deserto que nÃ£o aparece de dia. SÃ³ ao entardecer, quando as sombras alcanÃ§am certo Ã¢ngulo.",
            "O FaraÃ³ Kha-Mentu tinha um filho. NinguÃ©m sabe o que aconteceu com ele. Os hierÃ³glifos mencionam 'o Herdeiro Perdido'.",
        ],
        "hidden_quests": []
    },
    "Spectra": {
        "full_name": "BibliotecÃ¡ria Spectra",
        "emoji": "ğŸ‘»",
        "world": 50,
        "lore": [
            "O Abismo nÃ£o Ã© um lugar. Ã‰ um estado. VocÃª pode estar no Abismo agora mesmo sem saber.",
            "Estudei aqui por 200 anos. Todo dia aprendo algo que desfaz o que aprendi antes.",
            "O Senhor das Sombras me perguntou uma vez: 'O que Ã© pior â€” nÃ£o existir, ou existir em sofrimento?' Ainda nÃ£o respondi.",
        ],
        "secrets": [
            "HÃ¡ uma sala nesta biblioteca que eu nunca abri. Ela abre sozinha em certas noites. E fecha antes que alguÃ©m possa entrar.",
            "O verdadeiro nome do Senhor das Sombras Ã© proibido de ser dito. Mas estÃ¡ escrito em um livro aqui. Eu nunca o li.",
        ],
        "hidden_quests": [
            {
                "id": "hq_spectra_001",
                "name": "ğŸ“š O Livro Proibido",
                "description": "Spectra te conta sobre um livro que nunca foi lido. Encontre-o.",
                "type": "individual", "objective": "explore", "count": 8,
                "reward_xp": 15000, "reward_coins": 300, "reward_item": "PÃ¡gina do Livro Proibido",
                "lore": "Alguns conhecimentos existem para nunca serem descobertos. Ou serÃ¡ que existem para serem descobertos pelos dignos?",
                "npc": "BibliotecÃ¡ria Spectra", "difficulty": "MÃ­tico"
            }
        ]
    },
    "Imperador Astral": {
        "full_name": "Imperador Astral",
        "emoji": "ğŸ‘‘",
        "world": 60,
        "lore": [
            "Governei os cÃ©us por dez mil anos. VocÃª Ã© a primeira criatura mortal que chega atÃ© mim sem ser destruÃ­da primeiro.",
            "Os deuses nÃ£o criaram o universo. Encontraram ele. Eu fui o primeiro a acordar dentro dele.",
            "O verdadeiro poder nÃ£o Ã© destruiÃ§Ã£o. Ã‰ criaÃ§Ã£o. Qualquer tolo pode destruir â€” poucos sÃ£o capazes de criar.",
        ],
        "secrets": [
            "Existe um dÃ©cimo terceiro reino alÃ©m do Trono Celestial. NÃ£o estÃ¡ em nenhum mapa. Chega-se apenas sendo digno.",
            "O teste final nÃ£o Ã© derrotar inimigos. Ã‰ fazer uma escolha que a maioria dos herÃ³is se recusa a considerar.",
        ],
        "hidden_quests": []
    },
}

# Mapeamento de nomes parciais para NPCs
NPC_NAME_MAP = {
    "theron": "Theron", "aldeÃ£o": "Theron", "aldeao": "Theron",
    "elara": "Elara", "curandeira": "Elara",
    "sylvara": "Sylvara", "druida": "Sylvara",
    "bjorn": "Bjorn", "anciÃ£o": "Bjorn", "anciao": "Bjorn",
    "ramses": "Ramses", "arqueÃ³logo": "Ramses", "arqueologo": "Ramses",
    "spectra": "Spectra", "bibliotecÃ¡ria": "Spectra", "bibliotecaria": "Spectra",
    "imperador": "Imperador Astral", "astral": "Imperador Astral",
    "brynn": "Mercador Brynn", "mercador": "Mercador Brynn",
    "capitÃ£o": "CapitÃ£o Aldric", "capitao": "CapitÃ£o Aldric", "aldric": "CapitÃ£o Aldric",
}

# DicionÃ¡rio de canais de mundo prÃ³prio: {user_id: channel_id}
MUNDO_PROPRIO_CHANNELS = {}

# ================= HANDLER: CRIAR MUNDO PRÃ“PRIO + ADICIONAR JOGADOR =================
@bot.listen("on_message")
async def handle_mundo_proprio(message):
    if message.author.bot:
        return
    content = message.content.lower().strip()
    uid = str(message.author.id)

    # â”€â”€â”€ CRIAR MUNDO PRÃ“PRIO â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    # Pode ser usado em qualquer canal do servidor
    if content in ["criar mundo proprio", "criar mundo prÃ³prio", "criar meu mundo", "criar meu mundo proprio", "criar meu mundo prÃ³prio"]:
        if not message.guild:
            await message.channel.send("âŒ Este comando sÃ³ funciona em servidores!")
            return

        player = get_player(uid)
        if not player:
            await message.channel.send(f"âŒ {message.author.mention} Crie seu personagem primeiro com `comeÃ§ar`!")
            return

        # Verificar se jÃ¡ tem um mundo prÃ³prio ativo
        if uid in MUNDO_PROPRIO_CHANNELS:
            ch = message.guild.get_channel(MUNDO_PROPRIO_CHANNELS[uid])
            if ch:
                await message.channel.send(f"ğŸŒ {message.author.mention} VocÃª jÃ¡ tem um mundo prÃ³prio: {ch.mention}!")
                return
            else:
                # Canal foi deletado, limpar do dicionÃ¡rio e banco
                del MUNDO_PROPRIO_CHANNELS[uid]
                _db_delete_mundo_proprio(uid)

        # Categoria: â•­â”â”â”â”â”âœ¦Monstrinho (ID: 1471273874204397578)
        CATEGORIA_ID = 1471273874204397578
        categoria = message.guild.get_channel(CATEGORIA_ID)

        # Nome do canal baseado no jogador (limpar caracteres especiais)
        import re as _re
        nome_limpo = _re.sub(r'[^a-z0-9\-]', '', message.author.display_name.lower().replace(' ', '-'))
        if not nome_limpo:
            nome_limpo = str(message.author.id)
        nome_canal = f"mundo-{nome_limpo}"[:100]

        # PermissÃµes: todos podem ver, sÃ³ criador e bot podem escrever
        overwrites = {
            message.guild.default_role: discord.PermissionOverwrite(
                read_messages=True, send_messages=False, view_channel=True
            ),
            message.author: discord.PermissionOverwrite(
                read_messages=True, send_messages=True, view_channel=True,
                embed_links=True, attach_files=True
            ),
            message.guild.me: discord.PermissionOverwrite(
                read_messages=True, send_messages=True, view_channel=True,
                embed_links=True, manage_messages=True
            ),
        }

        try:
            if categoria:
                novo_canal = await message.guild.create_text_channel(
                    name=nome_canal,
                    category=categoria,
                    overwrites=overwrites,
                    topic=f"ğŸŒ Mundo prÃ³prio de {message.author.display_name} | Use 'adicionar jogador @user' para convidar!"
                )
            else:
                # Se a categoria nÃ£o existir, cria sem categoria
                novo_canal = await message.guild.create_text_channel(
                    name=nome_canal,
                    overwrites=overwrites,
                    topic=f"ğŸŒ Mundo prÃ³prio de {message.author.display_name} | Use 'adicionar jogador @user' para convidar!"
                )

            MUNDO_PROPRIO_CHANNELS[uid] = novo_canal.id
            _db_save_mundo_proprio(uid, novo_canal.id)  # persistir

            embed = discord.Embed(
                title="ğŸŒ SEU MUNDO FOI CRIADO!",
                description=(
                    f"{message.author.mention} **Bem-vindo ao seu mundo prÃ³prio!**\n\n"
                    f"*'Um novo reino surge do nada, moldado pela sua vontade...'*\n\n"
                    f"Aqui Ã© o seu domÃ­nio. Apenas vocÃª pode agir aqui â€” "
                    f"mas outros podem observar sua jornada.\n\n"
                    f"Use `adicionar jogador @usuario` para convidar alguÃ©m para explorar junto!"
                ),
                color=discord.Color.purple()
            )
            embed.add_field(
                name="ğŸ® Comandos disponÃ­veis",
                value="Todos os comandos do bot funcionam aqui!\nUse `adicionar jogador @user` para permitir que alguÃ©m jogue junto.",
                inline=False
            )
            embed.set_footer(text=f"Canal criado por {message.author.display_name}")
            await novo_canal.send(embed=embed)
            await message.channel.send(f"âœ… {message.author.mention} Seu mundo foi criado: {novo_canal.mention}!")
        except discord.Forbidden:
            await message.channel.send(
                f"âŒ {message.author.mention} O bot nÃ£o tem permissÃ£o para criar canais!\n"
                f"Um administrador precisa dar ao bot a permissÃ£o **Gerenciar Canais**."
            )
        except Exception as e:
            await message.channel.send(f"âŒ Erro ao criar o mundo: `{e}`")
        return

    # â”€â”€â”€ ADICIONAR JOGADOR AO MUNDO PRÃ“PRIO â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    if content.startswith("adicionar jogador") and message.mentions:
        # Verificar se o canal atual Ã© um mundo prÃ³prio do autor
        canal_dono = None
        for owner_id, ch_id in MUNDO_PROPRIO_CHANNELS.items():
            if ch_id == message.channel.id and owner_id == uid:
                canal_dono = uid
                break

        if not canal_dono:
            # NÃ£o responder se nÃ£o for o dono do canal
            return

        for target in message.mentions:
            if target.bot:
                continue
            try:
                await message.channel.set_permissions(
                    target,
                    read_messages=True,
                    send_messages=True
                )
                embed = discord.Embed(
                    title="ğŸ¤ Jogador Adicionado!",
                    description=(
                        f"{target.mention} **foi convidado para explorar este mundo!**\n\n"
                        f"*'Um novo aventureiro cruza as fronteiras do reino...'*\n\n"
                        f"VocÃª agora pode usar todos os comandos aqui!"
                    ),
                    color=discord.Color.green()
                )
                await message.channel.send(embed=embed)
            except Exception as e:
                await message.channel.send(f"âŒ Erro ao adicionar {target.display_name}: {e}")
        return


# ================= HANDLER: FORJAR ARMAS COM SISTEMA DE FUSÃƒO =================
@bot.listen("on_message")
async def handle_forjar_fusao(message):
    if message.author.bot:
        return
    content = message.content.lower().strip()
    uid = str(message.author.id)

    # Verificar canal (mundo proprio ou canal principal)
    canal_valido = (message.channel.name == CANAL_BETA)
    if not canal_valido:
        for owner_id, ch_id in MUNDO_PROPRIO_CHANNELS.items():
            if ch_id == message.channel.id:
                canal_valido = True
                break
    if not canal_valido:
        return

    if content not in ["forjar armas", "forjar arma", "fusÃ£o de itens", "fusao de itens", "fundir itens"]:
        return

    player = get_player(uid)
    if not player:
        await message.channel.send("âŒ Crie seu personagem primeiro!")
        return

    if player.get("job") != "Ferreiro":
        await message.channel.send(
            "âš’ï¸ **Forjar com fusÃ£o Ã© exclusivo do Ferreiro!**\n"
            "Use `procurar emprego` e escolha a profissÃ£o **Ferreiro** para desbloquear esta habilidade."
        )
        return

    # SequÃªncia de raridades para fusÃ£o
    RARITY_CHAIN = ["Comum", "Incomum", "Raro", "Ã‰pico", "LendÃ¡rio", "MÃ­tico", "Ancestral", "Divino", "Primordial"]
    RARITY_NEXT = {RARITY_CHAIN[i]: RARITY_CHAIN[i+1] for i in range(len(RARITY_CHAIN)-1)}

    # Contar itens no inventÃ¡rio por raridade â€” usa ITEMS (weapons + armor)
    inventory = player.get("inventory", [])
    rarity_counts = {}

    all_equip = ITEMS["weapons"] + ITEMS["armor"]
    all_equip_by_name = {i["name"]: i for i in all_equip}

    for item_name in inventory:
        item_data = all_equip_by_name.get(item_name)
        if item_data:
            r = item_data.get("rarity", "Comum")
            rarity_counts[r] = rarity_counts.get(r, 0) + 1

    # Mostrar painel de fusÃ£o
    embed = discord.Embed(
        title="âš’ï¸ FORJA â€” Sistema de FusÃ£o",
        description=(
            "*'A forja geme com calor sobrenatural. Cinco itens fundidos como um sÃ³...'*\n\n"
            "**Para fundir:** Use `fundir [raridade]` com mÃ­nimo de **5 itens** da mesma raridade.\n"
            "Ex: `fundir lendÃ¡rio`, `fundir mÃ­tico`\n\n"
            "**Chances de fusÃ£o:**\n"
            "âœ… **60%** â€” Item da raridade **superior** gerado!\n"
            "âš ï¸ **25%** â€” Item da **mesma raridade** (reduzido)\n"
            "ğŸ’€ **15%** â€” Todos os itens **destruÃ­dos** na fusÃ£o"
        ),
        color=discord.Color.orange()
    )

    if rarity_counts:
        inv_text = ""
        for r in RARITY_CHAIN:
            if r in rarity_counts:
                count = rarity_counts[r]
                emoji = RARITIES.get(r, {}).get("emoji", "âšª")
                next_r = RARITY_NEXT.get(r, "â€”")
                fusible = "âœ… Pode fundir!" if count >= 5 else f"âŒ Faltam {5-count} para fundir"
                inv_text += f"{emoji} **{r}**: `{count}` itens â†’ {fusible}\n"
        embed.add_field(name="ğŸ“¦ Seus Equipamentos por Raridade", value=inv_text or "_Nenhum_", inline=False)
    else:
        embed.add_field(name="ğŸ“¦ InventÃ¡rio", value="_VocÃª nÃ£o tem armas ou armaduras para fundir!\nComplete dungeons e explore para conseguir equipamentos._", inline=False)

    embed.set_footer(text="Use 'fundir [raridade]' para iniciar a fusÃ£o | Ex: 'fundir lendÃ¡rio'")
    await message.channel.send(embed=embed)


# ================= RECEITAS DE FORJA MANUAL =================
FORGE_RECIPES = {
    # ===== ARMAS =====
    "Espada de Ferro": {
        "type": "weapon", "rarity": "Incomum", "atk": 12,
        "materials": {"MinÃ©rio de Ferro": 3, "Madeira": 1},
        "cost": 50, "level_req": 1, "job_req": None,
        "desc": "Uma espada sÃ³lida de ferro. ConfiÃ¡vel e resistente."
    },
    "Machado de Batalha Forjado": {
        "type": "weapon", "rarity": "Incomum", "atk": 15,
        "materials": {"MinÃ©rio de Ferro": 4, "Couro": 1},
        "cost": 70, "level_req": 5, "job_req": None,
        "desc": "Machado balanceado para combate."
    },
    "Espada RÃºnica": {
        "type": "weapon", "rarity": "Raro", "atk": 28,
        "materials": {"MinÃ©rio de AÃ§o": 4, "Cristal Arcano": 2, "Madeira Ã‰lfica": 1},
        "cost": 200, "level_req": 15, "job_req": "Ferreiro",
        "desc": "Gravada com runas de poder. Brilha no escuro."
    },
    "Katana do TrovÃ£o": {
        "type": "weapon", "rarity": "Raro", "atk": 30,
        "materials": {"MinÃ©rio de AÃ§o": 3, "Pedra de TrovÃ£o": 2, "Seda Venenosa": 1},
        "cost": 250, "level_req": 18, "job_req": "Ferreiro",
        "desc": "Conduz eletricidade em cada corte."
    },
    "LÃ¢mina do Eclipse": {
        "type": "weapon", "rarity": "Ã‰pico", "atk": 50,
        "materials": {"MinÃ©rio de Mithril": 5, "EssÃªncia das Sombras": 3, "Pedra Lunar": 2},
        "cost": 800, "level_req": 30, "job_req": "Ferreiro",
        "desc": "Forjada sob eclipse total. Devora a luz ao redor."
    },
    "Espada dos TitÃ£s": {
        "type": "weapon", "rarity": "Ã‰pico", "atk": 53,
        "materials": {"MinÃ©rio de TitÃ¢nio": 5, "Osso de TitÃ£": 3, "NÃºcleo de Fogo": 2},
        "cost": 900, "level_req": 35, "job_req": "Ferreiro",
        "desc": "Carregada com a forÃ§a de um titÃ£ derrotado."
    },
    "Excalibur Forjada": {
        "type": "weapon", "rarity": "LendÃ¡rio", "atk": 105,
        "materials": {"MinÃ©rio Sagrado": 10, "LÃ¡grima do DragÃ£o": 5, "Fragmento Celestial": 3, "EssÃªncia Divina": 2},
        "cost": 5000, "level_req": 60, "job_req": "Ferreiro",
        "desc": "A lÃ¢mina sagrada recriada por mÃ£os mestres. Brilha com luz dourada."
    },
    "Arma do Cataclismo": {
        "type": "weapon", "rarity": "MÃ­tico", "atk": 210,
        "materials": {"MinÃ©rio do Abismo": 15, "CoraÃ§Ã£o de DragÃ£o AnciÃ£o": 5, "Fragmento do Vazio": 5, "Alma Cristalizada": 3},
        "cost": 20000, "level_req": 90, "job_req": "Ferreiro",
        "desc": "Uma arma que ameaÃ§a rasgar a realidade ao ser empunhada."
    },
    "LÃ¢mina da ExtinÃ§Ã£o": {
        "type": "weapon", "rarity": "Ancestral", "atk": 295,
        "materials": {"Fragmento Ancestral": 20, "PÃ³ de Estrela Extinta": 8, "Sangue de DragÃ£o Primordial": 5, "NÃºcleo do Cosmos": 3},
        "cost": 50000, "level_req": 120, "job_req": "Ferreiro",
        "desc": "Forjada com o material de uma estrela morta. Existe desde antes dos reinos."
    },
    "Vontade Primordial": {
        "type": "weapon", "rarity": "Primordial", "atk": 820,
        "materials": {"EssÃªncia Primordial": 30, "Fragmento do InÃ­cio": 10, "Chama Eterna": 7, "LÃ¡grima do Cosmos": 5},
        "cost": 200000, "level_req": 180, "job_req": "Ferreiro",
        "desc": "A arma mais poderosa que pode ser criada. Dizem que ela existia antes do tempo."
    },
    # ===== ARMADURAS =====
    "Armadura de Couro ReforÃ§ada": {
        "type": "armor", "rarity": "Incomum", "def": 10,
        "materials": {"Couro": 4, "Metal BÃ¡sico": 2},
        "cost": 60, "level_req": 1, "job_req": None,
        "desc": "Couro endurecido com reforÃ§os metÃ¡licos."
    },
    "Armadura de AÃ§o": {
        "type": "armor", "rarity": "Raro", "def": 22,
        "materials": {"MinÃ©rio de AÃ§o": 5, "Couro Tratado": 2, "Parafuso de Bronze": 3},
        "cost": 300, "level_req": 15, "job_req": "Ferreiro",
        "desc": "ProteÃ§Ã£o sÃ³lida de aÃ§o. Boa resistÃªncia a cortes e perfuraÃ§Ãµes."
    },
    "Armadura RÃºnica Forjada": {
        "type": "armor", "rarity": "Raro", "def": 25,
        "materials": {"MinÃ©rio de AÃ§o": 4, "Cristal Arcano": 3, "Pena de Grifo": 2},
        "cost": 350, "level_req": 20, "job_req": "Ferreiro",
        "desc": "Runas gravadas concedem resistÃªncia mÃ¡gica adicional."
    },
    "Armadura do DragÃ£o Forjada": {
        "type": "armor", "rarity": "Ã‰pico", "def": 42,
        "materials": {"Escama de DragÃ£o": 6, "MinÃ©rio de Mithril": 4, "Cristal de Fogo": 3},
        "cost": 1200, "level_req": 35, "job_req": "Ferreiro",
        "desc": "Forjada com escamas reais de dragÃ£o. Resistente ao fogo."
    },
    "Armadura das Sombras Forjada": {
        "type": "armor", "rarity": "Ã‰pico", "def": 40,
        "materials": {"EssÃªncia das Sombras": 5, "Couro de Besta Sombria": 4, "PÃ³ Noturno": 3},
        "cost": 1000, "level_req": 32, "job_req": "Ferreiro",
        "desc": "Absorve parte da luz ao redor. Dificulta ser visto no escuro."
    },
    "Ã‰gide dos Deuses Forjada": {
        "type": "armor", "rarity": "LendÃ¡rio", "def": 88,
        "materials": {"Metal Sagrado": 10, "BÃªnÃ§Ã£o Divina": 5, "Armadura de Zeus": 1, "Pedra da Eternidade": 3},
        "cost": 8000, "level_req": 65, "job_req": "Ferreiro",
        "desc": "ProteÃ§Ã£o digna dos deuses. Ningum deve usÃ¡-la sem mÃ©rito."
    },
    "Armadura do AlÃ©m": {
        "type": "armor", "rarity": "MÃ­tico", "def": 195,
        "materials": {"MinÃ©rio do Abismo": 12, "Tecido do Vazio": 6, "Cristal do Destino": 4, "Fragmento Eterno": 3},
        "cost": 25000, "level_req": 95, "job_req": "Ferreiro",
        "desc": "ProteÃ§Ã£o que existe alÃ©m do plano material. ImpossÃ­vel de ser destruÃ­da."
    },
    "CouraÃ§a Ancestral Forjada": {
        "type": "armor", "rarity": "Ancestral", "def": 280,
        "materials": {"Fragmento Ancestral": 18, "EssÃªncia do Tempo": 8, "Metal da Era Perdida": 6, "Osso de GuardiÃ£o": 4},
        "cost": 60000, "level_req": 130, "job_req": "Ferreiro",
        "desc": "Armadura dos guardiÃµes da era primordial. Pesa menos do que parece."
    },
    "Vestes do SilÃªncio Forjadas": {
        "type": "armor", "rarity": "Primordial", "def": 740,
        "materials": {"EssÃªncia Primordial": 25, "Tecido do Antes": 10, "Cristal do Cosmos": 6, "Vontade Solidificada": 4},
        "cost": 250000, "level_req": 185, "job_req": "Ferreiro",
        "desc": "A proteÃ§Ã£o mais absoluta que pode ser criada. Forjada no inÃ­cio de tudo."
    },
}


@bot.listen("on_message")
async def handle_forge_craft(message):
    """Sistema de forja manual de armas e armaduras"""
    if message.author.bot:
        return
    content = message.content.lower().strip()
    uid = str(message.author.id)

    canal_valido = (message.channel.name == CANAL_BETA)
    if not canal_valido:
        for owner_id, ch_id in MUNDO_PROPRIO_CHANNELS.items():
            if ch_id == message.channel.id:
                canal_valido = True
                break
    if not canal_valido:
        return

    # ===== RECEITAS DE FORJA =====
    if content in ["receitas de forja", "receitas forja", "o que posso forjar", "forjar o quÃª", "forjar o que"]:
        player = get_player(uid)
        if not player:
            return

        RARITY_EMOJIS = {
            "Comum": "â¬œ", "Incomum": "ğŸŸ©", "Raro": "ğŸŸ¦",
            "Ã‰pico": "ğŸŸª", "LendÃ¡rio": "ğŸŸ¨", "MÃ­tico": "ğŸ”´",
            "Ancestral": "ğŸŸ ", "Divino": "âœ¨", "Primordial": "ğŸ’ "
        }
        embed = discord.Embed(
            title="âš’ï¸ Receitas de Forja",
            description="*'Cada peÃ§a-prima comeÃ§a com uma centelha e materiais certos.'*\n\nUse `forjar [nome]` para criar um item!\n**Ferreiros** tÃªm acesso a receitas raras+.",
            color=discord.Color.orange()
        )
        # Agrupar por raridade
        by_rarity = {}
        for item_name, recipe in FORGE_RECIPES.items():
            r = recipe["rarity"]
            by_rarity.setdefault(r, []).append((item_name, recipe))

        RARITY_ORDER = ["Incomum", "Raro", "Ã‰pico", "LendÃ¡rio", "MÃ­tico", "Ancestral", "Divino", "Primordial"]
        for rar in RARITY_ORDER:
            if rar not in by_rarity:
                continue
            lines = []
            for iname, irec in by_rarity[rar]:
                emoji = RARITY_EMOJIS.get(rar, "âšª")
                type_icon = "âš”ï¸" if irec["type"] == "weapon" else "ğŸ›¡ï¸"
                job_txt = f" _(Ferreiro)_" if irec.get("job_req") else ""
                lvl_txt = f" Lv.{irec['level_req']}+" if irec["level_req"] > 1 else ""
                lines.append(f"{type_icon} **{iname}**{lvl_txt}{job_txt}")
            if lines:
                embed.add_field(
                    name=f"{RARITY_EMOJIS.get(rar,'âšª')} {rar}",
                    value="\n".join(lines),
                    inline=True
                )
        embed.set_footer(text="Use 'detalhes forja [nome]' para ver materiais | 'forjar [nome]' para criar")
        await message.channel.send(embed=embed)
        return

    # ===== DETALHES DA RECEITA =====
    if content.startswith("detalhes forja "):
        player = get_player(uid)
        if not player:
            return
        item_query = content[15:].strip()
        found = None
        for iname, recipe in FORGE_RECIPES.items():
            if item_query in iname.lower() or iname.lower() in item_query:
                found = (iname, recipe)
                break
        if not found:
            await message.channel.send(f"âŒ Receita nÃ£o encontrada para **'{item_query}'**.\nUse `receitas de forja` para ver todas.")
            return
        iname, recipe = found
        RARITY_COLORS = {
            "Incomum": discord.Color.green(), "Raro": discord.Color.blue(),
            "Ã‰pico": discord.Color.purple(), "LendÃ¡rio": discord.Color.gold(),
            "MÃ­tico": discord.Color.red(), "Ancestral": discord.Color.orange(),
            "Primordial": discord.Color.from_rgb(0, 200, 255)
        }
        embed = discord.Embed(
            title=f"âš’ï¸ Receita: {iname}",
            description=f"_{recipe['desc']}_",
            color=RARITY_COLORS.get(recipe["rarity"], discord.Color.light_grey())
        )
        type_icon = "âš”ï¸" if recipe["type"] == "weapon" else "ğŸ›¡ï¸"
        stat_key = "atk" if recipe["type"] == "weapon" else "def"
        embed.add_field(name="ğŸ“‹ Tipo", value=f"{type_icon} {recipe['type'].capitalize()} | {stat_key.upper()}: +{recipe[stat_key]}", inline=True)
        embed.add_field(name="â­ Raridade", value=recipe["rarity"], inline=True)
        embed.add_field(name="ğŸ“Š Requisitos", value=f"NÃ­vel {recipe['level_req']}+ | {'Ferreiro' if recipe.get('job_req') else 'Qualquer classe'}", inline=True)
        # Materiais
        mat_lines = []
        inv_counts = {}
        inv = player.get("inventory", [])
        for item in inv:
            item_n = item if isinstance(item, str) else item.get("name", "")
            inv_counts[item_n] = inv_counts.get(item_n, 0) + 1
        for mat, qty in recipe["materials"].items():
            have = inv_counts.get(mat, 0)
            status = "âœ…" if have >= qty else f"âŒ ({have}/{qty})"
            mat_lines.append(f"{status} **{mat}** Ã— {qty}")
        embed.add_field(name="ğŸ§± Materiais NecessÃ¡rios", value="\n".join(mat_lines), inline=False)
        embed.add_field(name="ğŸ’° Custo de Forja", value=f"`{recipe['cost']:,}` CSI", inline=True)
        can_forge = player["level"] >= recipe["level_req"] and (not recipe.get("job_req") or player.get("job") == recipe["job_req"])
        has_mats = all(inv_counts.get(m, 0) >= q for m, q in recipe["materials"].items())
        has_coins = player["coins"] >= recipe["cost"]
        status_txt = "âœ… **VocÃª pode forjar este item!**" if (can_forge and has_mats and has_coins) else "âŒ Requisitos nÃ£o atendidos (veja acima)"
        embed.add_field(name="ğŸ“Œ Status", value=status_txt, inline=False)
        embed.set_footer(text=f"Use 'forjar {iname}' para criar este item!")
        await message.channel.send(embed=embed)
        return

    # ===== FORJAR ITEM =====
    if content.startswith("forjar ") and content not in ["forjar armas", "forjar arma", "fusÃ£o de itens", "fusao de itens", "fundir itens"]:
        item_query = content[7:].strip()
        # Evitar conflito com o sistema de fusÃ£o
        if item_query in ["armas", "arma", "fusÃ£o", "fusao"]:
            return

        player = get_player(uid)
        if not player:
            return

        # Encontrar receita (busca parcial)
        found = None
        for iname, recipe in FORGE_RECIPES.items():
            if item_query in iname.lower() or iname.lower() in item_query:
                found = (iname, recipe)
                break
        if not found:
            await message.channel.send(
                f"âŒ Receita **'{item_query}'** nÃ£o encontrada!\n"
                f"Use `receitas de forja` para ver todas as receitas disponÃ­veis.\n"
                f"Use `detalhes forja [nome]` para ver materiais de uma receita."
            )
            return

        iname, recipe = found

        # Verificar nÃ­vel
        if player["level"] < recipe["level_req"]:
            await message.channel.send(f"âŒ VocÃª precisa ser **nÃ­vel {recipe['level_req']}** para forjar **{iname}**!\nSeu nÃ­vel: {player['level']}")
            return

        # Verificar emprego (se necessÃ¡rio)
        if recipe.get("job_req") and player.get("job") != recipe["job_req"]:
            await message.channel.send(f"âŒ Apenas **{recipe['job_req']}** pode forjar **{iname}**!\nUse `procurar emprego` para mudar de profissÃ£o.")
            return

        # Verificar moedas
        if player["coins"] < recipe["cost"]:
            await message.channel.send(f"âŒ VocÃª precisa de **{recipe['cost']:,} CSI** para forjar **{iname}**!\nVocÃª tem: `{player['coins']:,}` CSI.")
            return

        # Verificar e consumir materiais
        inv = list(player.get("inventory", []))
        inv_counts = {}
        for item in inv:
            item_n = item if isinstance(item, str) else item.get("name", "")
            inv_counts[item_n] = inv_counts.get(item_n, 0) + 1

        missing = []
        for mat, qty in recipe["materials"].items():
            if inv_counts.get(mat, 0) < qty:
                missing.append(f"**{mat}** (precisa {qty}, tem {inv_counts.get(mat, 0)})")

        if missing:
            await message.channel.send(
                f"âŒ Materiais insuficientes para forjar **{iname}**!\n\n"
                f"Faltam:\n" + "\n".join(missing)
            )
            return

        # Consumir materiais
        for mat, qty in recipe["materials"].items():
            removed = 0
            new_inv = []
            for item in inv:
                item_n = item if isinstance(item, str) else item.get("name", "")
                if item_n == mat and removed < qty:
                    removed += 1
                else:
                    new_inv.append(item)
            inv = new_inv

        # Adicionar item forjado
        inv.append(iname)
        player["inventory"] = inv
        player["coins"] -= recipe["cost"]
        save_player_db(uid, player)

        RARITY_COLORS = {
            "Incomum": discord.Color.green(), "Raro": discord.Color.blue(),
            "Ã‰pico": discord.Color.purple(), "LendÃ¡rio": discord.Color.gold(),
            "MÃ­tico": discord.Color.red(), "Ancestral": discord.Color.orange(),
            "Primordial": discord.Color.from_rgb(0, 200, 255)
        }
        RARITY_EMOJIS = {
            "Comum": "â¬œ", "Incomum": "ğŸŸ©", "Raro": "ğŸŸ¦", "Ã‰pico": "ğŸŸª",
            "LendÃ¡rio": "ğŸŸ¨", "MÃ­tico": "ğŸ”´", "Ancestral": "ğŸŸ ",
            "Divino": "âœ¨", "Primordial": "ğŸ’ "
        }
        rar = recipe["rarity"]
        type_icon = "âš”ï¸" if recipe["type"] == "weapon" else "ğŸ›¡ï¸"
        stat_key = "atk" if recipe["type"] == "weapon" else "def"

        embed = discord.Embed(
            title=f"âš’ï¸ {RARITY_EMOJIS.get(rar,'âšª')} {iname} FORJADO!",
            description=f"*'O metal resfria. Sua obra-prima estÃ¡ completa.'*\n\n_{recipe['desc']}_",
            color=RARITY_COLORS.get(rar, discord.Color.orange())
        )
        embed.add_field(name=f"{type_icon} Tipo", value=f"{recipe['type'].capitalize()}", inline=True)
        embed.add_field(name=f"{'âš”ï¸' if stat_key=='atk' else 'ğŸ›¡ï¸'} {stat_key.upper()}", value=f"+{recipe[stat_key]}", inline=True)
        embed.add_field(name="â­ Raridade", value=rar, inline=True)
        mat_txt = " | ".join([f"{mat} Ã—{qty}" for mat, qty in recipe["materials"].items()])
        embed.add_field(name="ğŸ§± Materiais Usados", value=mat_txt, inline=False)
        embed.add_field(name="ğŸ’° CSI Gasto", value=f"`{recipe['cost']:,}` CSI", inline=True)
        embed.set_footer(text=f"Use 'equipar {iname}' para equipar | 'inspecionar arma {iname}' para detalhes")
        await message.channel.send(embed=embed)
        # Adicionar ao ITEMS para ser reconhecida pelo sistema
        existing = [i["name"] for i in ITEMS[recipe["type"] + "s"]]
        if iname not in existing:
            ITEMS[recipe["type"] + "s"].append({"name": iname, "rarity": rar, stat_key: recipe[stat_key]})
        return


@bot.listen("on_message")
async def handle_fundir_raridade(message):
    if message.author.bot:
        return
    content = message.content.lower().strip()
    uid = str(message.author.id)

    canal_valido = (message.channel.name == CANAL_BETA)
    if not canal_valido:
        for owner_id, ch_id in MUNDO_PROPRIO_CHANNELS.items():
            if ch_id == message.channel.id:
                canal_valido = True
                break
    if not canal_valido:
        return

    if not content.startswith("fundir "):
        return

    rarity_input = content.replace("fundir ", "").strip().capitalize()
    # Normalizar
    RARITY_ALIASES = {
        "Comum": "Comum", "Incomum": "Incomum", "Raro": "Raro", "Epico": "Ã‰pico", "Ã‰pico": "Ã‰pico",
        "Lendario": "LendÃ¡rio", "LendÃ¡rio": "LendÃ¡rio", "Mitico": "MÃ­tico", "MÃ­tico": "MÃ­tico",
        "Ancestral": "Ancestral", "Divino": "Divino", "Primordial": "Primordial"
    }
    rarity = RARITY_ALIASES.get(rarity_input)
    if not rarity:
        await message.channel.send(f"âŒ Raridade invÃ¡lida: **{rarity_input}**\nRaridades vÃ¡lidas: Comum, Incomum, Raro, Ã‰pico, LendÃ¡rio, MÃ­tico, Ancestral, Divino, Primordial")
        return

    player = get_player(uid)
    if not player:
        return

    if player.get("job") != "Ferreiro":
        await message.channel.send("âš’ï¸ Apenas **Ferreiros** podem fundir itens!")
        return

    # SequÃªncia de raridades
    RARITY_CHAIN = ["Comum", "Incomum", "Raro", "Ã‰pico", "LendÃ¡rio", "MÃ­tico", "Ancestral", "Divino", "Primordial"]
    RARITY_NEXT = {RARITY_CHAIN[i]: RARITY_CHAIN[i+1] for i in range(len(RARITY_CHAIN)-1)}

    # Coletar itens do inventÃ¡rio com a raridade especificada â€” usa ITEMS real
    inventory = player.get("inventory", [])
    all_equip = ITEMS["weapons"] + ITEMS["armor"]
    all_equip_by_name = {i["name"]: i for i in all_equip}

    matching_items = [
        item_name for item_name in inventory
        if all_equip_by_name.get(item_name, {}).get("rarity", "") == rarity
    ]

    if len(matching_items) < 5:
        await message.channel.send(
            f"âŒ VocÃª precisa de pelo menos **5 equipamentos {rarity}** para fundir!\n"
            f"VocÃª tem: **{len(matching_items)}** {RARITIES.get(rarity,{}).get('emoji','')} {rarity}\n\n"
            f"*Dica: Complete dungeons, explore e caÃ§e para conseguir mais equipamentos.*"
        )
        return

    # Remover 5 itens do inventÃ¡rio
    removed = 0
    new_inventory = list(inventory)
    for item_name in matching_items[:5]:
        if item_name in new_inventory:
            new_inventory.remove(item_name)
            removed += 1

    # Rolar resultado
    roll = random.random()
    next_rarity = RARITY_NEXT.get(rarity)

    # Pool de itens da raridade alvo â€” de ITEMS real
    def get_items_of_rarity(target_rarity):
        return [i["name"] for i in (ITEMS["weapons"] + ITEMS["armor"]) if i.get("rarity") == target_rarity]

    if roll < 0.60 and next_rarity:
        possible = get_items_of_rarity(next_rarity)
        new_item = random.choice(possible) if possible else f"Fragmento {next_rarity}"
        new_inventory.append(new_item)
        embed = discord.Embed(
            title="âœ¨ FUSÃƒO BEM-SUCEDIDA!",
            description=f"*'As chamas da forja rugem! Os cinco itens se fundem em um sÃ³!'*",
            color=discord.Color.gold()
        )
        embed.add_field(
            name="âš’ï¸ Resultado",
            value=f"5Ã— {RARITIES.get(rarity,{}).get('emoji','')} **{rarity}** â†’ {RARITIES.get(next_rarity,{}).get('emoji','')} **{new_item}** ({next_rarity})",
            inline=False
        )
        embed.add_field(name="ğŸ‰ ParabÃ©ns!", value=f"**{new_item}** ({next_rarity}) adicionado ao inventÃ¡rio!\nUse `equipar {new_item}` para equipar.", inline=False)

    elif roll < 0.85:
        possible = get_items_of_rarity(rarity)
        new_item = random.choice(possible) if possible else f"Fragmento {rarity}"
        new_inventory.append(new_item)
        embed = discord.Embed(
            title="âš ï¸ FUSÃƒO PARCIAL",
            description=f"*'A forja tremeu. Os itens se fundiram, mas algo foi perdido no processo...'*",
            color=discord.Color.orange()
        )
        embed.add_field(
            name="âš’ï¸ Resultado",
            value=f"5Ã— {RARITIES.get(rarity,{}).get('emoji','')} **{rarity}** â†’ {RARITIES.get(rarity,{}).get('emoji','')} **{new_item}** ({rarity})",
            inline=False
        )
        embed.add_field(name="ğŸ’¡ Dica", value="Tente novamente! As chances de sucesso total sÃ£o **60%**.", inline=False)

    else:
        embed = discord.Embed(
            title="ğŸ’€ FUSÃƒO FRACASSADA!",
            description=f"*'Uma explosÃ£o de energia. Os itens se dissolvem em pÃ³ dourado... e somem.'*",
            color=discord.Color.red()
        )
        embed.add_field(
            name="ğŸ’¥ Resultado",
            value=f"5Ã— {RARITIES.get(rarity,{}).get('emoji','')} **{rarity}** â†’ âŒ **Todos destruÃ­dos!**",
            inline=False
        )
        embed.add_field(name="ğŸ˜” Azar...", value="Os equipamentos foram perdidos. Colete mais e tente novamente!", inline=False)

    player["inventory"] = new_inventory
    save_player_db(uid, player)
    embed.set_footer(text=f"Ferreiro {message.author.display_name} | FusÃ£o de {rarity}")
    await message.channel.send(embed=embed)


# ================= HANDLER: DIALOGAR COM NPC =================
@bot.listen("on_message")
async def handle_dialogar_npc(message):
    if message.author.bot:
        return
    content = message.content.lower().strip()
    uid = str(message.author.id)

    canal_valido = (message.channel.name == CANAL_BETA)
    if not canal_valido:
        for owner_id, ch_id in MUNDO_PROPRIO_CHANNELS.items():
            if ch_id == message.channel.id:
                canal_valido = True
                break
    if not canal_valido:
        return

    if not (content.startswith("dialogar com npc") or content.startswith("falar com npc") or
            content.startswith("conversar com npc") or content.startswith("dialogar npc")):
        return

    # Extrair nome do NPC
    for prefix in ["dialogar com npc ", "falar com npc ", "conversar com npc ", "dialogar npc "]:
        if content.startswith(prefix):
            npc_name_input = content.replace(prefix, "").strip()
            break
    else:
        npc_name_input = ""

    if not npc_name_input:
        # Mostrar lista de NPCs disponÃ­veis
        embed = discord.Embed(
            title="ğŸ—£ï¸ Dialogar com NPC",
            description=(
                "*'Os NPCs do reino tÃªm muito a contar...'*\n\n"
                "Use: `dialogar com npc [nome]`\n\n"
                "**NPCs disponÃ­veis:**\n"
                "â€¢ `dialogar com npc theron` â€” AldeÃ£o Theron\n"
                "â€¢ `dialogar com npc elara` â€” Curandeira Elara\n"
                "â€¢ `dialogar com npc sylvara` â€” Druida Sylvara\n"
                "â€¢ `dialogar com npc bjorn` â€” AnciÃ£o Bjorn\n"
                "â€¢ `dialogar com npc ramses` â€” ArqueÃ³logo Ramses\n"
                "â€¢ `dialogar com npc spectra` â€” BibliotecÃ¡ria Spectra\n"
                "â€¢ `dialogar com npc imperador` â€” Imperador Astral\n"
                "â€¢ ...e outros NPCs dos reinos!"
            ),
            color=discord.Color.blurple()
        )
        await message.channel.send(embed=embed)
        return

    player = get_player(uid)
    if not player:
        await message.channel.send("âŒ Crie seu personagem primeiro com `comeÃ§ar`!")
        return

    # Encontrar NPC
    npc_key = NPC_NAME_MAP.get(npc_name_input.lower())

    if not npc_key or npc_key not in NPC_DIALOGUES_EXTENDED:
        # Tentar encontrar em CITY_NPCS
        world_key = max(k for k in player.get("worlds", [1]))
        city_data = CITY_NPCS.get(world_key, {})
        npcs_list = city_data.get("npcs", [])
        found_npc = None
        for npc in npcs_list:
            if npc_name_input.lower() in npc["name"].lower():
                found_npc = npc
                break

        if found_npc:
            dialogue = random.choice(found_npc["dialogues"])
            embed = discord.Embed(
                title=f"{found_npc['emoji']} {found_npc['name']} â€” _{found_npc['role']}_",
                description=f'*"{dialogue}"*',
                color=discord.Color.purple()
            )
            embed.set_footer(text="Use 'dialogar com npc [nome]' novamente para ouvir mais!")
            await message.channel.send(embed=embed)
        else:
            await message.channel.send(
                f"â“ NPC **{npc_name_input}** nÃ£o encontrado!\n"
                f"Use `dialogar com npc` para ver a lista de NPCs disponÃ­veis."
            )
        return

    npc_data = NPC_DIALOGUES_EXTENDED[npc_key]

    # Rolar tipo de diÃ¡logo: lore, segredo ou quest
    roll = random.random()
    if roll < 0.50 and npc_data.get("lore"):
        # Lore
        dialogue = random.choice(npc_data["lore"])
        embed = discord.Embed(
            title=f"{npc_data['emoji']} {npc_data['full_name']}",
            description=f'*"{dialogue}"*',
            color=discord.Color.purple()
        )
        embed.set_footer(text="Continue dialogando para descobrir mais histÃ³rias, segredos e quests ocultas!")

    elif roll < 0.75 and npc_data.get("secrets"):
        # Segredo!
        secret = random.choice(npc_data["secrets"])
        embed = discord.Embed(
            title=f"ğŸ”® {npc_data['emoji']} {npc_data['full_name']} â€” *sussurra um segredo...*",
            description=f'*"{secret}"*',
            color=discord.Color.dark_purple()
        )
        embed.add_field(name="ğŸ¤« Segredo Revelado!", value="Guarde bem esta informaÃ§Ã£o â€” ela pode ser valiosa.", inline=False)
        embed.set_footer(text="Segredos podem levar a quests ocultas e recompensas raras!")

    elif npc_data.get("hidden_quests"):
        # Quest oculta!
        quest = random.choice(npc_data["hidden_quests"])
        embed = discord.Embed(
            title=f"â­ {npc_data['emoji']} {npc_data['full_name']} â€” *revela uma missÃ£o oculta!*",
            description=f'*"Tenho algo importante para te pedir... mas nÃ£o Ã© uma missÃ£o comum."*\n\n**{quest["name"]}**\n{quest["description"]}',
            color=discord.Color.gold()
        )
        embed.add_field(name="ğŸ“– Lore", value=quest["lore"], inline=False)
        rewards = f"â­ **{quest['reward_xp']} XP** | ğŸ’° **{quest['reward_coins']} coins**"
        if quest.get("reward_item"):
            rewards += f" | ğŸ **{quest['reward_item']}**"
        embed.add_field(name="ğŸ† Recompensas", value=rewards, inline=False)
        embed.add_field(name="âš”ï¸ Dificuldade", value=quest["difficulty"], inline=True)
        embed.set_footer(text="Quest oculta desbloqueada via diÃ¡logo com NPC! Use 'aceitar quest [nome]' para iniciar.")
        # Oferecer aceitar
        view = QuestAcceptButton(uid, quest)
        await message.channel.send(embed=embed, view=view)
        return
    else:
        # Fallback: lore
        if npc_data.get("lore"):
            dialogue = random.choice(npc_data["lore"])
        else:
            dialogue = "..."
        embed = discord.Embed(
            title=f"{npc_data['emoji']} {npc_data['full_name']}",
            description=f'*"{dialogue}"*',
            color=discord.Color.purple()
        )
        embed.set_footer(text="Continue dialogando para descobrir mais!")

    await message.channel.send(embed=embed)


# ================= HANDLER: FORMA BESTIAL E QUARTA FORMA (PETS) =================
@bot.listen("on_message")
async def handle_formas_especiais_pet(message):
    if message.author.bot:
        return
    content = message.content.lower().strip()
    uid = str(message.author.id)

    canal_valido = (message.channel.name == CANAL_BETA)
    if not canal_valido:
        for owner_id, ch_id in MUNDO_PROPRIO_CHANNELS.items():
            if ch_id == message.channel.id:
                canal_valido = True
                break
    if not canal_valido:
        return

    # â”€â”€â”€ QUARTA FORMA (exclusiva pets comuns) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    if content in ["quarta forma pet", "forma especial pet", "quarta forma", "evoluir quarta forma"]:
        player = get_player(uid)
        if not player or not player.get("pet"):
            await message.channel.send("âŒ VocÃª nÃ£o tem um pet ativo!")
            return

        pet_name = player["pet"]
        if isinstance(pet_name, dict):
            pet_name = pet_name.get("name", "")

        # Verificar se o pet Ã© Comum
        current_rarity = None
        for world_pets in PETS.values():
            for p in world_pets:
                if p["name"] == pet_name:
                    current_rarity = p["rarity"]
                    break

        # Verificar nas evoluÃ§Ãµes
        if not current_rarity:
            for evo in PET_EVOLUTIONS.values():
                if evo.get("next") == pet_name:
                    current_rarity = evo["next_data"].get("rarity")

        if current_rarity != "Comum":
            await message.channel.send(
                f"âŒ A **Quarta Forma** Ã© exclusiva de pets de raridade **Comum**!\n"
                f"Seu pet **{pet_name}** Ã© de raridade **{current_rarity or '?'}**.\n\n"
                f"*Pets de raridade LendÃ¡rio ou superior podem ter Forma Bestial (use `forma bestial pet` no nÃ­vel 80)!*"
            )
            return

        # Verificar se tem quarta forma
        fourth_form_data = COMMON_PET_FOURTH_FORMS.get(pet_name)
        if not fourth_form_data:
            # Qualquer pet comum sem quarta forma registrada ganha uma genÃ©rica
            fourth_form_data = {
                "level_required": 3,
                "next": f"{pet_name} Desperto",
                "next_data": {
                    "name": f"{pet_name} Desperto",
                    "emoji": "âœ¨",
                    "rarity": "Comum",
                    "bonus_hp": 50, "bonus_atk": 20,
                    "special": True, "form": "quarta_forma",
                    "desc": f"A quarta forma exclusiva do {pet_name}. Uma forma Ãºnica que nenhum pet raro possui!"
                }
            }

        if player["level"] < fourth_form_data["level_required"]:
            await message.channel.send(
                f"âŒ Seu pet precisa que vocÃª seja **NÃ­vel {fourth_form_data['level_required']}** para atingir a Quarta Forma!\n"
                f"NÃ­vel atual: **{player['level']}**"
            )
            return

        next_pet = fourth_form_data["next_data"]
        player["pet"] = next_pet["name"]
        save_player_db(uid, player)

        embed = discord.Embed(
            title="âœ¨ QUARTA FORMA DESBLOQUEADA! âœ¨",
            description=(
                f"*'Uma aura dourada envolve {pet_name}... mas algo diferente acontece desta vez!'*\n\n"
                f"ğŸŒŸ **{pet_name}** â†’ {next_pet['emoji']} **{next_pet['name']}** â€” *Quarta Forma Exclusiva!*\n\n"
                f"*'{next_pet['desc']}'*"
            ),
            color=discord.Color.from_rgb(255, 215, 0)
        )
        embed.add_field(name="ğŸ’ª ATK BÃ´nus", value=f"+{next_pet['bonus_atk']}", inline=True)
        embed.add_field(name="â¤ï¸ HP BÃ´nus", value=f"+{next_pet['bonus_hp']}", inline=True)
        embed.add_field(name="âšª Raridade", value="Comum â€” Quarta Forma Exclusiva!", inline=True)
        embed.add_field(
            name="ğŸ”® Exclusividade",
            value="*Esta forma NUNCA poderÃ¡ ser alcanÃ§ada por pets raros ou superiores. Ã‰ o poder secreto dos Comuns!*",
            inline=False
        )
        embed.set_footer(text="Pets comuns tÃªm formas que nenhum lendÃ¡rio jamais alcanÃ§arÃ¡...")
        await message.channel.send(embed=embed)
        return

    # â”€â”€â”€ FORMA BESTIAL (pets de nÃ­vel alto, nÃ­vel 80 do jogador) â”€â”€â”€â”€â”€â”€
    if content in ["forma bestial pet", "despertar bestial", "forma bestial", "bestial pet"]:
        player = get_player(uid)
        if not player or not player.get("pet"):
            await message.channel.send("âŒ VocÃª nÃ£o tem um pet ativo!")
            return

        if player["level"] < 80:
            await message.channel.send(
                f"ğŸ”’ **Forma Bestial** requer que vocÃª seja **NÃ­vel 80**!\n"
                f"NÃ­vel atual: **{player['level']}**\n\n"
                f"*'O despertar bestial exige um mestre, nÃ£o um aprendiz...'*"
            )
            return

        pet_name = player["pet"]
        if isinstance(pet_name, dict):
            pet_name = pet_name.get("name", "")

        bestial_data = BESTIAL_FORMS.get(pet_name)
        if not bestial_data:
            await message.channel.send(
                f"âŒ **{pet_name}** nÃ£o possui Forma Bestial registrada.\n\n"
                f"Pets elegÃ­veis para Forma Bestial sÃ£o de raridade **LendÃ¡rio** ou superior.\n"
                f"Use `ver fazenda` para verificar seus pets."
            )
            return

        next_pet = bestial_data
        player["pet"] = next_pet["name"]
        save_player_db(uid, player)

        embed = discord.Embed(
            title="ğŸ”¥ FORMA BESTIAL DESPERTADA! ğŸ”¥",
            description=(
                f"*'O poder ancestral surge do mais fundo do ser... A Forma Bestial foi liberada!'*\n\n"
                f"ğŸ’€ **{pet_name}** â†’ {next_pet['emoji']} **{next_pet['name']}** â€” *Forma Bestial!*\n\n"
                f"*'{next_pet['desc']}'*"
            ),
            color=discord.Color.dark_red()
        )
        embed.add_field(name="ğŸ’ª ATK BÃ´nus", value=f"+{next_pet['bonus_atk']}", inline=True)
        embed.add_field(name="â¤ï¸ HP BÃ´nus", value=f"+{next_pet['bonus_hp']}", inline=True)
        embed.add_field(name=f"{RARITIES.get(next_pet['rarity'],{}).get('emoji','âœ¨')} Raridade", value=next_pet["rarity"], inline=True)
        embed.add_field(
            name="âš ï¸ AtenÃ§Ã£o",
            value="*A Forma Bestial Ã© permanente. Uma vez despertada, nÃ£o pode ser revertida.*",
            inline=False
        )
        embed.set_footer(text="Apenas mestres de nÃ­vel 80+ podem despertar a Forma Bestial.")
        await message.channel.send(embed=embed)
        return

    # Verificar canal mundo prÃ³prio para comandos do bot principal
    if not canal_valido:
        return

    if content in ["ajuda formas pet", "formas pet", "formas especiais pet"]:
        embed = discord.Embed(
            title="ğŸ¾ Formas Especiais de Pets",
            description="Sistema de transformaÃ§Ãµes especiais para seus companheiros!",
            color=discord.Color.purple()
        )
        embed.add_field(
            name="âœ¨ Quarta Forma (Pets Comuns)",
            value=(
                "Exclusiva para pets de raridade **Comum**!\n"
                "Use: `quarta forma pet`\n"
                "Requer: NÃ­vel 3+ do jogador\n"
                "Uma forma que nenhum pet raro jamais poderÃ¡ alcanÃ§ar."
            ),
            inline=False
        )
        embed.add_field(
            name="ğŸ”¥ Forma Bestial (Pets LendÃ¡rio+)",
            value=(
                "Exclusiva para pets de raridade **LendÃ¡rio** ou superior!\n"
                "Use: `forma bestial pet`\n"
                "Requer: **NÃ­vel 80** do jogador\n"
                "Desperta o poder ancestral adormecido no pet."
            ),
            inline=False
        )
        await message.channel.send(embed=embed)


# ================= COMANDO: USAR CHAVE =================
@bot.listen("on_message")
async def handle_usar_chave(message):
    if message.author.bot:
        return
    if message.channel.name != CANAL_BETA and message.channel.id not in MUNDO_PROPRIO_CHANNELS.values():
        return

    content = message.content.strip()
    content_lower = content.lower()
    uid = str(message.author.id)

    # Aceita: "usar chave [nome]" ou "usar chave da dungeon [nome]"
    if not content_lower.startswith("usar chave"):
        return

    player = get_player(uid)
    if not player:
        await message.channel.send("âŒ Crie seu personagem primeiro com `comeÃ§ar`!")
        return

    # Extrai a parte depois de "usar chave"
    query = content[len("usar chave"):].strip()
    # Remove prefixos comuns como "da", "do", "de", "da dungeon"
    for prefix in ["da dungeon ", "do dungeon ", "de dungeon ", "da ", "do ", "de "]:
        if query.lower().startswith(prefix):
            query = query[len(prefix):]
            break

    if not query:
        # Mostra ajuda
        keys_in_inv = [i for i in player.get("inventory", []) if i.startswith("ğŸ—ï¸")]
        if not keys_in_inv:
            await message.channel.send(
                "âŒ VocÃª nÃ£o tem nenhuma chave!\n\n"
                "ğŸ’¡ Complete dungeons comuns com `dungeon` para encontrar chaves nos baÃºs."
            )
        else:
            chaves_txt = "\n".join(f"â€¢ `{k}`" for k in set(keys_in_inv))
            await message.channel.send(
                f"ğŸ—ï¸ **Suas chaves:**\n{chaves_txt}\n\n"
                f"**Como usar:** `usar chave [nome da dungeon]`\n"
                f"**Exemplo:** `usar chave Gruta Esquecida`\n\n"
                f"Use `ver chaves` para ver quais dungeons cada chave abre."
            )
        return

    # Procura a dungeon secreta pelo nome em TODOS os mundos
    found_dungeon = None
    found_world_data = None
    query_lower = query.lower()

    for w_data in WORLDS.values():
        for sd in w_data.get("secret_dungeons", []):
            sd_name_clean = sd["name"].lower()
            # Remove emojis para comparaÃ§Ã£o mais flexÃ­vel
            import re as _re
            sd_name_text = _re.sub(r'[^\w\s]', '', sd_name_clean).strip()
            q_text = _re.sub(r'[^\w\s]', '', query_lower).strip()
            if q_text in sd_name_text or sd_name_text in q_text or q_text in sd_name_clean:
                found_dungeon = sd
                found_world_data = w_data
                break
        if found_dungeon:
            break

    if not found_dungeon:
        await message.channel.send(
            f"âŒ Nenhuma dungeon secreta encontrada com o nome **'{query}'**.\n\n"
            f"Use `ver chaves` para ver as dungeons disponÃ­veis no seu reino atual, ou `dungeon` para explorar."
        )
        return

    key_name = found_dungeon.get("key_name", "")
    if not key_name:
        await message.channel.send(f"âŒ Esta dungeon nÃ£o precisa de chave. Use `dungeon` para acessÃ¡-la.")
        return

    # Verifica se o jogador tem a chave
    if key_name not in player.get("inventory", []):
        await message.channel.send(
            f"ğŸ”’ **VocÃª nÃ£o tem a chave certa!**\n\n"
            f"A dungeon **{found_dungeon['name']}** requer: **{key_name}**\n\n"
            f"ğŸ—ï¸ Suas chaves atuais: {', '.join(set(i for i in player.get('inventory', []) if i.startswith('ğŸ—ï¸'))) or '*nenhuma*'}\n\n"
            f"ğŸ’¡ Complete dungeons comuns com `dungeon` para encontrar chaves."
        )
        return

    # Consome a chave e entra na dungeon
    player["inventory"].remove(key_name)
    save_player_db(uid, player)

    drop_rarity = found_dungeon.get("special_boss_drop", "Ã‰pico")
    rarity_info = RARITIES.get(drop_rarity, RARITIES.get("Ã‰pico", {"emoji": "ğŸŸ£"}))

    embed = discord.Embed(
        title=f"ğŸ”® DUNGEON SECRETA â€” {found_dungeon['name']}",
        description=(
            f"*'A chave brilha ao toque... a porta de pedra comeÃ§a a tremer e se abre lentamente!'*\n\n"
            f"ğŸ—ï¸ **{key_name}** foi consumida.\n"
            f"ğŸ‘¹ Boss: **{found_dungeon['boss']}**\n"
            f"{rarity_info['emoji']} Drop mÃ¡ximo: **{drop_rarity}**"
        ),
        color=discord.Color.purple()
    )
    embed.set_footer(text="Preparado? A dungeon secreta aguarda...")
    await message.channel.send(embed=embed)
    await asyncio.sleep(2)

    # Usa found_world_data como contexto do mundo
    await explore_dungeon(message.channel, uid, found_dungeon, found_world_data)


# ================= COMANDO: MONTARIA =================
@bot.listen("on_message")
async def handle_montaria(message):
    if message.author.bot:
        return
    if message.channel.name != CANAL_BETA and message.channel.id not in MUNDO_PROPRIO_CHANNELS.values():
        return

    content = message.content.lower().strip()
    uid = str(message.author.id)

    # ---- montar [pet] ----
    if content.startswith("montar "):
        pet_name_input = message.content.strip()[7:].strip()
        player = get_player(uid)
        if not player:
            await message.channel.send("âŒ Crie seu personagem primeiro com `comeÃ§ar`!")
            return

        # Procura o pet no inventÃ¡rio de pets do jogador
        pets_list = player.get("pets_list", [])
        found_pet = None
        for p in pets_list:
            pn = p.get("name", "") if isinstance(p, dict) else str(p)
            if pet_name_input.lower() in pn.lower():
                found_pet = pn
                break

        # TambÃ©m verifica o pet principal ativo
        if not found_pet:
            main_pet = player.get("pet")
            if main_pet:
                mpn = main_pet if isinstance(main_pet, str) else main_pet.get("name", "")
                if pet_name_input.lower() in mpn.lower():
                    found_pet = mpn

        if not found_pet:
            await message.channel.send(
                f"âŒ Pet **{pet_name_input}** nÃ£o encontrado na sua fazenda/pet ativo!\n"
                f"Use `ver fazenda` para listar seus pets."
            )
            return

        mount_data = get_pet_mount_data(found_pet)
        if not mount_data:
            await message.channel.send(
                f"âŒ **{found_pet}** nÃ£o pode ser usado como montaria!\n\n"
                f"Pets elegÃ­veis para montaria incluem: Lobos, DragÃµes, Grifos, UnicÃ³rnios, Cavalos, e criaturas grandes de raridade **Incomum+**.\n"
                f"Verifique `lista montarias` para ver todos os pets elegÃ­veis."
            )
            return

        player["mount"] = found_pet
        save_player_db(uid, player)

        embed = discord.Embed(
            title="ğŸ MONTARIA EQUIPADA!",
            description=f"*'VocÃª sobe em **{found_pet}** e sente o poder da criatura sob vocÃª!'*",
            color=discord.Color.green()
        )
        embed.add_field(name="ğŸ Montaria", value=f"**{found_pet}**", inline=True)
        embed.add_field(name="ğŸ›¡ï¸ DEF BÃ´nus", value=f"`+{mount_data['mount_bonus_def']}`", inline=True)
        embed.add_field(name="ğŸ’¨ Velocidade", value=f"`+{mount_data['mount_bonus_spd']}`", inline=True)
        embed.add_field(
            name="âœ… Efeito Ativo",
            value="*Sua montaria te acompanha automaticamente em batalhas de boss, adicionando bÃ´nus de DEF!*",
            inline=False
        )
        await message.channel.send(embed=embed)
        return

    # ---- desmontar ----
    if content in ["desmontar", "remover montaria", "tirar montaria"]:
        player = get_player(uid)
        if not player:
            return
        current_mount = player.get("mount")
        if not current_mount:
            await message.channel.send("âŒ VocÃª nÃ£o tem nenhuma montaria ativa!")
            return
        player["mount"] = None
        save_player_db(uid, player)
        await message.channel.send(f"ğŸ Montaria **{current_mount}** removida. *VocÃª desce do seu companheiro.*")
        return

    # ---- ver montaria ----
    if content in ["ver montaria", "minha montaria", "montaria"]:
        player = get_player(uid)
        if not player:
            return
        current_mount = player.get("mount")
        if not current_mount:
            await message.channel.send(
                f"ğŸ VocÃª nÃ£o tem montaria ativa.\n\n"
                f"Para montar em um pet: `montar [nome do pet]`\n"
                f"Veja pets elegÃ­veis: `lista montarias`"
            )
            return
        mount_data = get_pet_mount_data(current_mount)
        if not mount_data:
            await message.channel.send(f"ğŸ Montaria ativa: **{current_mount}** *(dados nÃ£o encontrados)*")
            return
        embed = discord.Embed(
            title="ğŸ Sua Montaria Atual",
            color=discord.Color.blue()
        )
        embed.add_field(name="ğŸ Montaria", value=f"**{current_mount}**", inline=True)
        embed.add_field(name="ğŸ›¡ï¸ DEF BÃ´nus", value=f"`+{mount_data['mount_bonus_def']}`", inline=True)
        embed.add_field(name="ğŸ’¨ Velocidade", value=f"`+{mount_data['mount_bonus_spd']}`", inline=True)
        await message.channel.send(embed=embed)
        return

    # ---- lista montarias ----
    if content in ["lista montarias", "pets montaria", "montarias disponÃ­veis", "montarias disponiveis"]:
        embed = discord.Embed(
            title="ğŸ Pets que Podem Virar Montaria",
            description="Esses pets podem ser equipados como montaria com `montar [nome]`!\nMontarias adicionam bÃ´nus de DEF em batalhas de boss.",
            color=discord.Color.gold()
        )
        # Listar pets extras com montaria
        lines = []
        for world, pets in PETS_EXTRA.items():
            for p in pets:
                if p.get("can_mount"):
                    lines.append(f"{p['emoji']} **{p['name']}** [{p['rarity']}] â€” DEF +{p.get('mount_bonus_def',0)} | Spd +{p.get('mount_bonus_spd',0)}")
        # Listar pets originais com montaria
        for pname, mdata in EXISTING_PETS_MOUNT.items():
            lines.append(f"ğŸ¾ **{pname}** â€” DEF +{mdata.get('mount_bonus_def',0)} | Spd +{mdata.get('mount_bonus_spd',0)}")

        # Dividir em campos para nÃ£o ultrapassar limite
        chunks = [lines[i:i+10] for i in range(0, len(lines), 10)]
        for i, chunk in enumerate(chunks):
            embed.add_field(name=f"Montarias {i+1}", value="\n".join(chunk), inline=False)
        embed.set_footer(text="Use: montar [nome do pet] | desmontar | ver montaria")
        await message.channel.send(embed=embed)
        return


# ================= COMANDO: MUNDOS PRÃ“PRIOS â€” BOT RESPONDE NELES TAMBÃ‰M =================
# Garantir que o bot responde a todos os comandos nos canais de mundo prÃ³prio
@bot.listen("on_message")
async def handle_mundo_proprio_canal(message):
    """Permite que o bot responda nos canais de mundo prÃ³prio como se fosse o canal principal"""
    if message.author.bot:
        return
    # Verificar se o canal Ã© um mundo prÃ³prio
    is_mundo_proprio = False
    for owner_id, ch_id in MUNDO_PROPRIO_CHANNELS.items():
        if ch_id == message.channel.id:
            is_mundo_proprio = True
            break
    if not is_mundo_proprio:
        return
    # O canal de mundo prÃ³prio deve funcionar como o canal beta
    # O CANAL_BETA Ã© verificado em outros handlers â€” aqui garantimos que
    # os handlers principais tambÃ©m respondem neste canal
    # Isso Ã© feito verificando o nome do canal nos handlers, mas como usamos
    # channel.name == CANAL_BETA, precisamos de uma abordagem diferente.
    # Os handlers de mundo prÃ³prio jÃ¡ verificam MUNDO_PROPRIO_CHANNELS,
    # entÃ£o os principais comandos funcionam via os @bot.listen jÃ¡ existentes
    # que checam message.channel.name == CANAL_BETA.
    # Para garantir compatibilidade total, temporariamente alteramos a verificaÃ§Ã£o
    # adicionando suporte a canais de mundo prÃ³prio nos handlers de mundo prÃ³prio acima.
    pass


# ================= HANDLER: CONFRONTAR BOSS DO LEVEL X =================
@bot.listen("on_message")
async def handle_confrontar_boss_level(message):
    if message.author.bot:
        return
    if message.channel.name != CANAL_BETA and message.channel.id not in MUNDO_PROPRIO_CHANNELS.values():
        return

    content = message.content.lower().strip()
    uid = str(message.author.id)

    # Aceita: "confrontar boss do level 9", "confrontar boss level 9"
    import re
    m = re.match(r"confrontar boss (?:do )?level (\d+)$", content)
    if not m:
        return

    target_level = int(m.group(1))
    boss_gate_levels = [9, 19, 29, 39, 49, 59, 69, 79, 89, 99, 109, 119, 129, 139, 149, 159, 169, 179, 189, 199, 209, 219, 229, 239, 249, 259, 269, 279, 289, 299, 309, 319, 329, 339, 349, 359, 369, 379, 389, 399, 409, 419, 429, 439, 449, 459, 469, 479, 489, 499, 509, 519, 529, 539, 549, 559, 569, 579, 589, 599]

    if target_level not in boss_gate_levels:
        niveis_str = ", ".join(str(x) for x in boss_gate_levels[:10]) + "..."
        await message.channel.send(
            f"âŒ **Level {target_level}** nÃ£o tem boss de nÃ­vel!\n\n"
            f"Bosses de nÃ­vel existem nos nÃ­veis: **{niveis_str}**\n"
            f"Exemplo: `confrontar boss do level 9`, `confrontar boss do level 19`"
        )
        return

    player = get_player(uid)
    if not player:
        await message.channel.send("âŒ Crie seu personagem primeiro com `comeÃ§ar`!")
        return

    player_level = player.get("level", 1)
    if player_level < target_level:
        await message.channel.send(
            f"ğŸ”’ **Boss do Level {target_level}** ainda bloqueado!\n\n"
            f"VocÃª estÃ¡ no nÃ­vel **{player_level}**. Alcance o nÃ­vel **{target_level}** para poder confrontar este boss.\n\n"
            f"*'O guardiÃ£o desta passagem sequer nota sua presenÃ§a... ainda.'*"
        )
        return

    boss_data = get_level_boss(target_level)
    if not boss_data:
        await message.channel.send(f"âŒ NÃ£o foi possÃ­vel encontrar o boss do level {target_level}.")
        return

    already_defeated = boss_data["name"] in player.get("bosses", [])

    # Salvar como pending boss para os botÃµes funcionarem
    effects = player.get("active_effects", {})
    effects["pending_boss"] = boss_data
    player["active_effects"] = effects
    save_player_db(uid, player)

    boss_level_to_world = {
        9:1, 19:10, 29:20, 39:30, 49:40, 59:50, 69:60, 79:70, 89:80, 99:90,
        109:100, 119:110, 129:120, 139:130, 149:140, 159:150, 169:160, 179:170, 189:180, 199:190,
        209:200, 219:210, 229:220, 239:230, 249:240, 259:250, 269:260, 279:270, 289:280, 299:290,
        309:300, 319:310, 329:320, 339:330, 349:340, 359:350, 369:360, 379:370, 389:380, 399:390,
        409:400, 419:410, 429:420, 439:430, 449:440, 459:450, 469:460, 479:470, 489:480, 499:490,
        509:500, 519:510, 529:520, 539:530, 549:540, 559:550, 569:560, 579:570, 589:580, 599:590
    }
    world_key = boss_level_to_world.get(target_level, 1)
    world_data = WORLDS.get(world_key, {})
    world_name = world_data.get("name", f"Reino {target_level}")
    world_emoji = world_data.get("emoji", "ğŸŒ")
    boss_nm = boss_data["name"]
    boss_intro_lines = BOSS_INTROS.get(boss_nm, BOSS_INTROS["default"])

    if already_defeated:
        embed = discord.Embed(
            title=f"âš”ï¸ REVANCHE Ã‰PICA â€” BOSS DO LEVEL {target_level}!",
            description=(
                f"*'As nÃ©voas do tempo se desfazem... O guardiÃ£o ressurge das sombras para um novo duelo!'*\n\n"
                f"ğŸ‘¹ **{boss_nm}** retorna para uma batalha ainda mais intensa!\n\n"
                f"{world_emoji} **{world_name}** â€” O guardiÃ£o que jÃ¡ foi derrotado... e quer vinganÃ§a.\n\n"
                f"*A lenda diz que reviver grandes batalhas fortalece a alma do guerreiro...*"
            ),
            color=discord.Color.from_rgb(150, 0, 200)
        )
    else:
        embed = discord.Embed(
            title=f"ğŸš¨ BOSS DE NÃVEL {target_level} â€” PASSAGEM BLOQUEADA!",
            description=(
                f"{random.choice(boss_intro_lines)}\n\n"
                f"âš ï¸ **Derrote-o para desbloquear o prÃ³ximo reino e liberar o XP bloqueado!**"
            ),
            color=discord.Color.dark_red()
        )

    embed.add_field(name="â¤ï¸ HP",           value=f"`{boss_data['hp']:,}`",  inline=True)
    embed.add_field(name="âš”ï¸ ATK",          value=f"`{boss_data['atk']}`",   inline=True)
    embed.add_field(name="â­ XP",           value=f"`{boss_data['xp']:,}`",  inline=True)
    embed.add_field(name="ğŸ¯ Level do Boss", value=f"`{target_level}`",       inline=True)
    if already_defeated:
        embed.add_field(name="ğŸ† Revanche", value="*Boss jÃ¡ derrotado anteriormente â€” nova chance de luta!*", inline=False)
    embed.add_field(name="ğŸ’¡ Dica", value="Use os botÃµes abaixo para lutar ou chamar aliados!", inline=False)

    view = BossButton(uid, boss_data["name"])
    await message.channel.send(embed=embed, view=view)



# ================= HANDLER: DEFINIR BIOGRAFIA DO PERSONAGEM =================
@bot.listen("on_message")
async def handle_definir_bio(message):
    if message.author.bot:
        return
    if message.channel.name != CANAL_BETA and message.channel.id not in MUNDO_PROPRIO_CHANNELS.values():
        return

    content = message.content.strip()
    content_lower = content.lower()
    uid = str(message.author.id)

    if content_lower in ["apagar bio", "apagar biografia", "limpar bio"]:
        player = get_player(uid)
        if not player:
            return
        player["bio"] = ""
        save_player_db(uid, player)
        await message.channel.send(
            "ğŸ—‘ï¸ **Biografia apagada.**\n"
            "*'As pÃ¡ginas em branco aguardam uma nova histÃ³ria...'*"
        )
        return

    if content_lower in ["ver bio", "minha biografia"]:
        player = get_player(uid)
        if not player:
            return
        bio = player.get("bio", "")
        if not bio:
            await message.channel.send(
                f"ğŸ“– **{message.author.display_name}** nÃ£o tem nenhuma biografia ainda.\n\n"
                f"*Use `definir bio [sua descriÃ§Ã£o]` para criar a sua!*"
            )
        else:
            embed = discord.Embed(
                title=f"ğŸ“– Biografia de {message.author.display_name}",
                description=f"*{bio}*",
                color=discord.Color.teal()
            )
            embed.set_thumbnail(url=message.author.display_avatar.url)
            await message.channel.send(embed=embed)
        return

    bio_prefixes = ["definir bio ", "definir biografia ", "minha bio "]
    matched_prefix = None
    for prefix in bio_prefixes:
        if content_lower.startswith(prefix):
            matched_prefix = prefix
            break

    if not matched_prefix:
        return

    player = get_player(uid)
    if not player:
        await message.channel.send("âŒ Crie seu personagem primeiro com `comeÃ§ar`!")
        return

    bio_text = content[len(matched_prefix):].strip()

    if not bio_text:
        await message.channel.send(
            "âŒ **Texto vazio!**\n\n"
            "**Como usar:** `definir bio [sua descriÃ§Ã£o]`\n"
            "**Exemplo:** `definir bio Um guerreiro que sobreviveu Ã  queda do reino do norte.`\n\n"
            "*MÃ¡ximo: 300 caracteres.*"
        )
        return

    if len(bio_text) > 300:
        await message.channel.send(
            f"âŒ **Biografia muito longa!** ({len(bio_text)}/300 caracteres)\n"
            f"*Reduza um pouco e tente novamente.*"
        )
        return

    player["bio"] = bio_text
    save_player_db(uid, player)

    classe = player.get("class", "")
    frases = {
        "Guerreiro":  "*'A lÃ¢mina forja o homem tanto quanto o fogo forja o aÃ§o.'*",
        "Mago":       "*'As palavras tÃªm poder. E estas palavras sÃ£o suas.'*",
        "Arqueiro":   "*'A flecha voa mais longe quando o arqueiro conhece sua prÃ³pria histÃ³ria.'*",
        "Assassino":  "*'Nas sombras, cada cicatriz conta um segredo.'*",
        "Necromante": "*'AtÃ© os mortos merecem um nome. Que dirÃ¡ os vivos.'*",
        "Paladino":   "*'Palavras gravadas no coraÃ§Ã£o valem mais que as esculpidas em pedra.'*",
        "Berserker":  "*'NÃ£o existe fÃºria sem origem. Agora a sua foi registrada.'*",
        "Druida":     "*'As Ã¡rvores guardam memÃ³rias nas suas raÃ­zes. E vocÃª, em suas palavras.'*",
        "Monge":      "*'Conhecer a si mesmo Ã© a primeira forma de iluminaÃ§Ã£o.'*",
        "Bardo":      "*'Toda boa canÃ§Ã£o comeÃ§a com uma boa histÃ³ria.'*",
    }
    frase = frases.get(classe, "*'Cada aventureiro merece ter sua histÃ³ria contada.'*")

    embed = discord.Embed(
        title="ğŸ“– Biografia Salva!",
        description=f"*{bio_text}*\n\n{frase}",
        color=discord.Color.teal()
    )
    embed.set_thumbnail(url=message.author.display_avatar.url)
    embed.set_footer(text="Sua bio jÃ¡ aparece em 'ver perfil' | Use 'apagar bio' para remover")
    await message.channel.send(embed=embed)


# ================= HANDLER: FORÃ‡AR ENTRADA EM DUNGEON SECRETA =================
@bot.listen("on_message")
async def handle_forcar_entrada(message):
    if message.author.bot:
        return
    if message.channel.name != CANAL_BETA and message.channel.id not in MUNDO_PROPRIO_CHANNELS.values():
        return

    content = message.content.strip()
    content_lower = content.lower()
    uid = str(message.author.id)

    if content_lower in ["forÃ§ar entrada", "forcar entrada", "invadir dungeon"]:
        player = get_player(uid)
        if not player:
            await message.channel.send("âŒ Crie seu personagem primeiro com `comeÃ§ar`!")
            return

        world = get_world(player["level"], player)
        secret_dungeons = world.get("secret_dungeons", [])

        if not secret_dungeons:
            await message.channel.send("âŒ NÃ£o hÃ¡ dungeons secretas disponÃ­veis no seu reino atual.")
            return

        lines = []
        for sd in secret_dungeons:
            key_req = sd.get("key_name", "Chave Desconhecida")
            lines.append(f"â€¢ **{sd['name']}** â€” chave: `{key_req}`")
        dungeons_list = "\n".join(lines)

        player_level = player.get("level", 1)
        atk = player.get("atk", 10)
        def_stat = player.get("def", 5)
        chance_base = min(55, 15 + (player_level // 5) + (atk // 20) + (def_stat // 25))
        classe = player.get("class", "")
        if classe == "Assassino":
            chance_base = min(70, chance_base + 15)
        elif classe == "Berserker":
            chance_base = min(65, chance_base + 10)
        elif classe == "Mago":
            chance_base = min(60, chance_base + 5)

        embed = discord.Embed(
            title="ğŸ’¥ FORÃ‡AR ENTRADA â€” Dungeons Secretas",
            description=(
                f"*'Sem chave? EntÃ£o arrebente a porta!'*\n\n"
                f"âš ï¸ **ATENÃ‡ÃƒO:** ForÃ§ar entrada Ã© arriscado!\n"
                f"â€¢ **Sucesso:** VocÃª entra na dungeon normalmente\n"
                f"â€¢ **Falha:** Perde **30â€“60%** do HP mÃ¡ximo\n"
                f"â€¢ **Cooldown:** 1 hora por tentativa\n\n"
                f"ğŸ¯ Sua chance atual de sucesso: **~{chance_base}%**\n"
                f"*(Aumenta com nÃ­vel, ATK e DEF)*\n\n"
                f"**Dungeons disponÃ­veis no seu reino:**\n{dungeons_list}"
            ),
            color=discord.Color.orange()
        )
        embed.set_footer(text="Use: forÃ§ar entrada [nome da dungeon]")
        await message.channel.send(embed=embed)
        return

    force_prefixes = ["forÃ§ar entrada ", "forcar entrada ", "invadir dungeon "]
    matched_prefix = None
    for prefix in force_prefixes:
        if content_lower.startswith(prefix):
            matched_prefix = prefix
            break

    if not matched_prefix:
        return

    player = get_player(uid)
    if not player:
        await message.channel.send("âŒ Crie seu personagem primeiro com `comeÃ§ar`!")
        return

    dungeon_query = content[len(matched_prefix):].strip()
    if not dungeon_query:
        await message.channel.send(
            "âŒ Informe o nome da dungeon!\n"
            "**Uso:** `forÃ§ar entrada [nome da dungeon]`\n\n"
            "Use `forÃ§ar entrada` para ver a lista de dungeons disponÃ­veis."
        )
        return

    now = time.time()
    last_force = player.get("last_force_entry", 0)
    cooldown_secs = 3600
    if now - last_force < cooldown_secs:
        restante = int(cooldown_secs - (now - last_force))
        minutos = restante // 60
        segundos = restante % 60
        await message.channel.send(
            f"â³ **VocÃª ainda estÃ¡ se recuperando da Ãºltima tentativa!**\n"
            f"*'Seu corpo ainda dÃ³i da investida anterior...'*\n\n"
            f"Aguarde mais **{minutos}m {segundos}s** antes de tentar novamente."
        )
        return

    import re as _re
    found_dungeon = None
    found_world_data = None
    query_lower = dungeon_query.lower()

    for w_data in WORLDS.values():
        for sd in w_data.get("secret_dungeons", []):
            sd_name_clean = sd["name"].lower()
            sd_name_text = _re.sub(r'[^\w\s]', '', sd_name_clean).strip()
            q_text = _re.sub(r'[^\w\s]', '', query_lower).strip()
            if q_text in sd_name_text or sd_name_text in q_text or q_text in sd_name_clean:
                found_dungeon = sd
                found_world_data = w_data
                break
        if found_dungeon:
            break

    if not found_dungeon:
        await message.channel.send(
            f"âŒ Nenhuma dungeon secreta encontrada com o nome **'{dungeon_query}'**.\n\n"
            f"Use `forÃ§ar entrada` para ver a lista de dungeons do seu reino."
        )
        return

    player_level = player.get("level", 1)
    atk = player.get("atk", 10)
    def_stat = player.get("def", 5)
    chance = min(55, 15 + (player_level // 5) + (atk // 20) + (def_stat // 25))
    classe = player.get("class", "")
    if classe == "Assassino":
        chance = min(70, chance + 15)
    elif classe == "Berserker":
        chance = min(65, chance + 10)
    elif classe == "Mago":
        chance = min(60, chance + 5)

    roll = random.randint(1, 100)
    sucesso = roll <= chance

    player["last_force_entry"] = now
    save_player_db(uid, player)

    dungeon_name = found_dungeon["name"]
    boss_name = found_dungeon.get("boss", "Boss Desconhecido")

    if not sucesso:
        max_hp = player.get("max_hp", 100)
        dano_pct = random.uniform(0.30, 0.60)
        dano = int(max_hp * dano_pct)
        novo_hp = max(1, player.get("hp", max_hp) - dano)
        player["hp"] = novo_hp
        save_player_db(uid, player)

        mensagens_falha = [
            "*'As runas da porta pulsam e uma explosÃ£o de energia te arremessa de volta!'*",
            "*'Os guardiÃµes da dungeon detectam sua invasÃ£o e te castigam com brutalidade!'*",
            "*'A barreira mÃ¡gica reage â€” um escudo de forÃ§a te atinge em cheio!'*",
            "*'A porta permanece fechada. Mas a armadilha escondida no portal nÃ£o.'*",
            "*'VocÃª forÃ§a a entrada... e paga o preÃ§o com seu prÃ³prio sangue.'*",
        ]
        embed = discord.Embed(
            title=f"ğŸ’¥ FALHA AO FORÃ‡AR ENTRADA â€” {dungeon_name}",
            description=random.choice(mensagens_falha),
            color=discord.Color.red()
        )
        embed.add_field(name="ğŸ² Resultado", value=f"Tirou **{roll}** â€” precisava â‰¤ **{chance}**", inline=True)
        embed.add_field(name="ğŸ’” Dano sofrido", value=f"`-{dano} HP` ({int(dano_pct*100)}% do HP mÃ¡ximo)", inline=True)
        embed.add_field(name="â¤ï¸ HP atual", value=f"`{novo_hp}/{max_hp}`", inline=True)
        embed.add_field(name="â³ PrÃ³xima tentativa", value="*DisponÃ­vel em 1 hora.*", inline=False)
        embed.set_footer(text=f"Aumente seu level/ATK/DEF para maior chance! | Sua chance era {chance}%")
        await message.channel.send(embed=embed)
        return

    mensagens_sucesso = [
        "*'Com um grito de guerra, vocÃª arrebenta a porta e entra na escuridÃ£o!'*",
        "*'Sua determinaÃ§Ã£o supera as runas de proteÃ§Ã£o â€” a porta cede!'*",
        "*'Golpe apÃ³s golpe, vocÃª abre um caminho Ã  forÃ§a. A dungeon Ã© sua!'*",
        "*'O prÃ³prio Boss lÃ¡ dentro deve ter sentido o impacto. VocÃª estÃ¡ dentro!'*",
        "*'As correntes mÃ¡gicas se partem sob sua forÃ§a bruta. Caminho aberto!'*",
    ]
    embed = discord.Embed(
        title=f"ğŸ’¥ ENTRADA FORÃ‡ADA â€” {dungeon_name}!",
        description=random.choice(mensagens_sucesso),
        color=discord.Color.green()
    )
    embed.add_field(name="ğŸ² Resultado", value=f"Tirou **{roll}** â€” precisava â‰¤ **{chance}** âœ…", inline=True)
    embed.add_field(name="ğŸ‘¹ Boss aguardando", value=f"**{boss_name}**", inline=True)
    embed.add_field(name="âš ï¸ Aviso", value="*VocÃª entrou sem uma chave. Sem bÃ´nus de preparaÃ§Ã£o!*", inline=False)
    embed.set_footer(text="Nenhuma chave foi consumida. Boa sorte na dungeon!")
    await message.channel.send(embed=embed)
    await asyncio.sleep(2)
    await explore_dungeon(message.channel, uid, found_dungeon, found_world_data)


# ================= HANDLER: COMANDOS EXCLUSIVOS DOS EMPREGOS =================
@bot.listen("on_message")
async def handle_job_commands(message):
    """
    Implementa todos os comandos exclusivos de cada emprego:
    Arcano:     estudar magia, biblioteca arcana
    Curandeiro: curar aliado @user
    Mercador:   mercado negro, negociar [item]
    Escriba:    crÃ´nica [texto], mapear, ler arquivo, ver biblioteca
    Cavaleiro:  patrulhar
    Guarda_Real:defender reino
    Rei:        governar, decretar lei [texto], nomear cavaleiro @user
    """
    if message.author.bot:
        return
    if message.channel.name != CANAL_BETA and message.channel.id not in MUNDO_PROPRIO_CHANNELS.values():
        return

    content = message.content.strip()
    content_lower = content.lower()
    uid = str(message.author.id)

    def _get_job_level(player, job):
        jd = JOBS.get(job, {})
        job_works = player.get("job_works", {})
        job_work_count = job_works.get(job, 0)
        job_levels = jd.get("levels", {})
        job_level = 1
        for lvl_num in sorted(job_levels.keys(), reverse=True):
            req = job_levels[lvl_num].get("req_work", 0)
            if job_work_count >= req:
                job_level = lvl_num
                break
        return job_level, job_levels.get(job_level, {})

    # ============================
    # ARCANO: estudar magia
    # ============================
    if content_lower in ["estudar magia", "estudar feitiÃ§o", "estudar feitico"]:
        player = get_player(uid)
        if not player:
            return
        if player.get("job") != "Arcano":
            await message.channel.send("ğŸ”® Apenas **Arcanos** podem estudar magia!\nUse `procurar emprego` para se tornar um Arcano.")
            return
        last_study = player.get("last_study_magic", 0)
        now = time.time()
        if now - last_study < 1800:
            rest = int(1800 - (now - last_study))
            await message.channel.send(f"ğŸ“š Seu cÃ©rebro ainda processa os estudos anteriores. PrÃ³ximo estudo em **{rest//60}m {rest%60}s**.")
            return
        job_level, lvl_data = _get_job_level(player, "Arcano")
        xp_gain = random.randint(200, 500) * job_level
        mana_gain = random.randint(5, 15) * job_level
        player["last_study_magic"] = now
        cur_mana = player.get("mana", 50)
        max_mana = player.get("max_mana", 50)
        player["mana"] = min(max_mana, cur_mana + mana_gain)
        save_player_db(uid, player)
        leveled = add_xp(uid, xp_gain)
        msgs = [
            "ğŸ“– VocÃª decifra um feitiÃ§o antigo que ninguÃ©m mais sabia pronunciar.",
            "âœ¨ Uma teoria arcana toma forma na sua mente â€” brilhante e perigosa.",
            "ğŸ”® Os cristais do laboratÃ³rio brilham enquanto sua compreensÃ£o aprofunda.",
            "ğŸ’« VocÃª conecta dois feitiÃ§os aparentemente opostos numa sÃ­ntese surpreendente.",
            "ğŸŒ€ Uma anomalia arcana surge no pergaminho â€” vocÃª a estuda em vez de fugir.",
        ]
        embed = discord.Embed(
            title="ğŸ”® Estudar Magia â€” SessÃ£o ConcluÃ­da",
            description=random.choice(msgs),
            color=discord.Color.purple()
        )
        embed.add_field(name="â­ XP Arcano", value=f"`+{xp_gain}` XP", inline=True)
        embed.add_field(name="ğŸ’™ Mana Recuperada", value=f"`+{mana_gain}` mana", inline=True)
        embed.add_field(name="ğŸ“Š NÃ­vel Arcano", value=f"`{job_level}/3` â€” {lvl_data.get('name','Arcano')}", inline=True)
        if leveled:
            p2 = get_player(uid)
            embed.add_field(name="ğŸ†™ Level Up!", value=f"NÃ­vel **{p2['level']}**!", inline=False)
        embed.set_footer(text="PrÃ³ximo estudo em 30 minutos | Use 'biblioteca arcana' para lore exclusivo")
        await message.channel.send(embed=embed)
        return

    # ============================
    # ARCANO: biblioteca arcana
    # ============================
    if content_lower in ["biblioteca arcana", "ver biblioteca arcana", "lore arcano"]:
        player = get_player(uid)
        if not player:
            return
        if player.get("job") != "Arcano":
            await message.channel.send("ğŸ”® A biblioteca arcana Ã© restrita aos **Arcanos**.\nUse `procurar emprego` para se tornar um.")
            return
        job_level, _ = _get_job_level(player, "Arcano")
        lore_entries = [
            ("ğŸ“œ O Primeiro FeitiÃ§o", "Antes da linguagem, havia o Verbo Arcano. Diz-se que o primeiro mago nÃ£o aprendeu magia â€” ele a inventou. Seu nome foi apagado de todos os registros, mas sua obra persiste em cada feitiÃ§o que existe."),
            ("ğŸŒ€ O Paradoxo do Vazio", "O Vazio nÃ£o Ã© ausÃªncia de magia â€” Ã© magia em seu estado mais puro, antes da forma. Entrar no Vazio Ã© possÃ­vel; sair Ã© opcional."),
            ("ğŸ’  As Sete Leis Arcanas", "Lei 1: Toda magia tem um custo. Lei 2: O custo nunca Ã© o que vocÃª espera. Lei 3: FeitiÃ§os esquecidos nÃ£o desaparecem â€” esperam. Lei 4: A mente Ã© o primeiro e Ãºltimo campo de batalha. Lei 5: Nenhum encantamento Ã© permanente, exceto os feitos com sangue. Lei 6: O nome verdadeiro de algo lhe dÃ¡ poder sobre ele. Lei 7: A Lei 7 nÃ£o pode ser escrita."),
            ("ğŸ”® O Abismo e o Arquimago", "O Arquimago Valdren passou 40 anos estudando o Abismo. No 41Âº ano, o Abismo comeÃ§ou a estudÃ¡-lo. O que restou foi encontrado em pedaÃ§os â€” cada pedaÃ§o em um continente diferente."),
            ("âœ¨ Magia Elementar AvanÃ§ada", "Fogo nÃ£o Ã© calor â€” Ã© transformaÃ§Ã£o. Ãgua nÃ£o Ã© fluidez â€” Ã© memÃ³ria. Terra nÃ£o Ã© solidez â€” Ã© paciÃªncia. Ar nÃ£o Ã© movimento â€” Ã© possibilidade. O Quinto Elemento Ã© a consciÃªncia de quem lanÃ§a o feitiÃ§o."),
        ]
        if job_level >= 2:
            lore_entries += [
                ("ğŸš« FeitiÃ§os Proibidos â€” CapÃ­tulo 1", "A Lista Negra contÃ©m 108 feitiÃ§os. Os primeiros 50 foram proibidos por serem perigosos. Os prÃ³ximos 40, por serem eficazes demais. Os Ãºltimos 18 foram proibidos porque nÃ£o se sabe o que fazem â€” e ninguÃ©m que os usou voltou para explicar."),
                ("ğŸ‘ï¸ O Olho que Tudo VÃª", "Existe uma criatura no plano astral que observa cada uso de magia no mundo. Ela nÃ£o interfere. Ela apenas... anota. Os Arcanos de nÃ­vel suficiente Ã s vezes sentem o peso desse olhar durante os estudos."),
            ]
        if job_level >= 3:
            lore_entries += [
                ("â˜ ï¸ A Magia do Fim", "Existe um feitiÃ§o que pode apagar uma palavra da realidade. NÃ£o do idioma â€” da realidade. Qualquer coisa nomeada por essa palavra deixaria de existir retroativamente. O feitiÃ§o foi usado uma vez. NinguÃ©m sabe qual palavra foi apagada â€” porque ninguÃ©m pode se lembrar que ela existia."),
            ]
        entry = random.choice(lore_entries)
        embed = discord.Embed(
            title=f"ğŸ“š Biblioteca Arcana â€” {entry[0]}",
            description=entry[1],
            color=discord.Color.dark_purple()
        )
        embed.set_footer(text=f"Arcano nÃ­vel {job_level}/3 | Novos textos a cada consulta | Use 'estudar magia' para XP")
        await message.channel.send(embed=embed)
        return

    # ============================
    # CURANDEIRO: curar aliado
    # ============================
    if content_lower.startswith("curar aliado") or content_lower.startswith("curar @"):
        player = get_player(uid)
        if not player:
            return
        if player.get("job") != "Curandeiro":
            await message.channel.send("ğŸ’š Apenas **Curandeiros** podem curar aliados!\nUse `procurar emprego`.")
            return
        if not message.mentions:
            await message.channel.send(
                "ğŸ’š **Curar Aliado**\n\n"
                "**Uso:** `curar aliado @jogador`\n"
                "**Exemplo:** `curar aliado @Sr.Reality`\n\n"
                "*Cura uma porÃ§Ã£o do HP mÃ¡ximo do aliado.*"
            )
            return
        last_heal = player.get("last_heal_ally", 0)
        now = time.time()
        if now - last_heal < 600:
            rest = int(600 - (now - last_heal))
            await message.channel.send(f"ğŸ’š Suas mÃ£os ainda brilham da Ãºltima cura. PrÃ³xima em **{rest//60}m {rest%60}s**.")
            return
        target = message.mentions[0]
        if target.id == message.author.id:
            await message.channel.send("ğŸ’š VocÃª nÃ£o pode se curar com esta habilidade! Use `usar poÃ§Ã£o` para se curar.")
            return
        target_player = get_player(str(target.id))
        if not target_player:
            await message.channel.send(f"âŒ **{target.display_name}** nÃ£o tem personagem criado.")
            return
        job_level, lvl_data = _get_job_level(player, "Curandeiro")
        hp_regen = lvl_data.get("hp_regen_bonus", 10)
        base_cure = int(target_player["max_hp"] * 0.20) + (hp_regen * job_level)
        if job_level >= 3 and random.random() < 0.25:
            base_cure = target_player["max_hp"]
            full_heal = True
        else:
            full_heal = False
        old_hp = target_player["hp"]
        target_player["hp"] = min(target_player["max_hp"], old_hp + base_cure)
        save_player_db(str(target.id), target_player)
        player["last_heal_ally"] = now
        save_player_db(uid, player)
        msgs = [
            f"ğŸ’š Suas mÃ£os brilham sobre **{target.display_name}**. A energia de cura flui como um rio.",
            f"ğŸŒ¿ Ervas e magia combinadas fazem as feridas de **{target.display_name}** fecharem.",
            f"âš•ï¸ Com precisÃ£o cirÃºrgica, vocÃª restaura a vitalidade de **{target.display_name}**.",
            f"âœ¨ A luz da cura envolve **{target.display_name}** por completo.",
        ]
        embed = discord.Embed(
            title="ğŸ’š Cura de Aliado",
            description=random.choice(msgs),
            color=discord.Color.green()
        )
        embed.add_field(name="ğŸ¯ Aliado", value=f"**{target.display_name}**", inline=True)
        embed.add_field(name="â¤ï¸ HP Restaurado", value=f"`+{target_player['hp'] - old_hp}` HP", inline=True)
        embed.add_field(name="â¤ï¸ HP Atual do Aliado", value=f"`{target_player['hp']}/{target_player['max_hp']}`", inline=True)
        if full_heal:
            embed.add_field(name="âœ¨ CURA SAGRADA!", value="*NÃ­vel 3 ativado â€” cura completa instantÃ¢nea!*", inline=False)
        embed.set_footer(text=f"Curandeiro nÃ­vel {job_level}/3 | PrÃ³xima cura em 10 minutos")
        await message.channel.send(embed=embed)
        return

    # ============================
    # MERCADOR: mercado negro
    # ============================
    if content_lower in ["mercado negro", "mercado vip", "loja secreta"]:
        player = get_player(uid)
        if not player:
            return
        if player.get("job") != "Mercador":
            await message.channel.send("ğŸ’° O **Mercado Negro** Ã© exclusivo dos **Mercadores**!\nUse `procurar emprego` para se tornar um.")
            return
        job_level, _ = _get_job_level(player, "Mercador")
        last_black = player.get("last_black_market", 0)
        now = time.time()
        if now - last_black < 3600:
            rest = int(3600 - (now - last_black))
            await message.channel.send(f"ğŸ•µï¸ O mercador misterioso ainda nÃ£o voltou. Tente em **{rest//60}m {rest%60}s**.")
            return
        # Itens disponÃ­veis no mercado negro
        black_market_items = [
            {"name": "ğŸ—ï¸ Chave Sombria", "price": 150, "desc": "Abre dungeons secretas de trevas"},
            {"name": "ğŸ’Š Elixir Proibido", "price": 200, "desc": "+50 HP mÃ¡ximo permanente (item Ãºnico)"},
            {"name": "ğŸ“œ Pergaminho Maldito", "price": 120, "desc": "+30% XP por 1 hora"},
            {"name": "ğŸ—¡ï¸ Adaga Venenosa", "price": 300, "desc": "Arma rara do mercado subterrÃ¢neo"},
            {"name": "ğŸ’ Gema do Abismo", "price": 400, "desc": "Recurso extremamente raro"},
            {"name": "ğŸ§ª PoÃ§Ã£o de Invisibilidade", "price": 180, "desc": "Evita combate obrigatÃ³rio uma vez"},
        ]
        if job_level >= 2:
            black_market_items += [
                {"name": "âš”ï¸ LÃ¢mina do Mercado Negro", "price": 600, "desc": "Arma Ã©pica exclusiva"},
                {"name": "ğŸ”® Orbe de Poder", "price": 500, "desc": "+100 Mana mÃ¡xima permanente"},
            ]
        if job_level >= 3:
            black_market_items += [
                {"name": "ğŸ‘‘ Coroa do Submundo", "price": 1500, "desc": "Artefato lendÃ¡rio exclusivo de magnatas"},
            ]
        player["last_black_market"] = now
        save_player_db(uid, player)

        sell_bonus = JOBS["Mercador"]["levels"].get(job_level, {}).get("sell_bonus", 0.25)
        embed = discord.Embed(
            title="ğŸ•µï¸ Mercado Negro â€” Itens Exclusivos",
            description=(
                f"*'Psst... vocÃª conhece as pessoas certas.'*\n\n"
                f"Como Mercador nÃ­vel **{job_level}/3**, vocÃª tem acesso a {len(black_market_items)} itens exclusivos.\n"
                f"BÃ´nus de venda atual: **+{int(sell_bonus*100)}%**\n\n"
                f"**Itens disponÃ­veis:**"
            ),
            color=discord.Color.dark_gold()
        )
        for item in black_market_items:
            embed.add_field(
                name=f"{item['name']} â€” {item['price']} ğŸ’°",
                value=item['desc'],
                inline=True
            )
        embed.set_footer(text="Use 'comprar [nome do item]' para adquirir | Mercado refresca a cada hora")
        await message.channel.send(embed=embed)
        return

    # ============================
    # MERCADOR: negociar [item]
    # ============================
    if content_lower.startswith("negociar "):
        player = get_player(uid)
        if not player:
            return
        if player.get("job") != "Mercador":
            await message.channel.send("ğŸ’° Apenas **Mercadores** sabem negociar profissionalmente!\nUse `procurar emprego`.")
            return
        item_name = content[9:].strip()
        if not item_name:
            await message.channel.send(
                "ğŸ’° **Negociar**\n\n"
                "**Uso:** `negociar [nome do item]`\n"
                "**Exemplo:** `negociar PoÃ§Ã£o de Cura`\n\n"
                "*Reduz o preÃ§o de compra de um item em 20â€“40%.*"
            )
            return
        job_level, _ = _get_job_level(player, "Mercador")
        desconto_pct = random.randint(20, 40) + (job_level * 5)
        msgs = [
            f"ğŸ¤ Sua lÃ¡bia funciona! **{item_name}** agora custa **{desconto_pct}% menos** nesta compra.",
            f"ğŸ’¬ VocÃª envolve o vendedor numa conversa e arranca um desconto de **{desconto_pct}%** em **{item_name}**.",
            f"ğŸ“Š Sua anÃ¡lise de mercado convence o lojista a baixar **{desconto_pct}%** no preÃ§o de **{item_name}**.",
        ]
        player["active_effects"] = player.get("active_effects", {})
        player["active_effects"]["negociar_desconto"] = {
            "item": item_name.lower(),
            "pct": desconto_pct,
            "expires": int(time.time()) + 600
        }
        save_player_db(uid, player)
        embed = discord.Embed(
            title="ğŸ¤ NegociaÃ§Ã£o Bem-sucedida!",
            description=random.choice(msgs),
            color=discord.Color.gold()
        )
        embed.add_field(name="ğŸ’¸ Desconto", value=f"`{desconto_pct}%` no prÃ³ximo **{item_name}**", inline=True)
        embed.add_field(name="â³ VÃ¡lido por", value="`10 minutos`", inline=True)
        embed.set_footer(text="Use 'comprar' dentro de 10 min para aplicar o desconto")
        await message.channel.send(embed=embed)
        return

    # ============================
    # ESCRIBA: crÃ´nica
    # ============================
    if content_lower.startswith("crÃ´nica ") or content_lower.startswith("cronica "):
        player = get_player(uid)
        if not player:
            return
        if player.get("job") != "Escriba":
            await message.channel.send("ğŸ“œ Apenas **Escribas** podem escrever crÃ´nicas!\nUse `procurar emprego`.")
            return
        prefix_len = 8 if content_lower.startswith("crÃ´nica ") else 8
        texto = content[prefix_len:].strip()
        if not texto:
            await message.channel.send(
                "ğŸ“œ **CrÃ´nica**\n\n"
                "**Uso:** `crÃ´nica [texto da crÃ´nica]`\n"
                "**Exemplo:** `crÃ´nica Hoje venci um dragÃ£o nas montanhas do norte...`\n\n"
                "*Registre suas aventuras e ganhe XP bÃ´nus! MÃ­nimo 20 caracteres.*"
            )
            return
        if len(texto) < 20:
            await message.channel.send(f"ğŸ“œ CrÃ´nica muito curta! Escreva pelo menos 20 caracteres ({len(texto)} escritos).")
            return
        last_cronica = player.get("last_cronica", 0)
        now = time.time()
        if now - last_cronica < 3600:
            rest = int(3600 - (now - last_cronica))
            await message.channel.send(f"ğŸ“œ VocÃª jÃ¡ registrou uma crÃ´nica recentemente. PrÃ³xima em **{rest//60}m {rest%60}s**.")
            return
        job_level, _ = _get_job_level(player, "Escriba")
        xp_bonus = min(len(texto) * 3, 800) * job_level
        player["last_cronica"] = now
        cronicas = player.get("cronicas", [])
        cronicas.append({"texto": texto[:500], "data": int(now)})
        player["cronicas"] = cronicas[-20:]
        save_player_db(uid, player)
        leveled = add_xp(uid, xp_bonus)
        embed = discord.Embed(
            title="ğŸ“œ CrÃ´nica Registrada!",
            description=f"*\"{texto[:300]}{'...' if len(texto)>300 else ''}\"*",
            color=discord.Color.orange()
        )
        embed.add_field(name="â­ XP BÃ´nus", value=f"`+{xp_bonus}` XP pela crÃ´nica", inline=True)
        embed.add_field(name="ğŸ“š CrÃ´nicas Totais", value=f"`{len(cronicas)}`", inline=True)
        if leveled:
            p2 = get_player(uid)
            embed.add_field(name="ğŸ†™ Level Up!", value=f"NÃ­vel **{p2['level']}**!", inline=False)
        embed.set_footer(text="Escriba nÃ­vel " + str(job_level) + "/3 | PrÃ³xima crÃ´nica em 1 hora | Use 'ver biblioteca' para rever")
        await message.channel.send(embed=embed)
        return

    # ============================
    # ESCRIBA: mapear
    # ============================
    if content_lower in ["mapear", "mapear area", "mapear Ã¡rea"]:
        player = get_player(uid)
        if not player:
            return
        if player.get("job") != "Escriba":
            await message.channel.send("ğŸ—ºï¸ Apenas **Escribas** sabem mapear Ã¡reas com precisÃ£o!\nUse `procurar emprego`.")
            return
        last_map = player.get("last_mapear", 0)
        now = time.time()
        if now - last_map < 1800:
            rest = int(1800 - (now - last_map))
            await message.channel.send(f"ğŸ—ºï¸ Seus mapas ainda estÃ£o sendo finalizados. PrÃ³ximo mapeamento em **{rest//60}m {rest%60}s**.")
            return
        job_level, _ = _get_job_level(player, "Escriba")
        player["last_mapear"] = now
        xp_gain = random.randint(100, 300) * job_level
        coins_gain = random.randint(20, 60) * job_level
        # Chance de revelar dungeon secreta
        revealed_secret = None
        world = get_world(player["level"], player)
        undiscovered = [loc for loc in world.get("locations", []) if not loc.get("discovered", False) and loc.get("type") == "dungeon_secreta"]
        if undiscovered and random.random() < (0.15 * job_level):
            revealed_secret = random.choice(undiscovered)
        save_player_db(uid, player)
        add_coins(uid, coins_gain)
        leveled = add_xp(uid, xp_gain)
        resultados = [
            "ğŸ—ºï¸ VocÃª percorre cada viela e trilha do reino, registrando tudo com precisÃ£o absoluta.",
            "ğŸ§­ Sua bÃºssola e pena trabalham em harmonia â€” o mapa toma forma.",
            "ğŸ“ Cada distÃ¢ncia medida, cada curva registrada. Uma obra de cartografia.",
            "ğŸ” VocÃª descobre que mapas anteriores estavam errados. Corrigido agora.",
        ]
        embed = discord.Embed(
            title="ğŸ—ºï¸ Ãrea Mapeada!",
            description=random.choice(resultados),
            color=discord.Color.teal()
        )
        embed.add_field(name="â­ XP", value=f"`+{xp_gain}`", inline=True)
        embed.add_field(name="ğŸ’° Coins", value=f"`+{coins_gain}`", inline=True)
        if revealed_secret:
            embed.add_field(
                name="ğŸ” LOCAL SECRETO DESCOBERTO!",
                value=f"**{revealed_secret['name']}** foi revelado no mapa!",
                inline=False
            )
        if leveled:
            p2 = get_player(uid)
            embed.add_field(name="ğŸ†™ Level Up!", value=f"NÃ­vel **{p2['level']}**!", inline=False)
        embed.set_footer(text="PrÃ³ximo mapeamento em 30 minutos | Use 'abrir mapa' para ver locais")
        await message.channel.send(embed=embed)
        return

    # ============================
    # ESCRIBA: ler arquivo
    # ============================
    if content_lower in ["ler arquivo", "arquivos secretos", "textos proibidos"]:
        player = get_player(uid)
        if not player:
            return
        if player.get("job") != "Escriba":
            await message.channel.send("ğŸ“š Os arquivos do Escriba sÃ£o restritos Ã  profissÃ£o!\nUse `procurar emprego`.")
            return
        job_level, _ = _get_job_level(player, "Escriba")
        arquivos = [
            ("ğŸ“œ A Profecia dos Sete Selos", "Quando o sÃ©timo herÃ³i quebrar o sÃ©timo selo, o mundo nÃ£o terminarÃ¡ â€” comeÃ§arÃ¡. O que vem depois Ã© o que os deuses tÃªm medo de nomear."),
            ("ğŸ—ºï¸ O Mapa do Fim do Mundo", "Existe um local marcado em todos os mapas antigos como 'Aqui Os DragÃµes Terminam'. Nenhum cartÃ³grafo que foi atÃ© lÃ¡ voltou. Os que quase chegaram descreveram uma porta. A porta estava aberta."),
            ("ğŸ“– DiÃ¡rio do Primeiro Aventureiro", "Dia 1: SaÃ­ da aldeia. Dia 47: Encontrei algo que nÃ£o devia existir. Dia 48: [pÃ¡gina rasgada]. Dia 302: Estou de volta. Mas a aldeia... a aldeia sumiu."),
            ("ğŸ” O Arquivo dos Nomes Verdadeiros", "Todo ser tem um nome verdadeiro. Pronunciar o nome verdadeiro de algo lhe dÃ¡ poder absoluto sobre ele. Esta lista contÃ©m os nomes verdadeiros de 12 entidades. Onze foram riscados. O dÃ©cimo segundo estÃ¡ sublinhado trÃªs vezes com uma nota: 'NUNCA'."),
            ("âš”ï¸ CrÃ´nicas da Guerra Esquecida", "Houve uma guerra antes da HistÃ³ria. TÃ£o devastadora que os vencedores apagaram qualquer registro â€” inclusive de si mesmos. O que vocÃª estÃ¡ lendo sÃ£o fragmentos que sobreviveram ao apagamento. Isso significa que algo nÃ£o quis que fossem destruÃ­dos."),
        ]
        if job_level >= 3:
            arquivos += [
                ("â˜ ï¸ O Texto Proibido de Valdis", "Este texto foi proibido nÃ£o por ser perigoso, mas por ser preciso. Ele descreve em detalhes a natureza dos deuses: o que eles sÃ£o, o que eles temem, e como terminam. Ler atÃ© o fim Ã© uma escolha irreversÃ­vel."),
            ]
        entry = random.choice(arquivos)
        embed = discord.Embed(
            title=f"ğŸ“š Arquivo Secreto â€” {entry[0]}",
            description=entry[1],
            color=discord.Color.dark_teal()
        )
        embed.set_footer(text=f"Escriba nÃ­vel {job_level}/3 | Arquivo aleatÃ³rio a cada leitura | Use 'crÃ´nica' para registrar suas descobertas")
        await message.channel.send(embed=embed)
        return

    # ============================
    # ESCRIBA: ver biblioteca (crÃ´nicas)
    # ============================
    if content_lower in ["ver biblioteca", "minhas cronicas", "minhas crÃ´nicas", "ver cronicas"]:
        player = get_player(uid)
        if not player:
            return
        if player.get("job") != "Escriba":
            await message.channel.send("ğŸ“š Apenas **Escribas** tÃªm biblioteca!\nUse `procurar emprego`.")
            return
        cronicas = player.get("cronicas", [])
        scrolls = [i for i in player.get("inventory", []) if isinstance(i, dict) and i.get("type") == "scroll"]
        npc_records = player.get("npc_records", [])
        books = player.get("stored_books", [])
        embed = discord.Embed(
            title=f"ğŸ“š Biblioteca de {message.author.display_name}",
            description="*O conhecimento acumulado ao longo da sua jornada.*",
            color=discord.Color.dark_teal()
        )
        if cronicas:
            last = cronicas[-1]
            embed.add_field(
                name=f"ğŸ“œ Ãšltima CrÃ´nica ({len(cronicas)} total)",
                value=f"*\"{last['texto'][:200]}{'...' if len(last['texto'])>200 else ''}\"*",
                inline=False
            )
        else:
            embed.add_field(name="ğŸ“œ CrÃ´nicas", value="*Nenhuma crÃ´nica registrada ainda. Use `crÃ´nica [texto]`.*", inline=False)
        embed.add_field(name="ğŸ“œ Pergaminhos", value=f"`{len(scrolls)}` no inventÃ¡rio", inline=True)
        embed.add_field(name="ğŸ‘¥ NPCs Registrados", value=f"`{len(npc_records)}`", inline=True)
        embed.add_field(name="ğŸ“– Livros Armazenados", value=f"`{len(books)}`", inline=True)
        embed.set_footer(text="Use 'crÃ´nica [texto]' | 'coletar pergaminho' | 'registrar npc' | 'armazenar livro'")
        await message.channel.send(embed=embed)
        return

    # ============================
    # CAVALEIRO: patrulhar
    # ============================
    if content_lower in ["patrulhar", "fazer patrulha", "ronda"]:
        player = get_player(uid)
        if not player:
            return
        if player.get("job") not in ["Cavaleiro", "Guarda_Real"]:
            await message.channel.send("âš”ï¸ Apenas **Cavaleiros** e **Guardas Reais** podem patrulhar!\nUse `procurar emprego`.")
            return
        last_patrol = player.get("last_patrol", 0)
        now = time.time()
        if now - last_patrol < 1200:
            rest = int(1200 - (now - last_patrol))
            await message.channel.send(f"ğŸ›¡ï¸ VocÃª acabou de terminar uma patrulha. PrÃ³xima em **{rest//60}m {rest%60}s**.")
            return
        job = player.get("job")
        job_level, lvl_data = _get_job_level(player, job)
        xp_gain = random.randint(150, 400) * job_level
        coins_gain = random.randint(30, 80) * job_level
        # Chance de encontrar invasor
        encontrou_invasor = random.random() < 0.25
        player["last_patrol"] = now
        save_player_db(uid, player)
        add_coins(uid, coins_gain)
        leveled = add_xp(uid, xp_gain)
        msgs_patrol = [
            "ğŸ—¡ï¸ VocÃª percorre cada rua e beco do reino. Tudo em paz â€” por enquanto.",
            "âš”ï¸ Uma luta no mercado Ã© encerrada com sua simples presenÃ§a. Respeito merecido.",
            "ğŸ›¡ï¸ VocÃª escolta um mercador vulnerÃ¡vel atÃ© o portÃ£o da cidade. Ele agradece emocionado.",
            "ğŸ° A patrulha noturna revela uma brecha no muro sul. VocÃª organiza o reparo.",
            "ğŸ‘ï¸ Algo estranho nas sombras do beco 7. Investigado. Nada encontrado. Por ora.",
        ]
        embed = discord.Embed(
            title=f"{'âš”ï¸' if job == 'Cavaleiro' else 'ğŸ›¡ï¸'} Patrulha ConcluÃ­da",
            description=random.choice(msgs_patrol),
            color=discord.Color.blue()
        )
        embed.add_field(name="â­ XP", value=f"`+{xp_gain}`", inline=True)
        embed.add_field(name="ğŸ’° Coins", value=f"`+{coins_gain}`", inline=True)
        if encontrou_invasor:
            invasor_dano = random.randint(10, 30)
            player["hp"] = max(1, player.get("hp", 100) - invasor_dano)
            xp_extra = random.randint(100, 250)
            save_player_db(uid, player)
            add_xp(uid, xp_extra)
            embed.add_field(
                name="âš ï¸ INVASOR ENCONTRADO!",
                value=f"VocÃª encontrou e combateu um invasor!\n`-{invasor_dano} HP` sofrido | `+{xp_extra} XP` extra de combate",
                inline=False
            )
        if leveled:
            p2 = get_player(uid)
            embed.add_field(name="ğŸ†™ Level Up!", value=f"NÃ­vel **{p2['level']}**!", inline=False)
        embed.set_footer(text=f"{lvl_data.get('name', job)} nÃ­vel {job_level}/3 | PrÃ³xima patrulha em 20 min | Use 'defender cidade' para invasÃµes")
        await message.channel.send(embed=embed)
        return

    # ============================
    # GUARDA REAL: defender reino
    # ============================
    if content_lower in ["defender reino", "modo defesa", "guardar reino"]:
        player = get_player(uid)
        if not player:
            return
        if player.get("job") != "Guarda_Real":
            await message.channel.send("ğŸ›¡ï¸ Apenas **Guardas Reais** podem ativar o modo de defesa do reino!\nUse `procurar emprego`.")
            return
        last_defend_reino = player.get("last_defend_reino", 0)
        now = time.time()
        if now - last_defend_reino < 3600:
            rest = int(3600 - (now - last_defend_reino))
            await message.channel.send(f"ğŸ›¡ï¸ VocÃª ainda estÃ¡ em posiÃ§Ã£o de guarda. PrÃ³xima defesa em **{rest//60}m {rest%60}s**.")
            return
        job_level, lvl_data = _get_job_level(player, "Guarda_Real")
        player["last_defend_reino"] = now
        dano_recebido = random.randint(5, 20) * (3 - job_level + 1)
        player["hp"] = max(1, player.get("hp", 100) - dano_recebido)
        xp_gain = random.randint(300, 700) * job_level
        coins_gain = random.randint(60, 130) * job_level
        save_player_db(uid, player)
        add_coins(uid, coins_gain)
        leveled = add_xp(uid, xp_gain)
        ameacas = [
            ("ğŸ—¡ï¸ Assassino Real", "Um assassino tentou chegar ao trono. VocÃª o interceptou no corredor das sombras."),
            ("ğŸ’£ EspiÃ£o Infiltrado", "Uma espiÃ£ disfarÃ§ada de serva foi detectada pelo seu instinto aguÃ§ado."),
            ("âš”ï¸ Ataque Surpresa", "Um ataque surpresa na madrugada foi repelido sob seu comando direto."),
            ("ğŸ”® Mago Renegado", "Um mago renegado tentou lanÃ§ar um feitiÃ§o no salÃ£o do trono. Neutralizado."),
            ("ğŸ¹ Arqueiro na Torre", "Um arqueiro estava posicionado na torre norte. VocÃª chegou antes da flecha."),
        ]
        ameaca = random.choice(ameacas)
        embed = discord.Embed(
            title=f"ğŸ›¡ï¸ Defesa do Reino â€” {ameaca[0]}",
            description=ameaca[1],
            color=discord.Color.dark_blue()
        )
        embed.add_field(name="â­ XP", value=f"`+{xp_gain}`", inline=True)
        embed.add_field(name="ğŸ’° Coins", value=f"`+{coins_gain}`", inline=True)
        embed.add_field(name="ğŸ’” Dano sofrido", value=f"`-{dano_recebido} HP`", inline=True)
        embed.add_field(name="â¤ï¸ HP atual", value=f"`{player['hp']}/{player['max_hp']}`", inline=True)
        if leveled:
            p2 = get_player(uid)
            embed.add_field(name="ğŸ†™ Level Up!", value=f"NÃ­vel **{p2['level']}**!", inline=False)
        embed.set_footer(text=f"{lvl_data.get('name','Guarda Real')} nÃ­vel {job_level}/3 | PrÃ³xima defesa em 1 hora")
        await message.channel.send(embed=embed)
        return

    # ============================
    # REI: governar
    # ============================
    if content_lower in ["governar", "governar reino", "tomar decisÃ£o", "tomar decisao"]:
        player = get_player(uid)
        if not player:
            return
        if player.get("job") != "Rei":
            await message.channel.send("ğŸ‘‘ Apenas **Reis** podem governar!\nUse `me tornar rei` para assumir o trono (nÃ­vel 30+).")
            return
        last_gov = player.get("last_governar", 0)
        now = time.time()
        if now - last_gov < 7200:
            rest = int(7200 - (now - last_gov))
            await message.channel.send(f"ğŸ‘‘ VocÃª jÃ¡ governou recentemente. PrÃ³ximas decisÃµes em **{rest//60}m {rest%60}s**.")
            return
        decisoes = [
            {
                "titulo": "ğŸ“Š Crise EconÃ´mica",
                "desc": "O tesouro estÃ¡ baixo. Como decidir?",
                "opcoes": [
                    ("Aumentar impostos (+coins, -popularidade)", 150, 50, -5),
                    ("Cortar gastos (+pequeno coins, +-)", 60, 100, 0),
                    ("Abrir rotas de comÃ©rcio (-tempo, +muito coins)", 200, 200, 5),
                ]
            },
            {
                "titulo": "âš”ï¸ Conflito nas Fronteiras",
                "desc": "Uma tribo vizinha ameaÃ§a a fronteira.",
                "opcoes": [
                    ("Enviar diplomatas (chance paz, +alinhamento)", 0, 150, 10),
                    ("ReforÃ§ar defesas (+DEF, -coins)", -80, 120, 2),
                    ("Ataque preventivo (-alinhamento, +XP)", 0, 300, -8),
                ]
            },
            {
                "titulo": "ğŸŒ¾ Colheita Escassa",
                "desc": "O povo passa fome. Suas reservas estÃ£o baixas.",
                "opcoes": [
                    ("Distribuir reservas reais (-coins, +popularidade)", -100, 80, 8),
                    ("Importar alimentos (-muitos coins, +estabilidade)", -200, 50, 3),
                    ("Ignorar e esperar (nada, -alinhamento)", 0, 30, -10),
                ]
            },
        ]
        decisao = random.choice(decisoes)
        opcao_escolhida = random.choice(decisao["opcoes"])
        coins_delta, xp_gain, align_delta = opcao_escolhida[1], opcao_escolhida[2], opcao_escolhida[3]
        player["last_governar"] = now
        ap = player.get("alignment_points", 0) + align_delta
        player["alignment_points"] = max(-100, min(100, ap))
        save_player_db(uid, player)
        if coins_delta > 0:
            add_coins(uid, coins_delta)
        elif coins_delta < 0:
            player["coins"] = max(0, player.get("coins", 0) + coins_delta)
            save_player_db(uid, player)
        leveled = add_xp(uid, xp_gain)
        job_level, lvl_data = _get_job_level(player, "Rei")
        embed = discord.Embed(
            title=f"ğŸ‘‘ DecisÃ£o Real â€” {decisao['titulo']}",
            description=f"*{decisao['desc']}*\n\n**DecisÃ£o tomada:** {opcao_escolhida[0]}",
            color=discord.Color.gold()
        )
        if coins_delta != 0:
            embed.add_field(name="ğŸ’° Tesouro", value=f"`{'+' if coins_delta>0 else ''}{coins_delta}` coins", inline=True)
        embed.add_field(name="â­ XP", value=f"`+{xp_gain}`", inline=True)
        embed.add_field(name="âš–ï¸ Alinhamento", value=f"`{'+' if align_delta>=0 else ''}{align_delta}`", inline=True)
        if leveled:
            p2 = get_player(uid)
            embed.add_field(name="ğŸ†™ Level Up!", value=f"NÃ­vel **{p2['level']}**!", inline=False)
        embed.set_footer(text=f"{lvl_data.get('name','Rei')} | PrÃ³ximas decisÃµes em 2 horas | Use 'decretar lei' para efeitos especiais")
        await message.channel.send(embed=embed)
        return

    # ============================
    # REI: decretar lei
    # ============================
    if content_lower.startswith("decretar lei ") or content_lower.startswith("decretar "):
        player = get_player(uid)
        if not player:
            return
        if player.get("job") != "Rei":
            await message.channel.send("ğŸ‘‘ Apenas **Reis** podem decretar leis!\nUse `me tornar rei` (nÃ­vel 30+).")
            return
        lei = content[13:].strip() if content_lower.startswith("decretar lei ") else content[9:].strip()
        if not lei:
            await message.channel.send(
                "ğŸ‘‘ **Decretar Lei**\n\n"
                "**Uso:** `decretar lei [nome da lei]`\n"
                "**Exemplo:** `decretar lei Todos os monstros pagam pedÃ¡gio`\n\n"
                "*Seu decreto terÃ¡ um efeito especial no reino!*"
            )
            return
        last_decree = player.get("last_decree", 0)
        now = time.time()
        if now - last_decree < 14400:
            rest = int(14400 - (now - last_decree))
            await message.channel.send(f"ğŸ“œ Seu Ãºltimo decreto ainda estÃ¡ em vigor. PrÃ³ximo em **{rest//60}m {rest%60}s**.")
            return
        job_level, _ = _get_job_level(player, "Rei")
        efeitos = [
            ("ğŸ›¡ï¸ ProteÃ§Ã£o ReforÃ§ada", "Todo o reino recebe +10% DEF por 2 horas", "def_boost", 0.10),
            ("ğŸ’° Incentivo EconÃ´mico", "+15% coins em trabalhos por 2 horas", "coin_boost", 0.15),
            ("â­ Decreto de Treinamento", "+20% XP ganho por 2 horas", "xp_boost", 0.20),
            ("ğŸŒ¿ Lei da Colheita", "+30% recursos coletados por 2 horas", "resource_boost", 0.30),
        ]
        efeito = random.choice(efeitos)
        player["last_decree"] = now
        player["active_effects"] = player.get("active_effects", {})
        player["active_effects"][efeito[2]] = {"value": efeito[3], "expires": int(now) + 7200}
        save_player_db(uid, player)
        embed = discord.Embed(
            title=f"ğŸ“œ DECRETO REAL â€” *\"{lei}\"*",
            description=f"*O arauto anuncia seu decreto pelas ruas do reino...*",
            color=discord.Color.gold()
        )
        embed.add_field(name="âš–ï¸ Lei Decretada", value=f"*\"{lei}\"*", inline=False)
        embed.add_field(name=f"{efeito[0]}", value=efeito[1], inline=False)
        embed.add_field(name="â³ DuraÃ§Ã£o", value="`2 horas`", inline=True)
        embed.add_field(name="ğŸ‘‘ NÃ­vel Real", value=f"`{job_level}/3`", inline=True)
        embed.set_footer(text="PrÃ³ximo decreto em 4 horas | Use 'governar' para tomar decisÃµes")
        await message.channel.send(embed=embed)
        return

    # ============================
    # REI: nomear cavaleiro @user
    # ============================
    if content_lower.startswith("nomear cavaleiro"):
        player = get_player(uid)
        if not player:
            return
        if player.get("job") != "Rei":
            await message.channel.send("ğŸ‘‘ Apenas **Reis** podem nomear cavaleiros!\nUse `me tornar rei` (nÃ­vel 30+).")
            return
        if not message.mentions:
            await message.channel.send(
                "ğŸ‘‘ **Nomear Cavaleiro**\n\n"
                "**Uso:** `nomear cavaleiro @jogador`\n"
                "**Exemplo:** `nomear cavaleiro @Sr.Reality`\n\n"
                "*Concede o tÃ­tulo de Cavaleiro do Reino ao jogador escolhido.*"
            )
            return
        target = message.mentions[0]
        if target.id == message.author.id:
            await message.channel.send("ğŸ‘‘ Um rei nÃ£o pode se nomear cavaleiro!")
            return
        target_player = get_player(str(target.id))
        if not target_player:
            await message.channel.send(f"âŒ **{target.display_name}** nÃ£o tem personagem criado.")
            return
        knights = player.get("knights", [])
        if str(target.id) in knights:
            await message.channel.send(f"âš”ï¸ **{target.display_name}** jÃ¡ Ã© cavaleiro do seu reino!")
            return
        if len(knights) >= 5:
            await message.channel.send("ğŸ‘‘ VocÃª jÃ¡ tem 5 cavaleiros. MÃ¡ximo atingido!")
            return
        knights.append(str(target.id))
        player["knights"] = knights
        save_player_db(uid, player)
        target_player["city_title"] = f"Cavaleiro de {message.author.display_name}"
        target_player["hp"] = min(target_player["max_hp"], target_player.get("hp", 100) + 30)
        save_player_db(str(target.id), target_player)
        embed = discord.Embed(
            title="âš”ï¸ NOMEAÃ‡ÃƒO REAL!",
            description=(
                f"*'Ajoelhe-se, {target.display_name}. Levante-se, Cavaleiro do Reino!'*\n\n"
                f"Pelo poder real de **{message.author.display_name}**, "
                f"**{target.display_name}** Ã© agora **Cavaleiro do Reino**!"
            ),
            color=discord.Color.gold()
        )
        embed.add_field(name="ğŸ… TÃ­tulo Concedido", value=f"`Cavaleiro de {message.author.display_name}`", inline=True)
        embed.add_field(name="â¤ï¸ HP BÃ´nus", value="`+30 HP` pela honra", inline=True)
        embed.add_field(name="âš”ï¸ Cavaleiros do Reino", value=f"`{len(knights)}/5`", inline=True)
        await message.channel.send(embed=embed)
        return


# ================= RUN BOT =================
bot.run(TOKEN)
